var mr=Object.defineProperty;var gr=(s,e,t)=>e in s?mr(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var st=(s,e,t)=>(gr(s,typeof e!="symbol"?e+"":e,t),t),Kt=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var x=(s,e,t)=>(Kt(s,e,"read from private field"),t?t.call(s):e.get(s)),se=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},Ae=(s,e,t,n)=>(Kt(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t);var _t=(s,e,t,n)=>({set _(r){Ae(s,e,r,t)},get _(){return x(s,e,n)}}),le=(s,e,t)=>(Kt(s,e,"access private method"),t);import{_ as _imports_0$1}from"./chevron-back-outline-221160d9.js";import{d as defineComponent,r as ref,c as onMounted,K as Capacitor,h as createElementBlock,s as openBlock,L as useMediaQuery,b as useLocalStorage,G as computed,M as readonly,g as getAllBookMetaData,N as onUpdated,j as unref,k as createBlock,l as isRef,O as normalizeClass,m as createCommentVNode,y as pushScopeId,z as popScopeId,i as createBaseVNode,E as _export_sfc,u as useRouter,e as getSongMetaData,P as onUnmounted,t as toDisplayString,F as Fragment,C as _imports_2,p as renderList,q as createVNode,Q as _imports_2$1}from"./index-4d0be3dc.js";import{_ as _imports_3}from"./bookmark-64fd0918.js";import{_ as _imports_0}from"./wifi_off-856a1c9a.js";import{g as getDefaultExportFromCjs,a as getAugmentedNamespace,c as commonjsGlobal,v as validate_token,s as set,r as request_client}from"./broadcast-693787bd.js";import{T as Toast}from"./index-ec31f543.js";import{u as useCapacitorPreferences}from"./preferences-223d7d1b.js";const _imports_1="/acchymns-pr-PR_kwDOHpETuc5yaKFf/assets/musical-notes-outline.svg",_imports_5="/acchymns-pr-PR_kwDOHpETuc5yaKFf/assets/radio-outline.svg";var wheel$1={exports:{}};wheel$1.exports=addWheelListener;wheel$1.exports.addWheelListener=addWheelListener;wheel$1.exports.removeWheelListener=removeWheelListener;function addWheelListener(s,e,t){s.addEventListener("wheel",e,t)}function removeWheelListener(s,e,t){s.removeEventListener("wheel",e,t)}var wheelExports=wheel$1.exports,amator={exports:{}},NEWTON_ITERATIONS=4,NEWTON_MIN_SLOPE=.001,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1),float32ArraySupported=typeof Float32Array=="function";function A(s,e){return 1-3*e+3*s}function B(s,e){return 3*e-6*s}function C(s){return 3*s}function calcBezier(s,e,t){return((A(e,t)*s+B(e,t))*s+C(e))*s}function getSlope(s,e,t){return 3*A(e,t)*s*s+2*B(e,t)*s+C(e)}function binarySubdivide(s,e,t,n,r){var i,o,a=0;do o=e+(t-e)/2,i=calcBezier(o,n,r)-s,i>0?t=o:e=o;while(Math.abs(i)>SUBDIVISION_PRECISION&&++a<SUBDIVISION_MAX_ITERATIONS);return o}function newtonRaphsonIterate(s,e,t,n){for(var r=0;r<NEWTON_ITERATIONS;++r){var i=getSlope(e,t,n);if(i===0)return e;var o=calcBezier(e,t,n)-s;e-=o/i}return e}function LinearEasing(s){return s}var src=function(e,t,n,r){if(!(0<=e&&e<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&n===r)return LinearEasing;for(var i=float32ArraySupported?new Float32Array(kSplineTableSize):new Array(kSplineTableSize),o=0;o<kSplineTableSize;++o)i[o]=calcBezier(o*kSampleStepSize,e,n);function a(c){for(var l=0,u=1,p=kSplineTableSize-1;u!==p&&i[u]<=c;++u)l+=kSampleStepSize;--u;var g=(c-i[u])/(i[u+1]-i[u]),y=l+g*kSampleStepSize,h=getSlope(y,e,n);return h>=NEWTON_MIN_SLOPE?newtonRaphsonIterate(c,y,e,n):h===0?y:binarySubdivide(c,l,l+kSampleStepSize,e,n)}return function(l){return l===0?0:l===1?1:calcBezier(a(l),t,r)}},BezierEasing=src,animations={ease:BezierEasing(.25,.1,.25,1),easeIn:BezierEasing(.42,0,1,1),easeOut:BezierEasing(0,0,.58,1),easeInOut:BezierEasing(.42,0,.58,1),linear:BezierEasing(0,0,1,1)};amator.exports=animate$1;amator.exports.makeAggregateRaf=makeAggregateRaf;amator.exports.sharedScheduler=makeAggregateRaf();function animate$1(s,e,t){var n=Object.create(null),r=Object.create(null);t=t||{};var i=typeof t.easing=="function"?t.easing:animations[t.easing];i||(t.easing&&console.warn("Unknown easing function in amator: "+t.easing),i=animations.ease);var o=typeof t.step=="function"?t.step:noop$2,a=typeof t.done=="function"?t.done:noop$2,c=getScheduler(t.scheduler),l=Object.keys(e);l.forEach(function(v){n[v]=s[v],r[v]=e[v]-s[v]});var u=typeof t.duration=="number"?t.duration:400,p=Math.max(1,u*.06),g,y=0;return g=c.next(f),{cancel:h};function h(){c.cancel(g),g=0}function f(){var v=i(y/p);y+=1,d(v),y<=p?(g=c.next(f),o(s)):(g=0,setTimeout(function(){a(s)},0))}function d(v){l.forEach(function(E){s[E]=r[E]*v+n[E]})}}function noop$2(){}function getScheduler(s){if(!s){var e=typeof window<"u"&&window.requestAnimationFrame;return e?rafScheduler():timeoutScheduler()}if(typeof s.next!="function")throw new Error("Scheduler is supposed to have next(cb) function");if(typeof s.cancel!="function")throw new Error("Scheduler is supposed to have cancel(handle) function");return s}function rafScheduler(){return{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}}function timeoutScheduler(){return{next:function(s){return setTimeout(s,1e3/60)},cancel:function(s){return clearTimeout(s)}}}function makeAggregateRaf(){var s=new Set,e=new Set,t=0;return{next:r,cancel:r,clearAll:n};function n(){s.clear(),e.clear(),cancelAnimationFrame(t),t=0}function r(a){e.add(a),i()}function i(){t||(t=requestAnimationFrame(o))}function o(){t=0;var a=e;e=s,s=a,s.forEach(function(c){c()}),s.clear()}}var amatorExports=amator.exports,ngraph_events=function(e){validateSubject(e);var t=createEventsStorage(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e};function createEventsStorage(s){var e=Object.create(null);return{on:function(t,n,r){if(typeof n!="function")throw new Error("callback is expected to be a function");var i=e[t];return i||(i=e[t]=[]),i.push({callback:n,ctx:r}),s},off:function(t,n){var r=typeof t>"u";if(r)return e=Object.create(null),s;if(e[t]){var i=typeof n!="function";if(i)delete e[t];else for(var o=e[t],a=0;a<o.length;++a)o[a].callback===n&&o.splice(a,1)}return s},fire:function(t){var n=e[t];if(!n)return s;var r;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var i=0;i<n.length;++i){var o=n[i];o.callback.apply(o.ctx,r)}return s}}}function validateSubject(s){if(!s)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],t=0;t<e.length;++t)if(s.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}var kinetic_1=kinetic$1;function kinetic$1(s,e,t){typeof t!="object"&&(t={});var n=typeof t.minVelocity=="number"?t.minVelocity:5,r=typeof t.amplitude=="number"?t.amplitude:.25,i=typeof t.cancelAnimationFrame=="function"?t.cancelAnimationFrame:getCancelAnimationFrame(),o=typeof t.requestAnimationFrame=="function"?t.requestAnimationFrame:getRequestAnimationFrame(),a,c,l=342,u,p,g,y,h,f,d,v;return{start:O,stop:m,cancel:E};function E(){i(u),i(v)}function O(){a=s(),y=d=p=h=0,c=new Date,i(u),i(v),u=o(N)}function N(){var k=Date.now(),T=k-c;c=k;var S=s(),F=S.x-a.x,P=S.y-a.y;a=S;var G=1e3/(1+T);p=.8*F*G+.2*p,h=.8*P*G+.2*h,u=o(N)}function m(){i(u),i(v);var k=s();g=k.x,f=k.y,c=Date.now(),(p<-n||p>n)&&(y=r*p,g+=y),(h<-n||h>n)&&(d=r*h,f+=d),v=o(b)}function b(){var k=Date.now()-c,T=!1,S=0,F=0;y&&(S=-y*Math.exp(-k/l),S>.5||S<-.5?T=!0:S=y=0),d&&(F=-d*Math.exp(-k/l),F>.5||F<-.5?T=!0:F=d=0),T&&(e(g+S,f+F),v=o(b))}}function getCancelAnimationFrame(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function getRequestAnimationFrame(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(s){return setTimeout(s,16)}}var createTextSelectionInterceptor_1=createTextSelectionInterceptor$1;function createTextSelectionInterceptor$1(s){if(s)return{capture:noop$1,release:noop$1};var e,t,n,r=!1;return{capture:i,release:o};function i(a){r=!0,t=window.document.onselectstart,n=window.document.ondragstart,window.document.onselectstart=disabled,e=a,e.ondragstart=disabled}function o(){r&&(r=!1,window.document.onselectstart=t,e&&(e.ondragstart=n))}}function disabled(s){return s.stopPropagation(),!1}function noop$1(){}var transform,hasRequiredTransform;function requireTransform(){if(hasRequiredTransform)return transform;hasRequiredTransform=1,transform=s;function s(){this.x=0,this.y=0,this.scale=1}return transform}var svgController={exports:{}},hasRequiredSvgController;function requireSvgController(){if(hasRequiredSvgController)return svgController.exports;hasRequiredSvgController=1,svgController.exports=s,svgController.exports.canAttach=e;function s(t,n){if(!e(t))throw new Error("svg element is required for svg.panzoom to work");var r=t.ownerSVGElement;if(!r)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");n.disableKeyboardInteraction||r.setAttribute("tabindex",0);var i={getBBox:a,getScreenCTM:c,getOwner:o,applyTransform:u,initTransform:l};return i;function o(){return r}function a(){var p=t.getBBox();return{left:p.x,top:p.y,width:p.width,height:p.height}}function c(){var p=r.getCTM();return p||r.getScreenCTM()}function l(p){var g=t.getCTM();g===null&&(g=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),p.x=g.e,p.y=g.f,p.scale=g.a,r.removeAttributeNS(null,"viewBox")}function u(p){t.setAttribute("transform","matrix("+p.scale+" 0 0 "+p.scale+" "+p.x+" "+p.y+")")}}function e(t){return t&&t.ownerSVGElement&&t.getCTM}return svgController.exports}var domController={exports:{}},hasRequiredDomController;function requireDomController(){if(hasRequiredDomController)return domController.exports;hasRequiredDomController=1,domController.exports=s,domController.exports.canAttach=e;function s(t,n){var r=e(t);if(!r)throw new Error("panzoom requires DOM element to be attached to the DOM tree");var i=t.parentElement;t.scrollTop=0,n.disableKeyboardInteraction||i.setAttribute("tabindex",0);var o={getBBox:c,getOwner:a,applyTransform:l};return o;function a(){return i}function c(){return{left:0,top:0,width:t.clientWidth,height:t.clientHeight}}function l(u){t.style.transformOrigin="0 0 0",t.style.transform="matrix("+u.scale+", 0, 0, "+u.scale+", "+u.x+", "+u.y+")"}}function e(t){return t&&t.parentElement&&t.style}return domController.exports}var wheel=wheelExports,animate=amatorExports,eventify=ngraph_events,kinetic=kinetic_1,createTextSelectionInterceptor=createTextSelectionInterceptor_1,domTextSelectionInterceptor=createTextSelectionInterceptor(),fakeTextSelectorInterceptor=createTextSelectionInterceptor(!0),Transform=requireTransform(),makeSvgController=requireSvgController(),makeDomController=requireDomController(),defaultZoomSpeed=1,defaultDoubleTapZoomSpeed=1.75,doubleTapSpeedInMS=300,clickEventTimeInMS=200,panzoom=createPanZoom,initialWidth=0,initialHeight=0;function createPanZoom(s,e){initialWidth=s.offsetWidth,initialHeight=s.offsetHeight,e=e||{};var t=e.controller;if(t||(makeSvgController.canAttach(s)?t=makeSvgController(s,e):makeDomController.canAttach(s)&&(t=makeDomController(s,e))),!t)throw new Error("Cannot create panzoom for the current type of dom element");var n=t.getOwner(),r={x:0,y:0},i=!1,o=new Transform;t.initTransform&&t.initTransform(o);var a=typeof e.filterKey=="function"?e.filterKey:noop,c=typeof e.pinchSpeed=="number"?e.pinchSpeed:1,l=e.bounds,u=typeof e.maxZoom=="number"?e.maxZoom:Number.POSITIVE_INFINITY,p=typeof e.minZoom=="number"?e.minZoom:0,g=typeof e.boundsPadding=="number"?e.boundsPadding:.05,y=typeof e.zoomDoubleClickSpeed=="number"?e.zoomDoubleClickSpeed:defaultDoubleTapZoomSpeed,h=e.beforeWheel||noop,f=e.beforeMouseDown||noop,d=typeof e.zoomSpeed=="number"?e.zoomSpeed:defaultZoomSpeed,v=parseTransformOrigin(e.transformOrigin),E=e.enableTextSelection?fakeTextSelectorInterceptor:domTextSelectionInterceptor;validateBounds(l),e.autocenter&&Ne();var O,N=0,m=0,b=0,k=null,T=new Date,S,F=!1,P=!0,G=!0,j=!1,L,K,Q,ne,D,$;"smoothScroll"in e&&!e.smoothScroll?$=rigidScroll():$=kinetic(Ge,nt,e.smoothScroll);var J,re,pe,U=!1;te();var w={dispose:ge,moveBy:Be,moveTo:Ye,smoothMoveTo:Ue,centerOn:oe,zoomTo:yt,zoomAbs:ue,smoothZoom:lt,smoothZoomAbs:ht,showRectangle:ie,pause:W,resume:ee,isPaused:ye,getTransform:Fe,getMinZoom:Le,setMinZoom:ke,getMaxZoom:ze,setMaxZoom:Oe,setVerticalPan:he,setHorizontalPan:me,getInitWidth:Y,getInitHeight:M,getTransformOrigin:be,setTransformOrigin:fe,getZoomSpeed:Ce,setZoomSpeed:Me};eventify(w);var _=typeof e.initialX=="number"?e.initialX:o.x,R=typeof e.initialY=="number"?e.initialY:o.y,V=typeof e.initialZoom=="number"?e.initialZoom:o.scale;return(_!=o.x||R!=o.y||V!=o.scale)&&ue(_,R,V),w;function M(){return initialHeight}function Y(){return initialWidth}function W(){Te(),U=!0}function ee(){U&&(te(),U=!1)}function me(xe){P=xe}function he(xe){G=xe}function ye(){return U}function ie(xe){var $e=n.getBoundingClientRect(),Xe=ve($e.width,$e.height),Ke=xe.right-xe.left,rt=xe.bottom-xe.top;if(!Number.isFinite(Ke)||!Number.isFinite(rt))throw new Error("Invalid rectangle");var ot=Xe.x/Ke,at=Xe.y/rt,ut=Math.min(ot,at);o.x=-(xe.left+Ke/2)*ut+Xe.x/2,o.y=-(xe.top+rt/2)*ut+Xe.y/2,o.scale=ut}function ve(xe,$e){if(t.getScreenCTM){var Xe=t.getScreenCTM(),Ke=Xe.a,rt=Xe.d,ot=Xe.e,at=Xe.f;r.x=xe*Ke-ot,r.y=$e*rt-at}else r.x=xe,r.y=$e;return r}function Ne(){var xe,$e,Xe=0,Ke=0,rt=We();if(rt)Xe=rt.left,Ke=rt.top,xe=rt.right-rt.left,$e=rt.bottom-rt.top;else{var ot=n.getBoundingClientRect();xe=ot.width,$e=ot.height}var at=t.getBBox();if(!(at.width===0||at.height===0)){var ut=$e/at.height,bt=xe/at.width,gt=Math.min(bt,ut);o.x=-(at.left+at.width/2)*gt+xe/2+Xe,o.y=-(at.top+at.height/2)*gt+$e/2+Ke,o.scale=gt}}function Fe(){return o}function Le(){return p}function ke(xe){p=xe}function ze(){return u}function Oe(xe){u=xe}function be(){return v}function fe(xe){v=parseTransformOrigin(xe)}function Ce(){return d}function Me(xe){if(!Number.isFinite(xe))throw new Error("Zoom speed should be a number");d=xe}function Ge(){return{x:o.x,y:o.y}}function Ye(xe,$e){o.x=xe,o.y=$e,Ve(),At("pan"),Qe()}function je(xe,$e){Ye(P?o.x+xe:o.x,G?o.y+$e:o.y)}function Ve(){var xe=We();if(xe){var $e=!1,Xe=qe(),Ke=xe.left-Xe.right;return Ke>0&&(o.x+=Ke,$e=!0),Ke=xe.right-Xe.left,Ke<0&&(o.x+=Ke,$e=!0),G&&(Ke=xe.top-Xe.bottom,Ke>0&&(o.y+=Ke,$e=!0),Ke=xe.bottom-Xe.top,Ke<0&&(o.y+=Ke,$e=!0)),$e}}function We(){if(l){if(typeof l=="boolean"){var xe=n.getBoundingClientRect(),$e=xe.width,Xe=xe.height;return{left:$e*g,top:Xe*g,right:$e*(1-g),bottom:Xe*(1-g)}}return l}}function qe(){var xe=t.getBBox(),$e=Ze(xe.left,xe.top);return{left:$e.x,top:$e.y,right:xe.width*o.scale+$e.x,bottom:xe.height*o.scale+$e.y}}function Ze(xe,$e){return{x:xe*o.scale+o.x,y:$e*o.scale+o.y}}function Qe(){i=!0,O=window.requestAnimationFrame(Ie)}function Ee(xe,$e,Xe){if(isNaN$1(xe)||isNaN$1($e)||isNaN$1(Xe))throw new Error("zoom requires valid numbers");var Ke=o.scale*Xe;if(Ke<p){if(o.scale===p)return;Xe=p/o.scale}if(Ke>u){if(o.scale===u)return;Xe=u/o.scale}var rt=ve(xe,$e);if(o.x=rt.x-Xe*(rt.x-o.x),o.y=rt.y-Xe*(rt.y-o.y),l&&g===1&&p===1)o.scale*=Xe,Ve();else{var ot=Ve();ot||(o.scale*=Xe)}At("zoom"),Qe()}function ue(xe,$e,Xe){var Ke=Xe/o.scale;Ee(xe,$e,Ke)}function oe(xe){var $e=xe.ownerSVGElement;if(!$e)throw new Error("ui element is required to be within the scene");var Xe=xe.getBoundingClientRect(),Ke=Xe.left+Xe.width/2,rt=Xe.top+Xe.height/2,ot=$e.getBoundingClientRect(),at=ot.width/2-Ke,ut=ot.height/2-rt;Be(at,ut,!0)}function Ue(xe,$e){Be(xe-o.x,$e-o.y,!0)}function Be(xe,$e,Xe){if(!Xe)return je(xe,$e);J&&J.cancel();var Ke={x:0,y:0},rt={x:xe,y:$e},ot=0,at=0;J=animate(Ke,rt,{step:function(ut){je(ut.x-ot,ut.y-at),ot=ut.x,at=ut.y}})}function nt(xe,$e){mt(),Ye(xe,$e)}function ge(){Te()}function te(){n.addEventListener("mousedown",De,{passive:!1}),n.addEventListener("dblclick",Re,{passive:!1}),n.addEventListener("touchstart",Z,{passive:!1}),n.addEventListener("keydown",z,{passive:!1}),wheel.addWheelListener(n,tt,{passive:!1}),Qe()}function Te(){wheel.removeWheelListener(n,tt),n.removeEventListener("mousedown",De),n.removeEventListener("keydown",z),n.removeEventListener("dblclick",Re),n.removeEventListener("touchstart",Z),O&&(window.cancelAnimationFrame(O),O=0),$.cancel(),et(),it(),E.release(),Yt()}function Ie(){i&&Se()}function Se(){i=!1,t.applyTransform(o),At("transform"),O=0}function z(xe){var $e=0,Xe=0,Ke=0;if(xe.keyCode===38?Xe=1:xe.keyCode===40?Xe=-1:xe.keyCode===37?$e=1:xe.keyCode===39?$e=-1:xe.keyCode===189||xe.keyCode===109?Ke=1:(xe.keyCode===187||xe.keyCode===107)&&(Ke=-1),!a(xe,$e,Xe,Ke)){if($e||Xe){xe.preventDefault(),xe.stopPropagation();var rt=n.getBoundingClientRect(),ot=Math.min(rt.width,rt.height),at=.05,ut=ot*at*$e,bt=ot*at*Xe;Be(ut,bt)}if(Ke){var gt=wt(Ke*100),ot=v?dt():I();yt(ot.x,ot.y,gt)}}}function I(){var xe=n.getBoundingClientRect();return{x:xe.width/2,y:xe.height/2}}function Z(xe){if(H(xe),ae(),xe.touches.length===1)return ce(xe,xe.touches[0]);xe.touches.length===2&&(D=_e(xe.touches[0],xe.touches[1]),pe=!0,we())}function H(xe){e.onTouch&&!e.onTouch(xe)||(xe.stopPropagation(),xe.preventDefault())}function q(xe){ae(),!(e.onDoubleClick&&!e.onDoubleClick(xe))&&(xe.preventDefault(),xe.stopPropagation())}function ce(xe){m=new Date;var $e=xe.touches[0],Xe=ct($e);S=Xe;var Ke=ve(Xe.x,Xe.y);L=Ke.x,K=Ke.y,Q=L,ne=K,$.cancel(),we()}function we(){F||(F=!0,document.addEventListener("touchmove",X),document.addEventListener("touchend",Pe),document.addEventListener("touchcancel",Pe))}function X(xe){if(xe.touches.length===1){xe.stopPropagation();var $e=xe.touches[0],Xe=ct($e),Ke=ve(Xe.x,Xe.y),rt=Ke.x-L,ot=Ke.y-K;rt!==0&&ot!==0&&wn(),L=Ke.x,K=Ke.y,Be(rt,ot)}else if(xe.touches.length===2){pe=!0;var at=xe.touches[0],ut=xe.touches[1],bt=_e(at,ut),gt=1+(bt/D-1)*c,_n=ct(at),Nn=ct(ut);if(L=(_n.x+Nn.x)/2,K=(_n.y+Nn.y)/2,v){var Xe=dt();L=Xe.x,K=Xe.y}yt(L,K,gt),D=bt,xe.stopPropagation(),xe.preventDefault()}}function ae(){b&&(clearTimeout(b),b=0)}function de(xe){if(e.onClick){ae();var $e=L-Q,Xe=K-ne,Ke=Math.sqrt($e*$e+Xe*Xe);Ke>5||(b=setTimeout(function(){b=0,e.onClick(xe)},doubleTapSpeedInMS))}}function Pe(xe){if(ae(),xe.touches.length>0){var $e=ct(xe.touches[0]),Xe=ve($e.x,$e.y);L=Xe.x,K=Xe.y}else{var Ke=new Date;if(Ke-N<doubleTapSpeedInMS)if(v){var $e=dt();lt($e.x,$e.y,y)}else lt(S.x,S.y,y);else Ke-m<clickEventTimeInMS&&de(xe);N=Ke,Yt(),it()}}function _e(xe,$e){var Xe=xe.clientX-$e.clientX,Ke=xe.clientY-$e.clientY;return Math.sqrt(Xe*Xe+Ke*Ke)}function Re(xe){q(xe);var $e=ct(xe);v&&($e=dt()),lt($e.x,$e.y,y)}function De(xe){if(ae(),!f(xe)){if(k=xe,T=new Date,F)return xe.stopPropagation(),!1;var $e=xe.button===1&&window.event!==null||xe.button===0;if($e){$.cancel();var Xe=ct(xe),Ke=ve(Xe.x,Xe.y);return Q=L=Ke.x,ne=K=Ke.y,document.addEventListener("mousemove",He),document.addEventListener("mouseup",Je),E.capture(xe.target||xe.srcElement),!1}}}function He(xe){if(!F){wn();var $e=ct(xe),Xe=ve($e.x,$e.y),Ke=Xe.x-L,rt=Xe.y-K;L=Xe.x,K=Xe.y,Be(Ke,rt)}}function Je(){var xe=new Date;xe-T<clickEventTimeInMS&&de(k),E.release(),Yt(),et()}function et(){document.removeEventListener("mousemove",He),document.removeEventListener("mouseup",Je),j=!1}function it(){document.removeEventListener("touchmove",X),document.removeEventListener("touchend",Pe),document.removeEventListener("touchcancel",Pe),j=!1,pe=!1,F=!1}function tt(xe){if(!h(xe)){$.cancel();var $e=xe.deltaY;xe.deltaMode>0&&($e*=100);var Xe=wt($e);if(Xe!==1){var Ke=v?dt():ct(xe);yt(Ke.x,Ke.y,Xe),xe.preventDefault()}}}function ct(xe){var $e,Xe,Ke=n.getBoundingClientRect();return $e=xe.clientX-Ke.left,Xe=xe.clientY-Ke.top,{x:$e,y:Xe}}function lt(xe,$e,Xe){var Ke=o.scale,rt={scale:Ke},ot={scale:Xe*Ke};$.cancel(),mt(),re=animate(rt,ot,{step:function(at){ue(xe,$e,at.scale)},done:pr})}function ht(xe,$e,Xe){var Ke=o.scale,rt={scale:Ke},ot={scale:Xe};$.cancel(),mt(),re=animate(rt,ot,{step:function(at){ue(xe,$e,at.scale)}})}function dt(){var xe=n.getBoundingClientRect();return{x:xe.width*v.x,y:xe.height*v.y}}function yt(xe,$e,Xe){return $.cancel(),mt(),Ee(xe,$e,Xe)}function mt(){re&&(re.cancel(),re=null)}function wt(xe){var $e=Math.sign(xe),Xe=Math.min(.25,Math.abs(d*xe/128));return 1-$e*Xe}function wn(){j||(At("panstart"),j=!0,$.start())}function Yt(){j&&(pe||$.stop(),At("panend"))}function pr(){At("zoomend")}function At(xe){w.fire(xe,w)}}function parseTransformOrigin(s){if(s){if(typeof s=="object")return(!isNumber$1(s.x)||!isNumber$1(s.y))&&failTransformOrigin(s),s;failTransformOrigin()}}function failTransformOrigin(s){throw console.error(s),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function noop(){}function validateBounds(s){var e=typeof s;if(!(e==="undefined"||e==="boolean")){var t=isNumber$1(s.left)&&isNumber$1(s.top)&&isNumber$1(s.bottom)&&isNumber$1(s.right);if(!t)throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}}function isNumber$1(s){return Number.isFinite(s)}function isNaN$1(s){return Number.isNaN?Number.isNaN(s):s!==s}function rigidScroll(){return{start:noop,stop:noop,cancel:noop}}function autoRun(){if(typeof document>"u")return;var s=document.getElementsByTagName("script");if(!s)return;for(var e,t=0;t<s.length;++t){var n=s[t];if(n.src&&n.src.match(/\bpanzoom(\.min)?\.js/)){e=n;break}}if(!e)return;var r=e.getAttribute("query");if(!r)return;var i=e.getAttribute("name")||"pz",o=Date.now();a();function a(){var u=document.querySelector(r);if(!u){var p=Date.now(),g=p-o;if(g<2e3){setTimeout(a,100);return}console.error("Cannot find the panzoom element",i);return}var y=c(e);console.log(y),window[i]=createPanZoom(u,y)}function c(u){for(var p=u.attributes,g={},y=0;y<p.length;++y){var h=p[y],f=l(h);f&&(g[f.name]=f.value)}return g}function l(u){if(u.name){var p=u.name[0]==="p"&&u.name[1]==="z"&&u.name[2]==="-";if(p){var g=u.name.substr(3),y=JSON.parse(u.value);return{name:g,value:y}}}}}autoRun();const createPanZoom$1=getDefaultExportFromCjs(panzoom);function commonjsRequire(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$6=getAugmentedNamespace(__viteBrowserExternal$1);var path2dPolyfill_esm={},hasRequiredPath2dPolyfill_esm;function requirePath2dPolyfill_esm(){if(hasRequiredPath2dPolyfill_esm)return path2dPolyfill_esm;hasRequiredPath2dPolyfill_esm=1;function s(h,f,d){if(d||arguments.length===2)for(var v=0,E=f.length,O;v<E;v++)(O||!(v in f))&&(O||(O=Array.prototype.slice.call(f,0,v)),O[v]=f[v]);return h.concat(O||Array.prototype.slice.call(f))}var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/gi,n=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function r(h){var f=h.match(n);return f?f.map(Number):[]}function i(h){var f=[],d=String(h).trim();return d[0]!=="M"&&d[0]!=="m"||d.replace(t,function(v,E,O){var N=r(O),m=E.toLowerCase(),b=E;if(m==="m"&&N.length>2&&(f.push(s([b],N.splice(0,2),!0)),m="l",b=b==="m"?"l":"L"),N.length<e[m])return"";for(f.push(s([b],N.splice(0,e[m]),!0));N.length>=e[m]&&N.length&&e[m];)f.push(s([b],N.splice(0,e[m]),!0));return""}),f}function o(h,f){var d=h.x*Math.cos(f)-h.y*Math.sin(f),v=h.y*Math.cos(f)+h.x*Math.sin(f);h.x=d,h.y=v}function a(h,f,d){h.x+=f,h.y+=d}function c(h,f){h.x*=f,h.y*=f}var l=function(){function h(f){var d;this.commands=[],f&&f instanceof h?(d=this.commands).push.apply(d,f.commands):f&&(this.commands=i(f))}return h.prototype.addPath=function(f){var d;f&&f instanceof h&&(d=this.commands).push.apply(d,f.commands)},h.prototype.moveTo=function(f,d){this.commands.push(["M",f,d])},h.prototype.lineTo=function(f,d){this.commands.push(["L",f,d])},h.prototype.arc=function(f,d,v,E,O,N){this.commands.push(["AC",f,d,v,E,O,!!N])},h.prototype.arcTo=function(f,d,v,E,O){this.commands.push(["AT",f,d,v,E,O])},h.prototype.ellipse=function(f,d,v,E,O,N,m,b){this.commands.push(["E",f,d,v,E,O,N,m,!!b])},h.prototype.closePath=function(){this.commands.push(["Z"])},h.prototype.bezierCurveTo=function(f,d,v,E,O,N){this.commands.push(["C",f,d,v,E,O,N])},h.prototype.quadraticCurveTo=function(f,d,v,E){this.commands.push(["Q",f,d,v,E])},h.prototype.rect=function(f,d,v,E){this.commands.push(["R",f,d,v,E])},h.prototype.roundRect=function(f,d,v,E,O){typeof O>"u"?this.commands.push(["RR",f,d,v,E,0]):this.commands.push(["RR",f,d,v,E,O])},h}();function u(h,f){var d=0,v=0,E,O,N,m,b,k,T,S,F,P,G,j,L,K,Q,ne,D,$,J,re,pe,U=null,w=null,_=null,R=null,V=null,M=null;h.beginPath();for(var Y=0;Y<f.length;++Y){$=f[Y][0],$!=="S"&&$!=="s"&&$!=="C"&&$!=="c"&&(U=null,w=null),$!=="T"&&$!=="t"&&$!=="Q"&&$!=="q"&&(_=null,R=null);var W=void 0;switch($){case"m":case"M":W=f[Y],$==="m"?(d+=W[1],v+=W[2]):(d=W[1],v=W[2]),($==="M"||!V)&&(V={x:d,y:v}),h.moveTo(d,v);break;case"l":W=f[Y],d+=W[1],v+=W[2],h.lineTo(d,v);break;case"L":W=f[Y],d=W[1],v=W[2],h.lineTo(d,v);break;case"H":W=f[Y],d=W[1],h.lineTo(d,v);break;case"h":W=f[Y],d+=W[1],h.lineTo(d,v);break;case"V":W=f[Y],v=W[1],h.lineTo(d,v);break;case"v":W=f[Y],v+=W[1],h.lineTo(d,v);break;case"a":case"A":if(W=f[Y],M===null)throw new Error("This should never happen");$==="a"?(d+=W[6],v+=W[7]):(d=W[6],v=W[7]),K=W[1],Q=W[2],T=W[3]*Math.PI/180,N=!!W[4],m=!!W[5],b={x:d,y:v},k={x:(M.x-b.x)/2,y:(M.y-b.y)/2},o(k,-T),S=k.x*k.x/(K*K)+k.y*k.y/(Q*Q),S>1&&(S=Math.sqrt(S),K*=S,Q*=S),J={x:K*k.y/Q,y:-(Q*k.x)/K},F=K*K*Q*Q,P=K*K*k.y*k.y+Q*Q*k.x*k.x,m!==N?c(J,Math.sqrt((F-P)/P)||0):c(J,-Math.sqrt((F-P)/P)||0),O=Math.atan2((k.y-J.y)/Q,(k.x-J.x)/K),E=Math.atan2(-(k.y+J.y)/Q,-(k.x+J.x)/K),o(J,T),a(J,(b.x+M.x)/2,(b.y+M.y)/2),h.save(),h.translate(J.x,J.y),h.rotate(T),h.scale(K,Q),h.arc(0,0,1,O,E,!m),h.restore();break;case"C":W=f[Y],U=W[3],w=W[4],d=W[5],v=W[6],h.bezierCurveTo(W[1],W[2],U,w,d,v);break;case"c":W=f[Y],h.bezierCurveTo(W[1]+d,W[2]+v,W[3]+d,W[4]+v,W[5]+d,W[6]+v),U=W[3]+d,w=W[4]+v,d+=W[5],v+=W[6];break;case"S":W=f[Y],(U===null||w===null)&&(U=d,w=v),h.bezierCurveTo(2*d-U,2*v-w,W[1],W[2],W[3],W[4]),U=W[1],w=W[2],d=W[3],v=W[4];break;case"s":W=f[Y],(U===null||w===null)&&(U=d,w=v),h.bezierCurveTo(2*d-U,2*v-w,W[1]+d,W[2]+v,W[3]+d,W[4]+v),U=W[1]+d,w=W[2]+v,d+=W[3],v+=W[4];break;case"Q":W=f[Y],_=W[1],R=W[2],d=W[3],v=W[4],h.quadraticCurveTo(_,R,d,v);break;case"q":W=f[Y],_=W[1]+d,R=W[2]+v,d+=W[3],v+=W[4],h.quadraticCurveTo(_,R,d,v);break;case"T":W=f[Y],(_===null||R===null)&&(_=d,R=v),_=2*d-_,R=2*v-R,d=W[1],v=W[2],h.quadraticCurveTo(_,R,d,v);break;case"t":W=f[Y],(_===null||R===null)&&(_=d,R=v),_=2*d-_,R=2*v-R,d+=W[1],v+=W[2],h.quadraticCurveTo(_,R,d,v);break;case"z":case"Z":V&&(d=V.x,v=V.y),V=null,h.closePath();break;case"AC":W=f[Y],d=W[1],v=W[2],L=W[3],O=W[4],E=W[5],re=W[6],h.arc(d,v,L,O,E,re);break;case"AT":W=f[Y],G=W[1],j=W[2],d=W[3],v=W[4],L=W[5],h.arcTo(G,j,d,v,L);break;case"E":W=f[Y],d=W[1],v=W[2],K=W[3],Q=W[4],T=W[5],O=W[6],E=W[7],re=W[8],h.save(),h.translate(d,v),h.rotate(T),h.scale(K,Q),h.arc(0,0,1,O,E,re),h.restore();break;case"R":W=f[Y],d=W[1],v=W[2],ne=W[3],D=W[4],V={x:d,y:v},h.rect(d,v,ne,D);break;case"RR":W=f[Y],d=W[1],v=W[2],ne=W[3],D=W[4],pe=W[5],V={x:d,y:v},h.roundRect(d,v,ne,D,pe);break}M?(M.x=d,M.y=v):M={x:d,y:v}}}function p(h){if(!(!h||!h.CanvasRenderingContext2D||h.Path2D)){var f=h.CanvasRenderingContext2D,d=f.prototype.fill,v=f.prototype.stroke,E=f.prototype.isPointInPath;f.prototype.fill=function(){for(var N=[],m=0;m<arguments.length;m++)N[m]=arguments[m];if(N[0]instanceof l){var b=N[0],k=N[1]||"nonzero";u(this,b.commands),d.apply(this,[k])}else{var k=N[0]||"nonzero";return d.apply(this,[k])}},f.prototype.stroke=function(N){N&&u(this,N.commands),v.apply(this)},f.prototype.isPointInPath=function(){for(var N=[],m=0;m<arguments.length;m++)N[m]=arguments[m];if(N[0]instanceof l){var b=N[0],k=N[1],T=N[2],S=N[3]||"nonzero";return u(this,b.commands),E.apply(this,[k,T,S])}else return E.apply(this,N)},h.Path2D=l}}function g(h,f,d,v,E){var O=this;if(E===void 0&&(E=0),typeof E=="number"&&(E=[E]),Array.isArray(E)){if(E.length===0||E.length>4)throw new RangeError("Failed to execute 'roundRect' on '".concat(this.constructor.name,"': ").concat(E.length," radii provided. Between one and four radii are necessary."));E.forEach(function(S){if(S<0)throw new RangeError("Failed to execute 'roundRect' on '".concat(O.constructor.name,"': Radius value ").concat(S," is negative."))})}else return;if(E.length===1&&E[0]===0)return this.rect(h,f,d,v);var N=Math.min(d,v)/2,m,b,k,T=m=b=k=Math.min(N,E[0]);E.length===2&&(m=k=Math.min(N,E[1])),E.length===3&&(m=k=Math.min(N,E[1]),b=Math.min(N,E[2])),E.length===4&&(m=Math.min(N,E[1]),b=Math.min(N,E[2]),k=Math.min(N,E[3])),this.moveTo(h,f+v-k),this.arcTo(h,f,h+T,f,T),this.arcTo(h+d,f,h+d,f+m,m),this.arcTo(h+d,f+v,h+d-b,f+v,b),this.arcTo(h,f+v,h,f+v-k,k),this.moveTo(h,f)}function y(h){if(!(!h||!h.CanvasRenderingContext2D)){var f=h.CanvasRenderingContext2D,d=h.Path2D;f&&!f.prototype.roundRect&&(f.prototype.roundRect=g),d&&!d.prototype.roundRect&&(d.prototype.roundRect=g)}}return p(window),y(window),path2dPolyfill_esm}(function(module,exports){(function(e,t){module.exports=e.pdfjsLib=t()})(globalThis,()=>(()=>{var __webpack_modules__=[,(s,e,t)=>{var Qe;Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.TextRenderingMode=e.RenderingIntentFlag=e.PromiseCapability=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.MAX_IMAGE_SIZE_TO_CACHE=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.BASELINE_FACTOR=e.AnnotationType=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.assert=J,e.bytesToString=me,e.createValidAbsoluteUrl=pe,e.getModificationDate=Ye,e.getUuid=Ze,e.getVerbosityLevel=Q,e.info=ne,e.isArrayBuffer=Me,e.isArrayEqual=Ge,e.isNodeJS=void 0,e.normalizeUnicode=qe,e.objectFromMap=ve,e.objectSize=ie,e.setVerbosityLevel=K,e.shadow=U,e.string32=ye,e.stringToBytes=he,e.stringToPDFString=be,e.stringToUTF8String=fe,e.unreachable=$,e.utf8StringToString=Ce,e.warn=D,t(2),t(84),t(86),t(87),t(89),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123);const n=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=n;const r=[1,0,0,1,0,0];e.IDENTITY_MATRIX=r;const i=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=i;const o=1e7;e.MAX_IMAGE_SIZE_TO_CACHE=o;const a=1.35;e.LINE_FACTOR=a;const c=.35;e.LINE_DESCENT_FACTOR=c;const l=c/a;e.BASELINE_FACTOR=l;const u={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=u;const p={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=p;const g="pdfjs_internal_editor_";e.AnnotationEditorPrefix=g;const y={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};e.AnnotationEditorType=y;const h={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};e.AnnotationEditorParamsType=h;const f={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=f;const d={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=d;const v={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=v;const E={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=E;const O={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=O;const N={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=N;const m={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=m;const b={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=b;const k={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=k;const T={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=T;const S={O:"PageOpen",C:"PageClose"};e.PageActionEventType=S;const F={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=F;const P={NONE:0,BINARY:1};e.CMapCompressionType=P;const G={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=G;const j={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=j;let L=F.WARNINGS;function K(Ee){Number.isInteger(Ee)&&(L=Ee)}function Q(){return L}function ne(Ee){L>=F.INFOS&&console.log(`Info: ${Ee}`)}function D(Ee){L>=F.WARNINGS&&console.log(`Warning: ${Ee}`)}function $(Ee){throw new Error(Ee)}function J(Ee,ue){Ee||$(ue)}function re(Ee){switch(Ee==null?void 0:Ee.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function pe(Ee){let ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!Ee)return null;try{if(oe&&typeof Ee=="string"){if(oe.addDefaultProtocol&&Ee.startsWith("www.")){const Be=Ee.match(/\./g);(Be==null?void 0:Be.length)>=2&&(Ee=`http://${Ee}`)}if(oe.tryConvertEncoding)try{Ee=fe(Ee)}catch{}}const Ue=ue?new URL(Ee,ue):new URL(Ee);if(re(Ue))return Ue}catch{}return null}function U(Ee,ue,oe){let Ue=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return Object.defineProperty(Ee,ue,{value:oe,enumerable:!Ue,configurable:!0,writable:!1}),oe}const w=function(){function ue(oe,Ue){this.constructor===ue&&$("Cannot initialize BaseException."),this.message=oe,this.name=Ue}return ue.prototype=new Error,ue.constructor=ue,ue}();e.BaseException=w;class _ extends w{constructor(ue,oe){super(ue,"PasswordException"),this.code=oe}}e.PasswordException=_;class R extends w{constructor(ue,oe){super(ue,"UnknownErrorException"),this.details=oe}}e.UnknownErrorException=R;class V extends w{constructor(ue){super(ue,"InvalidPDFException")}}e.InvalidPDFException=V;class M extends w{constructor(ue){super(ue,"MissingPDFException")}}e.MissingPDFException=M;class Y extends w{constructor(ue,oe){super(ue,"UnexpectedResponseException"),this.status=oe}}e.UnexpectedResponseException=Y;class W extends w{constructor(ue){super(ue,"FormatError")}}e.FormatError=W;class ee extends w{constructor(ue){super(ue,"AbortException")}}e.AbortException=ee;function me(Ee){(typeof Ee!="object"||(Ee==null?void 0:Ee.length)===void 0)&&$("Invalid argument for bytesToString");const ue=Ee.length,oe=8192;if(ue<oe)return String.fromCharCode.apply(null,Ee);const Ue=[];for(let Be=0;Be<ue;Be+=oe){const nt=Math.min(Be+oe,ue),ge=Ee.subarray(Be,nt);Ue.push(String.fromCharCode.apply(null,ge))}return Ue.join("")}function he(Ee){typeof Ee!="string"&&$("Invalid argument for stringToBytes");const ue=Ee.length,oe=new Uint8Array(ue);for(let Ue=0;Ue<ue;++Ue)oe[Ue]=Ee.charCodeAt(Ue)&255;return oe}function ye(Ee){return String.fromCharCode(Ee>>24&255,Ee>>16&255,Ee>>8&255,Ee&255)}function ie(Ee){return Object.keys(Ee).length}function ve(Ee){const ue=Object.create(null);for(const[oe,Ue]of Ee)ue[oe]=Ue;return ue}function Ne(){const Ee=new Uint8Array(4);return Ee[0]=1,new Uint32Array(Ee.buffer,0,1)[0]===1}function Fe(){try{return new Function(""),!0}catch{return!1}}class Le{static get isLittleEndian(){return U(this,"isLittleEndian",Ne())}static get isEvalSupported(){return U(this,"isEvalSupported",Fe())}static get isOffscreenCanvasSupported(){return U(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?U(this,"platform",{isWin:!1,isMac:!1}):U(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var ue,oe;return U(this,"isCSSRoundSupported",(oe=(ue=globalThis.CSS)==null?void 0:ue.supports)==null?void 0:oe.call(ue,"width: round(1.5px, 1px)"))}}e.FeatureTest=Le;const ke=[...Array(256).keys()].map(Ee=>Ee.toString(16).padStart(2,"0"));class ze{static makeHexColor(ue,oe,Ue){return`#${ke[ue]}${ke[oe]}${ke[Ue]}`}static scaleMinMax(ue,oe){let Ue;ue[0]?(ue[0]<0&&(Ue=oe[0],oe[0]=oe[1],oe[1]=Ue),oe[0]*=ue[0],oe[1]*=ue[0],ue[3]<0&&(Ue=oe[2],oe[2]=oe[3],oe[3]=Ue),oe[2]*=ue[3],oe[3]*=ue[3]):(Ue=oe[0],oe[0]=oe[2],oe[2]=Ue,Ue=oe[1],oe[1]=oe[3],oe[3]=Ue,ue[1]<0&&(Ue=oe[2],oe[2]=oe[3],oe[3]=Ue),oe[2]*=ue[1],oe[3]*=ue[1],ue[2]<0&&(Ue=oe[0],oe[0]=oe[1],oe[1]=Ue),oe[0]*=ue[2],oe[1]*=ue[2]),oe[0]+=ue[4],oe[1]+=ue[4],oe[2]+=ue[5],oe[3]+=ue[5]}static transform(ue,oe){return[ue[0]*oe[0]+ue[2]*oe[1],ue[1]*oe[0]+ue[3]*oe[1],ue[0]*oe[2]+ue[2]*oe[3],ue[1]*oe[2]+ue[3]*oe[3],ue[0]*oe[4]+ue[2]*oe[5]+ue[4],ue[1]*oe[4]+ue[3]*oe[5]+ue[5]]}static applyTransform(ue,oe){const Ue=ue[0]*oe[0]+ue[1]*oe[2]+oe[4],Be=ue[0]*oe[1]+ue[1]*oe[3]+oe[5];return[Ue,Be]}static applyInverseTransform(ue,oe){const Ue=oe[0]*oe[3]-oe[1]*oe[2],Be=(ue[0]*oe[3]-ue[1]*oe[2]+oe[2]*oe[5]-oe[4]*oe[3])/Ue,nt=(-ue[0]*oe[1]+ue[1]*oe[0]+oe[4]*oe[1]-oe[5]*oe[0])/Ue;return[Be,nt]}static getAxialAlignedBoundingBox(ue,oe){const Ue=this.applyTransform(ue,oe),Be=this.applyTransform(ue.slice(2,4),oe),nt=this.applyTransform([ue[0],ue[3]],oe),ge=this.applyTransform([ue[2],ue[1]],oe);return[Math.min(Ue[0],Be[0],nt[0],ge[0]),Math.min(Ue[1],Be[1],nt[1],ge[1]),Math.max(Ue[0],Be[0],nt[0],ge[0]),Math.max(Ue[1],Be[1],nt[1],ge[1])]}static inverseTransform(ue){const oe=ue[0]*ue[3]-ue[1]*ue[2];return[ue[3]/oe,-ue[1]/oe,-ue[2]/oe,ue[0]/oe,(ue[2]*ue[5]-ue[4]*ue[3])/oe,(ue[4]*ue[1]-ue[5]*ue[0])/oe]}static singularValueDecompose2dScale(ue){const oe=[ue[0],ue[2],ue[1],ue[3]],Ue=ue[0]*oe[0]+ue[1]*oe[2],Be=ue[0]*oe[1]+ue[1]*oe[3],nt=ue[2]*oe[0]+ue[3]*oe[2],ge=ue[2]*oe[1]+ue[3]*oe[3],te=(Ue+ge)/2,Te=Math.sqrt((Ue+ge)**2-4*(Ue*ge-nt*Be))/2,Ie=te+Te||1,Se=te-Te||1;return[Math.sqrt(Ie),Math.sqrt(Se)]}static normalizeRect(ue){const oe=ue.slice(0);return ue[0]>ue[2]&&(oe[0]=ue[2],oe[2]=ue[0]),ue[1]>ue[3]&&(oe[1]=ue[3],oe[3]=ue[1]),oe}static intersect(ue,oe){const Ue=Math.max(Math.min(ue[0],ue[2]),Math.min(oe[0],oe[2])),Be=Math.min(Math.max(ue[0],ue[2]),Math.max(oe[0],oe[2]));if(Ue>Be)return null;const nt=Math.max(Math.min(ue[1],ue[3]),Math.min(oe[1],oe[3])),ge=Math.min(Math.max(ue[1],ue[3]),Math.max(oe[1],oe[3]));return nt>ge?null:[Ue,nt,Be,ge]}static bezierBoundingBox(ue,oe,Ue,Be,nt,ge,te,Te){const Ie=[],Se=[[],[]];let z,I,Z,H,q,ce,we,X;for(let _e=0;_e<2;++_e){if(_e===0?(I=6*ue-12*Ue+6*nt,z=-3*ue+9*Ue-9*nt+3*te,Z=3*Ue-3*ue):(I=6*oe-12*Be+6*ge,z=-3*oe+9*Be-9*ge+3*Te,Z=3*Be-3*oe),Math.abs(z)<1e-12){if(Math.abs(I)<1e-12)continue;H=-Z/I,0<H&&H<1&&Ie.push(H);continue}we=I*I-4*Z*z,X=Math.sqrt(we),!(we<0)&&(q=(-I+X)/(2*z),0<q&&q<1&&Ie.push(q),ce=(-I-X)/(2*z),0<ce&&ce<1&&Ie.push(ce))}let ae=Ie.length,de;const Pe=ae;for(;ae--;)H=Ie[ae],de=1-H,Se[0][ae]=de*de*de*ue+3*de*de*H*Ue+3*de*H*H*nt+H*H*H*te,Se[1][ae]=de*de*de*oe+3*de*de*H*Be+3*de*H*H*ge+H*H*H*Te;return Se[0][Pe]=ue,Se[1][Pe]=oe,Se[0][Pe+1]=te,Se[1][Pe+1]=Te,Se[0].length=Se[1].length=Pe+2,[Math.min(...Se[0]),Math.min(...Se[1]),Math.max(...Se[0]),Math.max(...Se[1])]}}e.Util=ze;const Oe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function be(Ee){if(Ee[0]>="ï"){let oe;if(Ee[0]==="þ"&&Ee[1]==="ÿ"?oe="utf-16be":Ee[0]==="ÿ"&&Ee[1]==="þ"?oe="utf-16le":Ee[0]==="ï"&&Ee[1]==="»"&&Ee[2]==="¿"&&(oe="utf-8"),oe)try{const Ue=new TextDecoder(oe,{fatal:!0}),Be=he(Ee);return Ue.decode(Be)}catch(Ue){D(`stringToPDFString: "${Ue}".`)}}const ue=[];for(let oe=0,Ue=Ee.length;oe<Ue;oe++){const Be=Oe[Ee.charCodeAt(oe)];ue.push(Be?String.fromCharCode(Be):Ee.charAt(oe))}return ue.join("")}function fe(Ee){return decodeURIComponent(escape(Ee))}function Ce(Ee){return unescape(encodeURIComponent(Ee))}function Me(Ee){return typeof Ee=="object"&&(Ee==null?void 0:Ee.byteLength)!==void 0}function Ge(Ee,ue){if(Ee.length!==ue.length)return!1;for(let oe=0,Ue=Ee.length;oe<Ue;oe++)if(Ee[oe]!==ue[oe])return!1;return!0}function Ye(){let Ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Date;return[Ee.getUTCFullYear().toString(),(Ee.getUTCMonth()+1).toString().padStart(2,"0"),Ee.getUTCDate().toString().padStart(2,"0"),Ee.getUTCHours().toString().padStart(2,"0"),Ee.getUTCMinutes().toString().padStart(2,"0"),Ee.getUTCSeconds().toString().padStart(2,"0")].join("")}class je{constructor(){se(this,Qe,!1);this.promise=new Promise((ue,oe)=>{this.resolve=Ue=>{Ae(this,Qe,!0),ue(Ue)},this.reject=Ue=>{Ae(this,Qe,!0),oe(Ue)}})}get settled(){return x(this,Qe)}}Qe=new WeakMap,e.PromiseCapability=je;let Ve=null,We=null;function qe(Ee){return Ve||(Ve=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,We=new Map([["ﬅ","ſt"]])),Ee.replaceAll(Ve,(ue,oe,Ue)=>oe?oe.normalize("NFKC"):We.get(Ue))}function Ze(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const Ee=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(Ee);else for(let ue=0;ue<32;ue++)Ee[ue]=Math.floor(Math.random()*255);return me(Ee)}},(s,e,t)=>{var n=t(3),r=t(4),i=t(69),o=t(70),a="WebAssembly",c=r[a],l=Error("e",{cause:7}).cause!==7,u=function(g,y){var h={};h[g]=o(g,y,l),n({global:!0,constructor:!0,arity:1,forced:l},h)},p=function(g,y){if(c&&c[g]){var h={};h[g]=o(a+"."+g,y,l),n({target:a,stat:!0,constructor:!0,arity:1,forced:l},h)}};u("Error",function(g){return function(h){return i(g,this,arguments)}}),u("EvalError",function(g){return function(h){return i(g,this,arguments)}}),u("RangeError",function(g){return function(h){return i(g,this,arguments)}}),u("ReferenceError",function(g){return function(h){return i(g,this,arguments)}}),u("SyntaxError",function(g){return function(h){return i(g,this,arguments)}}),u("TypeError",function(g){return function(h){return i(g,this,arguments)}}),u("URIError",function(g){return function(h){return i(g,this,arguments)}}),p("CompileError",function(g){return function(h){return i(g,this,arguments)}}),p("LinkError",function(g){return function(h){return i(g,this,arguments)}}),p("RuntimeError",function(g){return function(h){return i(g,this,arguments)}})},(s,e,t)=>{var n=t(4),r=t(5).f,i=t(44),o=t(48),a=t(38),c=t(56),l=t(68);s.exports=function(u,p){var g=u.target,y=u.global,h=u.stat,f,d,v,E,O,N;if(y?d=n:h?d=n[g]||a(g,{}):d=(n[g]||{}).prototype,d)for(v in p){if(O=p[v],u.dontCallGetSet?(N=r(d,v),E=N&&N.value):E=d[v],f=l(y?v:g+(h?".":"#")+v,u.forced),!f&&E!==void 0){if(typeof O==typeof E)continue;c(O,E)}(u.sham||E&&E.sham)&&i(O,"sham",!0),o(d,v,O,u)}}},function(s){var e=function(t){return t&&t.Math===Math&&t};s.exports=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof commonjsGlobal=="object"&&commonjsGlobal)||function(){return this}()||this||Function("return this")()},(s,e,t)=>{var n=t(6),r=t(8),i=t(10),o=t(11),a=t(12),c=t(18),l=t(39),u=t(42),p=Object.getOwnPropertyDescriptor;e.f=n?p:function(y,h){if(y=a(y),h=c(h),u)try{return p(y,h)}catch{}if(l(y,h))return o(!r(i.f,y,h),y[h])}},(s,e,t)=>{var n=t(7);s.exports=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},s=>{s.exports=function(e){try{return!!e()}catch{return!0}}},(s,e,t)=>{var n=t(9),r=Function.prototype.call;s.exports=n?r.bind(r):function(){return r.apply(r,arguments)}},(s,e,t)=>{var n=t(7);s.exports=!n(function(){var r=(function(){}).bind();return typeof r!="function"||r.hasOwnProperty("prototype")})},(s,e)=>{var t={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,r=n&&!t.call({1:2},1);e.f=r?function(o){var a=n(this,o);return!!a&&a.enumerable}:t},s=>{s.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},(s,e,t)=>{var n=t(13),r=t(16);s.exports=function(i){return n(r(i))}},(s,e,t)=>{var n=t(14),r=t(7),i=t(15),o=Object,a=n("".split);s.exports=r(function(){return!o("z").propertyIsEnumerable(0)})?function(c){return i(c)==="String"?a(c,""):o(c)}:o},(s,e,t)=>{var n=t(9),r=Function.prototype,i=r.call,o=n&&r.bind.bind(i,i);s.exports=n?o:function(a){return function(){return i.apply(a,arguments)}}},(s,e,t)=>{var n=t(14),r=n({}.toString),i=n("".slice);s.exports=function(o){return i(r(o),8,-1)}},(s,e,t)=>{var n=t(17),r=TypeError;s.exports=function(i){if(n(i))throw r("Can't call method on "+i);return i}},s=>{s.exports=function(e){return e==null}},(s,e,t)=>{var n=t(19),r=t(23);s.exports=function(i){var o=n(i,"string");return r(o)?o:o+""}},(s,e,t)=>{var n=t(8),r=t(20),i=t(23),o=t(30),a=t(33),c=t(34),l=TypeError,u=c("toPrimitive");s.exports=function(p,g){if(!r(p)||i(p))return p;var y=o(p,u),h;if(y){if(g===void 0&&(g="default"),h=n(y,p,g),!r(h)||i(h))return h;throw l("Can't convert object to primitive value")}return g===void 0&&(g="number"),a(p,g)}},(s,e,t)=>{var n=t(21),r=t(22),i=r.all;s.exports=r.IS_HTMLDDA?function(o){return typeof o=="object"?o!==null:n(o)||o===i}:function(o){return typeof o=="object"?o!==null:n(o)}},(s,e,t)=>{var n=t(22),r=n.all;s.exports=n.IS_HTMLDDA?function(i){return typeof i=="function"||i===r}:function(i){return typeof i=="function"}},s=>{var e=typeof document=="object"&&document.all,t=typeof e>"u"&&e!==void 0;s.exports={all:e,IS_HTMLDDA:t}},(s,e,t)=>{var n=t(24),r=t(21),i=t(25),o=t(26),a=Object;s.exports=o?function(c){return typeof c=="symbol"}:function(c){var l=n("Symbol");return r(l)&&i(l.prototype,a(c))}},(s,e,t)=>{var n=t(4),r=t(21),i=function(o){return r(o)?o:void 0};s.exports=function(o,a){return arguments.length<2?i(n[o]):n[o]&&n[o][a]}},(s,e,t)=>{var n=t(14);s.exports=n({}.isPrototypeOf)},(s,e,t)=>{var n=t(27);s.exports=n&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},(s,e,t)=>{var n=t(28),r=t(7),i=t(4),o=i.String;s.exports=!!Object.getOwnPropertySymbols&&!r(function(){var a=Symbol("symbol detection");return!o(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&n&&n<41})},(s,e,t)=>{var n=t(4),r=t(29),i=n.process,o=n.Deno,a=i&&i.versions||o&&o.version,c=a&&a.v8,l,u;c&&(l=c.split("."),u=l[0]>0&&l[0]<4?1:+(l[0]+l[1])),!u&&r&&(l=r.match(/Edge\/(\d+)/),(!l||l[1]>=74)&&(l=r.match(/Chrome\/(\d+)/),l&&(u=+l[1]))),s.exports=u},s=>{s.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},(s,e,t)=>{var n=t(31),r=t(17);s.exports=function(i,o){var a=i[o];return r(a)?void 0:n(a)}},(s,e,t)=>{var n=t(21),r=t(32),i=TypeError;s.exports=function(o){if(n(o))return o;throw i(r(o)+" is not a function")}},s=>{var e=String;s.exports=function(t){try{return e(t)}catch{return"Object"}}},(s,e,t)=>{var n=t(8),r=t(21),i=t(20),o=TypeError;s.exports=function(a,c){var l,u;if(c==="string"&&r(l=a.toString)&&!i(u=n(l,a))||r(l=a.valueOf)&&!i(u=n(l,a))||c!=="string"&&r(l=a.toString)&&!i(u=n(l,a)))return u;throw o("Can't convert object to primitive value")}},(s,e,t)=>{var n=t(4),r=t(35),i=t(39),o=t(41),a=t(27),c=t(26),l=n.Symbol,u=r("wks"),p=c?l.for||l:l&&l.withoutSetter||o;s.exports=function(g){return i(u,g)||(u[g]=a&&i(l,g)?l[g]:p("Symbol."+g)),u[g]}},(s,e,t)=>{var n=t(36),r=t(37);(s.exports=function(i,o){return r[i]||(r[i]=o!==void 0?o:{})})("versions",[]).push({version:"3.32.1",mode:n?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.1/LICENSE",source:"https://github.com/zloirock/core-js"})},s=>{s.exports=!1},(s,e,t)=>{var n=t(4),r=t(38),i="__core-js_shared__",o=n[i]||r(i,{});s.exports=o},(s,e,t)=>{var n=t(4),r=Object.defineProperty;s.exports=function(i,o){try{r(n,i,{value:o,configurable:!0,writable:!0})}catch{n[i]=o}return o}},(s,e,t)=>{var n=t(14),r=t(40),i=n({}.hasOwnProperty);s.exports=Object.hasOwn||function(a,c){return i(r(a),c)}},(s,e,t)=>{var n=t(16),r=Object;s.exports=function(i){return r(n(i))}},(s,e,t)=>{var n=t(14),r=0,i=Math.random(),o=n(1 .toString);s.exports=function(a){return"Symbol("+(a===void 0?"":a)+")_"+o(++r+i,36)}},(s,e,t)=>{var n=t(6),r=t(7),i=t(43);s.exports=!n&&!r(function(){return Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a!==7})},(s,e,t)=>{var n=t(4),r=t(20),i=n.document,o=r(i)&&r(i.createElement);s.exports=function(a){return o?i.createElement(a):{}}},(s,e,t)=>{var n=t(6),r=t(45),i=t(11);s.exports=n?function(o,a,c){return r.f(o,a,i(1,c))}:function(o,a,c){return o[a]=c,o}},(s,e,t)=>{var n=t(6),r=t(42),i=t(46),o=t(47),a=t(18),c=TypeError,l=Object.defineProperty,u=Object.getOwnPropertyDescriptor,p="enumerable",g="configurable",y="writable";e.f=n?i?function(f,d,v){if(o(f),d=a(d),o(v),typeof f=="function"&&d==="prototype"&&"value"in v&&y in v&&!v[y]){var E=u(f,d);E&&E[y]&&(f[d]=v.value,v={configurable:g in v?v[g]:E[g],enumerable:p in v?v[p]:E[p],writable:!1})}return l(f,d,v)}:l:function(f,d,v){if(o(f),d=a(d),o(v),r)try{return l(f,d,v)}catch{}if("get"in v||"set"in v)throw c("Accessors not supported");return"value"in v&&(f[d]=v.value),f}},(s,e,t)=>{var n=t(6),r=t(7);s.exports=n&&r(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},(s,e,t)=>{var n=t(20),r=String,i=TypeError;s.exports=function(o){if(n(o))return o;throw i(r(o)+" is not an object")}},(s,e,t)=>{var n=t(21),r=t(45),i=t(49),o=t(38);s.exports=function(a,c,l,u){u||(u={});var p=u.enumerable,g=u.name!==void 0?u.name:c;if(n(l)&&i(l,g,u),u.global)p?a[c]=l:o(c,l);else{try{u.unsafe?a[c]&&(p=!0):delete a[c]}catch{}p?a[c]=l:r.f(a,c,{value:l,enumerable:!1,configurable:!u.nonConfigurable,writable:!u.nonWritable})}return a}},(s,e,t)=>{var n=t(14),r=t(7),i=t(21),o=t(39),a=t(6),c=t(50).CONFIGURABLE,l=t(51),u=t(52),p=u.enforce,g=u.get,y=String,h=Object.defineProperty,f=n("".slice),d=n("".replace),v=n([].join),E=a&&!r(function(){return h(function(){},"length",{value:8}).length!==8}),O=String(String).split("String"),N=s.exports=function(m,b,k){f(y(b),0,7)==="Symbol("&&(b="["+d(y(b),/^Symbol\(([^)]*)\)/,"$1")+"]"),k&&k.getter&&(b="get "+b),k&&k.setter&&(b="set "+b),(!o(m,"name")||c&&m.name!==b)&&(a?h(m,"name",{value:b,configurable:!0}):m.name=b),E&&k&&o(k,"arity")&&m.length!==k.arity&&h(m,"length",{value:k.arity});try{k&&o(k,"constructor")&&k.constructor?a&&h(m,"prototype",{writable:!1}):m.prototype&&(m.prototype=void 0)}catch{}var T=p(m);return o(T,"source")||(T.source=v(O,typeof b=="string"?b:"")),m};Function.prototype.toString=N(function(){return i(this)&&g(this).source||l(this)},"toString")},(s,e,t)=>{var n=t(6),r=t(39),i=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,a=r(i,"name"),c=a&&(function(){}).name==="something",l=a&&(!n||n&&o(i,"name").configurable);s.exports={EXISTS:a,PROPER:c,CONFIGURABLE:l}},(s,e,t)=>{var n=t(14),r=t(21),i=t(37),o=n(Function.toString);r(i.inspectSource)||(i.inspectSource=function(a){return o(a)}),s.exports=i.inspectSource},(s,e,t)=>{var n=t(53),r=t(4),i=t(20),o=t(44),a=t(39),c=t(37),l=t(54),u=t(55),p="Object already initialized",g=r.TypeError,y=r.WeakMap,h,f,d,v=function(m){return d(m)?f(m):h(m,{})},E=function(m){return function(b){var k;if(!i(b)||(k=f(b)).type!==m)throw g("Incompatible receiver, "+m+" required");return k}};if(n||c.state){var O=c.state||(c.state=new y);O.get=O.get,O.has=O.has,O.set=O.set,h=function(m,b){if(O.has(m))throw g(p);return b.facade=m,O.set(m,b),b},f=function(m){return O.get(m)||{}},d=function(m){return O.has(m)}}else{var N=l("state");u[N]=!0,h=function(m,b){if(a(m,N))throw g(p);return b.facade=m,o(m,N,b),b},f=function(m){return a(m,N)?m[N]:{}},d=function(m){return a(m,N)}}s.exports={set:h,get:f,has:d,enforce:v,getterFor:E}},(s,e,t)=>{var n=t(4),r=t(21),i=n.WeakMap;s.exports=r(i)&&/native code/.test(String(i))},(s,e,t)=>{var n=t(35),r=t(41),i=n("keys");s.exports=function(o){return i[o]||(i[o]=r(o))}},s=>{s.exports={}},(s,e,t)=>{var n=t(39),r=t(57),i=t(5),o=t(45);s.exports=function(a,c,l){for(var u=r(c),p=o.f,g=i.f,y=0;y<u.length;y++){var h=u[y];!n(a,h)&&!(l&&n(l,h))&&p(a,h,g(c,h))}}},(s,e,t)=>{var n=t(24),r=t(14),i=t(58),o=t(67),a=t(47),c=r([].concat);s.exports=n("Reflect","ownKeys")||function(u){var p=i.f(a(u)),g=o.f;return g?c(p,g(u)):p}},(s,e,t)=>{var n=t(59),r=t(66),i=r.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(a){return n(a,i)}},(s,e,t)=>{var n=t(14),r=t(39),i=t(12),o=t(60).indexOf,a=t(55),c=n([].push);s.exports=function(l,u){var p=i(l),g=0,y=[],h;for(h in p)!r(a,h)&&r(p,h)&&c(y,h);for(;u.length>g;)r(p,h=u[g++])&&(~o(y,h)||c(y,h));return y}},(s,e,t)=>{var n=t(12),r=t(61),i=t(64),o=function(a){return function(c,l,u){var p=n(c),g=i(p),y=r(u,g),h;if(a&&l!==l){for(;g>y;)if(h=p[y++],h!==h)return!0}else for(;g>y;y++)if((a||y in p)&&p[y]===l)return a||y||0;return!a&&-1}};s.exports={includes:o(!0),indexOf:o(!1)}},(s,e,t)=>{var n=t(62),r=Math.max,i=Math.min;s.exports=function(o,a){var c=n(o);return c<0?r(c+a,0):i(c,a)}},(s,e,t)=>{var n=t(63);s.exports=function(r){var i=+r;return i!==i||i===0?0:n(i)}},s=>{var e=Math.ceil,t=Math.floor;s.exports=Math.trunc||function(r){var i=+r;return(i>0?t:e)(i)}},(s,e,t)=>{var n=t(65);s.exports=function(r){return n(r.length)}},(s,e,t)=>{var n=t(62),r=Math.min;s.exports=function(i){return i>0?r(n(i),9007199254740991):0}},s=>{s.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},(s,e)=>{e.f=Object.getOwnPropertySymbols},(s,e,t)=>{var n=t(7),r=t(21),i=/#|\.prototype\./,o=function(p,g){var y=c[a(p)];return y===u?!0:y===l?!1:r(g)?n(g):!!g},a=o.normalize=function(p){return String(p).replace(i,".").toLowerCase()},c=o.data={},l=o.NATIVE="N",u=o.POLYFILL="P";s.exports=o},(s,e,t)=>{var n=t(9),r=Function.prototype,i=r.apply,o=r.call;s.exports=typeof Reflect=="object"&&Reflect.apply||(n?o.bind(i):function(){return o.apply(i,arguments)})},(s,e,t)=>{var n=t(24),r=t(39),i=t(44),o=t(25),a=t(71),c=t(56),l=t(74),u=t(75),p=t(76),g=t(80),y=t(81),h=t(6),f=t(36);s.exports=function(d,v,E,O){var N="stackTraceLimit",m=O?2:1,b=d.split("."),k=b[b.length-1],T=n.apply(null,b);if(T){var S=T.prototype;if(!f&&r(S,"cause")&&delete S.cause,!E)return T;var F=n("Error"),P=v(function(G,j){var L=p(O?j:G,void 0),K=O?new T(G):new T;return L!==void 0&&i(K,"message",L),y(K,P,K.stack,2),this&&o(S,this)&&u(K,this,P),arguments.length>m&&g(K,arguments[m]),K});if(P.prototype=S,k!=="Error"?a?a(P,F):c(P,F,{name:!0}):h&&N in T&&(l(P,T,N),l(P,T,"prepareStackTrace")),c(P,T),!f)try{S.name!==k&&i(S,"name",k),S.constructor=P}catch{}return P}}},(s,e,t)=>{var n=t(72),r=t(47),i=t(73);s.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,a={},c;try{c=n(Object.prototype,"__proto__","set"),c(a,[]),o=a instanceof Array}catch{}return function(u,p){return r(u),i(p),o?c(u,p):u.__proto__=p,u}}():void 0)},(s,e,t)=>{var n=t(14),r=t(31);s.exports=function(i,o,a){try{return n(r(Object.getOwnPropertyDescriptor(i,o)[a]))}catch{}}},(s,e,t)=>{var n=t(21),r=String,i=TypeError;s.exports=function(o){if(typeof o=="object"||n(o))return o;throw i("Can't set "+r(o)+" as a prototype")}},(s,e,t)=>{var n=t(45).f;s.exports=function(r,i,o){o in r||n(r,o,{configurable:!0,get:function(){return i[o]},set:function(a){i[o]=a}})}},(s,e,t)=>{var n=t(21),r=t(20),i=t(71);s.exports=function(o,a,c){var l,u;return i&&n(l=a.constructor)&&l!==c&&r(u=l.prototype)&&u!==c.prototype&&i(o,u),o}},(s,e,t)=>{var n=t(77);s.exports=function(r,i){return r===void 0?arguments.length<2?"":i:n(r)}},(s,e,t)=>{var n=t(78),r=String;s.exports=function(i){if(n(i)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return r(i)}},(s,e,t)=>{var n=t(79),r=t(21),i=t(15),o=t(34),a=o("toStringTag"),c=Object,l=i(function(){return arguments}())==="Arguments",u=function(p,g){try{return p[g]}catch{}};s.exports=n?i:function(p){var g,y,h;return p===void 0?"Undefined":p===null?"Null":typeof(y=u(g=c(p),a))=="string"?y:l?i(g):(h=i(g))==="Object"&&r(g.callee)?"Arguments":h}},(s,e,t)=>{var n=t(34),r=n("toStringTag"),i={};i[r]="z",s.exports=String(i)==="[object z]"},(s,e,t)=>{var n=t(20),r=t(44);s.exports=function(i,o){n(o)&&"cause"in o&&r(i,"cause",o.cause)}},(s,e,t)=>{var n=t(44),r=t(82),i=t(83),o=Error.captureStackTrace;s.exports=function(a,c,l,u){i&&(o?o(a,c):n(a,"stack",r(l,u)))}},(s,e,t)=>{var n=t(14),r=Error,i=n("".replace),o=function(l){return String(r(l).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,c=a.test(o);s.exports=function(l,u){if(c&&typeof l=="string"&&!r.prepareStackTrace)for(;u--;)l=i(l,a,"");return l}},(s,e,t)=>{var n=t(7),r=t(11);s.exports=!n(function(){var i=Error("a");return"stack"in i?(Object.defineProperty(i,"stack",r(1,7)),i.stack!==7):!0})},(s,e,t)=>{var n=t(48),r=t(14),i=t(77),o=t(85),a=URLSearchParams,c=a.prototype,l=r(c.append),u=r(c.delete),p=r(c.forEach),g=r([].push),y=new a("a=1&a=2&b=3");y.delete("a",1),y.delete("b",void 0),y+""!="a=2"&&n(c,"delete",function(h){var f=arguments.length,d=f<2?void 0:arguments[1];if(f&&d===void 0)return u(this,h);var v=[];p(this,function(S,F){g(v,{key:F,value:S})}),o(f,1);for(var E=i(h),O=i(d),N=0,m=0,b=!1,k=v.length,T;N<k;)T=v[N++],b||T.key===E?(b=!0,u(this,T.key)):m++;for(;m<k;)T=v[m++],T.key===E&&T.value===O||l(this,T.key,T.value)},{enumerable:!0,unsafe:!0})},s=>{var e=TypeError;s.exports=function(t,n){if(t<n)throw e("Not enough arguments");return t}},(s,e,t)=>{var n=t(48),r=t(14),i=t(77),o=t(85),a=URLSearchParams,c=a.prototype,l=r(c.getAll),u=r(c.has),p=new a("a=1");(p.has("a",2)||!p.has("a",void 0))&&n(c,"has",function(y){var h=arguments.length,f=h<2?void 0:arguments[1];if(h&&f===void 0)return u(this,y);var d=l(this,y);o(h,1);for(var v=i(f),E=0;E<d.length;)if(d[E++]===v)return!0;return!1},{enumerable:!0,unsafe:!0})},(s,e,t)=>{var n=t(6),r=t(14),i=t(88),o=URLSearchParams.prototype,a=r(o.forEach);n&&!("size"in o)&&i(o,"size",{get:function(){var l=0;return a(this,function(){l++}),l},configurable:!0,enumerable:!0})},(s,e,t)=>{var n=t(49),r=t(45);s.exports=function(i,o,a){return a.get&&n(a.get,o,{getter:!0}),a.set&&n(a.set,o,{setter:!0}),r.f(i,o,a)}},(s,e,t)=>{var n=t(3),r=t(40),i=t(64),o=t(90),a=t(92),c=t(7),l=c(function(){return[].push.call({length:4294967296},1)!==4294967297}),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(g){return g instanceof TypeError}},p=l||!u();n({target:"Array",proto:!0,arity:1,forced:p},{push:function(y){var h=r(this),f=i(h),d=arguments.length;a(f+d);for(var v=0;v<d;v++)h[f]=arguments[v],f++;return o(h,f),f}})},(s,e,t)=>{var n=t(6),r=t(91),i=TypeError,o=Object.getOwnPropertyDescriptor,a=n&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(c){return c instanceof TypeError}}();s.exports=a?function(c,l){if(r(c)&&!o(c,"length").writable)throw i("Cannot set read only .length");return c.length=l}:function(c,l){return c.length=l}},(s,e,t)=>{var n=t(15);s.exports=Array.isArray||function(i){return n(i)==="Array"}},s=>{var e=TypeError,t=9007199254740991;s.exports=function(n){if(n>t)throw e("Maximum allowed index exceeded");return n}},(s,e,t)=>{var n=t(94),r=t(98).findLast,i=n.aTypedArray,o=n.exportTypedArrayMethod;o("findLast",function(c){return r(i(this),c,arguments.length>1?arguments[1]:void 0)})},(s,e,t)=>{var n=t(95),r=t(6),i=t(4),o=t(21),a=t(20),c=t(39),l=t(78),u=t(32),p=t(44),g=t(48),y=t(88),h=t(25),f=t(96),d=t(71),v=t(34),E=t(41),O=t(52),N=O.enforce,m=O.get,b=i.Int8Array,k=b&&b.prototype,T=i.Uint8ClampedArray,S=T&&T.prototype,F=b&&f(b),P=k&&f(k),G=Object.prototype,j=i.TypeError,L=v("toStringTag"),K=E("TYPED_ARRAY_TAG"),Q="TypedArrayConstructor",ne=n&&!!d&&l(i.opera)!=="Opera",D=!1,$,J,re,pe={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},U={BigInt64Array:8,BigUint64Array:8},w=function(me){if(!a(me))return!1;var he=l(me);return he==="DataView"||c(pe,he)||c(U,he)},_=function(ee){var me=f(ee);if(a(me)){var he=m(me);return he&&c(he,Q)?he[Q]:_(me)}},R=function(ee){if(!a(ee))return!1;var me=l(ee);return c(pe,me)||c(U,me)},V=function(ee){if(R(ee))return ee;throw j("Target is not a typed array")},M=function(ee){if(o(ee)&&(!d||h(F,ee)))return ee;throw j(u(ee)+" is not a typed array constructor")},Y=function(ee,me,he,ye){if(r){if(he)for(var ie in pe){var ve=i[ie];if(ve&&c(ve.prototype,ee))try{delete ve.prototype[ee]}catch{try{ve.prototype[ee]=me}catch{}}}(!P[ee]||he)&&g(P,ee,he?me:ne&&k[ee]||me,ye)}},W=function(ee,me,he){var ye,ie;if(r){if(d){if(he){for(ye in pe)if(ie=i[ye],ie&&c(ie,ee))try{delete ie[ee]}catch{}}if(!F[ee]||he)try{return g(F,ee,he?me:ne&&F[ee]||me)}catch{}else return}for(ye in pe)ie=i[ye],ie&&(!ie[ee]||he)&&g(ie,ee,me)}};for($ in pe)J=i[$],re=J&&J.prototype,re?N(re)[Q]=J:ne=!1;for($ in U)J=i[$],re=J&&J.prototype,re&&(N(re)[Q]=J);if((!ne||!o(F)||F===Function.prototype)&&(F=function(){throw j("Incorrect invocation")},ne))for($ in pe)i[$]&&d(i[$],F);if((!ne||!P||P===G)&&(P=F.prototype,ne))for($ in pe)i[$]&&d(i[$].prototype,P);if(ne&&f(S)!==P&&d(S,P),r&&!c(P,L)){D=!0,y(P,L,{configurable:!0,get:function(){return a(this)?this[K]:void 0}});for($ in pe)i[$]&&p(i[$],K,$)}s.exports={NATIVE_ARRAY_BUFFER_VIEWS:ne,TYPED_ARRAY_TAG:D&&K,aTypedArray:V,aTypedArrayConstructor:M,exportTypedArrayMethod:Y,exportTypedArrayStaticMethod:W,getTypedArrayConstructor:_,isView:w,isTypedArray:R,TypedArray:F,TypedArrayPrototype:P}},s=>{s.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},(s,e,t)=>{var n=t(39),r=t(21),i=t(40),o=t(54),a=t(97),c=o("IE_PROTO"),l=Object,u=l.prototype;s.exports=a?l.getPrototypeOf:function(p){var g=i(p);if(n(g,c))return g[c];var y=g.constructor;return r(y)&&g instanceof y?y.prototype:g instanceof l?u:null}},(s,e,t)=>{var n=t(7);s.exports=!n(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype})},(s,e,t)=>{var n=t(99),r=t(13),i=t(40),o=t(64),a=function(c){var l=c===1;return function(u,p,g){for(var y=i(u),h=r(y),f=n(p,g),d=o(h),v,E;d-- >0;)if(v=h[d],E=f(v,d,y),E)switch(c){case 0:return v;case 1:return d}return l?-1:void 0}};s.exports={findLast:a(0),findLastIndex:a(1)}},(s,e,t)=>{var n=t(100),r=t(31),i=t(9),o=n(n.bind);s.exports=function(a,c){return r(a),c===void 0?a:i?o(a,c):function(){return a.apply(c,arguments)}}},(s,e,t)=>{var n=t(15),r=t(14);s.exports=function(i){if(n(i)==="Function")return r(i)}},(s,e,t)=>{var n=t(94),r=t(98).findLastIndex,i=n.aTypedArray,o=n.exportTypedArrayMethod;o("findLastIndex",function(c){return r(i(this),c,arguments.length>1?arguments[1]:void 0)})},(s,e,t)=>{var n=t(4),r=t(8),i=t(94),o=t(64),a=t(103),c=t(40),l=t(7),u=n.RangeError,p=n.Int8Array,g=p&&p.prototype,y=g&&g.set,h=i.aTypedArray,f=i.exportTypedArrayMethod,d=!l(function(){var E=new Uint8ClampedArray(2);return r(y,E,{length:1,0:3},1),E[1]!==3}),v=d&&i.NATIVE_ARRAY_BUFFER_VIEWS&&l(function(){var E=new p(2);return E.set(1),E.set("2",1),E[0]!==0||E[1]!==2});f("set",function(O){h(this);var N=a(arguments.length>1?arguments[1]:void 0,1),m=c(O);if(d)return r(y,this,m,N);var b=this.length,k=o(m),T=0;if(k+N>b)throw u("Wrong length");for(;T<k;)this[N+T]=m[T++]},!d||v)},(s,e,t)=>{var n=t(104),r=RangeError;s.exports=function(i,o){var a=n(i);if(a%o)throw r("Wrong offset");return a}},(s,e,t)=>{var n=t(62),r=RangeError;s.exports=function(i){var o=n(i);if(o<0)throw r("The argument can't be less than 0");return o}},(s,e,t)=>{var n=t(106),r=t(94),i=r.aTypedArray,o=r.exportTypedArrayMethod,a=r.getTypedArrayConstructor;o("toReversed",function(){return n(i(this),a(this))})},(s,e,t)=>{var n=t(64);s.exports=function(r,i){for(var o=n(r),a=new i(o),c=0;c<o;c++)a[c]=r[o-c-1];return a}},(s,e,t)=>{var n=t(94),r=t(14),i=t(31),o=t(108),a=n.aTypedArray,c=n.getTypedArrayConstructor,l=n.exportTypedArrayMethod,u=r(n.TypedArrayPrototype.sort);l("toSorted",function(g){g!==void 0&&i(g);var y=a(this),h=o(c(y),y);return u(h,g)})},(s,e,t)=>{var n=t(64);s.exports=function(r,i){for(var o=0,a=n(i),c=new r(a);a>o;)c[o]=i[o++];return c}},(s,e,t)=>{var n=t(110),r=t(94),i=t(111),o=t(62),a=t(112),c=r.aTypedArray,l=r.getTypedArrayConstructor,u=r.exportTypedArrayMethod,p=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(g){return g===8}}();u("with",function(g,y){var h=c(this),f=o(g),d=i(h)?a(y):+y;return n(h,l(h),f,d)},!p)},(s,e,t)=>{var n=t(64),r=t(62),i=RangeError;s.exports=function(o,a,c,l){var u=n(o),p=r(c),g=p<0?u+p:p;if(g>=u||g<0)throw i("Incorrect index");for(var y=new a(u),h=0;h<u;h++)y[h]=h===g?l:o[h];return y}},(s,e,t)=>{var n=t(78);s.exports=function(r){var i=n(r);return i==="BigInt64Array"||i==="BigUint64Array"}},(s,e,t)=>{var n=t(19),r=TypeError;s.exports=function(i){var o=n(i,"number");if(typeof o=="number")throw r("Can't convert number to bigint");return BigInt(o)}},(s,e,t)=>{var n=t(6),r=t(88),i=t(114),o=ArrayBuffer.prototype;n&&!("detached"in o)&&r(o,"detached",{configurable:!0,get:function(){return i(this)}})},(s,e,t)=>{var n=t(14),r=t(115),i=n(ArrayBuffer.prototype.slice);s.exports=function(o){if(r(o)!==0)return!1;try{return i(o,0,0),!1}catch{return!0}}},(s,e,t)=>{var n=t(72),r=t(15),i=TypeError;s.exports=n(ArrayBuffer.prototype,"byteLength","get")||function(o){if(r(o)!=="ArrayBuffer")throw i("ArrayBuffer expected");return o.byteLength}},(s,e,t)=>{var n=t(3),r=t(117);r&&n({target:"ArrayBuffer",proto:!0},{transfer:function(){return r(this,arguments.length?arguments[0]:void 0,!0)}})},(s,e,t)=>{var n=t(4),r=t(14),i=t(72),o=t(118),a=t(114),c=t(115),l=t(119),u=n.TypeError,p=n.structuredClone,g=n.ArrayBuffer,y=n.DataView,h=Math.min,f=g.prototype,d=y.prototype,v=r(f.slice),E=i(f,"resizable","get"),O=i(f,"maxByteLength","get"),N=r(d.getInt8),m=r(d.setInt8);s.exports=l&&function(b,k,T){var S=c(b),F=k===void 0?S:o(k),P=!E||!E(b);if(a(b))throw u("ArrayBuffer is detached");var G=p(b,{transfer:[b]});if(S===F&&(T||P))return G;if(S>=F&&(!T||P))return v(G,0,F);for(var j=T&&!P&&O?{maxByteLength:O(G)}:void 0,L=new g(F,j),K=new y(G),Q=new y(L),ne=h(F,S),D=0;D<ne;D++)m(Q,D,N(K,D));return L}},(s,e,t)=>{var n=t(62),r=t(65),i=RangeError;s.exports=function(o){if(o===void 0)return 0;var a=n(o),c=r(a);if(a!==c)throw i("Wrong length or index");return c}},(s,e,t)=>{var n=t(4),r=t(7),i=t(28),o=t(120),a=t(121),c=t(122),l=n.structuredClone;s.exports=!!l&&!r(function(){if(a&&i>92||c&&i>94||o&&i>97)return!1;var u=new ArrayBuffer(8),p=l(u,{transfer:[u]});return u.byteLength!==0||p.byteLength!==8})},(s,e,t)=>{var n=t(121),r=t(122);s.exports=!n&&!r&&typeof window=="object"&&typeof document=="object"},s=>{s.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},(s,e,t)=>{var n=t(4),r=t(15);s.exports=r(n.process)==="process"},(s,e,t)=>{var n=t(3),r=t(117);r&&n({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return r(this,arguments.length?arguments[0]:void 0,!1)}})},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var s,t,n,r,St,o,Ft,c,l,u,p,g,y,h,f,d,Dt,E,O,jt,m,b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0,__w_pdfjs_require__(84),__w_pdfjs_require__(86),__w_pdfjs_require__(87),__w_pdfjs_require__(2),__w_pdfjs_require__(93),__w_pdfjs_require__(101),__w_pdfjs_require__(102),__w_pdfjs_require__(105),__w_pdfjs_require__(107),__w_pdfjs_require__(109),__w_pdfjs_require__(113),__w_pdfjs_require__(116),__w_pdfjs_require__(123),__w_pdfjs_require__(89),__w_pdfjs_require__(125),__w_pdfjs_require__(136),__w_pdfjs_require__(138),__w_pdfjs_require__(141),__w_pdfjs_require__(143),__w_pdfjs_require__(145),__w_pdfjs_require__(147),__w_pdfjs_require__(149),__w_pdfjs_require__(152);var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(163),_display_utils=__w_pdfjs_require__(168),_font_loader=__w_pdfjs_require__(171),_displayNode_utils=__w_pdfjs_require__(172),_canvas=__w_pdfjs_require__(173),_worker_options=__w_pdfjs_require__(176),_message_handler=__w_pdfjs_require__(177),_metadata=__w_pdfjs_require__(178),_optional_content_config=__w_pdfjs_require__(179),_transport_stream=__w_pdfjs_require__(180),_displayFetch_stream=__w_pdfjs_require__(181),_displayNetwork=__w_pdfjs_require__(184),_displayNode_stream=__w_pdfjs_require__(185),_displaySvg=__w_pdfjs_require__(186),_xfa_text=__w_pdfjs_require__(194);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(T){if(typeof T=="string"||T instanceof URL?T={url:T}:(0,_util.isArrayBuffer)(T)&&(T={data:T}),typeof T!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!T.url&&!T.data&&!T.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const S=new PDFDocumentLoadingTask,{docId:F}=S,P=T.url?getUrlProp(T.url):null,G=T.data?getDataProp(T.data):null,j=T.httpHeaders||null,L=T.withCredentials===!0,K=T.password??null,Q=T.range instanceof PDFDataRangeTransport?T.range:null,ne=Number.isInteger(T.rangeChunkSize)&&T.rangeChunkSize>0?T.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let D=T.worker instanceof PDFWorker?T.worker:null;const $=T.verbosity,J=typeof T.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(T.docBaseUrl)?T.docBaseUrl:null,re=typeof T.cMapUrl=="string"?T.cMapUrl:null,pe=T.cMapPacked!==!1,U=T.CMapReaderFactory||DefaultCMapReaderFactory,w=typeof T.standardFontDataUrl=="string"?T.standardFontDataUrl:null,_=T.StandardFontDataFactory||DefaultStandardFontDataFactory,R=T.stopAtErrors!==!0,V=Number.isInteger(T.maxImageSize)&&T.maxImageSize>-1?T.maxImageSize:-1,M=T.isEvalSupported!==!1,Y=typeof T.isOffscreenCanvasSupported=="boolean"?T.isOffscreenCanvasSupported:!_util.isNodeJS,W=Number.isInteger(T.canvasMaxAreaInBytes)?T.canvasMaxAreaInBytes:-1,ee=typeof T.disableFontFace=="boolean"?T.disableFontFace:_util.isNodeJS,me=T.fontExtraProperties===!0,he=T.enableXfa===!0,ye=T.ownerDocument||globalThis.document,ie=T.disableRange===!0,ve=T.disableStream===!0,Ne=T.disableAutoFetch===!0,Fe=T.pdfBug===!0,Le=Q?Q.length:T.length??NaN,ke=typeof T.useSystemFonts=="boolean"?T.useSystemFonts:!_util.isNodeJS&&!ee,ze=typeof T.useWorkerFetch=="boolean"?T.useWorkerFetch:U===_display_utils.DOMCMapReaderFactory&&_===_display_utils.DOMStandardFontDataFactory&&re&&w&&(0,_display_utils.isValidFetchUrl)(re,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(w,document.baseURI),Oe=T.canvasFactory||new DefaultCanvasFactory({ownerDocument:ye}),be=T.filterFactory||new DefaultFilterFactory({docId:F,ownerDocument:ye}),fe=null;(0,_util.setVerbosityLevel)($);const Ce={canvasFactory:Oe,filterFactory:be};if(ze||(Ce.cMapReaderFactory=new U({baseUrl:re,isCompressed:pe}),Ce.standardFontDataFactory=new _({baseUrl:w})),!D){const Ye={verbosity:$,port:_worker_options.GlobalWorkerOptions.workerPort};D=Ye.port?PDFWorker.fromPort(Ye):new PDFWorker(Ye),S._worker=D}const Me={docId:F,apiVersion:"3.10.111",data:G,password:K,disableAutoFetch:Ne,rangeChunkSize:ne,length:Le,docBaseUrl:J,enableXfa:he,evaluatorOptions:{maxImageSize:V,disableFontFace:ee,ignoreErrors:R,isEvalSupported:M,isOffscreenCanvasSupported:Y,canvasMaxAreaInBytes:W,fontExtraProperties:me,useSystemFonts:ke,cMapUrl:ze?re:null,standardFontDataUrl:ze?w:null}},Ge={ignoreErrors:R,isEvalSupported:M,disableFontFace:ee,fontExtraProperties:me,enableXfa:he,ownerDocument:ye,disableAutoFetch:Ne,pdfBug:Fe,styleElement:fe};return D.promise.then(function(){if(S.destroyed)throw new Error("Loading aborted");const Ye=_fetchDocument(D,Me),je=new Promise(function(Ve){let We;Q?We=new _transport_stream.PDFDataTransportStream({length:Le,initialData:Q.initialData,progressiveDone:Q.progressiveDone,contentDispositionFilename:Q.contentDispositionFilename,disableRange:ie,disableStream:ve},Q):G||(We=(Ze=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(Ze):(0,_display_utils.isValidFetchUrl)(Ze.url)?new _displayFetch_stream.PDFFetchStream(Ze):new _displayNetwork.PDFNetworkStream(Ze))({url:P,length:Le,httpHeaders:j,withCredentials:L,rangeChunkSize:ne,disableRange:ie,disableStream:ve})),Ve(We)});return Promise.all([Ye,je]).then(function(Ve){let[We,qe]=Ve;if(S.destroyed)throw new Error("Loading aborted");const Ze=new _message_handler.MessageHandler(F,We,D.port),Qe=new WorkerTransport(Ze,S,qe,Ge,Ce);S._transport=Qe,Ze.send("Ready",null)})}).catch(S._capability.reject),S}async function _fetchDocument(T,S){if(T.destroyed)throw new Error("Worker was destroyed");const F=await T.messageHandler.sendWithPromise("GetDocRequest",S,S.data?[S.data.buffer]:null);if(T.destroyed)throw new Error("Worker was destroyed");return F}function getUrlProp(T){if(T instanceof URL)return T.href;try{return new URL(T,window.location).href}catch{if(_util.isNodeJS&&typeof T=="string")return T}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(T){if(_util.isNodeJS&&typeof Buffer<"u"&&T instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(T instanceof Uint8Array&&T.byteLength===T.buffer.byteLength)return T;if(typeof T=="string")return(0,_util.stringToBytes)(T);if(typeof T=="object"&&!isNaN(T==null?void 0:T.length)||(0,_util.isArrayBuffer)(T))return new Uint8Array(T);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const e=class e{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${_t(e,s)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var S,F,P;this.destroyed=!0;try{(S=this._worker)!=null&&S.port&&(this._worker._pendingDestroy=!0),await((F=this._transport)==null?void 0:F.destroy())}catch(G){throw(P=this._worker)!=null&&P.port&&delete this._worker._pendingDestroy,G}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};s=new WeakMap,se(e,s,0);let PDFDocumentLoadingTask=e;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(S,F){let P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,G=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this.length=S,this.initialData=F,this.progressiveDone=P,this.contentDispositionFilename=G,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(S){this._rangeListeners.push(S)}addProgressListener(S){this._progressListeners.push(S)}addProgressiveReadListener(S){this._progressiveReadListeners.push(S)}addProgressiveDoneListener(S){this._progressiveDoneListeners.push(S)}onDataRange(S,F){for(const P of this._rangeListeners)P(S,F)}onDataProgress(S,F){this._readyCapability.promise.then(()=>{for(const P of this._progressListeners)P(S,F)})}onDataProgressiveRead(S){this._readyCapability.promise.then(()=>{for(const F of this._progressiveReadListeners)F(S)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const S of this._progressiveDoneListeners)S()})}transportReady(){this._readyCapability.resolve()}requestDataRange(S,F){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(S,F){this._pdfInfo=S,this._transport=F,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(P=>{if(!P)return P;const G=[];for(const j in P)G.push(...P[j]);return G}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(S){return this._transport.getPage(S)}getPageIndex(S){return this._transport.getPageIndex(S)}getDestinations(){return this._transport.getDestinations()}getDestination(S){return this._transport.getDestination(S)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this._transport.startCleanup(S||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(S,F,P){se(this,r);se(this,o);se(this,t,null);se(this,n,!1);let G=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this._pageIndex=S,this._pageInfo=F,this._transport=P,this._stats=G?new _display_utils.StatTimer:null,this._pdfBug=G,this.commonObjs=P.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:S,rotation:F=this.rotate,offsetX:P=0,offsetY:G=0,dontFlip:j=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new _display_utils.PageViewport({viewBox:this.view,scale:S,rotation:F,offsetX:P,offsetY:G,dontFlip:j})}getAnnotations(){let{intent:S="display"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const F=this._transport.getRenderingIntent(S);return this._transport.getAnnotations(this._pageIndex,F.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var S;return((S=this._transport._htmlForXfa)==null?void 0:S.children[this._pageIndex])||null}render(S){var R,V;let{canvasContext:F,viewport:P,intent:G="display",annotationMode:j=_util.AnnotationMode.ENABLE,transform:L=null,background:K=null,optionalContentConfigPromise:Q=null,annotationCanvasMap:ne=null,pageColors:D=null,printAnnotationStorage:$=null}=S;(R=this._stats)==null||R.time("Overall");const J=this._transport.getRenderingIntent(G,j,$);Ae(this,n,!1),le(this,o,Ft).call(this),Q||(Q=this._transport.getOptionalContentConfig());let re=this._intentStates.get(J.cacheKey);re||(re=Object.create(null),this._intentStates.set(J.cacheKey,re)),re.streamReaderCancelTimeout&&(clearTimeout(re.streamReaderCancelTimeout),re.streamReaderCancelTimeout=null);const pe=!!(J.renderingIntent&_util.RenderingIntentFlag.PRINT);re.displayReadyCapability||(re.displayReadyCapability=new _util.PromiseCapability,re.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(V=this._stats)==null||V.time("Page Request"),this._pumpOperatorList(J));const U=M=>{var Y,W;re.renderTasks.delete(w),(this._maybeCleanupAfterRender||pe)&&Ae(this,n,!0),le(this,r,St).call(this,!pe),M?(w.capability.reject(M),this._abortOperatorList({intentState:re,reason:M instanceof Error?M:new Error(M)})):w.capability.resolve(),(Y=this._stats)==null||Y.timeEnd("Rendering"),(W=this._stats)==null||W.timeEnd("Overall")},w=new InternalRenderTask({callback:U,params:{canvasContext:F,viewport:P,transform:L,background:K},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:ne,operatorList:re.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!pe,pdfBug:this._pdfBug,pageColors:D});(re.renderTasks||(re.renderTasks=new Set)).add(w);const _=w.task;return Promise.all([re.displayReadyCapability.promise,Q]).then(M=>{var ee;let[Y,W]=M;if(this.destroyed){U();return}(ee=this._stats)==null||ee.time("Rendering"),w.initializeGraphics({transparency:Y,optionalContentConfig:W}),w.operatorListChanged()}).catch(U),_}getOperatorList(){var Q;let{intent:S="display",annotationMode:F=_util.AnnotationMode.ENABLE,printAnnotationStorage:P=null}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};function G(){L.operatorList.lastChunk&&(L.opListReadCapability.resolve(L.operatorList),L.renderTasks.delete(K))}const j=this._transport.getRenderingIntent(S,F,P,!0);let L=this._intentStates.get(j.cacheKey);L||(L=Object.create(null),this._intentStates.set(j.cacheKey,L));let K;return L.opListReadCapability||(K=Object.create(null),K.operatorListChanged=G,L.opListReadCapability=new _util.PromiseCapability,(L.renderTasks||(L.renderTasks=new Set)).add(K),L.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Q=this._stats)==null||Q.time("Page Request"),this._pumpOperatorList(j)),L.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:S=!1,disableNormalization:F=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const P=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:S===!0,disableNormalization:F===!0},{highWaterMark:P,size(G){return G.items.length}})}getTextContent(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(P=>_xfa_text.XfaText.textContent(P));const F=this.streamTextContent(S);return new Promise(function(P,G){function j(){L.read().then(function(Q){let{value:ne,done:D}=Q;if(D){P(K);return}Object.assign(K.styles,ne.styles),K.items.push(...ne.items),j()},G)}const L=F.getReader(),K={items:[],styles:Object.create(null)};j()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const S=[];for(const F of this._intentStates.values())if(this._abortOperatorList({intentState:F,reason:new Error("Page was destroyed."),force:!0}),!F.opListReadCapability)for(const P of F.renderTasks)S.push(P.completed),P.cancel();return this.objs.clear(),Ae(this,n,!1),le(this,o,Ft).call(this),Promise.all(S)}cleanup(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;Ae(this,n,!0);const F=le(this,r,St).call(this,!1);return S&&F&&this._stats&&(this._stats=new _display_utils.StatTimer),F}_startRenderPage(S,F){var G,j;const P=this._intentStates.get(F);P&&((G=this._stats)==null||G.timeEnd("Page Request"),(j=P.displayReadyCapability)==null||j.resolve(S))}_renderPageChunk(S,F){for(let P=0,G=S.length;P<G;P++)F.operatorList.fnArray.push(S.fnArray[P]),F.operatorList.argsArray.push(S.argsArray[P]);F.operatorList.lastChunk=S.lastChunk,F.operatorList.separateAnnots=S.separateAnnots;for(const P of F.renderTasks)P.operatorListChanged();S.lastChunk&&le(this,r,St).call(this,!0)}_pumpOperatorList(S){let{renderingIntent:F,cacheKey:P,annotationStorageSerializable:G}=S;const{map:j,transfers:L}=G,Q=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:F,cacheKey:P,annotationStorage:j},L).getReader(),ne=this._intentStates.get(P);ne.streamReader=Q;const D=()=>{Q.read().then($=>{let{value:J,done:re}=$;if(re){ne.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(J,ne),D())},$=>{if(ne.streamReader=null,!this._transport.destroyed){if(ne.operatorList){ne.operatorList.lastChunk=!0;for(const J of ne.renderTasks)J.operatorListChanged();le(this,r,St).call(this,!0)}if(ne.displayReadyCapability)ne.displayReadyCapability.reject($);else if(ne.opListReadCapability)ne.opListReadCapability.reject($);else throw $}})};D()}_abortOperatorList(S){let{intentState:F,reason:P,force:G=!1}=S;if(F.streamReader){if(F.streamReaderCancelTimeout&&(clearTimeout(F.streamReaderCancelTimeout),F.streamReaderCancelTimeout=null),!G){if(F.renderTasks.size>0)return;if(P instanceof _display_utils.RenderingCancelledException){let j=RENDERING_CANCELLED_TIMEOUT;P.extraDelay>0&&P.extraDelay<1e3&&(j+=P.extraDelay),F.streamReaderCancelTimeout=setTimeout(()=>{F.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:F,reason:P,force:!0})},j);return}}if(F.streamReader.cancel(new _util.AbortException(P.message)).catch(()=>{}),F.streamReader=null,!this._transport.destroyed){for(const[j,L]of this._intentStates)if(L===F){this._intentStates.delete(j);break}this.cleanup()}}}get stats(){return this._stats}}t=new WeakMap,n=new WeakMap,r=new WeakSet,St=function(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(le(this,o,Ft).call(this),!x(this,n)||this.destroyed)return!1;if(S)return Ae(this,t,setTimeout(()=>{Ae(this,t,null),le(this,r,St).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:F,operatorList:P}of this._intentStates.values())if(F.size>0||!P.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),Ae(this,n,!1),!0},o=new WeakSet,Ft=function(){x(this,t)&&(clearTimeout(x(this,t)),Ae(this,t,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){se(this,c,new Set);se(this,l,Promise.resolve())}postMessage(S,F){const P={data:structuredClone(S,null)};x(this,l).then(()=>{for(const G of x(this,c))G.call(this,P)})}addEventListener(S,F){x(this,c).add(F)}removeEventListener(S,F){x(this,c).delete(F)}terminate(){x(this,c).clear()}}c=new WeakMap,l=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const T=(u=document==null?void 0:document.currentScript)==null?void 0:u.src;T&&(PDFWorkerUtil.fallbackWorkerSrc=T.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(T,S){let F;try{if(F=new URL(T),!F.origin||F.origin==="null")return!1}catch{return!1}const P=new URL(S,F);return F.origin===P.origin},PDFWorkerUtil.createCDNWrapper=function(T){const S=`importScripts("${T}");`;return URL.createObjectURL(new Blob([S]))}}const _PDFWorker=class _PDFWorker{constructor(){var P;let{name:T=null,port:S=null,verbosity:F=(0,_util.getVerbosityLevel)()}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.name=T,this.destroyed=!1,this.verbosity=F,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,S){if((P=x(_PDFWorker,p))!=null&&P.has(S))throw new Error("Cannot use more than one PDFWorker per port.");(x(_PDFWorker,p)||Ae(_PDFWorker,p,new WeakMap)).set(S,this),this._initializeFromPort(S);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(T){this._port=T,this._messageHandler=new _message_handler.MessageHandler("main","worker",T),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:T}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,T)||(T=PDFWorkerUtil.createCDNWrapper(new URL(T,window.location).href));const S=new Worker(T),F=new _message_handler.MessageHandler("main","worker",S),P=()=>{S.removeEventListener("error",G),F.destroy(),S.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},G=()=>{this._webWorker||P()};S.addEventListener("error",G),F.on("test",L=>{if(S.removeEventListener("error",G),this.destroyed){P();return}L?(this._messageHandler=F,this._port=S,this._webWorker=S,this._readyCapability.resolve(),F.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),F.destroy(),S.terminate())}),F.on("ready",L=>{if(S.removeEventListener("error",G),this.destroyed){P();return}try{j()}catch{this._setupFakeWorker()}});const j=()=>{const L=new Uint8Array;F.send("test",L,[L.buffer])};j();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(T=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const S=new LoopbackPort;this._port=S;const F=`fake${PDFWorkerUtil.fakeWorkerId++}`,P=new _message_handler.MessageHandler(F+"_worker",F,S);T.setup(P,S);const G=new _message_handler.MessageHandler(F,F+"_worker",S);this._messageHandler=G,this._readyCapability.resolve(),G.send("configure",{verbosity:this.verbosity})}).catch(T=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${T.message}".`))})}destroy(){var T;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(T=x(_PDFWorker,p))==null||T.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(T){var F;if(!(T!=null&&T.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const S=(F=x(this,p))==null?void 0:F.get(T.port);if(S){if(S._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return S}return new _PDFWorker(T)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var T;try{return((T=globalThis.pdfjsWorker)==null?void 0:T.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};p=new WeakMap,se(_PDFWorker,p,void 0);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(S,F,P,G,j){se(this,d);se(this,g,new Map);se(this,y,new Map);se(this,h,new Map);se(this,f,null);this.messageHandler=S,this.loadingTask=F,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:G.ownerDocument,styleElement:G.styleElement}),this._params=G,this.canvasFactory=j.canvasFactory,this.filterFactory=j.filterFactory,this.cMapReaderFactory=j.cMapReaderFactory,this.standardFontDataFactory=j.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=P,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(S){let F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_util.AnnotationMode.ENABLE,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,G=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,j=_util.RenderingIntentFlag.DISPLAY,L=_annotation_storage.SerializableEmpty;switch(S){case"any":j=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":j=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${S}`)}switch(F){case _util.AnnotationMode.DISABLE:j+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:j+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:j+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,L=(j&_util.RenderingIntentFlag.PRINT&&P instanceof _annotation_storage.PrintAnnotationStorage?P:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${F}`)}return G&&(j+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:j,cacheKey:`${j}_${L.hash}`,annotationStorageSerializable:L}}destroy(){var P;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(P=x(this,f))==null||P.reject(new Error("Worker was destroyed during onPassword callback"));const S=[];for(const G of x(this,y).values())S.push(G._destroy());x(this,y).clear(),x(this,h).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const F=this.messageHandler.sendWithPromise("Terminate",null);return S.push(F),Promise.all(S).then(()=>{var G;this.commonObjs.clear(),this.fontLoader.clear(),x(this,g).clear(),this.filterFactory.destroy(),(G=this._networkStream)==null||G.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:S,loadingTask:F}=this;S.on("GetReader",(P,G)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=j=>{this._lastProgress={loaded:j.loaded,total:j.total}},G.onPull=()=>{this._fullReader.read().then(function(j){let{value:L,done:K}=j;if(K){G.close();return}(0,_util.assert)(L instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),G.enqueue(new Uint8Array(L),1,[L])}).catch(j=>{G.error(j)})},G.onCancel=j=>{this._fullReader.cancel(j),G.ready.catch(L=>{if(!this.destroyed)throw L})}}),S.on("ReaderHeadersReady",P=>{const G=new _util.PromiseCapability,j=this._fullReader;return j.headersReady.then(()=>{var L;(!j.isStreamingSupported||!j.isRangeSupported)&&(this._lastProgress&&((L=F.onProgress)==null||L.call(F,this._lastProgress)),j.onProgress=K=>{var Q;(Q=F.onProgress)==null||Q.call(F,{loaded:K.loaded,total:K.total})}),G.resolve({isStreamingSupported:j.isStreamingSupported,isRangeSupported:j.isRangeSupported,contentLength:j.contentLength})},G.reject),G.promise}),S.on("GetRangeReader",(P,G)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const j=this._networkStream.getRangeReader(P.begin,P.end);if(!j){G.close();return}G.onPull=()=>{j.read().then(function(L){let{value:K,done:Q}=L;if(Q){G.close();return}(0,_util.assert)(K instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),G.enqueue(new Uint8Array(K),1,[K])}).catch(L=>{G.error(L)})},G.onCancel=L=>{j.cancel(L),G.ready.catch(K=>{if(!this.destroyed)throw K})}}),S.on("GetDoc",P=>{let{pdfInfo:G}=P;this._numPages=G.numPages,this._htmlForXfa=G.htmlForXfa,delete G.htmlForXfa,F._capability.resolve(new PDFDocumentProxy(G,this))}),S.on("DocException",function(P){let G;switch(P.name){case"PasswordException":G=new _util.PasswordException(P.message,P.code);break;case"InvalidPDFException":G=new _util.InvalidPDFException(P.message);break;case"MissingPDFException":G=new _util.MissingPDFException(P.message);break;case"UnexpectedResponseException":G=new _util.UnexpectedResponseException(P.message,P.status);break;case"UnknownErrorException":G=new _util.UnknownErrorException(P.message,P.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}F._capability.reject(G)}),S.on("PasswordRequest",P=>{if(Ae(this,f,new _util.PromiseCapability),F.onPassword){const G=j=>{j instanceof Error?x(this,f).reject(j):x(this,f).resolve({password:j})};try{F.onPassword(G,P.code)}catch(j){x(this,f).reject(j)}}else x(this,f).reject(new _util.PasswordException(P.message,P.code));return x(this,f).promise}),S.on("DataLoaded",P=>{var G;(G=F.onProgress)==null||G.call(F,{loaded:P.length,total:P.length}),this.downloadInfoCapability.resolve(P)}),S.on("StartRenderPage",P=>{if(this.destroyed)return;x(this,y).get(P.pageIndex)._startRenderPage(P.transparency,P.cacheKey)}),S.on("commonobj",P=>{var K;let[G,j,L]=P;if(!this.destroyed&&!this.commonObjs.has(G))switch(j){case"Font":const Q=this._params;if("error"in L){const $=L.error;(0,_util.warn)(`Error during font loading: ${$}`),this.commonObjs.resolve(G,$);break}const ne=Q.pdfBug&&((K=globalThis.FontInspector)!=null&&K.enabled)?($,J)=>globalThis.FontInspector.fontAdded($,J):null,D=new _font_loader.FontFaceObject(L,{isEvalSupported:Q.isEvalSupported,disableFontFace:Q.disableFontFace,ignoreErrors:Q.ignoreErrors,inspectFont:ne});this.fontLoader.bind(D).catch($=>S.sendWithPromise("FontFallback",{id:G})).finally(()=>{!Q.fontExtraProperties&&D.data&&(D.data=null),this.commonObjs.resolve(G,D)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(G,L);break;default:throw new Error(`Got unknown common object type ${j}`)}}),S.on("obj",P=>{var ne;let[G,j,L,K]=P;if(this.destroyed)return;const Q=x(this,y).get(j);if(!Q.objs.has(G))switch(L){case"Image":if(Q.objs.resolve(G,K),K){let D;if(K.bitmap){const{width:$,height:J}=K;D=$*J*4}else D=((ne=K.data)==null?void 0:ne.length)||0;D>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Q._maybeCleanupAfterRender=!0)}break;case"Pattern":Q.objs.resolve(G,K);break;default:throw new Error(`Got unknown object type ${L}`)}}),S.on("DocProgress",P=>{var G;this.destroyed||(G=F.onProgress)==null||G.call(F,{loaded:P.loaded,total:P.total})}),S.on("FetchBuiltInCMap",P=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(P):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),S.on("FetchStandardFontData",P=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(P):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var P;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:S,transfers:F}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:S,filename:((P=this._fullReader)==null?void 0:P.filename)??null},F).finally(()=>{this.annotationStorage.resetModified()})}getPage(S){if(!Number.isInteger(S)||S<=0||S>this._numPages)return Promise.reject(new Error("Invalid page request."));const F=S-1,P=x(this,h).get(F);if(P)return P;const G=this.messageHandler.sendWithPromise("GetPage",{pageIndex:F}).then(j=>{if(this.destroyed)throw new Error("Transport destroyed");const L=new PDFPageProxy(F,j,this,this._params.pdfBug);return x(this,y).set(F,L),L});return x(this,h).set(F,G),G}getPageIndex(S){return typeof S!="object"||S===null||!Number.isInteger(S.num)||S.num<0||!Number.isInteger(S.gen)||S.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:S.num,gen:S.gen})}getAnnotations(S,F){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:S,intent:F})}getFieldObjects(){return le(this,d,Dt).call(this,"GetFieldObjects")}hasJSActions(){return le(this,d,Dt).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(S){return typeof S!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:S})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return le(this,d,Dt).call(this,"GetDocJSActions")}getPageJSActions(S){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:S})}getStructTree(S){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:S})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(S=>new _optional_content_config.OptionalContentConfig(S))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const S="GetMetadata",F=x(this,g).get(S);if(F)return F;const P=this.messageHandler.sendWithPromise(S,null).then(G=>{var j,L;return{info:G[0],metadata:G[1]?new _metadata.Metadata(G[1]):null,contentDispositionFilename:((j=this._fullReader)==null?void 0:j.filename)??null,contentLength:((L=this._fullReader)==null?void 0:L.contentLength)??null}});return x(this,g).set(S,P),P}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const F of x(this,y).values())if(!F.cleanup())throw new Error(`startCleanup: Page ${F.pageNumber} is currently rendering.`);this.commonObjs.clear(),S||this.fontLoader.clear(),x(this,g).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:S,enableXfa:F}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:S,enableXfa:F})}}g=new WeakMap,y=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakSet,Dt=function(S){let F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const P=x(this,g).get(S);if(P)return P;const G=this.messageHandler.sendWithPromise(S,F);return x(this,g).set(S,G),G};class PDFObjects{constructor(){se(this,O);se(this,E,Object.create(null))}get(S){let F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(F){const G=le(this,O,jt).call(this,S);return G.capability.promise.then(()=>F(G.data)),null}const P=x(this,E)[S];if(!(P!=null&&P.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${S}.`);return P.data}has(S){const F=x(this,E)[S];return(F==null?void 0:F.capability.settled)||!1}resolve(S){let F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const P=le(this,O,jt).call(this,S);P.data=F,P.capability.resolve()}clear(){var S;for(const F in x(this,E)){const{data:P}=x(this,E)[F];(S=P==null?void 0:P.bitmap)==null||S.close()}Ae(this,E,Object.create(null))}}E=new WeakMap,O=new WeakSet,jt=function(S){var F;return(F=x(this,E))[S]||(F[S]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(S){se(this,m,null);Ae(this,m,S),this.onContinue=null}get promise(){return x(this,m).capability.promise}cancel(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;x(this,m).cancel(null,S)}get separateAnnots(){const{separateAnnots:S}=x(this,m).operatorList;if(!S)return!1;const{annotationCanvasMap:F}=x(this,m);return S.form||S.canvas&&(F==null?void 0:F.size)>0}}m=new WeakMap,exports.RenderTask=RenderTask;const k=class k{constructor(S){let{callback:F,params:P,objs:G,commonObjs:j,annotationCanvasMap:L,operatorList:K,pageIndex:Q,canvasFactory:ne,filterFactory:D,useRequestAnimationFrame:$=!1,pdfBug:J=!1,pageColors:re=null}=S;this.callback=F,this.params=P,this.objs=G,this.commonObjs=j,this.annotationCanvasMap=L,this.operatorListIdx=null,this.operatorList=K,this._pageIndex=Q,this.canvasFactory=ne,this.filterFactory=D,this._pdfBug=J,this.pageColors=re,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=$===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=P.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(S){var Q,ne;let{transparency:F=!1,optionalContentConfig:P}=S;if(this.cancelled)return;if(this._canvas){if(x(k,b).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");x(k,b).add(this._canvas)}this._pdfBug&&((Q=globalThis.StepperManager)!=null&&Q.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:G,viewport:j,transform:L,background:K}=this.params;this.gfx=new _canvas.CanvasGraphics(G,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:P},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:L,viewport:j,transparency:F,background:K}),this.operatorListIdx=0,this.graphicsReady=!0,(ne=this.graphicsReadyCallback)==null||ne.call(this)}cancel(){var P;let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.running=!1,this.cancelled=!0,(P=this.gfx)==null||P.endDrawing(),this._canvas&&x(k,b).delete(this._canvas),this.callback(S||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,F))}operatorListChanged(){var S;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(S=this.stepper)==null||S.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&x(k,b).delete(this._canvas),this.callback())))}};b=new WeakMap,se(k,b,new WeakSet);let InternalRenderTask=k;const version="3.10.111";exports.version=version;const build="e142baecb";exports.build=build},(s,e,t)=>{var n=t(3),r=t(126),i=t(135);n({target:"Set",proto:!0,real:!0,forced:!i("difference")},{difference:r})},(s,e,t)=>{var n=t(127),r=t(128),i=t(129),o=t(132),a=t(133),c=t(130),l=t(131),u=r.has,p=r.remove;s.exports=function(y){var h=n(this),f=a(y),d=i(h);return o(h)<=f.size?c(h,function(v){f.includes(v)&&p(d,v)}):l(f.getIterator(),function(v){u(h,v)&&p(d,v)}),d}},(s,e,t)=>{var n=t(128).has;s.exports=function(r){return n(r),r}},(s,e,t)=>{var n=t(14),r=Set.prototype;s.exports={Set,add:n(r.add),has:n(r.has),remove:n(r.delete),proto:r}},(s,e,t)=>{var n=t(128),r=t(130),i=n.Set,o=n.add;s.exports=function(a){var c=new i;return r(a,function(l){o(c,l)}),c}},(s,e,t)=>{var n=t(14),r=t(131),i=t(128),o=i.Set,a=i.proto,c=n(a.forEach),l=n(a.keys),u=l(new o).next;s.exports=function(p,g,y){return y?r({iterator:l(p),next:u},g):c(p,g)}},(s,e,t)=>{var n=t(8);s.exports=function(r,i,o){for(var a=o?r:r.iterator,c=r.next,l,u;!(l=n(c,a)).done;)if(u=i(l.value),u!==void 0)return u}},(s,e,t)=>{var n=t(72),r=t(128);s.exports=n(r.proto,"size","get")||function(i){return i.size}},(s,e,t)=>{var n=t(31),r=t(47),i=t(8),o=t(62),a=t(134),c="Invalid size",l=RangeError,u=TypeError,p=Math.max,g=function(y,h,f,d){this.set=y,this.size=h,this.has=f,this.keys=d};g.prototype={getIterator:function(){return a(r(i(this.keys,this.set)))},includes:function(y){return i(this.has,this.set,y)}},s.exports=function(y){r(y);var h=+y.size;if(h!==h)throw u(c);var f=o(h);if(f<0)throw l(c);return new g(y,p(f,0),n(y.has),n(y.keys))}},s=>{s.exports=function(e){return{iterator:e,next:e.next,done:!1}}},(s,e,t)=>{var n=t(24),r=function(i){return{size:i,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};s.exports=function(i){var o=n("Set");try{new o()[i](r(0));try{return new o()[i](r(-1)),!1}catch{return!0}}catch{return!1}}},(s,e,t)=>{var n=t(3),r=t(7),i=t(137),o=t(135),a=!o("intersection")||r(function(){return Array.from(new Set([1,2,3]).intersection(new Set([3,2])))!=="3,2"});n({target:"Set",proto:!0,real:!0,forced:a},{intersection:i})},(s,e,t)=>{var n=t(127),r=t(128),i=t(132),o=t(133),a=t(130),c=t(131),l=r.Set,u=r.add,p=r.has;s.exports=function(y){var h=n(this),f=o(y),d=new l;return i(h)>f.size?c(f.getIterator(),function(v){p(h,v)&&u(d,v)}):a(h,function(v){f.includes(v)&&u(d,v)}),d}},(s,e,t)=>{var n=t(3),r=t(139),i=t(135);n({target:"Set",proto:!0,real:!0,forced:!i("isDisjointFrom")},{isDisjointFrom:r})},(s,e,t)=>{var n=t(127),r=t(128).has,i=t(132),o=t(133),a=t(130),c=t(131),l=t(140);s.exports=function(p){var g=n(this),y=o(p);if(i(g)<=y.size)return a(g,function(f){if(y.includes(f))return!1},!0)!==!1;var h=y.getIterator();return c(h,function(f){if(r(g,f))return l(h,"normal",!1)})!==!1}},(s,e,t)=>{var n=t(8),r=t(47),i=t(30);s.exports=function(o,a,c){var l,u;r(o);try{if(l=i(o,"return"),!l){if(a==="throw")throw c;return c}l=n(l,o)}catch(p){u=!0,l=p}if(a==="throw")throw c;if(u)throw l;return r(l),c}},(s,e,t)=>{var n=t(3),r=t(142),i=t(135);n({target:"Set",proto:!0,real:!0,forced:!i("isSubsetOf")},{isSubsetOf:r})},(s,e,t)=>{var n=t(127),r=t(132),i=t(130),o=t(133);s.exports=function(c){var l=n(this),u=o(c);return r(l)>u.size?!1:i(l,function(p){if(!u.includes(p))return!1},!0)!==!1}},(s,e,t)=>{var n=t(3),r=t(144),i=t(135);n({target:"Set",proto:!0,real:!0,forced:!i("isSupersetOf")},{isSupersetOf:r})},(s,e,t)=>{var n=t(127),r=t(128).has,i=t(132),o=t(133),a=t(131),c=t(140);s.exports=function(u){var p=n(this),g=o(u);if(i(p)<g.size)return!1;var y=g.getIterator();return a(y,function(h){if(!r(p,h))return c(y,"normal",!1)})!==!1}},(s,e,t)=>{var n=t(3),r=t(146),i=t(135);n({target:"Set",proto:!0,real:!0,forced:!i("symmetricDifference")},{symmetricDifference:r})},(s,e,t)=>{var n=t(127),r=t(128),i=t(129),o=t(133),a=t(131),c=r.add,l=r.has,u=r.remove;s.exports=function(g){var y=n(this),h=o(g).getIterator(),f=i(y);return a(h,function(d){l(y,d)?u(f,d):c(f,d)}),f}},(s,e,t)=>{var n=t(3),r=t(148),i=t(135);n({target:"Set",proto:!0,real:!0,forced:!i("union")},{union:r})},(s,e,t)=>{var n=t(127),r=t(128).add,i=t(129),o=t(133),a=t(131);s.exports=function(l){var u=n(this),p=o(l).getIterator(),g=i(u);return a(p,function(y){r(g,y)}),g}},(s,e,t)=>{var n=t(3),r=t(4),i=t(24),o=t(11),a=t(45).f,c=t(39),l=t(150),u=t(75),p=t(76),g=t(151),y=t(82),h=t(6),f=t(36),d="DOMException",v=i("Error"),E=i(d),O=function(){l(this,N);var Q=arguments.length,ne=p(Q<1?void 0:arguments[0]),D=p(Q<2?void 0:arguments[1],"Error"),$=new E(ne,D),J=v(ne);return J.name=d,a($,"stack",o(1,y(J.stack,1))),u($,this,O),$},N=O.prototype=E.prototype,m="stack"in v(d),b="stack"in new E(1,2),k=E&&h&&Object.getOwnPropertyDescriptor(r,d),T=!!k&&!(k.writable&&k.configurable),S=m&&!T&&!b;n({global:!0,constructor:!0,forced:f||S},{DOMException:S?O:E});var F=i(d),P=F.prototype;if(P.constructor!==F){f||a(P,"constructor",o(1,F));for(var G in g)if(c(g,G)){var j=g[G],L=j.s;c(F,L)||a(F,L,o(6,j.c))}}},(s,e,t)=>{var n=t(25),r=TypeError;s.exports=function(i,o){if(n(o,i))return i;throw r("Incorrect invocation")}},s=>{s.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},(s,e,t)=>{var n=t(36),r=t(3),i=t(4),o=t(24),a=t(14),c=t(7),l=t(41),u=t(21),p=t(153),g=t(17),y=t(20),h=t(23),f=t(154),d=t(47),v=t(78),E=t(39),O=t(159),N=t(44),m=t(64),b=t(85),k=t(160),T=t(162),S=t(128),F=t(83),P=t(119),G=i.Object,j=i.Array,L=i.Date,K=i.Error,Q=i.EvalError,ne=i.RangeError,D=i.ReferenceError,$=i.SyntaxError,J=i.TypeError,re=i.URIError,pe=i.PerformanceMark,U=i.WebAssembly,w=U&&U.CompileError||K,_=U&&U.LinkError||K,R=U&&U.RuntimeError||K,V=o("DOMException"),M=T.Map,Y=T.has,W=T.get,ee=T.set,me=S.Set,he=S.add,ye=o("Object","keys"),ie=a([].push),ve=a((!0).valueOf),Ne=a(1 .valueOf),Fe=a("".valueOf),Le=a(L.prototype.getTime),ke=l("structuredClone"),ze="DataCloneError",Oe="Transferring",be=function(ge){return!c(function(){var te=new i.Set([7]),Te=ge(te),Ie=ge(G(7));return Te===te||!Te.has(7)||typeof Ie!="object"||Ie!==7})&&ge},fe=function(ge,te){return!c(function(){var Te=new te,Ie=ge({a:Te,b:Te});return!(Ie&&Ie.a===Ie.b&&Ie.a instanceof te&&Ie.a.stack===Te.stack)})},Ce=function(ge){return!c(function(){var te=ge(new i.AggregateError([1],ke,{cause:3}));return te.name!=="AggregateError"||te.errors[0]!==1||te.message!==ke||te.cause!==3})},Me=i.structuredClone,Ge=n||!fe(Me,K)||!fe(Me,V)||!Ce(Me),Ye=!Me&&be(function(ge){return new pe(ke,{detail:ge}).detail}),je=be(Me)||Ye,Ve=function(ge){throw new V("Uncloneable type: "+ge,ze)},We=function(ge,te){throw new V((te||"Cloning")+" of "+ge+" cannot be properly polyfilled in this engine",ze)},qe=function(ge,te){return je||We(te),je(ge)},Ze=function(){var ge;try{ge=new i.DataTransfer}catch{try{ge=new i.ClipboardEvent("").clipboardData}catch{}}return ge&&ge.items&&ge.files?ge:null},Qe=function(ge,te,Te){if(Y(te,ge))return W(te,ge);var Ie=Te||v(ge),Se,z,I,Z,H,q;if(Ie==="SharedArrayBuffer")je?Se=je(ge):Se=ge;else{var ce=i.DataView;!ce&&typeof ge.slice!="function"&&We("ArrayBuffer");try{if(typeof ge.slice=="function"&&!ge.resizable)Se=ge.slice(0);else for(z=ge.byteLength,I=("maxByteLength"in ge)?{maxByteLength:ge.maxByteLength}:void 0,Se=new ArrayBuffer(z,I),Z=new ce(ge),H=new ce(Se),q=0;q<z;q++)H.setUint8(q,Z.getUint8(q))}catch{throw new V("ArrayBuffer is detached",ze)}}return ee(te,ge,Se),Se},Ee=function(ge,te,Te,Ie,Se){var z=i[te];return y(z)||We(te),new z(Qe(ge.buffer,Se),Te,Ie)},ue=function(ge,te,Te){this.object=ge,this.type=te,this.metadata=Te},oe=function(ge,te,Te){if(h(ge)&&Ve("Symbol"),!y(ge))return ge;if(te){if(Y(te,ge))return W(te,ge)}else te=new M;var Ie=v(ge),Se,z,I,Z,H,q,ce,we;switch(Ie){case"Array":I=j(m(ge));break;case"Object":I={};break;case"Map":I=new M;break;case"Set":I=new me;break;case"RegExp":I=new RegExp(ge.source,k(ge));break;case"Error":switch(z=ge.name,z){case"AggregateError":I=o("AggregateError")([]);break;case"EvalError":I=Q();break;case"RangeError":I=ne();break;case"ReferenceError":I=D();break;case"SyntaxError":I=$();break;case"TypeError":I=J();break;case"URIError":I=re();break;case"CompileError":I=w();break;case"LinkError":I=_();break;case"RuntimeError":I=R();break;default:I=K()}break;case"DOMException":I=new V(ge.message,ge.name);break;case"ArrayBuffer":case"SharedArrayBuffer":I=Te?new ue(ge,Ie):Qe(ge,te,Ie);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":q=Ie==="DataView"?ge.byteLength:ge.length,I=Te?new ue(ge,Ie,{offset:ge.byteOffset,length:q}):Ee(ge,Ie,ge.byteOffset,q,te);break;case"DOMQuad":try{I=new DOMQuad(oe(ge.p1,te,Te),oe(ge.p2,te,Te),oe(ge.p3,te,Te),oe(ge.p4,te,Te))}catch{I=qe(ge,Ie)}break;case"File":if(je)try{I=je(ge),v(I)!==Ie&&(I=void 0)}catch{}if(!I)try{I=new File([ge],ge.name,ge)}catch{}I||We(Ie);break;case"FileList":if(Z=Ze(),Z){for(H=0,q=m(ge);H<q;H++)Z.items.add(oe(ge[H],te,Te));I=Z.files}else I=qe(ge,Ie);break;case"ImageData":try{I=new ImageData(oe(ge.data,te,Te),ge.width,ge.height,{colorSpace:ge.colorSpace})}catch{I=qe(ge,Ie)}break;default:if(je)I=je(ge);else switch(Ie){case"BigInt":I=G(ge.valueOf());break;case"Boolean":I=G(ve(ge));break;case"Number":I=G(Ne(ge));break;case"String":I=G(Fe(ge));break;case"Date":I=new L(Le(ge));break;case"Blob":try{I=ge.slice(0,ge.size,ge.type)}catch{We(Ie)}break;case"DOMPoint":case"DOMPointReadOnly":Se=i[Ie];try{I=Se.fromPoint?Se.fromPoint(ge):new Se(ge.x,ge.y,ge.z,ge.w)}catch{We(Ie)}break;case"DOMRect":case"DOMRectReadOnly":Se=i[Ie];try{I=Se.fromRect?Se.fromRect(ge):new Se(ge.x,ge.y,ge.width,ge.height)}catch{We(Ie)}break;case"DOMMatrix":case"DOMMatrixReadOnly":Se=i[Ie];try{I=Se.fromMatrix?Se.fromMatrix(ge):new Se(ge)}catch{We(Ie)}break;case"AudioData":case"VideoFrame":u(ge.clone)||We(Ie);try{I=ge.clone()}catch{Ve(Ie)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":We(Ie);default:Ve(Ie)}}switch(ee(te,ge,I),Ie){case"Array":case"Object":for(ce=ye(ge),H=0,q=m(ce);H<q;H++)we=ce[H],O(I,we,oe(ge[we],te,Te));break;case"Map":ge.forEach(function(X,ae){ee(I,oe(ae,te,Te),oe(X,te,Te))});break;case"Set":ge.forEach(function(X){he(I,oe(X,te,Te))});break;case"Error":N(I,"message",oe(ge.message,te,Te)),E(ge,"cause")&&N(I,"cause",oe(ge.cause,te,Te)),z==="AggregateError"&&(I.errors=oe(ge.errors,te,Te));case"DOMException":F&&N(I,"stack",oe(ge.stack,te,Te))}return I},Ue=function(ge,te){if(!y(ge))return ge;if(Y(te,ge))return W(te,ge);var Te,Ie,Se,z,I,Z,H,q;if(ge instanceof ue)switch(Te=ge.type,Ie=ge.object,Te){case"ArrayBuffer":case"SharedArrayBuffer":q=Qe(Ie,te,Te);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":Se=ge.metadata,q=Ee(Ie,Te,Se.offset,Se.length,te)}else switch(v(ge)){case"Array":case"Object":for(Z=ye(ge),z=0,I=m(Z);z<I;z++)H=Z[z],ge[H]=Ue(ge[H],te);break;case"Map":q=new M,ge.forEach(function(ce,we){ee(q,Ue(we,te),Ue(ce,te))});break;case"Set":q=new me,ge.forEach(function(ce){he(q,Ue(ce,te))});break;case"Error":ge.message=Ue(ge.message,te),E(ge,"cause")&&(ge.cause=Ue(ge.cause,te)),ge.name==="AggregateError"&&(ge.errors=Ue(ge.errors,te));case"DOMException":F&&(ge.stack=Ue(ge.stack,te))}return ee(te,ge,q||ge),q||ge},Be=function(ge,te){if(!y(ge))throw J("Transfer option cannot be converted to a sequence");var Te=[];f(ge,function(X){ie(Te,d(X))});for(var Ie=0,Se=m(Te),z=[],I,Z,H,q,ce,we;Ie<Se;){if(I=Te[Ie++],Z=v(I),Z==="ArrayBuffer"){ie(z,I);continue}if(Y(te,I))throw new V("Duplicate transferable",ze);if(P)q=Me(I,{transfer:[I]});else switch(Z){case"ImageBitmap":H=i.OffscreenCanvas,p(H)||We(Z,Oe);try{ce=new H(I.width,I.height),we=ce.getContext("bitmaprenderer"),we.transferFromImageBitmap(I),q=ce.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!u(I.clone)||!u(I.close))&&We(Z,Oe);try{q=I.clone(),I.close()}catch{}break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":We(Z,Oe)}if(q===void 0)throw new V("This object cannot be transferred: "+Z,ze);ee(te,I,q)}return z},nt=function(ge,te){for(var Te=0,Ie=m(ge),Se,z;Te<Ie;){if(Se=ge[Te++],Y(te,Se))throw new V("Duplicate transferable",ze);P?z=Me(Se,{transfer:[Se]}):(u(Se.transfer)||We("ArrayBuffer",Oe),z=Se.transfer()),ee(te,Se,z)}};r({global:!0,enumerable:!0,sham:!P,forced:Ge},{structuredClone:function(te){var Te=b(arguments.length,1)>1&&!g(arguments[1])?d(arguments[1]):void 0,Ie=Te?Te.transfer:void 0,Se=!1,z,I;Ie!==void 0&&(z=new M,I=Be(Ie,z),Se=!!m(I));var Z=oe(te,z,Se);return Se&&(z=new M,nt(Ie,z),Z=Ue(Z,z)),Z}})},(s,e,t)=>{var n=t(14),r=t(7),i=t(21),o=t(78),a=t(24),c=t(51),l=function(){},u=[],p=a("Reflect","construct"),g=/^\s*(?:class|function)\b/,y=n(g.exec),h=!g.exec(l),f=function(E){if(!i(E))return!1;try{return p(l,u,E),!0}catch{return!1}},d=function(E){if(!i(E))return!1;switch(o(E)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!y(g,c(E))}catch{return!0}};d.sham=!0,s.exports=!p||r(function(){var v;return f(f.call)||!f(Object)||!f(function(){v=!0})||v})?d:f},(s,e,t)=>{var n=t(99),r=t(8),i=t(47),o=t(32),a=t(155),c=t(64),l=t(25),u=t(157),p=t(158),g=t(140),y=TypeError,h=function(d,v){this.stopped=d,this.result=v},f=h.prototype;s.exports=function(d,v,E){var O=E&&E.that,N=!!(E&&E.AS_ENTRIES),m=!!(E&&E.IS_RECORD),b=!!(E&&E.IS_ITERATOR),k=!!(E&&E.INTERRUPTED),T=n(v,O),S,F,P,G,j,L,K,Q=function(D){return S&&g(S,"normal",D),new h(!0,D)},ne=function(D){return N?(i(D),k?T(D[0],D[1],Q):T(D[0],D[1])):k?T(D,Q):T(D)};if(m)S=d.iterator;else if(b)S=d;else{if(F=p(d),!F)throw y(o(d)+" is not iterable");if(a(F)){for(P=0,G=c(d);G>P;P++)if(j=ne(d[P]),j&&l(f,j))return j;return new h(!1)}S=u(d,F)}for(L=m?d.next:S.next;!(K=r(L,S)).done;){try{j=ne(K.value)}catch(D){g(S,"throw",D)}if(typeof j=="object"&&j&&l(f,j))return j}return new h(!1)}},(s,e,t)=>{var n=t(34),r=t(156),i=n("iterator"),o=Array.prototype;s.exports=function(a){return a!==void 0&&(r.Array===a||o[i]===a)}},s=>{s.exports={}},(s,e,t)=>{var n=t(8),r=t(31),i=t(47),o=t(32),a=t(158),c=TypeError;s.exports=function(l,u){var p=arguments.length<2?a(l):u;if(r(p))return i(n(p,l));throw c(o(l)+" is not iterable")}},(s,e,t)=>{var n=t(78),r=t(30),i=t(17),o=t(156),a=t(34),c=a("iterator");s.exports=function(l){if(!i(l))return r(l,c)||r(l,"@@iterator")||o[n(l)]}},(s,e,t)=>{var n=t(18),r=t(45),i=t(11);s.exports=function(o,a,c){var l=n(a);l in o?r.f(o,l,i(0,c)):o[l]=c}},(s,e,t)=>{var n=t(8),r=t(39),i=t(25),o=t(161),a=RegExp.prototype;s.exports=function(c){var l=c.flags;return l===void 0&&!("flags"in a)&&!r(c,"flags")&&i(a,c)?n(o,c):l}},(s,e,t)=>{var n=t(47);s.exports=function(){var r=n(this),i="";return r.hasIndices&&(i+="d"),r.global&&(i+="g"),r.ignoreCase&&(i+="i"),r.multiline&&(i+="m"),r.dotAll&&(i+="s"),r.unicode&&(i+="u"),r.unicodeSets&&(i+="v"),r.sticky&&(i+="y"),i}},(s,e,t)=>{var n=t(14),r=Map.prototype;s.exports={Map,set:n(r.set),get:n(r.get),has:n(r.has),remove:n(r.delete),proto:r}},(s,e,t)=>{var l,u,p,kn,y;Object.defineProperty(e,"__esModule",{value:!0}),e.SerializableEmpty=e.PrintAnnotationStorage=e.AnnotationStorage=void 0,t(89),t(149),t(152);var n=t(1),r=t(164),i=t(170);const o=Object.freeze({map:null,hash:"",transfers:void 0});e.SerializableEmpty=o;class a{constructor(){se(this,p);se(this,l,!1);se(this,u,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(f,d){const v=x(this,u).get(f);return v===void 0?d:Object.assign(d,v)}getRawValue(f){return x(this,u).get(f)}remove(f){if(x(this,u).delete(f),x(this,u).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const d of x(this,u).values())if(d instanceof r.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(f,d){const v=x(this,u).get(f);let E=!1;if(v!==void 0)for(const[O,N]of Object.entries(d))v[O]!==N&&(E=!0,v[O]=N);else E=!0,x(this,u).set(f,d);E&&le(this,p,kn).call(this),d instanceof r.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(d.constructor._type)}has(f){return x(this,u).has(f)}getAll(){return x(this,u).size>0?(0,n.objectFromMap)(x(this,u)):null}setAll(f){for(const[d,v]of Object.entries(f))this.setValue(d,v)}get size(){return x(this,u).size}resetModified(){x(this,l)&&(Ae(this,l,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new c(this)}get serializable(){if(x(this,u).size===0)return o;const f=new Map,d=new i.MurmurHash3_64,v=[],E=Object.create(null);let O=!1;for(const[N,m]of x(this,u)){const b=m instanceof r.AnnotationEditor?m.serialize(!1,E):m;b&&(f.set(N,b),d.update(`${N}:${JSON.stringify(b)}`),O||(O=!!b.bitmap))}if(O)for(const N of f.values())N.bitmap&&v.push(N.bitmap);return f.size>0?{map:f,hash:d.hexdigest(),transfers:v}:o}}l=new WeakMap,u=new WeakMap,p=new WeakSet,kn=function(){x(this,l)||(Ae(this,l,!0),typeof this.onSetModified=="function"&&this.onSetModified())},e.AnnotationStorage=a;class c extends a{constructor(d){super();se(this,y,void 0);const{map:v,hash:E,transfers:O}=d.serializable,N=structuredClone(v,null);Ae(this,y,{map:N,hash:E,transfers:O})}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return x(this,y)}}y=new WeakMap,e.PrintAnnotationStorage=c},(s,e,t)=>{var a,c,l,u,p,g,y,h,f,d,Zt,E,Qt,N,Jt,b,On,T,Pn,F,Rn,G,In,L,Mn;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0,t(89),t(2);var n=t(165),r=t(1);const Q=class Q{constructor(D){se(this,d);se(this,N);se(this,T);se(this,F);se(this,G);se(this,L);se(this,a,!1);se(this,c,null);se(this,l,this.focusin.bind(this));se(this,u,this.focusout.bind(this));se(this,p,!1);se(this,g,!1);se(this,y,!1);st(this,"_initialOptions",Object.create(null));st(this,"_uiManager",null);st(this,"_focusEventsAllowed",!0);se(this,h,!1);se(this,f,Q._zIndex++);this.constructor===Q&&(0,r.unreachable)("Cannot initialize AnnotationEditor."),this.parent=D.parent,this.id=D.id,this.width=this.height=null,this.pageIndex=D.parent.pageIndex,this.name=D.name,this.div=null,this._uiManager=D.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=D.isCentered;const{rotation:$,rawDims:{pageWidth:J,pageHeight:re,pageX:pe,pageY:U}}=this.parent.viewport;this.rotation=$,this.pageRotation=(360+$-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[J,re],this.pageTranslation=[pe,U];const[w,_]=this.parentDimensions;this.x=D.x/w,this.y=D.y/_,this.isAttachedToDOM=!1,this.deleted=!1}static get _defaultLineColor(){return(0,r.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(D){const $=new o({id:D.parent.getNextId(),parent:D.parent,uiManager:D._uiManager});$.annotationElementId=D.annotationElementId,$.deleted=!0,$._uiManager.addToAnnotationStorage($)}static initialize(D){}static updateDefaultParams(D,$){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(D){return!1}static paste(D,$){(0,r.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return x(this,h)}set _isDraggable(D){var $;Ae(this,h,D),($=this.div)==null||$.classList.toggle("draggable",D)}center(){const[D,$]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*$/(D*2),this.y+=this.width*D/($*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*$/(D*2),this.y-=this.width*D/($*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(D){this._uiManager.addCommands(D)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=x(this,f)}setParent(D){D!==null&&(this.pageIndex=D.pageIndex,this.pageDimensions=D.pageDimensions),this.parent=D}focusin(D){this._focusEventsAllowed&&(x(this,p)?Ae(this,p,!1):this.parent.setSelected(this))}focusout(D){var J;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const $=D.relatedTarget;$!=null&&$.closest(`#${this.id}`)||(D.preventDefault(),(J=this.parent)!=null&&J.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(D,$,J,re){const[pe,U]=this.parentDimensions;[J,re]=this.screenToPageTranslation(J,re),this.x=(D+J)/pe,this.y=($+re)/U,this.fixAndSetPosition()}translate(D,$){le(this,d,Zt).call(this,this.parentDimensions,D,$)}translateInPage(D,$){le(this,d,Zt).call(this,this.pageDimensions,D,$),this.moveInDOM(),this.div.scrollIntoView({block:"nearest"})}drag(D,$){const[J,re]=this.parentDimensions;if(this.x+=D/J,this.y+=$/re,this.x<0||this.x>1||this.y<0||this.y>1){const{x:pe,y:U}=this.div.getBoundingClientRect();this.parent.findNewParent(this,pe,U)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}this.div.style.left=`${(100*this.x).toFixed(2)}%`,this.div.style.top=`${(100*this.y).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[D,$]=this.pageDimensions;let{x:J,y:re,width:pe,height:U}=this;switch(pe*=D,U*=$,J*=D,re*=$,this.rotation){case 0:J=Math.max(0,Math.min(D-pe,J)),re=Math.max(0,Math.min($-U,re));break;case 90:J=Math.max(0,Math.min(D-U,J)),re=Math.min($,Math.max(pe,re));break;case 180:J=Math.min(D,Math.max(pe,J)),re=Math.min($,Math.max(U,re));break;case 270:J=Math.min(D,Math.max(U,J)),re=Math.max(0,Math.min($-pe,re));break}this.x=J/D,this.y=re/$,this.div.style.left=`${(100*this.x).toFixed(2)}%`,this.div.style.top=`${(100*this.y).toFixed(2)}%`}screenToPageTranslation(D,$){var J;return le(J=Q,E,Qt).call(J,D,$,this.parentRotation)}pageTranslationToScreen(D,$){var J;return le(J=Q,E,Qt).call(J,D,$,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:D,pageDimensions:[$,J]}=this,re=$*D,pe=J*D;return r.FeatureTest.isCSSRoundSupported?[Math.round(re),Math.round(pe)]:[re,pe]}setDims(D,$){const[J,re]=this.parentDimensions;this.div.style.width=`${(100*D/J).toFixed(2)}%`,x(this,a)||(this.div.style.height=`${(100*$/re).toFixed(2)}%`)}fixDims(){const{style:D}=this.div,{height:$,width:J}=D,re=J.endsWith("%"),pe=!x(this,a)&&$.endsWith("%");if(re&&pe)return;const[U,w]=this.parentDimensions;re||(D.width=`${(100*parseFloat(J)/U).toFixed(2)}%`),!x(this,a)&&!pe&&(D.height=`${(100*parseFloat($)/w).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",x(this,l)),this.div.addEventListener("focusout",x(this,u));const[D,$]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*$/D).toFixed(2)}%`,this.div.style.maxHeight=`${(100*D/$).toFixed(2)}%`);const[J,re]=this.getInitialTranslation();return this.translate(J,re),(0,n.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(D){const{isMac:$}=r.FeatureTest.platform;if(D.button!==0||D.ctrlKey&&$){D.preventDefault();return}Ae(this,p,!0),le(this,L,Mn).call(this,D)}moveInDOM(){this.parent.moveEditorInDOM(this)}_setParentAndPosition(D,$,J){D.changeParent(this),this.x=$,this.y=J,this.fixAndSetPosition(),this.moveInDOM()}getRect(D,$){const J=this.parentScale,[re,pe]=this.pageDimensions,[U,w]=this.pageTranslation,_=D/J,R=$/J,V=this.x*re,M=this.y*pe,Y=this.width*re,W=this.height*pe;switch(this.rotation){case 0:return[V+_+U,pe-M-R-W+w,V+_+Y+U,pe-M-R+w];case 90:return[V+R+U,pe-M+_+w,V+R+W+U,pe-M+_+Y+w];case 180:return[V-_-Y+U,pe-M+R+w,V-_+U,pe-M+R+W+w];case 270:return[V-R-W+U,pe-M-_-Y+w,V-R+U,pe-M-_+w];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(D,$){const[J,re,pe,U]=D,w=pe-J,_=U-re;switch(this.rotation){case 0:return[J,$-U,w,_];case 90:return[J,$-re,_,w];case 180:return[pe,$-re,w,_];case 270:return[pe,$-U,_,w];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){Ae(this,y,!0)}disableEditMode(){Ae(this,y,!1)}isInEditMode(){return x(this,y)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var D,$;(D=this.div)==null||D.addEventListener("focusin",x(this,l)),($=this.div)==null||$.addEventListener("focusout",x(this,u))}serialize(){(0,r.unreachable)("An editor must be serializable")}static deserialize(D,$,J){const re=new this.prototype.constructor({parent:$,id:$.getNextId(),uiManager:J});re.rotation=D.rotation;const[pe,U]=re.pageDimensions,[w,_,R,V]=re.getRectInCurrentCoords(D.rect,U);return re.x=w/pe,re.y=_/U,re.width=R/pe,re.height=V/U,re}remove(){this.div.removeEventListener("focusin",x(this,l)),this.div.removeEventListener("focusout",x(this,u)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this)}get isResizable(){return!1}makeResizable(){this.isResizable&&(le(this,T,Pn).call(this),x(this,c).classList.remove("hidden"))}select(){var D;this.makeResizable(),(D=this.div)==null||D.classList.add("selectedEditor")}unselect(){var D,$,J;(D=x(this,c))==null||D.classList.add("hidden"),($=this.div)==null||$.classList.remove("selectedEditor"),(J=this.div)!=null&&J.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(D,$){}disableEditing(){}enableEditing(){}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return x(this,g)}set isEditing(D){Ae(this,g,D),this.parent&&(D?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(D,$){Ae(this,a,!0);const J=D/$,{style:re}=this.div;re.aspectRatio=J,re.height="auto"}static get MIN_SIZE(){return 16}};a=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakSet,Zt=function(D,$,J){let[re,pe]=D;[$,J]=this.screenToPageTranslation($,J),this.x+=$/re,this.y+=J/pe,this.fixAndSetPosition()},E=new WeakSet,Qt=function(D,$,J){switch(J){case 90:return[$,-D];case 180:return[-D,-$];case 270:return[-$,D];default:return[D,$]}},N=new WeakSet,Jt=function(D){switch(D){case 90:{const[$,J]=this.pageDimensions;return[0,-$/J,J/$,0]}case 180:return[-1,0,0,-1];case 270:{const[$,J]=this.pageDimensions;return[0,$/J,-J/$,0]}default:return[1,0,0,1]}},b=new WeakSet,On=function(D){D.preventDefault()},T=new WeakSet,Pn=function(){if(x(this,c))return;Ae(this,c,document.createElement("div")),x(this,c).classList.add("resizers");const D=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||D.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const $ of D){const J=document.createElement("div");x(this,c).append(J),J.classList.add("resizer",$),J.addEventListener("pointerdown",le(this,F,Rn).bind(this,$)),J.addEventListener("contextmenu",le(Q,b,On))}this.div.prepend(x(this,c))},F=new WeakSet,Rn=function(D,$){$.preventDefault();const{isMac:J}=r.FeatureTest.platform;if($.button!==0||$.ctrlKey&&J)return;const re=le(this,G,In).bind(this,D),pe=this._isDraggable;this._isDraggable=!1;const U={passive:!0,capture:!0};window.addEventListener("pointermove",re,U);const w=this.x,_=this.y,R=this.width,V=this.height,M=this.parent.div.style.cursor,Y=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle($.target).cursor;const W=()=>{this._isDraggable=pe,window.removeEventListener("pointerup",W),window.removeEventListener("blur",W),window.removeEventListener("pointermove",re,U),this.parent.div.style.cursor=M,this.div.style.cursor=Y;const ee=this.x,me=this.y,he=this.width,ye=this.height;ee===w&&me===_&&he===R&&ye===V||this.addCommands({cmd:()=>{this.width=he,this.height=ye,this.x=ee,this.y=me;const[ie,ve]=this.parentDimensions;this.setDims(ie*he,ve*ye),this.fixAndSetPosition(),this.moveInDOM()},undo:()=>{this.width=R,this.height=V,this.x=w,this.y=_;const[ie,ve]=this.parentDimensions;this.setDims(ie*R,ve*V),this.fixAndSetPosition(),this.moveInDOM()},mustExec:!0})};window.addEventListener("pointerup",W),window.addEventListener("blur",W)},G=new WeakSet,In=function(D,$){const[J,re]=this.parentDimensions,pe=this.x,U=this.y,w=this.width,_=this.height,R=Q.MIN_SIZE/J,V=Q.MIN_SIZE/re,M=Ve=>Math.round(Ve*1e4)/1e4,Y=le(this,N,Jt).call(this,this.rotation),W=(Ve,We)=>[Y[0]*Ve+Y[2]*We,Y[1]*Ve+Y[3]*We],ee=le(this,N,Jt).call(this,360-this.rotation),me=(Ve,We)=>[ee[0]*Ve+ee[2]*We,ee[1]*Ve+ee[3]*We];let he,ye,ie=!1,ve=!1;switch(D){case"topLeft":ie=!0,he=(Ve,We)=>[0,0],ye=(Ve,We)=>[Ve,We];break;case"topMiddle":he=(Ve,We)=>[Ve/2,0],ye=(Ve,We)=>[Ve/2,We];break;case"topRight":ie=!0,he=(Ve,We)=>[Ve,0],ye=(Ve,We)=>[0,We];break;case"middleRight":ve=!0,he=(Ve,We)=>[Ve,We/2],ye=(Ve,We)=>[0,We/2];break;case"bottomRight":ie=!0,he=(Ve,We)=>[Ve,We],ye=(Ve,We)=>[0,0];break;case"bottomMiddle":he=(Ve,We)=>[Ve/2,We],ye=(Ve,We)=>[Ve/2,0];break;case"bottomLeft":ie=!0,he=(Ve,We)=>[0,We],ye=(Ve,We)=>[Ve,0];break;case"middleLeft":ve=!0,he=(Ve,We)=>[0,We/2],ye=(Ve,We)=>[Ve,We/2];break}const Ne=he(w,_),Fe=ye(w,_);let Le=W(...Fe);const ke=M(pe+Le[0]),ze=M(U+Le[1]);let Oe=1,be=1,[fe,Ce]=this.screenToPageTranslation($.movementX,$.movementY);if([fe,Ce]=me(fe/J,Ce/re),ie){const Ve=Math.hypot(w,_);Oe=be=Math.max(Math.min(Math.hypot(Fe[0]-Ne[0]-fe,Fe[1]-Ne[1]-Ce)/Ve,1/w,1/_),R/w,V/_)}else ve?Oe=Math.max(R,Math.min(1,Math.abs(Fe[0]-Ne[0]-fe)))/w:be=Math.max(V,Math.min(1,Math.abs(Fe[1]-Ne[1]-Ce)))/_;const Me=M(w*Oe),Ge=M(_*be);Le=W(...ye(Me,Ge));const Ye=ke-Le[0],je=ze-Le[1];this.width=Me,this.height=Ge,this.x=Ye,this.y=je,this.setDims(J*Me,re*Ge),this.fixAndSetPosition()},L=new WeakSet,Mn=function(D){if(!this._isDraggable)return;const $=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let J,re;$&&(J={passive:!0,capture:!0},re=U=>{const[w,_]=this.screenToPageTranslation(U.movementX,U.movementY);this._uiManager.dragSelectedEditors(w,_)},window.addEventListener("pointermove",re,J));const pe=()=>{if(window.removeEventListener("pointerup",pe),window.removeEventListener("blur",pe),$&&window.removeEventListener("pointermove",re,J),Ae(this,p,!1),!this._uiManager.endDragSession()){const{isMac:U}=r.FeatureTest.platform;D.ctrlKey&&!U||D.shiftKey||D.metaKey&&U?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",pe),window.addEventListener("blur",pe)},se(Q,E),se(Q,b),st(Q,"_colorManager",new n.ColorManager),st(Q,"_zIndex",1);let i=Q;e.AnnotationEditor=i;class o extends i{constructor(D){super(D),this.annotationElementId=D.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(s,e,t)=>{var y,h,f,d,v,qt,N,m,b,k,T,Fn,P,G,j,L,K,Q,ne,D,$,J,re,pe,U,w,_,R,V,M,Y,W,ee,me,he,ye,ie,ve,Ne,Fe,Le,ke,ze,Oe,be,fe,Ce,Dn,Ge,en,je,Ln,We,tn,Ze,Bn,Ee,Vn,oe,ft,Be,Nt,ge,Wn,Te,Un,Se,nn,I,kt,H,rn;Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=i,e.opacityToHex=o,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(2),t(89),t(125),t(136),t(138),t(141),t(143),t(145),t(147),t(166);var n=t(1),r=t(168);function i(we,X,ae){for(const de of ae)X.addEventListener(de,we[de].bind(we))}function o(we){return Math.round(Math.min(255,Math.max(1,255*we))).toString(16).padStart(2,"0")}class a{constructor(){se(this,y,0)}getId(){return`${n.AnnotationEditorPrefix}${_t(this,y)._++}`}}y=new WeakMap;const O=class O{constructor(){se(this,v);se(this,h,(0,n.getUuid)());se(this,f,0);se(this,d,null)}static get _isSVGFittingCanvas(){const X='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',de=new OffscreenCanvas(1,3).getContext("2d"),Pe=new Image;Pe.src=X;const _e=Pe.decode().then(()=>(de.drawImage(Pe,0,0,1,1,0,0,1,3),new Uint32Array(de.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,n.shadow)(this,"_isSVGFittingCanvas",_e)}async getFromFile(X){const{lastModified:ae,name:de,size:Pe,type:_e}=X;return le(this,v,qt).call(this,`${ae}_${de}_${Pe}_${_e}`,X)}async getFromUrl(X){return le(this,v,qt).call(this,X,X)}async getFromId(X){x(this,d)||Ae(this,d,new Map);const ae=x(this,d).get(X);return ae?ae.bitmap?(ae.refCounter+=1,ae):ae.file?this.getFromFile(ae.file):this.getFromUrl(ae.url):null}getSvgUrl(X){const ae=x(this,d).get(X);return ae!=null&&ae.isSvg?ae.svgUrl:null}deleteId(X){x(this,d)||Ae(this,d,new Map);const ae=x(this,d).get(X);ae&&(ae.refCounter-=1,ae.refCounter===0&&(ae.bitmap=null))}isValidId(X){return X.startsWith(`image_${x(this,h)}_`)}};h=new WeakMap,f=new WeakMap,d=new WeakMap,v=new WeakSet,qt=async function(X,ae){x(this,d)||Ae(this,d,new Map);let de=x(this,d).get(X);if(de===null)return null;if(de!=null&&de.bitmap)return de.refCounter+=1,de;try{de||(de={bitmap:null,id:`image_${x(this,h)}_${_t(this,f)._++}`,refCounter:0,isSvg:!1});let Pe;if(typeof ae=="string"){de.url=ae;const _e=await fetch(ae);if(!_e.ok)throw new Error(_e.statusText);Pe=await _e.blob()}else Pe=de.file=ae;if(Pe.type==="image/svg+xml"){const _e=O._isSVGFittingCanvas,Re=new FileReader,De=new Image,He=new Promise((Je,et)=>{De.onload=()=>{de.bitmap=De,de.isSvg=!0,Je()},Re.onload=async()=>{const it=de.svgUrl=Re.result;De.src=await _e?`${it}#svgView(preserveAspectRatio(none))`:it},De.onerror=Re.onerror=et});Re.readAsDataURL(Pe),await He}else de.bitmap=await createImageBitmap(Pe);de.refCounter=1}catch(Pe){console.error(Pe),de=null}return x(this,d).set(X,de),de&&x(this,d).set(de.id,de),de};let c=O;class l{constructor(){se(this,N,[]);se(this,m,!1);se(this,b,void 0);se(this,k,-1);let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:128;Ae(this,b,X)}add(X){let{cmd:ae,undo:de,mustExec:Pe,type:_e=NaN,overwriteIfSameType:Re=!1,keepUndo:De=!1}=X;if(Pe&&ae(),x(this,m))return;const He={cmd:ae,undo:de,type:_e};if(x(this,k)===-1){x(this,N).length>0&&(x(this,N).length=0),Ae(this,k,0),x(this,N).push(He);return}if(Re&&x(this,N)[x(this,k)].type===_e){De&&(He.undo=x(this,N)[x(this,k)].undo),x(this,N)[x(this,k)]=He;return}const Je=x(this,k)+1;Je===x(this,b)?x(this,N).splice(0,1):(Ae(this,k,Je),Je<x(this,N).length&&x(this,N).splice(Je)),x(this,N).push(He)}undo(){x(this,k)!==-1&&(Ae(this,m,!0),x(this,N)[x(this,k)].undo(),Ae(this,m,!1),Ae(this,k,x(this,k)-1))}redo(){x(this,k)<x(this,N).length-1&&(Ae(this,k,x(this,k)+1),Ae(this,m,!0),x(this,N)[x(this,k)].cmd(),Ae(this,m,!1))}hasSomethingToUndo(){return x(this,k)!==-1}hasSomethingToRedo(){return x(this,k)<x(this,N).length-1}destroy(){Ae(this,N,null)}}N=new WeakMap,m=new WeakMap,b=new WeakMap,k=new WeakMap,e.CommandManager=l;class u{constructor(X){se(this,T);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:ae}=n.FeatureTest.platform;for(const[de,Pe,_e={}]of X)for(const Re of de){const De=Re.startsWith("mac+");ae&&De?(this.callbacks.set(Re.slice(4),{callback:Pe,options:_e}),this.allKeys.add(Re.split("+").at(-1))):!ae&&!De&&(this.callbacks.set(Re,{callback:Pe,options:_e}),this.allKeys.add(Re.split("+").at(-1)))}}exec(X,ae){if(!this.allKeys.has(ae.key))return;const de=this.callbacks.get(le(this,T,Fn).call(this,ae));if(!de)return;const{callback:Pe,options:{bubbles:_e=!1,args:Re=[],checker:De=null}}=de;De&&!De(X,ae)||(Pe.bind(X,...Re)(),_e||(ae.stopPropagation(),ae.preventDefault()))}}T=new WeakSet,Fn=function(X){X.altKey&&this.buffer.push("alt"),X.ctrlKey&&this.buffer.push("ctrl"),X.metaKey&&this.buffer.push("meta"),X.shiftKey&&this.buffer.push("shift"),this.buffer.push(X.key);const ae=this.buffer.join("+");return this.buffer.length=0,ae},e.KeyboardManager=u;const F=class F{get _colors(){const X=new Map([["CanvasText",null],["Canvas",null]]);return(0,r.getColorValues)(X),(0,n.shadow)(this,"_colors",X)}convert(X){const ae=(0,r.getRGB)(X);if(!window.matchMedia("(forced-colors: active)").matches)return ae;for(const[de,Pe]of this._colors)if(Pe.every((_e,Re)=>_e===ae[Re]))return F._colorsMapping.get(de);return ae}getHexCode(X){const ae=this._colors.get(X);return ae?n.Util.makeHexColor(...ae):X}};st(F,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let p=F;e.ColorManager=p;const ce=class ce{constructor(X,ae,de,Pe,_e){se(this,Ce);se(this,Ge);se(this,je);se(this,We);se(this,Ze);se(this,Ee);se(this,oe);se(this,Be);se(this,ge);se(this,Te);se(this,Se);se(this,I);se(this,H);se(this,P,null);se(this,G,new Map);se(this,j,new Map);se(this,L,null);se(this,K,new l);se(this,Q,0);se(this,ne,new Set);se(this,D,null);se(this,$,null);se(this,J,new Set);se(this,re,null);se(this,pe,null);se(this,U,new a);se(this,w,!1);se(this,_,!1);se(this,R,null);se(this,V,n.AnnotationEditorType.NONE);se(this,M,new Set);se(this,Y,null);se(this,W,this.blur.bind(this));se(this,ee,this.focus.bind(this));se(this,me,this.copy.bind(this));se(this,he,this.cut.bind(this));se(this,ye,this.paste.bind(this));se(this,ie,this.keydown.bind(this));se(this,ve,this.onEditingAction.bind(this));se(this,Ne,this.onPageChanging.bind(this));se(this,Fe,this.onScaleChanging.bind(this));se(this,Le,this.onRotationChanging.bind(this));se(this,ke,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});se(this,ze,[0,0]);se(this,Oe,null);se(this,be,null);se(this,fe,null);Ae(this,be,X),Ae(this,fe,ae),Ae(this,re,de),x(this,re)._on("editingaction",x(this,ve)),x(this,re)._on("pagechanging",x(this,Ne)),x(this,re)._on("scalechanging",x(this,Fe)),x(this,re)._on("rotationchanging",x(this,Le)),Ae(this,L,Pe.annotationStorage),Ae(this,pe,Pe.filterFactory),Ae(this,Y,_e),this.viewParameters={realScale:r.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const X=ce.prototype,ae=_e=>{const{activeElement:Re}=document;return Re&&x(_e,be).contains(Re)&&_e.hasSomethingToControl()},de=this.TRANSLATE_SMALL,Pe=this.TRANSLATE_BIG;return(0,n.shadow)(this,"_keyboardManager",new u([[["ctrl+a","mac+meta+a"],X.selectAll],[["ctrl+z","mac+meta+z"],X.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],X.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],X.delete],[["Escape","mac+Escape"],X.unselectAll],[["ArrowLeft","mac+ArrowLeft"],X.translateSelectedEditors,{args:[-de,0],checker:ae}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],X.translateSelectedEditors,{args:[-Pe,0],checker:ae}],[["ArrowRight","mac+ArrowRight"],X.translateSelectedEditors,{args:[de,0],checker:ae}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],X.translateSelectedEditors,{args:[Pe,0],checker:ae}],[["ArrowUp","mac+ArrowUp"],X.translateSelectedEditors,{args:[0,-de],checker:ae}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],X.translateSelectedEditors,{args:[0,-Pe],checker:ae}],[["ArrowDown","mac+ArrowDown"],X.translateSelectedEditors,{args:[0,de],checker:ae}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],X.translateSelectedEditors,{args:[0,Pe],checker:ae}]]))}destroy(){le(this,We,tn).call(this),le(this,Ge,en).call(this),x(this,re)._off("editingaction",x(this,ve)),x(this,re)._off("pagechanging",x(this,Ne)),x(this,re)._off("scalechanging",x(this,Fe)),x(this,re)._off("rotationchanging",x(this,Le));for(const X of x(this,j).values())X.destroy();x(this,j).clear(),x(this,G).clear(),x(this,J).clear(),Ae(this,P,null),x(this,M).clear(),x(this,K).destroy()}get hcmFilter(){return(0,n.shadow)(this,"hcmFilter",x(this,Y)?x(this,pe).addHCMFilter(x(this,Y).foreground,x(this,Y).background):"none")}onPageChanging(X){let{pageNumber:ae}=X;Ae(this,Q,ae-1)}focusMainContainer(){x(this,be).focus()}findParent(X,ae){for(const de of x(this,j).values()){const{x:Pe,y:_e,width:Re,height:De}=de.div.getBoundingClientRect();if(X>=Pe&&X<=Pe+Re&&ae>=_e&&ae<=_e+De)return de}return null}disableUserSelect(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;x(this,fe).classList.toggle("noUserSelect",X)}addShouldRescale(X){x(this,J).add(X)}removeShouldRescale(X){x(this,J).delete(X)}onScaleChanging(X){let{scale:ae}=X;this.commitOrRemove(),this.viewParameters.realScale=ae*r.PixelsPerInch.PDF_TO_CSS_UNITS;for(const de of x(this,J))de.onScaleChanging()}onRotationChanging(X){let{pagesRotation:ae}=X;this.commitOrRemove(),this.viewParameters.rotation=ae}addToAnnotationStorage(X){!X.isEmpty()&&x(this,L)&&!x(this,L).has(X.id)&&x(this,L).setValue(X.id,X)}blur(){if(!this.hasSelection)return;const{activeElement:X}=document;for(const ae of x(this,M))if(ae.div.contains(X)){Ae(this,R,[ae,X]),ae._focusEventsAllowed=!1;break}}focus(){if(!x(this,R))return;const[X,ae]=x(this,R);Ae(this,R,null),ae.addEventListener("focusin",()=>{X._focusEventsAllowed=!0},{once:!0}),ae.focus()}copy(X){var de;if(X.preventDefault(),(de=x(this,P))==null||de.commitOrRemove(),!this.hasSelection)return;const ae=[];for(const Pe of x(this,M)){const _e=Pe.serialize(!0);_e&&ae.push(_e)}ae.length!==0&&X.clipboardData.setData("application/pdfjs",JSON.stringify(ae))}cut(X){this.copy(X),this.delete()}paste(X){X.preventDefault();const{clipboardData:ae}=X;for(const _e of ae.items)for(const Re of x(this,$))if(Re.isHandlingMimeForPasting(_e.type)){Re.paste(_e,this.currentLayer);return}let de=ae.getData("application/pdfjs");if(!de)return;try{de=JSON.parse(de)}catch(_e){(0,n.warn)(`paste: "${_e.message}".`);return}if(!Array.isArray(de))return;this.unselectAll();const Pe=this.currentLayer;try{const _e=[];for(const He of de){const Je=Pe.deserialize(He);if(!Je)return;_e.push(Je)}const Re=()=>{for(const He of _e)le(this,Se,nn).call(this,He);le(this,H,rn).call(this,_e)},De=()=>{for(const He of _e)He.remove()};this.addCommands({cmd:Re,undo:De,mustExec:!0})}catch(_e){(0,n.warn)(`paste: "${_e.message}".`)}}keydown(X){var ae;(ae=this.getActive())!=null&&ae.shouldGetKeyboardEvents()||ce._keyboardManager.exec(this,X)}onEditingAction(X){["undo","redo","delete","selectAll"].includes(X.name)&&this[X.name]()}setEditingState(X){X?(le(this,Ce,Dn).call(this),le(this,je,Ln).call(this),le(this,Ze,Bn).call(this),le(this,oe,ft).call(this,{isEditing:x(this,V)!==n.AnnotationEditorType.NONE,isEmpty:le(this,I,kt).call(this),hasSomethingToUndo:x(this,K).hasSomethingToUndo(),hasSomethingToRedo:x(this,K).hasSomethingToRedo(),hasSelectedEditor:!1})):(le(this,Ge,en).call(this),le(this,We,tn).call(this),le(this,Ee,Vn).call(this),le(this,oe,ft).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(X){if(!x(this,$)){Ae(this,$,X);for(const ae of x(this,$))le(this,Be,Nt).call(this,ae.defaultPropertiesToUpdate)}}getId(){return x(this,U).getId()}get currentLayer(){return x(this,j).get(x(this,Q))}getLayer(X){return x(this,j).get(X)}get currentPageIndex(){return x(this,Q)}addLayer(X){x(this,j).set(X.pageIndex,X),x(this,w)?X.enable():X.disable()}removeLayer(X){x(this,j).delete(X.pageIndex)}updateMode(X){let ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(x(this,V)!==X){if(Ae(this,V,X),X===n.AnnotationEditorType.NONE){this.setEditingState(!1),le(this,Te,Un).call(this);return}this.setEditingState(!0),le(this,ge,Wn).call(this),this.unselectAll();for(const de of x(this,j).values())de.updateMode(X);if(ae){for(const de of x(this,G).values())if(de.annotationElementId===ae){this.setSelected(de),de.enterInEditMode();break}}}}updateToolbar(X){X!==x(this,V)&&x(this,re).dispatch("switchannotationeditormode",{source:this,mode:X})}updateParams(X,ae){if(x(this,$)){if(X===n.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(X);return}for(const de of x(this,M))de.updateParams(X,ae);for(const de of x(this,$))de.updateDefaultParams(X,ae)}}enableWaiting(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(x(this,_)!==X){Ae(this,_,X);for(const ae of x(this,j).values())X?ae.disableClick():ae.enableClick(),ae.div.classList.toggle("waiting",X)}}getEditors(X){const ae=[];for(const de of x(this,G).values())de.pageIndex===X&&ae.push(de);return ae}getEditor(X){return x(this,G).get(X)}addEditor(X){x(this,G).set(X.id,X)}removeEditor(X){var ae;x(this,G).delete(X.id),this.unselect(X),(!X.annotationElementId||!x(this,ne).has(X.annotationElementId))&&((ae=x(this,L))==null||ae.remove(X.id))}addDeletedAnnotationElement(X){x(this,ne).add(X.annotationElementId),X.deleted=!0}isDeletedAnnotationElement(X){return x(this,ne).has(X)}removeDeletedAnnotationElement(X){x(this,ne).delete(X.annotationElementId),X.deleted=!1}setActiveEditor(X){x(this,P)!==X&&(Ae(this,P,X),X&&le(this,Be,Nt).call(this,X.propertiesToUpdate))}toggleSelected(X){if(x(this,M).has(X)){x(this,M).delete(X),X.unselect(),le(this,oe,ft).call(this,{hasSelectedEditor:this.hasSelection});return}x(this,M).add(X),X.select(),le(this,Be,Nt).call(this,X.propertiesToUpdate),le(this,oe,ft).call(this,{hasSelectedEditor:!0})}setSelected(X){for(const ae of x(this,M))ae!==X&&ae.unselect();x(this,M).clear(),x(this,M).add(X),X.select(),le(this,Be,Nt).call(this,X.propertiesToUpdate),le(this,oe,ft).call(this,{hasSelectedEditor:!0})}isSelected(X){return x(this,M).has(X)}unselect(X){X.unselect(),x(this,M).delete(X),le(this,oe,ft).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return x(this,M).size!==0}undo(){x(this,K).undo(),le(this,oe,ft).call(this,{hasSomethingToUndo:x(this,K).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:le(this,I,kt).call(this)})}redo(){x(this,K).redo(),le(this,oe,ft).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:x(this,K).hasSomethingToRedo(),isEmpty:le(this,I,kt).call(this)})}addCommands(X){x(this,K).add(X),le(this,oe,ft).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:le(this,I,kt).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const X=[...x(this,M)],ae=()=>{for(const Pe of X)Pe.remove()},de=()=>{for(const Pe of X)le(this,Se,nn).call(this,Pe)};this.addCommands({cmd:ae,undo:de,mustExec:!0})}commitOrRemove(){var X;(X=x(this,P))==null||X.commitOrRemove()}hasSomethingToControl(){return x(this,P)||this.hasSelection}selectAll(){for(const X of x(this,M))X.commit();le(this,H,rn).call(this,x(this,G).values())}unselectAll(){if(x(this,P)){x(this,P).commitOrRemove();return}if(this.hasSelection){for(const X of x(this,M))X.unselect();x(this,M).clear(),le(this,oe,ft).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(X,ae){if((arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1)||this.commitOrRemove(),!this.hasSelection)return;x(this,ze)[0]+=X,x(this,ze)[1]+=ae;const[Pe,_e]=x(this,ze),Re=[...x(this,M)],De=1e3;x(this,Oe)&&clearTimeout(x(this,Oe)),Ae(this,Oe,setTimeout(()=>{Ae(this,Oe,null),x(this,ze)[0]=x(this,ze)[1]=0,this.addCommands({cmd:()=>{for(const He of Re)x(this,G).has(He.id)&&He.translateInPage(Pe,_e)},undo:()=>{for(const He of Re)x(this,G).has(He.id)&&He.translateInPage(-Pe,-_e)},mustExec:!1})},De));for(const He of Re)He.translateInPage(X,ae)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),Ae(this,D,new Map);for(const X of x(this,M))x(this,D).set(X,{savedX:X.x,savedY:X.y,savedPageIndex:X.parent.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!x(this,D))return!1;this.disableUserSelect(!1);const X=x(this,D);Ae(this,D,null);let ae=!1;for(const[{x:Pe,y:_e,parent:Re},De]of X)De.newX=Pe,De.newY=_e,De.newPageIndex=Re.pageIndex,ae||(ae=Pe!==De.savedX||_e!==De.savedY||Re.pageIndex!==De.savedPageIndex);if(!ae)return!1;const de=(Pe,_e,Re,De)=>{if(x(this,G).has(Pe.id)){const He=x(this,j).get(De);He?Pe._setParentAndPosition(He,_e,Re):(Pe.pageIndex=De,Pe.x=_e,Pe.y=Re)}};return this.addCommands({cmd:()=>{for(const[Pe,{newX:_e,newY:Re,newPageIndex:De}]of X)de(Pe,_e,Re,De)},undo:()=>{for(const[Pe,{savedX:_e,savedY:Re,savedPageIndex:De}]of X)de(Pe,_e,Re,De)},mustExec:!0}),!0}dragSelectedEditors(X,ae){if(x(this,D))for(const de of x(this,D).keys())de.drag(X,ae)}rebuild(X){if(X.parent===null){const ae=this.getLayer(X.pageIndex);ae?(ae.changeParent(X),ae.addOrRebuild(X)):(this.addEditor(X),this.addToAnnotationStorage(X),X.rebuild())}else X.parent.addOrRebuild(X)}isActive(X){return x(this,P)===X}getActive(){return x(this,P)}getMode(){return x(this,V)}get imageManager(){return(0,n.shadow)(this,"imageManager",new c)}};P=new WeakMap,G=new WeakMap,j=new WeakMap,L=new WeakMap,K=new WeakMap,Q=new WeakMap,ne=new WeakMap,D=new WeakMap,$=new WeakMap,J=new WeakMap,re=new WeakMap,pe=new WeakMap,U=new WeakMap,w=new WeakMap,_=new WeakMap,R=new WeakMap,V=new WeakMap,M=new WeakMap,Y=new WeakMap,W=new WeakMap,ee=new WeakMap,me=new WeakMap,he=new WeakMap,ye=new WeakMap,ie=new WeakMap,ve=new WeakMap,Ne=new WeakMap,Fe=new WeakMap,Le=new WeakMap,ke=new WeakMap,ze=new WeakMap,Oe=new WeakMap,be=new WeakMap,fe=new WeakMap,Ce=new WeakSet,Dn=function(){window.addEventListener("focus",x(this,ee)),window.addEventListener("blur",x(this,W))},Ge=new WeakSet,en=function(){window.removeEventListener("focus",x(this,ee)),window.removeEventListener("blur",x(this,W))},je=new WeakSet,Ln=function(){window.addEventListener("keydown",x(this,ie),{capture:!0})},We=new WeakSet,tn=function(){window.removeEventListener("keydown",x(this,ie),{capture:!0})},Ze=new WeakSet,Bn=function(){document.addEventListener("copy",x(this,me)),document.addEventListener("cut",x(this,he)),document.addEventListener("paste",x(this,ye))},Ee=new WeakSet,Vn=function(){document.removeEventListener("copy",x(this,me)),document.removeEventListener("cut",x(this,he)),document.removeEventListener("paste",x(this,ye))},oe=new WeakSet,ft=function(X){Object.entries(X).some(de=>{let[Pe,_e]=de;return x(this,ke)[Pe]!==_e})&&x(this,re).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(x(this,ke),X)})},Be=new WeakSet,Nt=function(X){x(this,re).dispatch("annotationeditorparamschanged",{source:this,details:X})},ge=new WeakSet,Wn=function(){if(!x(this,w)){Ae(this,w,!0);for(const X of x(this,j).values())X.enable()}},Te=new WeakSet,Un=function(){if(this.unselectAll(),x(this,w)){Ae(this,w,!1);for(const X of x(this,j).values())X.disable()}},Se=new WeakSet,nn=function(X){const ae=x(this,j).get(X.pageIndex);ae?ae.addOrRebuild(X):this.addEditor(X)},I=new WeakSet,kt=function(){if(x(this,G).size===0)return!0;if(x(this,G).size===1)for(const X of x(this,G).values())return X.isEmpty();return!1},H=new WeakSet,rn=function(X){x(this,M).clear();for(const ae of X)ae.isEmpty()||(x(this,M).add(ae),ae.select());le(this,oe,ft).call(this,{hasSelectedEditor:!0})},st(ce,"TRANSLATE_SMALL",1),st(ce,"TRANSLATE_BIG",10);let g=ce;e.AnnotationEditorUIManager=g},(s,e,t)=>{var n=t(3),r=t(6),i=t(4),o=t(24),a=t(14),c=t(8),l=t(21),u=t(20),p=t(91),g=t(39),y=t(77),h=t(64),f=t(159),d=t(7),v=t(167),E=t(27),O=i.JSON,N=i.Number,m=i.SyntaxError,b=O&&O.parse,k=o("Object","keys"),T=Object.getOwnPropertyDescriptor,S=a("".charAt),F=a("".slice),P=a(/./.exec),G=a([].push),j=/^\d$/,L=/^[1-9]$/,K=/^(-|\d)$/,Q=/^[\t\n\r ]$/,ne=0,D=1,$=function(R,V){R=y(R);var M=new U(R,0),Y=M.parse(),W=Y.value,ee=M.skip(Q,Y.end);if(ee<R.length)throw m('Unexpected extra character: "'+S(R,ee)+'" after the parsed data at: '+ee);return l(V)?J({"":W},"",V,Y):W},J=function(R,V,M,Y){var W=R[V],ee=Y&&W===Y.value,me=ee&&typeof Y.source=="string"?{source:Y.source}:{},he,ye,ie,ve,Ne;if(u(W)){var Fe=p(W),Le=ee?Y.nodes:Fe?[]:{};if(Fe)for(he=Le.length,ie=h(W),ve=0;ve<ie;ve++)re(W,ve,J(W,""+ve,M,ve<he?Le[ve]:void 0));else for(ye=k(W),ie=h(ye),ve=0;ve<ie;ve++)Ne=ye[ve],re(W,Ne,J(W,Ne,M,g(Le,Ne)?Le[Ne]:void 0))}return c(M,R,V,W,me)},re=function(R,V,M){if(r){var Y=T(R,V);if(Y&&!Y.configurable)return}M===void 0?delete R[V]:f(R,V,M)},pe=function(R,V,M,Y){this.value=R,this.end=V,this.source=M,this.nodes=Y},U=function(R,V){this.source=R,this.index=V};U.prototype={fork:function(R){return new U(this.source,R)},parse:function(){var R=this.source,V=this.skip(Q,this.index),M=this.fork(V),Y=S(R,V);if(P(K,Y))return M.number();switch(Y){case"{":return M.object();case"[":return M.array();case'"':return M.string();case"t":return M.keyword(!0);case"f":return M.keyword(!1);case"n":return M.keyword(null)}throw m('Unexpected character: "'+Y+'" at: '+V)},node:function(R,V,M,Y,W){return new pe(V,Y,R?null:F(this.source,M,Y),W)},object:function(){for(var R=this.source,V=this.index+1,M=!1,Y={},W={};V<R.length;){if(V=this.until(['"',"}"],V),S(R,V)==="}"&&!M){V++;break}var ee=this.fork(V).string(),me=ee.value;V=ee.end,V=this.until([":"],V)+1,V=this.skip(Q,V),ee=this.fork(V).parse(),f(W,me,ee),f(Y,me,ee.value),V=this.until([",","}"],ee.end);var he=S(R,V);if(he===",")M=!0,V++;else if(he==="}"){V++;break}}return this.node(D,Y,this.index,V,W)},array:function(){for(var R=this.source,V=this.index+1,M=!1,Y=[],W=[];V<R.length;){if(V=this.skip(Q,V),S(R,V)==="]"&&!M){V++;break}var ee=this.fork(V).parse();if(G(W,ee),G(Y,ee.value),V=this.until([",","]"],ee.end),S(R,V)===",")M=!0,V++;else if(S(R,V)==="]"){V++;break}}return this.node(D,Y,this.index,V,W)},string:function(){var R=this.index,V=v(this.source,this.index+1);return this.node(ne,V.value,R,V.end)},number:function(){var R=this.source,V=this.index,M=V;if(S(R,M)==="-"&&M++,S(R,M)==="0")M++;else if(P(L,S(R,M)))M=this.skip(j,++M);else throw m("Failed to parse number at: "+M);if(S(R,M)==="."&&(M=this.skip(j,++M)),S(R,M)==="e"||S(R,M)==="E"){M++,(S(R,M)==="+"||S(R,M)==="-")&&M++;var Y=M;if(M=this.skip(j,M),Y===M)throw m("Failed to parse number's exponent value at: "+M)}return this.node(ne,N(F(R,V,M)),V,M)},keyword:function(R){var V=""+R,M=this.index,Y=M+V.length;if(F(this.source,M,Y)!==V)throw m("Failed to parse value at: "+M);return this.node(ne,R,M,Y)},skip:function(R,V){for(var M=this.source;V<M.length&&P(R,S(M,V));V++);return V},until:function(R,V){V=this.skip(Q,V);for(var M=S(this.source,V),Y=0;Y<R.length;Y++)if(R[Y]===M)return V;throw m('Unexpected character: "'+M+'" at: '+V)}};var w=d(function(){var R="9007199254740993",V;return b(R,function(M,Y,W){V=W.source}),V!==R}),_=E&&!d(function(){return 1/b("-0 	")!==-1/0});n({target:"JSON",stat:!0,forced:w},{parse:function(V,M){return _&&!l(M)?b(V):$(V,M)}})},(s,e,t)=>{var n=t(14),r=t(39),i=SyntaxError,o=parseInt,a=String.fromCharCode,c=n("".charAt),l=n("".slice),u=n(/./.exec),p={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},g=/^[\da-f]{4}$/i,y=/^[\u0000-\u001F]$/;s.exports=function(h,f){for(var d=!0,v="";f<h.length;){var E=c(h,f);if(E==="\\"){var O=l(h,f,f+2);if(r(p,O))v+=p[O],f+=2;else if(O==="\\u"){f+=2;var N=l(h,f,f+4);if(!u(g,N))throw i("Bad Unicode escape at: "+f);v+=a(o(N,16)),f+=4}else throw i('Unknown escape sequence: "'+O+'"')}else if(E==='"'){d=!1,f++;break}else{if(u(y,E))throw i("Bad control character in string literal at: "+f);v+=E,f++}}if(d)throw i("Unterminated string at: "+f);return{value:v,end:f}}},(s,e,t)=>{var ne,D,$,J,re,pe,U,w,_,R,V,M,Tt,W,Ct,me,sn,ye,Lt,ve,Bt,Fe,Ot,ke,Pt;Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMFilterFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=k,e.getColorValues=G,e.getCurrentTransform=j,e.getCurrentTransformInverse=L,e.getFilenameFromUrl=E,e.getPdfFilenameFromUrl=O,e.getRGB=P,e.getXfaPageViewport=F,e.isDataScheme=d,e.isPdfFile=v,e.isValidFetchUrl=m,e.loadScript=b,e.setLayerDimensions=K,t(2),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(89),t(84),t(86),t(87);var n=t(169),r=t(1);const i="http://www.w3.org/2000/svg",o="pdfjs_internal_id_";e.AnnotationPrefix=o;const Q=class Q{};st(Q,"CSS",96),st(Q,"PDF",72),st(Q,"PDF_TO_CSS_UNITS",Q.CSS/Q.PDF);let a=Q;e.PixelsPerInch=a;class c extends n.BaseFilterFactory{constructor(){let{docId:fe,ownerDocument:Ce=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super();se(this,M);se(this,W);se(this,me);se(this,ye);se(this,ve);se(this,Fe);se(this,ke);se(this,ne,void 0);se(this,D,void 0);se(this,$,void 0);se(this,J,void 0);se(this,re,void 0);se(this,pe,void 0);se(this,U,void 0);se(this,w,void 0);se(this,_,void 0);se(this,R,void 0);se(this,V,0);Ae(this,$,fe),Ae(this,J,Ce)}addFilter(fe){if(!fe)return"none";let Ce=x(this,M,Tt).get(fe);if(Ce)return Ce;let Me,Ge,Ye,je;if(fe.length===1){const Ze=fe[0],Qe=new Array(256);for(let Ee=0;Ee<256;Ee++)Qe[Ee]=Ze[Ee]/255;je=Me=Ge=Ye=Qe.join(",")}else{const[Ze,Qe,Ee]=fe,ue=new Array(256),oe=new Array(256),Ue=new Array(256);for(let Be=0;Be<256;Be++)ue[Be]=Ze[Be]/255,oe[Be]=Qe[Be]/255,Ue[Be]=Ee[Be]/255;Me=ue.join(","),Ge=oe.join(","),Ye=Ue.join(","),je=`${Me}${Ge}${Ye}`}if(Ce=x(this,M,Tt).get(je),Ce)return x(this,M,Tt).set(fe,Ce),Ce;const Ve=`g_${x(this,$)}_transfer_map_${_t(this,V)._++}`,We=`url(#${Ve})`;x(this,M,Tt).set(fe,We),x(this,M,Tt).set(je,We);const qe=le(this,ye,Lt).call(this,Ve);return le(this,Fe,Ot).call(this,Me,Ge,Ye,qe),We}addHCMFilter(fe,Ce){var Qe;const Me=`${fe}-${Ce}`;if(x(this,pe)===Me)return x(this,U);if(Ae(this,pe,Me),Ae(this,U,"none"),(Qe=x(this,re))==null||Qe.remove(),!fe||!Ce)return x(this,U);const Ge=le(this,ke,Pt).call(this,fe);fe=r.Util.makeHexColor(...Ge);const Ye=le(this,ke,Pt).call(this,Ce);if(Ce=r.Util.makeHexColor(...Ye),x(this,W,Ct).style.color="",fe==="#000000"&&Ce==="#ffffff"||fe===Ce)return x(this,U);const je=new Array(256);for(let Ee=0;Ee<=255;Ee++){const ue=Ee/255;je[Ee]=ue<=.03928?ue/12.92:((ue+.055)/1.055)**2.4}const Ve=je.join(","),We=`g_${x(this,$)}_hcm_filter`,qe=Ae(this,w,le(this,ye,Lt).call(this,We));le(this,Fe,Ot).call(this,Ve,Ve,Ve,qe),le(this,me,sn).call(this,qe);const Ze=(Ee,ue)=>{const oe=Ge[Ee]/255,Ue=Ye[Ee]/255,Be=new Array(ue+1);for(let nt=0;nt<=ue;nt++)Be[nt]=oe+nt/ue*(Ue-oe);return Be.join(",")};return le(this,Fe,Ot).call(this,Ze(0,5),Ze(1,5),Ze(2,5),qe),Ae(this,U,`url(#${We})`),x(this,U)}addHighlightHCMFilter(fe,Ce,Me,Ge){var Ue;const Ye=`${fe}-${Ce}-${Me}-${Ge}`;if(x(this,_)===Ye)return x(this,R);if(Ae(this,_,Ye),Ae(this,R,"none"),(Ue=x(this,w))==null||Ue.remove(),!fe||!Ce)return x(this,R);const[je,Ve]=[fe,Ce].map(le(this,ke,Pt).bind(this));let We=Math.round(.2126*je[0]+.7152*je[1]+.0722*je[2]),qe=Math.round(.2126*Ve[0]+.7152*Ve[1]+.0722*Ve[2]),[Ze,Qe]=[Me,Ge].map(le(this,ke,Pt).bind(this));qe<We&&([We,qe,Ze,Qe]=[qe,We,Qe,Ze]),x(this,W,Ct).style.color="";const Ee=(Be,nt,ge)=>{const te=new Array(256),Te=(qe-We)/ge,Ie=Be/255,Se=(nt-Be)/(255*ge);let z=0;for(let I=0;I<=ge;I++){const Z=Math.round(We+I*Te),H=Ie+I*Se;for(let q=z;q<=Z;q++)te[q]=H;z=Z+1}for(let I=z;I<256;I++)te[I]=te[z-1];return te.join(",")},ue=`g_${x(this,$)}_hcm_highlight_filter`,oe=Ae(this,w,le(this,ye,Lt).call(this,ue));return le(this,me,sn).call(this,oe),le(this,Fe,Ot).call(this,Ee(Ze[0],Qe[0],5),Ee(Ze[1],Qe[1],5),Ee(Ze[2],Qe[2],5),oe),Ae(this,R,`url(#${ue})`),x(this,R)}destroy(){arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&(x(this,U)||x(this,R))||(x(this,D)&&(x(this,D).parentNode.parentNode.remove(),Ae(this,D,null)),x(this,ne)&&(x(this,ne).clear(),Ae(this,ne,null)),Ae(this,V,0))}}ne=new WeakMap,D=new WeakMap,$=new WeakMap,J=new WeakMap,re=new WeakMap,pe=new WeakMap,U=new WeakMap,w=new WeakMap,_=new WeakMap,R=new WeakMap,V=new WeakMap,M=new WeakSet,Tt=function(){return x(this,ne)||Ae(this,ne,new Map)},W=new WeakSet,Ct=function(){if(!x(this,D)){const fe=x(this,J).createElement("div"),{style:Ce}=fe;Ce.visibility="hidden",Ce.contain="strict",Ce.width=Ce.height=0,Ce.position="absolute",Ce.top=Ce.left=0,Ce.zIndex=-1;const Me=x(this,J).createElementNS(i,"svg");Me.setAttribute("width",0),Me.setAttribute("height",0),Ae(this,D,x(this,J).createElementNS(i,"defs")),fe.append(Me),Me.append(x(this,D)),x(this,J).body.append(fe)}return x(this,D)},me=new WeakSet,sn=function(fe){const Ce=x(this,J).createElementNS(i,"feColorMatrix");Ce.setAttribute("type","matrix"),Ce.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),fe.append(Ce)},ye=new WeakSet,Lt=function(fe){const Ce=x(this,J).createElementNS(i,"filter");return Ce.setAttribute("color-interpolation-filters","sRGB"),Ce.setAttribute("id",fe),x(this,W,Ct).append(Ce),Ce},ve=new WeakSet,Bt=function(fe,Ce,Me){const Ge=x(this,J).createElementNS(i,Ce);Ge.setAttribute("type","discrete"),Ge.setAttribute("tableValues",Me),fe.append(Ge)},Fe=new WeakSet,Ot=function(fe,Ce,Me,Ge){const Ye=x(this,J).createElementNS(i,"feComponentTransfer");Ge.append(Ye),le(this,ve,Bt).call(this,Ye,"feFuncR",fe),le(this,ve,Bt).call(this,Ye,"feFuncG",Ce),le(this,ve,Bt).call(this,Ye,"feFuncB",Me)},ke=new WeakSet,Pt=function(fe){return x(this,W,Ct).style.color=fe,P(getComputedStyle(x(this,W,Ct)).getPropertyValue("color"))},e.DOMFilterFactory=c;class l extends n.BaseCanvasFactory{constructor(){let{ownerDocument:be=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._document=be}_createCanvas(be,fe){const Ce=this._document.createElement("canvas");return Ce.width=be,Ce.height=fe,Ce}}e.DOMCanvasFactory=l;async function u(Oe){let be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(m(Oe,document.baseURI)){const fe=await fetch(Oe);if(!fe.ok)throw new Error(fe.statusText);return be?new Uint8Array(await fe.arrayBuffer()):(0,r.stringToBytes)(await fe.text())}return new Promise((fe,Ce)=>{const Me=new XMLHttpRequest;Me.open("GET",Oe,!0),be&&(Me.responseType="arraybuffer"),Me.onreadystatechange=()=>{if(Me.readyState===XMLHttpRequest.DONE){if(Me.status===200||Me.status===0){let Ge;if(be&&Me.response?Ge=new Uint8Array(Me.response):!be&&Me.responseText&&(Ge=(0,r.stringToBytes)(Me.responseText)),Ge){fe(Ge);return}}Ce(new Error(Me.statusText))}},Me.send(null)})}class p extends n.BaseCMapReaderFactory{_fetchData(be,fe){return u(be,this.isCompressed).then(Ce=>({cMapData:Ce,compressionType:fe}))}}e.DOMCMapReaderFactory=p;class g extends n.BaseStandardFontDataFactory{_fetchData(be){return u(be,!0)}}e.DOMStandardFontDataFactory=g;class y extends n.BaseSVGFactory{_createSVG(be){return document.createElementNS(i,be)}}e.DOMSVGFactory=y;class h{constructor(be){let{viewBox:fe,scale:Ce,rotation:Me,offsetX:Ge=0,offsetY:Ye=0,dontFlip:je=!1}=be;this.viewBox=fe,this.scale=Ce,this.rotation=Me,this.offsetX=Ge,this.offsetY=Ye;const Ve=(fe[2]+fe[0])/2,We=(fe[3]+fe[1])/2;let qe,Ze,Qe,Ee;switch(Me%=360,Me<0&&(Me+=360),Me){case 180:qe=-1,Ze=0,Qe=0,Ee=1;break;case 90:qe=0,Ze=1,Qe=1,Ee=0;break;case 270:qe=0,Ze=-1,Qe=-1,Ee=0;break;case 0:qe=1,Ze=0,Qe=0,Ee=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}je&&(Qe=-Qe,Ee=-Ee);let ue,oe,Ue,Be;qe===0?(ue=Math.abs(We-fe[1])*Ce+Ge,oe=Math.abs(Ve-fe[0])*Ce+Ye,Ue=(fe[3]-fe[1])*Ce,Be=(fe[2]-fe[0])*Ce):(ue=Math.abs(Ve-fe[0])*Ce+Ge,oe=Math.abs(We-fe[1])*Ce+Ye,Ue=(fe[2]-fe[0])*Ce,Be=(fe[3]-fe[1])*Ce),this.transform=[qe*Ce,Ze*Ce,Qe*Ce,Ee*Ce,ue-qe*Ce*Ve-Qe*Ce*We,oe-Ze*Ce*Ve-Ee*Ce*We],this.width=Ue,this.height=Be}get rawDims(){const{viewBox:be}=this;return(0,r.shadow)(this,"rawDims",{pageWidth:be[2]-be[0],pageHeight:be[3]-be[1],pageX:be[0],pageY:be[1]})}clone(){let{scale:be=this.scale,rotation:fe=this.rotation,offsetX:Ce=this.offsetX,offsetY:Me=this.offsetY,dontFlip:Ge=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new h({viewBox:this.viewBox.slice(),scale:be,rotation:fe,offsetX:Ce,offsetY:Me,dontFlip:Ge})}convertToViewportPoint(be,fe){return r.Util.applyTransform([be,fe],this.transform)}convertToViewportRectangle(be){const fe=r.Util.applyTransform([be[0],be[1]],this.transform),Ce=r.Util.applyTransform([be[2],be[3]],this.transform);return[fe[0],fe[1],Ce[0],Ce[1]]}convertToPdfPoint(be,fe){return r.Util.applyInverseTransform([be,fe],this.transform)}}e.PageViewport=h;class f extends r.BaseException{constructor(be){let fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(be,"RenderingCancelledException"),this.extraDelay=fe}}e.RenderingCancelledException=f;function d(Oe){const be=Oe.length;let fe=0;for(;fe<be&&Oe[fe].trim()==="";)fe++;return Oe.substring(fe,fe+5).toLowerCase()==="data:"}function v(Oe){return typeof Oe=="string"&&/\.pdf$/i.test(Oe)}function E(Oe){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)||([Oe]=Oe.split(/[#?]/,1)),Oe.substring(Oe.lastIndexOf("/")+1)}function O(Oe){let be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"document.pdf";if(typeof Oe!="string")return be;if(d(Oe))return(0,r.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),be;const fe=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Ce=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Me=fe.exec(Oe);let Ge=Ce.exec(Me[1])||Ce.exec(Me[2])||Ce.exec(Me[3]);if(Ge&&(Ge=Ge[0],Ge.includes("%")))try{Ge=Ce.exec(decodeURIComponent(Ge))[0]}catch{}return Ge||be}class N{constructor(){st(this,"started",Object.create(null));st(this,"times",[])}time(be){be in this.started&&(0,r.warn)(`Timer is already running for ${be}`),this.started[be]=Date.now()}timeEnd(be){be in this.started||(0,r.warn)(`Timer has not been started for ${be}`),this.times.push({name:be,start:this.started[be],end:Date.now()}),delete this.started[be]}toString(){const be=[];let fe=0;for(const{name:Ce}of this.times)fe=Math.max(Ce.length,fe);for(const{name:Ce,start:Me,end:Ge}of this.times)be.push(`${Ce.padEnd(fe)} ${Ge-Me}ms
`);return be.join("")}}e.StatTimer=N;function m(Oe,be){try{const{protocol:fe}=be?new URL(Oe,be):new URL(Oe);return fe==="http:"||fe==="https:"}catch{return!1}}function b(Oe){let be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise((fe,Ce)=>{const Me=document.createElement("script");Me.src=Oe,Me.onload=function(Ge){be&&Me.remove(),fe(Ge)},Me.onerror=function(){Ce(new Error(`Cannot load script at: ${Me.src}`))},(document.head||document.documentElement).append(Me)})}function k(Oe){console.log("Deprecated API usage: "+Oe)}let T;class S{static toDateObject(be){if(!be||typeof be!="string")return null;T||(T=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const fe=T.exec(be);if(!fe)return null;const Ce=parseInt(fe[1],10);let Me=parseInt(fe[2],10);Me=Me>=1&&Me<=12?Me-1:0;let Ge=parseInt(fe[3],10);Ge=Ge>=1&&Ge<=31?Ge:1;let Ye=parseInt(fe[4],10);Ye=Ye>=0&&Ye<=23?Ye:0;let je=parseInt(fe[5],10);je=je>=0&&je<=59?je:0;let Ve=parseInt(fe[6],10);Ve=Ve>=0&&Ve<=59?Ve:0;const We=fe[7]||"Z";let qe=parseInt(fe[8],10);qe=qe>=0&&qe<=23?qe:0;let Ze=parseInt(fe[9],10)||0;return Ze=Ze>=0&&Ze<=59?Ze:0,We==="-"?(Ye+=qe,je+=Ze):We==="+"&&(Ye-=qe,je-=Ze),new Date(Date.UTC(Ce,Me,Ge,Ye,je,Ve))}}e.PDFDateString=S;function F(Oe,be){let{scale:fe=1,rotation:Ce=0}=be;const{width:Me,height:Ge}=Oe.attributes.style,Ye=[0,0,parseInt(Me),parseInt(Ge)];return new h({viewBox:Ye,scale:fe,rotation:Ce})}function P(Oe){if(Oe.startsWith("#")){const be=parseInt(Oe.slice(1),16);return[(be&16711680)>>16,(be&65280)>>8,be&255]}return Oe.startsWith("rgb(")?Oe.slice(4,-1).split(",").map(be=>parseInt(be)):Oe.startsWith("rgba(")?Oe.slice(5,-1).split(",").map(be=>parseInt(be)).slice(0,3):((0,r.warn)(`Not a valid color format: "${Oe}"`),[0,0,0])}function G(Oe){const be=document.createElement("span");be.style.visibility="hidden",document.body.append(be);for(const fe of Oe.keys()){be.style.color=fe;const Ce=window.getComputedStyle(be).color;Oe.set(fe,P(Ce))}be.remove()}function j(Oe){const{a:be,b:fe,c:Ce,d:Me,e:Ge,f:Ye}=Oe.getTransform();return[be,fe,Ce,Me,Ge,Ye]}function L(Oe){const{a:be,b:fe,c:Ce,d:Me,e:Ge,f:Ye}=Oe.getTransform().invertSelf();return[be,fe,Ce,Me,Ge,Ye]}function K(Oe,be){let fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,Ce=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;if(be instanceof h){const{pageWidth:Me,pageHeight:Ge}=be.rawDims,{style:Ye}=Oe,je=r.FeatureTest.isCSSRoundSupported,Ve=`var(--scale-factor) * ${Me}px`,We=`var(--scale-factor) * ${Ge}px`,qe=je?`round(${Ve}, 1px)`:`calc(${Ve})`,Ze=je?`round(${We}, 1px)`:`calc(${We})`;!fe||be.rotation%180===0?(Ye.width=qe,Ye.height=Ze):(Ye.width=Ze,Ye.height=qe)}Ce&&Oe.setAttribute("data-main-rotation",be.rotation)}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseFilterFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0,t(2);var n=t(1);class r{constructor(){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(u){return"none"}addHCMFilter(u,p){return"none"}addHighlightHCMFilter(u,p,g,y){return"none"}destroy(){}}e.BaseFilterFactory=r;class i{constructor(){this.constructor===i&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(u,p){if(u<=0||p<=0)throw new Error("Invalid canvas size");const g=this._createCanvas(u,p);return{canvas:g,context:g.getContext("2d")}}reset(u,p,g){if(!u.canvas)throw new Error("Canvas is not specified");if(p<=0||g<=0)throw new Error("Invalid canvas size");u.canvas.width=p,u.canvas.height=g}destroy(u){if(!u.canvas)throw new Error("Canvas is not specified");u.canvas.width=0,u.canvas.height=0,u.canvas=null,u.context=null}_createCanvas(u,p){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=i;class o{constructor(u){let{baseUrl:p=null,isCompressed:g=!0}=u;this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=p,this.isCompressed=g}async fetch(u){let{name:p}=u;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!p)throw new Error("CMap name must be specified.");const g=this.baseUrl+p+(this.isCompressed?".bcmap":""),y=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(g,y).catch(h=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${g}`)})}_fetchData(u,p){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=o;class a{constructor(u){let{baseUrl:p=null}=u;this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=p}async fetch(u){let{filename:p}=u;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!p)throw new Error("Font filename must be specified.");const g=`${this.baseUrl}${p}`;return this._fetchData(g).catch(y=>{throw new Error(`Unable to load font data at: ${g}`)})}_fetchData(u){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=a;class c{constructor(){this.constructor===c&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(u,p){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(u<=0||p<=0)throw new Error("Invalid SVG dimensions");const y=this._createSVG("svg:svg");return y.setAttribute("version","1.1"),g||(y.setAttribute("width",`${u}px`),y.setAttribute("height",`${p}px`)),y.setAttribute("preserveAspectRatio","none"),y.setAttribute("viewBox",`0 0 ${u} ${p}`),y}createElement(u){if(typeof u!="string")throw new Error("Invalid SVG element type");return this._createSVG(u)}_createSVG(u){(0,n.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=c},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(2);var n=t(1);const r=3285377520,i=4294901760,o=65535;class a{constructor(l){this.h1=l?l&4294967295:r,this.h2=l?l&4294967295:r}update(l){let u,p;if(typeof l=="string"){u=new Uint8Array(l.length*2),p=0;for(let k=0,T=l.length;k<T;k++){const S=l.charCodeAt(k);S<=255?u[p++]=S:(u[p++]=S>>>8,u[p++]=S&255)}}else if((0,n.isArrayBuffer)(l))u=l.slice(),p=u.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const g=p>>2,y=p-g*4,h=new Uint32Array(u.buffer,0,g);let f=0,d=0,v=this.h1,E=this.h2;const O=3432918353,N=461845907,m=O&o,b=N&o;for(let k=0;k<g;k++)k&1?(f=h[k],f=f*O&i|f*m&o,f=f<<15|f>>>17,f=f*N&i|f*b&o,v^=f,v=v<<13|v>>>19,v=v*5+3864292196):(d=h[k],d=d*O&i|d*m&o,d=d<<15|d>>>17,d=d*N&i|d*b&o,E^=d,E=E<<13|E>>>19,E=E*5+3864292196);switch(f=0,y){case 3:f^=u[g*4+2]<<16;case 2:f^=u[g*4+1]<<8;case 1:f^=u[g*4],f=f*O&i|f*m&o,f=f<<15|f>>>17,f=f*N&i|f*b&o,g&1?v^=f:E^=f}this.h1=v,this.h2=E}hexdigest(){let l=this.h1,u=this.h2;return l^=u>>>1,l=l*3981806797&i|l*36045&o,u=u*4283543511&i|((u<<16|l>>>16)*2950163797&i)>>>16,l^=u>>>1,l=l*444984403&i|l*60499&o,u=u*3301882366&i|((u<<16|l>>>16)*3120437893&i)>>>16,l^=u>>>1,(l>>>0).toString(16).padStart(8,"0")+(u>>>0).toString(16).padStart(8,"0")}}e.MurmurHash3_64=a},(s,e,t)=>{var o;Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0,t(125),t(136),t(138),t(141),t(143),t(145),t(147),t(89),t(149);var n=t(1);class r{constructor(c){se(this,o,new Set);let{ownerDocument:l=globalThis.document,styleElement:u=null}=c;this._document=l,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(c){this.nativeFontFaces.add(c),this._document.fonts.add(c)}removeNativeFontFace(c){this.nativeFontFaces.delete(c),this._document.fonts.delete(c)}insertRule(c){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const l=this.styleElement.sheet;l.insertRule(c,l.cssRules.length)}clear(){for(const c of this.nativeFontFaces)this._document.fonts.delete(c);this.nativeFontFaces.clear(),x(this,o).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(c){if(!(!c||x(this,o).has(c.loadedName))){if((0,n.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:l,src:u,style:p}=c,g=new FontFace(l,u,p);this.addNativeFontFace(g);try{await g.load(),x(this,o).add(l)}catch{(0,n.warn)(`Cannot load system font: ${c.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(g)}return}(0,n.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(c){if(c.attached||c.missingFile&&!c.systemFontInfo)return;if(c.attached=!0,c.systemFontInfo){await this.loadSystemFont(c.systemFontInfo);return}if(this.isFontLoadingAPISupported){const u=c.createNativeFontFace();if(u){this.addNativeFontFace(u);try{await u.loaded}catch(p){throw(0,n.warn)(`Failed to load font '${u.family}': '${p}'.`),c.disableFontFace=!0,p}}return}const l=c.createFontFaceRule();if(l){if(this.insertRule(l),this.isSyncFontLoadingSupported)return;await new Promise(u=>{const p=this._queueLoadingCallback(u);this._prepareFontLoadEvent(c,p)})}}get isFontLoadingAPISupported(){var l;const c=!!((l=this._document)!=null&&l.fonts);return(0,n.shadow)(this,"isFontLoadingAPISupported",c)}get isSyncFontLoadingSupported(){let c=!1;return(n.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(c=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",c)}_queueLoadingCallback(c){function l(){for((0,n.assert)(!p.done,"completeRequest() cannot be called twice."),p.done=!0;u.length>0&&u[0].done;){const g=u.shift();setTimeout(g.callback,0)}}const{loadingRequests:u}=this,p={done:!1,complete:l,callback:c};return u.push(p),p}get _loadTestFont(){const c=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",c)}_prepareFontLoadEvent(c,l){function u(P,G){return P.charCodeAt(G)<<24|P.charCodeAt(G+1)<<16|P.charCodeAt(G+2)<<8|P.charCodeAt(G+3)&255}function p(P,G,j,L){const K=P.substring(0,G),Q=P.substring(G+j);return K+L+Q}let g,y;const h=this._document.createElement("canvas");h.width=1,h.height=1;const f=h.getContext("2d");let d=0;function v(P,G){if(++d>30){(0,n.warn)("Load test font never loaded."),G();return}if(f.font="30px "+P,f.fillText(".",0,20),f.getImageData(0,0,1,1).data[3]>0){G();return}setTimeout(v.bind(null,P,G))}const E=`lt${Date.now()}${this.loadTestFontId++}`;let O=this._loadTestFont;O=p(O,976,E.length,E);const m=16,b=1482184792;let k=u(O,m);for(g=0,y=E.length-3;g<y;g+=4)k=k-b+u(E,g)|0;g<E.length&&(k=k-b+u(E+"XXX",g)|0),O=p(O,m,4,(0,n.string32)(k));const T=`url(data:font/opentype;base64,${btoa(O)});`,S=`@font-face {font-family:"${E}";src:${T}}`;this.insertRule(S);const F=this._document.createElement("div");F.style.visibility="hidden",F.style.width=F.style.height="10px",F.style.position="absolute",F.style.top=F.style.left="0px";for(const P of[c.loadedName,E]){const G=this._document.createElement("span");G.textContent="Hi",G.style.fontFamily=P,F.append(G)}this._document.body.append(F),v(E,()=>{F.remove(),l.complete()})}}o=new WeakMap,e.FontLoader=r;class i{constructor(c,l){let{isEvalSupported:u=!0,disableFontFace:p=!1,ignoreErrors:g=!1,inspectFont:y=null}=l;this.compiledGlyphs=Object.create(null);for(const h in c)this[h]=c[h];this.isEvalSupported=u!==!1,this.disableFontFace=p===!0,this.ignoreErrors=g===!0,this._inspectFont=y}createNativeFontFace(){var l;if(!this.data||this.disableFontFace)return null;let c;if(!this.cssFontInfo)c=new FontFace(this.loadedName,this.data,{});else{const u={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(u.style=`oblique ${this.cssFontInfo.italicAngle}deg`),c=new FontFace(this.cssFontInfo.fontFamily,this.data,u)}return(l=this._inspectFont)==null||l.call(this,this),c}createFontFaceRule(){var p;if(!this.data||this.disableFontFace)return null;const c=(0,n.bytesToString)(this.data),l=`url(data:${this.mimetype};base64,${btoa(c)});`;let u;if(!this.cssFontInfo)u=`@font-face {font-family:"${this.loadedName}";src:${l}}`;else{let g=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(g+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),u=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${g}src:${l}}`}return(p=this._inspectFont)==null||p.call(this,this,l),u}getPathGenerator(c,l){if(this.compiledGlyphs[l]!==void 0)return this.compiledGlyphs[l];let u;try{u=c.get(this.loadedName+"_path_"+l)}catch(p){if(!this.ignoreErrors)throw p;return(0,n.warn)(`getPathGenerator - ignoring character: "${p}".`),this.compiledGlyphs[l]=function(g,y){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const p=[];for(const g of u){const y=g.args!==void 0?g.args.join(","):"";p.push("c.",g.cmd,"(",y,`);
`)}return this.compiledGlyphs[l]=new Function("c","size",p.join(""))}return this.compiledGlyphs[l]=function(p,g){for(const y of u)y.cmd==="scale"&&(y.args=[g,-g]),p[y.cmd].apply(p,y.args)}}}e.FontFaceObject=i},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeFilterFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0,t(2),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123);var n=t(169),r=t(1);(function(){if(!(globalThis.DOMMatrix||!r.isNodeJS))try{globalThis.DOMMatrix=require$$6.DOMMatrix}catch(p){(0,r.warn)(`Cannot polyfill \`DOMMatrix\`, rendering may be broken: "${p}".`)}})(),function(){if(!(globalThis.Path2D||!r.isNodeJS))try{const{CanvasRenderingContext2D:p}=require$$6,{polyfillPath2D:g}=requirePath2dPolyfill_esm();globalThis.CanvasRenderingContext2D=p,g(globalThis)}catch(p){(0,r.warn)(`Cannot polyfill \`Path2D\`, rendering may be broken: "${p}".`)}}();const i=function(u){return new Promise((p,g)=>{require$$6.readFile(u,(h,f)=>{if(h||!f){g(new Error(h));return}p(new Uint8Array(f))})})};class o extends n.BaseFilterFactory{}e.NodeFilterFactory=o;class a extends n.BaseCanvasFactory{_createCanvas(p,g){return require$$6.createCanvas(p,g)}}e.NodeCanvasFactory=a;class c extends n.BaseCMapReaderFactory{_fetchData(p,g){return i(p).then(y=>({cMapData:y,compressionType:g}))}}e.NodeCMapReaderFactory=c;class l extends n.BaseStandardFontDataFactory{_fetchData(p){return i(p)}}e.NodeStandardFontDataFactory=l},(s,e,t)=>{var D,on,J,an;Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0,t(2),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(89);var n=t(1),r=t(168),i=t(174),o=t(175);const a=16,c=100,l=4096,u=15,p=10,g=1e3,y=16;function h(U,w){if(U._removeMirroring)throw new Error("Context is already forwarding operations.");U.__originalSave=U.save,U.__originalRestore=U.restore,U.__originalRotate=U.rotate,U.__originalScale=U.scale,U.__originalTranslate=U.translate,U.__originalTransform=U.transform,U.__originalSetTransform=U.setTransform,U.__originalResetTransform=U.resetTransform,U.__originalClip=U.clip,U.__originalMoveTo=U.moveTo,U.__originalLineTo=U.lineTo,U.__originalBezierCurveTo=U.bezierCurveTo,U.__originalRect=U.rect,U.__originalClosePath=U.closePath,U.__originalBeginPath=U.beginPath,U._removeMirroring=()=>{U.save=U.__originalSave,U.restore=U.__originalRestore,U.rotate=U.__originalRotate,U.scale=U.__originalScale,U.translate=U.__originalTranslate,U.transform=U.__originalTransform,U.setTransform=U.__originalSetTransform,U.resetTransform=U.__originalResetTransform,U.clip=U.__originalClip,U.moveTo=U.__originalMoveTo,U.lineTo=U.__originalLineTo,U.bezierCurveTo=U.__originalBezierCurveTo,U.rect=U.__originalRect,U.closePath=U.__originalClosePath,U.beginPath=U.__originalBeginPath,delete U._removeMirroring},U.save=function(){w.save(),this.__originalSave()},U.restore=function(){w.restore(),this.__originalRestore()},U.translate=function(R,V){w.translate(R,V),this.__originalTranslate(R,V)},U.scale=function(R,V){w.scale(R,V),this.__originalScale(R,V)},U.transform=function(R,V,M,Y,W,ee){w.transform(R,V,M,Y,W,ee),this.__originalTransform(R,V,M,Y,W,ee)},U.setTransform=function(R,V,M,Y,W,ee){w.setTransform(R,V,M,Y,W,ee),this.__originalSetTransform(R,V,M,Y,W,ee)},U.resetTransform=function(){w.resetTransform(),this.__originalResetTransform()},U.rotate=function(R){w.rotate(R),this.__originalRotate(R)},U.clip=function(R){w.clip(R),this.__originalClip(R)},U.moveTo=function(_,R){w.moveTo(_,R),this.__originalMoveTo(_,R)},U.lineTo=function(_,R){w.lineTo(_,R),this.__originalLineTo(_,R)},U.bezierCurveTo=function(_,R,V,M,Y,W){w.bezierCurveTo(_,R,V,M,Y,W),this.__originalBezierCurveTo(_,R,V,M,Y,W)},U.rect=function(_,R,V,M){w.rect(_,R,V,M),this.__originalRect(_,R,V,M)},U.closePath=function(){w.closePath(),this.__originalClosePath()},U.beginPath=function(){w.beginPath(),this.__originalBeginPath()}}class f{constructor(w){this.canvasFactory=w,this.cache=Object.create(null)}getCanvas(w,_,R){let V;return this.cache[w]!==void 0?(V=this.cache[w],this.canvasFactory.reset(V,_,R)):(V=this.canvasFactory.create(_,R),this.cache[w]=V),V}delete(w){delete this.cache[w]}clear(){for(const w in this.cache){const _=this.cache[w];this.canvasFactory.destroy(_),delete this.cache[w]}}}function d(U,w,_,R,V,M,Y,W,ee,me){const[he,ye,ie,ve,Ne,Fe]=(0,r.getCurrentTransform)(U);if(ye===0&&ie===0){const ze=Y*he+Ne,Oe=Math.round(ze),be=W*ve+Fe,fe=Math.round(be),Ce=(Y+ee)*he+Ne,Me=Math.abs(Math.round(Ce)-Oe)||1,Ge=(W+me)*ve+Fe,Ye=Math.abs(Math.round(Ge)-fe)||1;return U.setTransform(Math.sign(he),0,0,Math.sign(ve),Oe,fe),U.drawImage(w,_,R,V,M,0,0,Me,Ye),U.setTransform(he,ye,ie,ve,Ne,Fe),[Me,Ye]}if(he===0&&ve===0){const ze=W*ie+Ne,Oe=Math.round(ze),be=Y*ye+Fe,fe=Math.round(be),Ce=(W+me)*ie+Ne,Me=Math.abs(Math.round(Ce)-Oe)||1,Ge=(Y+ee)*ye+Fe,Ye=Math.abs(Math.round(Ge)-fe)||1;return U.setTransform(0,Math.sign(ye),Math.sign(ie),0,Oe,fe),U.drawImage(w,_,R,V,M,0,0,Ye,Me),U.setTransform(he,ye,ie,ve,Ne,Fe),[Ye,Me]}U.drawImage(w,_,R,V,M,Y,W,ee,me);const Le=Math.hypot(he,ye),ke=Math.hypot(ie,ve);return[Le*ee,ke*me]}function v(U){const{width:w,height:_}=U;if(w>g||_>g)return null;const R=1e3,V=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),M=w+1;let Y=new Uint8Array(M*(_+1)),W,ee,me;const he=w+7&-8;let ye=new Uint8Array(he*_),ie=0;for(const ke of U.data){let ze=128;for(;ze>0;)ye[ie++]=ke&ze?0:255,ze>>=1}let ve=0;for(ie=0,ye[ie]!==0&&(Y[0]=1,++ve),ee=1;ee<w;ee++)ye[ie]!==ye[ie+1]&&(Y[ee]=ye[ie]?2:1,++ve),ie++;for(ye[ie]!==0&&(Y[ee]=2,++ve),W=1;W<_;W++){ie=W*he,me=W*M,ye[ie-he]!==ye[ie]&&(Y[me]=ye[ie]?1:8,++ve);let ke=(ye[ie]?4:0)+(ye[ie-he]?8:0);for(ee=1;ee<w;ee++)ke=(ke>>2)+(ye[ie+1]?4:0)+(ye[ie-he+1]?8:0),V[ke]&&(Y[me+ee]=V[ke],++ve),ie++;if(ye[ie-he]!==ye[ie]&&(Y[me+ee]=ye[ie]?2:4,++ve),ve>R)return null}for(ie=he*(_-1),me=W*M,ye[ie]!==0&&(Y[me]=8,++ve),ee=1;ee<w;ee++)ye[ie]!==ye[ie+1]&&(Y[me+ee]=ye[ie]?4:8,++ve),ie++;if(ye[ie]!==0&&(Y[me+ee]=4,++ve),ve>R)return null;const Ne=new Int32Array([0,M,-1,0,-M,0,0,0,1]),Fe=new Path2D;for(W=0;ve&&W<=_;W++){let ke=W*M;const ze=ke+w;for(;ke<ze&&!Y[ke];)ke++;if(ke===ze)continue;Fe.moveTo(ke%M,W);const Oe=ke;let be=Y[ke];do{const fe=Ne[be];do ke+=fe;while(!Y[ke]);const Ce=Y[ke];Ce!==5&&Ce!==10?(be=Ce,Y[ke]=0):(be=Ce&51*be>>4,Y[ke]&=be>>2|be<<2),Fe.lineTo(ke%M,ke/M|0),Y[ke]||--ve}while(Oe!==ke);--W}return ye=null,Y=null,function(ke){ke.save(),ke.scale(1/w,-1/_),ke.translate(0,-_),ke.fill(Fe),ke.beginPath(),ke.restore()}}class E{constructor(w,_){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,w,_])}clone(){const w=Object.create(this);return w.clipBox=this.clipBox.slice(),w}setCurrentPoint(w,_){this.x=w,this.y=_}updatePathMinMax(w,_,R){[_,R]=n.Util.applyTransform([_,R],w),this.minX=Math.min(this.minX,_),this.minY=Math.min(this.minY,R),this.maxX=Math.max(this.maxX,_),this.maxY=Math.max(this.maxY,R)}updateRectMinMax(w,_){const R=n.Util.applyTransform(_,w),V=n.Util.applyTransform(_.slice(2),w);this.minX=Math.min(this.minX,R[0],V[0]),this.minY=Math.min(this.minY,R[1],V[1]),this.maxX=Math.max(this.maxX,R[0],V[0]),this.maxY=Math.max(this.maxY,R[1],V[1])}updateScalingPathMinMax(w,_){n.Util.scaleMinMax(w,_),this.minX=Math.min(this.minX,_[0]),this.maxX=Math.max(this.maxX,_[1]),this.minY=Math.min(this.minY,_[2]),this.maxY=Math.max(this.maxY,_[3])}updateCurvePathMinMax(w,_,R,V,M,Y,W,ee,me,he){const ye=n.Util.bezierBoundingBox(_,R,V,M,Y,W,ee,me);if(he){he[0]=Math.min(he[0],ye[0],ye[2]),he[1]=Math.max(he[1],ye[0],ye[2]),he[2]=Math.min(he[2],ye[1],ye[3]),he[3]=Math.max(he[3],ye[1],ye[3]);return}this.updateRectMinMax(w,ye)}getPathBoundingBox(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const R=[this.minX,this.minY,this.maxX,this.maxY];if(w===i.PathType.STROKE){_||(0,n.unreachable)("Stroke bounding box must include transform.");const V=n.Util.singularValueDecompose2dScale(_),M=V[0]*this.lineWidth/2,Y=V[1]*this.lineWidth/2;R[0]-=M,R[1]-=Y,R[2]+=M,R[3]+=Y}return R}updateClipFromPath(){const w=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(w||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(w){this.clipBox=w,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return n.Util.intersect(this.clipBox,this.getPathBoundingBox(w,_))}}function O(U,w){if(typeof ImageData<"u"&&w instanceof ImageData){U.putImageData(w,0,0);return}const _=w.height,R=w.width,V=_%y,M=(_-V)/y,Y=V===0?M:M+1,W=U.createImageData(R,y);let ee=0,me;const he=w.data,ye=W.data;let ie,ve,Ne,Fe;if(w.kind===n.ImageKind.GRAYSCALE_1BPP){const Le=he.byteLength,ke=new Uint32Array(ye.buffer,0,ye.byteLength>>2),ze=ke.length,Oe=R+7>>3,be=4294967295,fe=n.FeatureTest.isLittleEndian?4278190080:255;for(ie=0;ie<Y;ie++){for(Ne=ie<M?y:V,me=0,ve=0;ve<Ne;ve++){const Ce=Le-ee;let Me=0;const Ge=Ce>Oe?R:Ce*8-7,Ye=Ge&-8;let je=0,Ve=0;for(;Me<Ye;Me+=8)Ve=he[ee++],ke[me++]=Ve&128?be:fe,ke[me++]=Ve&64?be:fe,ke[me++]=Ve&32?be:fe,ke[me++]=Ve&16?be:fe,ke[me++]=Ve&8?be:fe,ke[me++]=Ve&4?be:fe,ke[me++]=Ve&2?be:fe,ke[me++]=Ve&1?be:fe;for(;Me<Ge;Me++)je===0&&(Ve=he[ee++],je=128),ke[me++]=Ve&je?be:fe,je>>=1}for(;me<ze;)ke[me++]=0;U.putImageData(W,0,ie*y)}}else if(w.kind===n.ImageKind.RGBA_32BPP){for(ve=0,Fe=R*y*4,ie=0;ie<M;ie++)ye.set(he.subarray(ee,ee+Fe)),ee+=Fe,U.putImageData(W,0,ve),ve+=y;ie<Y&&(Fe=R*V*4,ye.set(he.subarray(ee,ee+Fe)),U.putImageData(W,0,ve))}else if(w.kind===n.ImageKind.RGB_24BPP)for(Ne=y,Fe=R*Ne,ie=0;ie<Y;ie++){for(ie>=M&&(Ne=V,Fe=R*Ne),me=0,ve=Fe;ve--;)ye[me++]=he[ee++],ye[me++]=he[ee++],ye[me++]=he[ee++],ye[me++]=255;U.putImageData(W,0,ie*y)}else throw new Error(`bad image kind: ${w.kind}`)}function N(U,w){if(w.bitmap){U.drawImage(w.bitmap,0,0);return}const _=w.height,R=w.width,V=_%y,M=(_-V)/y,Y=V===0?M:M+1,W=U.createImageData(R,y);let ee=0;const me=w.data,he=W.data;for(let ye=0;ye<Y;ye++){const ie=ye<M?y:V;({srcPos:ee}=(0,o.convertBlackAndWhiteToRGBA)({src:me,srcPos:ee,dest:he,width:R,height:ie,nonBlackColor:0})),U.putImageData(W,0,ye*y)}}function m(U,w){const _=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const R of _)U[R]!==void 0&&(w[R]=U[R]);U.setLineDash!==void 0&&(w.setLineDash(U.getLineDash()),w.lineDashOffset=U.lineDashOffset)}function b(U){if(U.strokeStyle=U.fillStyle="#000000",U.fillRule="nonzero",U.globalAlpha=1,U.lineWidth=1,U.lineCap="butt",U.lineJoin="miter",U.miterLimit=10,U.globalCompositeOperation="source-over",U.font="10px sans-serif",U.setLineDash!==void 0&&(U.setLineDash([]),U.lineDashOffset=0),!n.isNodeJS){const{filter:w}=U;w!=="none"&&w!==""&&(U.filter="none")}}function k(U,w,_,R){const V=U.length;for(let M=3;M<V;M+=4){const Y=U[M];if(Y===0)U[M-3]=w,U[M-2]=_,U[M-1]=R;else if(Y<255){const W=255-Y;U[M-3]=U[M-3]*Y+w*W>>8,U[M-2]=U[M-2]*Y+_*W>>8,U[M-1]=U[M-1]*Y+R*W>>8}}}function T(U,w,_){const R=U.length,V=1/255;for(let M=3;M<R;M+=4){const Y=_?_[U[M]]:U[M];w[M]=w[M]*Y*V|0}}function S(U,w,_){const R=U.length;for(let V=3;V<R;V+=4){const M=U[V-3]*77+U[V-2]*152+U[V-1]*28;w[V]=_?w[V]*_[M>>8]>>8:w[V]*M>>16}}function F(U,w,_,R,V,M,Y,W,ee,me,he){const ye=!!M,ie=ye?M[0]:0,ve=ye?M[1]:0,Ne=ye?M[2]:0,Fe=V==="Luminosity"?S:T,ke=Math.min(R,Math.ceil(1048576/_));for(let ze=0;ze<R;ze+=ke){const Oe=Math.min(ke,R-ze),be=U.getImageData(W-me,ze+(ee-he),_,Oe),fe=w.getImageData(W,ze+ee,_,Oe);ye&&k(be.data,ie,ve,Ne),Fe(be.data,fe.data,Y),w.putImageData(fe,W,ze+ee)}}function P(U,w,_,R){const V=R[0],M=R[1],Y=R[2]-V,W=R[3]-M;Y===0||W===0||(F(w.context,_,Y,W,w.subtype,w.backdrop,w.transferMap,V,M,w.offsetX,w.offsetY),U.save(),U.globalAlpha=1,U.globalCompositeOperation="source-over",U.setTransform(1,0,0,1,0,0),U.drawImage(_.canvas,0,0),U.restore())}function G(U,w){const _=n.Util.singularValueDecompose2dScale(U);_[0]=Math.fround(_[0]),_[1]=Math.fround(_[1]);const R=Math.fround((globalThis.devicePixelRatio||1)*r.PixelsPerInch.PDF_TO_CSS_UNITS);return w!==void 0?w:_[0]<=R||_[1]<=R}const j=["butt","round","square"],L=["miter","round","bevel"],K={},Q={},pe=class pe{constructor(w,_,R,V,M,Y,W,ee){se(this,D);se(this,J);let{optionalContentConfig:me,markedContentStack:he=null}=Y;this.ctx=w,this.current=new E(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=_,this.objs=R,this.canvasFactory=V,this.filterFactory=M,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=he||[],this.optionalContentConfig=me,this.cachedCanvases=new f(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=W,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=ee,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(w){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof w=="string"?w.startsWith("g_")?this.commonObjs.get(w):this.objs.get(w):_}beginDrawing(w){let{transform:_,viewport:R,transparency:V=!1,background:M=null}=w;const Y=this.ctx.canvas.width,W=this.ctx.canvas.height,ee=this.ctx.fillStyle;if(this.ctx.fillStyle=M||"#ffffff",this.ctx.fillRect(0,0,Y,W),this.ctx.fillStyle=ee,V){const me=this.cachedCanvases.getCanvas("transparent",Y,W);this.compositeCtx=this.ctx,this.transparentCanvas=me.canvas,this.ctx=me.context,this.ctx.save(),this.ctx.transform(...(0,r.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),b(this.ctx),_&&(this.ctx.transform(..._),this.outputScaleX=_[0],this.outputScaleY=_[0]),this.ctx.transform(...R.transform),this.viewportScale=R.scale,this.baseTransform=(0,r.getCurrentTransform)(this.ctx)}executeOperatorList(w,_,R,V){const M=w.argsArray,Y=w.fnArray;let W=_||0;const ee=M.length;if(ee===W)return W;const me=ee-W>p&&typeof R=="function",he=me?Date.now()+u:0;let ye=0;const ie=this.commonObjs,ve=this.objs;let Ne;for(;;){if(V!==void 0&&W===V.nextBreakPoint)return V.breakIt(W,R),W;if(Ne=Y[W],Ne!==n.OPS.dependency)this[Ne].apply(this,M[W]);else for(const Fe of M[W]){const Le=Fe.startsWith("g_")?ie:ve;if(!Le.has(Fe))return Le.get(Fe,R),W}if(W++,W===ee)return W;if(me&&++ye>p){if(Date.now()>he)return R(),W;ye=0}}}endDrawing(){le(this,D,on).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const w of this._cachedBitmapsMap.values()){for(const _ of w.values())typeof HTMLCanvasElement<"u"&&_ instanceof HTMLCanvasElement&&(_.width=_.height=0);w.clear()}this._cachedBitmapsMap.clear(),le(this,J,an).call(this)}_scaleImage(w,_){const R=w.width,V=w.height;let M=Math.max(Math.hypot(_[0],_[1]),1),Y=Math.max(Math.hypot(_[2],_[3]),1),W=R,ee=V,me="prescale1",he,ye;for(;M>2&&W>1||Y>2&&ee>1;){let ie=W,ve=ee;M>2&&W>1&&(ie=W>=16384?Math.floor(W/2)-1||1:Math.ceil(W/2),M/=W/ie),Y>2&&ee>1&&(ve=ee>=16384?Math.floor(ee/2)-1||1:Math.ceil(ee)/2,Y/=ee/ve),he=this.cachedCanvases.getCanvas(me,ie,ve),ye=he.context,ye.clearRect(0,0,ie,ve),ye.drawImage(w,0,0,W,ee,0,0,ie,ve),w=he.canvas,W=ie,ee=ve,me=me==="prescale1"?"prescale2":"prescale1"}return{img:w,paintWidth:W,paintHeight:ee}}_createMaskCanvas(w){const _=this.ctx,{width:R,height:V}=w,M=this.current.fillColor,Y=this.current.patternFill,W=(0,r.getCurrentTransform)(_);let ee,me,he,ye;if((w.bitmap||w.data)&&w.count>1){const Me=w.bitmap||w.data.buffer;me=JSON.stringify(Y?W:[W.slice(0,4),M]),ee=this._cachedBitmapsMap.get(Me),ee||(ee=new Map,this._cachedBitmapsMap.set(Me,ee));const Ge=ee.get(me);if(Ge&&!Y){const Ye=Math.round(Math.min(W[0],W[2])+W[4]),je=Math.round(Math.min(W[1],W[3])+W[5]);return{canvas:Ge,offsetX:Ye,offsetY:je}}he=Ge}he||(ye=this.cachedCanvases.getCanvas("maskCanvas",R,V),N(ye.context,w));let ie=n.Util.transform(W,[1/R,0,0,-1/V,0,0]);ie=n.Util.transform(ie,[1,0,0,1,0,-V]);const ve=n.Util.applyTransform([0,0],ie),Ne=n.Util.applyTransform([R,V],ie),Fe=n.Util.normalizeRect([ve[0],ve[1],Ne[0],Ne[1]]),Le=Math.round(Fe[2]-Fe[0])||1,ke=Math.round(Fe[3]-Fe[1])||1,ze=this.cachedCanvases.getCanvas("fillCanvas",Le,ke),Oe=ze.context,be=Math.min(ve[0],Ne[0]),fe=Math.min(ve[1],Ne[1]);Oe.translate(-be,-fe),Oe.transform(...ie),he||(he=this._scaleImage(ye.canvas,(0,r.getCurrentTransformInverse)(Oe)),he=he.img,ee&&Y&&ee.set(me,he)),Oe.imageSmoothingEnabled=G((0,r.getCurrentTransform)(Oe),w.interpolate),d(Oe,he,0,0,he.width,he.height,0,0,R,V),Oe.globalCompositeOperation="source-in";const Ce=n.Util.transform((0,r.getCurrentTransformInverse)(Oe),[1,0,0,1,-be,-fe]);return Oe.fillStyle=Y?M.getPattern(_,this,Ce,i.PathType.FILL):M,Oe.fillRect(0,0,R,V),ee&&!Y&&(this.cachedCanvases.delete("fillCanvas"),ee.set(me,ze.canvas)),{canvas:ze.canvas,offsetX:Math.round(be),offsetY:Math.round(fe)}}setLineWidth(w){w!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=w,this.ctx.lineWidth=w}setLineCap(w){this.ctx.lineCap=j[w]}setLineJoin(w){this.ctx.lineJoin=L[w]}setMiterLimit(w){this.ctx.miterLimit=w}setDash(w,_){const R=this.ctx;R.setLineDash!==void 0&&(R.setLineDash(w),R.lineDashOffset=_)}setRenderingIntent(w){}setFlatness(w){}setGState(w){for(const[_,R]of w)switch(_){case"LW":this.setLineWidth(R);break;case"LC":this.setLineCap(R);break;case"LJ":this.setLineJoin(R);break;case"ML":this.setMiterLimit(R);break;case"D":this.setDash(R[0],R[1]);break;case"RI":this.setRenderingIntent(R);break;case"FL":this.setFlatness(R);break;case"Font":this.setFont(R[0],R[1]);break;case"CA":this.current.strokeAlpha=R;break;case"ca":this.current.fillAlpha=R,this.ctx.globalAlpha=R;break;case"BM":this.ctx.globalCompositeOperation=R;break;case"SMask":this.current.activeSMask=R?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(R);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const w=this.inSMaskMode;this.current.activeSMask&&!w?this.beginSMaskMode():!this.current.activeSMask&&w&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const w=this.ctx.canvas.width,_=this.ctx.canvas.height,R="smaskGroupAt"+this.groupLevel,V=this.cachedCanvases.getCanvas(R,w,_);this.suspendedCtx=this.ctx,this.ctx=V.context;const M=this.ctx;M.setTransform(...(0,r.getCurrentTransform)(this.suspendedCtx)),m(this.suspendedCtx,M),h(M,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),m(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(w){if(!this.current.activeSMask)return;w?(w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.ceil(w[2]),w[3]=Math.ceil(w[3])):w=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const _=this.current.activeSMask,R=this.suspendedCtx;P(R,_,this.ctx,w),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(m(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const w=this.current;this.stateStack.push(w),this.current=w.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),m(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(w,_,R,V,M,Y){this.ctx.transform(w,_,R,V,M,Y),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(w,_,R){const V=this.ctx,M=this.current;let Y=M.x,W=M.y,ee,me;const he=(0,r.getCurrentTransform)(V),ye=he[0]===0&&he[3]===0||he[1]===0&&he[2]===0,ie=ye?R.slice(0):null;for(let ve=0,Ne=0,Fe=w.length;ve<Fe;ve++)switch(w[ve]|0){case n.OPS.rectangle:Y=_[Ne++],W=_[Ne++];const Le=_[Ne++],ke=_[Ne++],ze=Y+Le,Oe=W+ke;V.moveTo(Y,W),Le===0||ke===0?V.lineTo(ze,Oe):(V.lineTo(ze,W),V.lineTo(ze,Oe),V.lineTo(Y,Oe)),ye||M.updateRectMinMax(he,[Y,W,ze,Oe]),V.closePath();break;case n.OPS.moveTo:Y=_[Ne++],W=_[Ne++],V.moveTo(Y,W),ye||M.updatePathMinMax(he,Y,W);break;case n.OPS.lineTo:Y=_[Ne++],W=_[Ne++],V.lineTo(Y,W),ye||M.updatePathMinMax(he,Y,W);break;case n.OPS.curveTo:ee=Y,me=W,Y=_[Ne+4],W=_[Ne+5],V.bezierCurveTo(_[Ne],_[Ne+1],_[Ne+2],_[Ne+3],Y,W),M.updateCurvePathMinMax(he,ee,me,_[Ne],_[Ne+1],_[Ne+2],_[Ne+3],Y,W,ie),Ne+=6;break;case n.OPS.curveTo2:ee=Y,me=W,V.bezierCurveTo(Y,W,_[Ne],_[Ne+1],_[Ne+2],_[Ne+3]),M.updateCurvePathMinMax(he,ee,me,Y,W,_[Ne],_[Ne+1],_[Ne+2],_[Ne+3],ie),Y=_[Ne+2],W=_[Ne+3],Ne+=4;break;case n.OPS.curveTo3:ee=Y,me=W,Y=_[Ne+2],W=_[Ne+3],V.bezierCurveTo(_[Ne],_[Ne+1],Y,W,Y,W),M.updateCurvePathMinMax(he,ee,me,_[Ne],_[Ne+1],Y,W,Y,W,ie),Ne+=4;break;case n.OPS.closePath:V.closePath();break}ye&&M.updateScalingPathMinMax(he,ie),M.setCurrentPoint(Y,W)}closePath(){this.ctx.closePath()}stroke(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const _=this.ctx,R=this.current.strokeColor;_.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof R=="object"&&(R!=null&&R.getPattern)?(_.save(),_.strokeStyle=R.getPattern(_,this,(0,r.getCurrentTransformInverse)(_),i.PathType.STROKE),this.rescaleAndStroke(!1),_.restore()):this.rescaleAndStroke(!0)),w&&this.consumePath(this.current.getClippedPathBoundingBox()),_.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const _=this.ctx,R=this.current.fillColor,V=this.current.patternFill;let M=!1;V&&(_.save(),_.fillStyle=R.getPattern(_,this,(0,r.getCurrentTransformInverse)(_),i.PathType.FILL),M=!0);const Y=this.current.getClippedPathBoundingBox();this.contentVisible&&Y!==null&&(this.pendingEOFill?(_.fill("evenodd"),this.pendingEOFill=!1):_.fill()),M&&_.restore(),w&&this.consumePath(Y)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=K}eoClip(){this.pendingClip=Q}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const w=this.pendingTextPaths,_=this.ctx;if(w===void 0){_.beginPath();return}_.save(),_.beginPath();for(const R of w)_.setTransform(...R.transform),_.translate(R.x,R.y),R.addToPath(_,R.fontSize);_.restore(),_.clip(),_.beginPath(),delete this.pendingTextPaths}setCharSpacing(w){this.current.charSpacing=w}setWordSpacing(w){this.current.wordSpacing=w}setHScale(w){this.current.textHScale=w/100}setLeading(w){this.current.leading=-w}setFont(w,_){var he;const R=this.commonObjs.get(w),V=this.current;if(!R)throw new Error(`Can't find font for ${w}`);if(V.fontMatrix=R.fontMatrix||n.FONT_IDENTITY_MATRIX,(V.fontMatrix[0]===0||V.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+w),_<0?(_=-_,V.fontDirection=-1):V.fontDirection=1,this.current.font=R,this.current.fontSize=_,R.isType3Font)return;const M=R.loadedName||"sans-serif",Y=((he=R.systemFontInfo)==null?void 0:he.css)||`"${M}", ${R.fallbackName}`;let W="normal";R.black?W="900":R.bold&&(W="bold");const ee=R.italic?"italic":"normal";let me=_;_<a?me=a:_>c&&(me=c),this.current.fontSizeScale=_/me,this.ctx.font=`${ee} ${W} ${me}px ${Y}`}setTextRenderingMode(w){this.current.textRenderingMode=w}setTextRise(w){this.current.textRise=w}moveText(w,_){this.current.x=this.current.lineX+=w,this.current.y=this.current.lineY+=_}setLeadingMoveText(w,_){this.setLeading(-_),this.moveText(w,_)}setTextMatrix(w,_,R,V,M,Y){this.current.textMatrix=[w,_,R,V,M,Y],this.current.textMatrixScale=Math.hypot(w,_),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(w,_,R,V){const M=this.ctx,Y=this.current,W=Y.font,ee=Y.textRenderingMode,me=Y.fontSize/Y.fontSizeScale,he=ee&n.TextRenderingMode.FILL_STROKE_MASK,ye=!!(ee&n.TextRenderingMode.ADD_TO_PATH_FLAG),ie=Y.patternFill&&!W.missingFile;let ve;(W.disableFontFace||ye||ie)&&(ve=W.getPathGenerator(this.commonObjs,w)),W.disableFontFace||ie?(M.save(),M.translate(_,R),M.beginPath(),ve(M,me),V&&M.setTransform(...V),(he===n.TextRenderingMode.FILL||he===n.TextRenderingMode.FILL_STROKE)&&M.fill(),(he===n.TextRenderingMode.STROKE||he===n.TextRenderingMode.FILL_STROKE)&&M.stroke(),M.restore()):((he===n.TextRenderingMode.FILL||he===n.TextRenderingMode.FILL_STROKE)&&M.fillText(w,_,R),(he===n.TextRenderingMode.STROKE||he===n.TextRenderingMode.FILL_STROKE)&&M.strokeText(w,_,R)),ye&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,r.getCurrentTransform)(M),x:_,y:R,fontSize:me,addToPath:ve})}get isFontSubpixelAAEnabled(){const{context:w}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);w.scale(1.5,1),w.fillText("I",0,10);const _=w.getImageData(0,0,10,10).data;let R=!1;for(let V=3;V<_.length;V+=4)if(_[V]>0&&_[V]<255){R=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",R)}showText(w){const _=this.current,R=_.font;if(R.isType3Font)return this.showType3Text(w);const V=_.fontSize;if(V===0)return;const M=this.ctx,Y=_.fontSizeScale,W=_.charSpacing,ee=_.wordSpacing,me=_.fontDirection,he=_.textHScale*me,ye=w.length,ie=R.vertical,ve=ie?1:-1,Ne=R.defaultVMetrics,Fe=V*_.fontMatrix[0],Le=_.textRenderingMode===n.TextRenderingMode.FILL&&!R.disableFontFace&&!_.patternFill;M.save(),M.transform(..._.textMatrix),M.translate(_.x,_.y+_.textRise),me>0?M.scale(he,-1):M.scale(he,1);let ke;if(_.patternFill){M.save();const Ce=_.fillColor.getPattern(M,this,(0,r.getCurrentTransformInverse)(M),i.PathType.FILL);ke=(0,r.getCurrentTransform)(M),M.restore(),M.fillStyle=Ce}let ze=_.lineWidth;const Oe=_.textMatrixScale;if(Oe===0||ze===0){const Ce=_.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(Ce===n.TextRenderingMode.STROKE||Ce===n.TextRenderingMode.FILL_STROKE)&&(ze=this.getSinglePixelWidth())}else ze/=Oe;if(Y!==1&&(M.scale(Y,Y),ze/=Y),M.lineWidth=ze,R.isInvalidPDFjsFont){const Ce=[];let Me=0;for(const Ge of w)Ce.push(Ge.unicode),Me+=Ge.width;M.fillText(Ce.join(""),0,0),_.x+=Me*Fe*he,M.restore(),this.compose();return}let be=0,fe;for(fe=0;fe<ye;++fe){const Ce=w[fe];if(typeof Ce=="number"){be+=ve*Ce*V/1e3;continue}let Me=!1;const Ge=(Ce.isSpace?ee:0)+W,Ye=Ce.fontChar,je=Ce.accent;let Ve,We,qe=Ce.width;if(ie){const Qe=Ce.vmetric||Ne,Ee=-(Ce.vmetric?Qe[1]:qe*.5)*Fe,ue=Qe[2]*Fe;qe=Qe?-Qe[0]:qe,Ve=Ee/Y,We=(be+ue)/Y}else Ve=be/Y,We=0;if(R.remeasure&&qe>0){const Qe=M.measureText(Ye).width*1e3/V*Y;if(qe<Qe&&this.isFontSubpixelAAEnabled){const Ee=qe/Qe;Me=!0,M.save(),M.scale(Ee,1),Ve/=Ee}else qe!==Qe&&(Ve+=(qe-Qe)/2e3*V/Y)}if(this.contentVisible&&(Ce.isInFont||R.missingFile)){if(Le&&!je)M.fillText(Ye,Ve,We);else if(this.paintChar(Ye,Ve,We,ke),je){const Qe=Ve+V*je.offset.x/Y,Ee=We-V*je.offset.y/Y;this.paintChar(je.fontChar,Qe,Ee,ke)}}const Ze=ie?qe*Fe-Ge*me:qe*Fe+Ge*me;be+=Ze,Me&&M.restore()}ie?_.y-=be:_.x+=be*he,M.restore(),this.compose()}showType3Text(w){const _=this.ctx,R=this.current,V=R.font,M=R.fontSize,Y=R.fontDirection,W=V.vertical?1:-1,ee=R.charSpacing,me=R.wordSpacing,he=R.textHScale*Y,ye=R.fontMatrix||n.FONT_IDENTITY_MATRIX,ie=w.length,ve=R.textRenderingMode===n.TextRenderingMode.INVISIBLE;let Ne,Fe,Le,ke;if(!(ve||M===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,_.save(),_.transform(...R.textMatrix),_.translate(R.x,R.y),_.scale(he,Y),Ne=0;Ne<ie;++Ne){if(Fe=w[Ne],typeof Fe=="number"){ke=W*Fe*M/1e3,this.ctx.translate(ke,0),R.x+=ke*he;continue}const ze=(Fe.isSpace?me:0)+ee,Oe=V.charProcOperatorList[Fe.operatorListId];if(!Oe){(0,n.warn)(`Type3 character "${Fe.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Fe,this.save(),_.scale(M,M),_.transform(...ye),this.executeOperatorList(Oe),this.restore()),Le=n.Util.applyTransform([Fe.width,0],ye)[0]*M+ze,_.translate(Le,0),R.x+=Le*he}_.restore(),this.processingType3=null}}setCharWidth(w,_){}setCharWidthAndBounds(w,_,R,V,M,Y){this.ctx.rect(R,V,M-R,Y-V),this.ctx.clip(),this.endPath()}getColorN_Pattern(w){let _;if(w[0]==="TilingPattern"){const R=w[1],V=this.baseTransform||(0,r.getCurrentTransform)(this.ctx),M={createCanvasGraphics:Y=>new pe(Y,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};_=new i.TilingPattern(w,R,this.ctx,M,V)}else _=this._getPattern(w[1],w[2]);return _}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(w,_,R){const V=n.Util.makeHexColor(w,_,R);this.ctx.strokeStyle=V,this.current.strokeColor=V}setFillRGBColor(w,_,R){const V=n.Util.makeHexColor(w,_,R);this.ctx.fillStyle=V,this.current.fillColor=V,this.current.patternFill=!1}_getPattern(w){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,R;return this.cachedPatterns.has(w)?R=this.cachedPatterns.get(w):(R=(0,i.getShadingPattern)(this.getObject(w)),this.cachedPatterns.set(w,R)),_&&(R.matrix=_),R}shadingFill(w){if(!this.contentVisible)return;const _=this.ctx;this.save();const R=this._getPattern(w);_.fillStyle=R.getPattern(_,this,(0,r.getCurrentTransformInverse)(_),i.PathType.SHADING);const V=(0,r.getCurrentTransformInverse)(_);if(V){const{width:M,height:Y}=_.canvas,[W,ee,me,he]=n.Util.getAxialAlignedBoundingBox([0,0,M,Y],V);this.ctx.fillRect(W,ee,me-W,he-ee)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(w,_){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(w)&&w.length===6&&this.transform(...w),this.baseTransform=(0,r.getCurrentTransform)(this.ctx),_)){const R=_[2]-_[0],V=_[3]-_[1];this.ctx.rect(_[0],_[1],R,V),this.current.updateRectMinMax((0,r.getCurrentTransform)(this.ctx),_),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(w){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const _=this.ctx;w.isolated||(0,n.info)("TODO: Support non-isolated groups."),w.knockout&&(0,n.warn)("Knockout groups not supported.");const R=(0,r.getCurrentTransform)(_);if(w.matrix&&_.transform(...w.matrix),!w.bbox)throw new Error("Bounding box is required.");let V=n.Util.getAxialAlignedBoundingBox(w.bbox,(0,r.getCurrentTransform)(_));const M=[0,0,_.canvas.width,_.canvas.height];V=n.Util.intersect(V,M)||[0,0,0,0];const Y=Math.floor(V[0]),W=Math.floor(V[1]);let ee=Math.max(Math.ceil(V[2])-Y,1),me=Math.max(Math.ceil(V[3])-W,1),he=1,ye=1;ee>l&&(he=ee/l,ee=l),me>l&&(ye=me/l,me=l),this.current.startNewPathAndClipBox([0,0,ee,me]);let ie="groupAt"+this.groupLevel;w.smask&&(ie+="_smask_"+this.smaskCounter++%2);const ve=this.cachedCanvases.getCanvas(ie,ee,me),Ne=ve.context;Ne.scale(1/he,1/ye),Ne.translate(-Y,-W),Ne.transform(...R),w.smask?this.smaskStack.push({canvas:ve.canvas,context:Ne,offsetX:Y,offsetY:W,scaleX:he,scaleY:ye,subtype:w.smask.subtype,backdrop:w.smask.backdrop,transferMap:w.smask.transferMap||null,startTransformInverse:null}):(_.setTransform(1,0,0,1,0,0),_.translate(Y,W),_.scale(he,ye),_.save()),m(_,Ne),this.ctx=Ne,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(_),this.groupLevel++}endGroup(w){if(!this.contentVisible)return;this.groupLevel--;const _=this.ctx,R=this.groupStack.pop();if(this.ctx=R,this.ctx.imageSmoothingEnabled=!1,w.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const V=(0,r.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...V);const M=n.Util.getAxialAlignedBoundingBox([0,0,_.canvas.width,_.canvas.height],V);this.ctx.drawImage(_.canvas,0,0),this.ctx.restore(),this.compose(M)}}beginAnnotation(w,_,R,V,M){if(le(this,D,on).call(this),b(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(_)&&_.length===4){const Y=_[2]-_[0],W=_[3]-_[1];if(M&&this.annotationCanvasMap){R=R.slice(),R[4]-=_[0],R[5]-=_[1],_=_.slice(),_[0]=_[1]=0,_[2]=Y,_[3]=W;const[ee,me]=n.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(this.ctx)),{viewportScale:he}=this,ye=Math.ceil(Y*this.outputScaleX*he),ie=Math.ceil(W*this.outputScaleY*he);this.annotationCanvas=this.canvasFactory.create(ye,ie);const{canvas:ve,context:Ne}=this.annotationCanvas;this.annotationCanvasMap.set(w,ve),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Ne,this.ctx.save(),this.ctx.setTransform(ee,0,0,-me,0,W*me),b(this.ctx)}else b(this.ctx),this.ctx.rect(_[0],_[1],Y,W),this.ctx.clip(),this.endPath()}this.current=new E(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...R),this.transform(...V)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),le(this,J,an).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(w){if(!this.contentVisible)return;const _=w.count;w=this.getObject(w.data,w),w.count=_;const R=this.ctx,V=this.processingType3;if(V&&(V.compiled===void 0&&(V.compiled=v(w)),V.compiled)){V.compiled(R);return}const M=this._createMaskCanvas(w),Y=M.canvas;R.save(),R.setTransform(1,0,0,1,0,0),R.drawImage(Y,M.offsetX,M.offsetY),R.restore(),this.compose()}paintImageMaskXObjectRepeat(w,_){let R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,V=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,M=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;w=this.getObject(w.data,w);const W=this.ctx;W.save();const ee=(0,r.getCurrentTransform)(W);W.transform(_,R,V,M,0,0);const me=this._createMaskCanvas(w);W.setTransform(1,0,0,1,me.offsetX-ee[4],me.offsetY-ee[5]);for(let he=0,ye=Y.length;he<ye;he+=2){const ie=n.Util.transform(ee,[_,R,V,M,Y[he],Y[he+1]]),[ve,Ne]=n.Util.applyTransform([0,0],ie);W.drawImage(me.canvas,ve,Ne)}W.restore(),this.compose()}paintImageMaskXObjectGroup(w){if(!this.contentVisible)return;const _=this.ctx,R=this.current.fillColor,V=this.current.patternFill;for(const M of w){const{data:Y,width:W,height:ee,transform:me}=M,he=this.cachedCanvases.getCanvas("maskCanvas",W,ee),ye=he.context;ye.save();const ie=this.getObject(Y,M);N(ye,ie),ye.globalCompositeOperation="source-in",ye.fillStyle=V?R.getPattern(ye,this,(0,r.getCurrentTransformInverse)(_),i.PathType.FILL):R,ye.fillRect(0,0,W,ee),ye.restore(),_.save(),_.transform(...me),_.scale(1,-1),d(_,he.canvas,0,0,W,ee,0,-1,1,1),_.restore()}this.compose()}paintImageXObject(w){if(!this.contentVisible)return;const _=this.getObject(w);if(!_){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(_)}paintImageXObjectRepeat(w,_,R,V){if(!this.contentVisible)return;const M=this.getObject(w);if(!M){(0,n.warn)("Dependent image isn't ready yet");return}const Y=M.width,W=M.height,ee=[];for(let me=0,he=V.length;me<he;me+=2)ee.push({transform:[_,0,0,R,V[me],V[me+1]],x:0,y:0,w:Y,h:W});this.paintInlineImageXObjectGroup(M,ee)}applyTransferMapsToCanvas(w){return this.current.transferMaps!=="none"&&(w.filter=this.current.transferMaps,w.drawImage(w.canvas,0,0),w.filter="none"),w.canvas}applyTransferMapsToBitmap(w){if(this.current.transferMaps==="none")return w.bitmap;const{bitmap:_,width:R,height:V}=w,M=this.cachedCanvases.getCanvas("inlineImage",R,V),Y=M.context;return Y.filter=this.current.transferMaps,Y.drawImage(_,0,0),Y.filter="none",M.canvas}paintInlineImageXObject(w){if(!this.contentVisible)return;const _=w.width,R=w.height,V=this.ctx;if(this.save(),!n.isNodeJS){const{filter:W}=V;W!=="none"&&W!==""&&(V.filter="none")}V.scale(1/_,-1/R);let M;if(w.bitmap)M=this.applyTransferMapsToBitmap(w);else if(typeof HTMLElement=="function"&&w instanceof HTMLElement||!w.data)M=w;else{const ee=this.cachedCanvases.getCanvas("inlineImage",_,R).context;O(ee,w),M=this.applyTransferMapsToCanvas(ee)}const Y=this._scaleImage(M,(0,r.getCurrentTransformInverse)(V));V.imageSmoothingEnabled=G((0,r.getCurrentTransform)(V),w.interpolate),d(V,Y.img,0,0,Y.paintWidth,Y.paintHeight,0,-R,_,R),this.compose(),this.restore()}paintInlineImageXObjectGroup(w,_){if(!this.contentVisible)return;const R=this.ctx;let V;if(w.bitmap)V=w.bitmap;else{const M=w.width,Y=w.height,ee=this.cachedCanvases.getCanvas("inlineImage",M,Y).context;O(ee,w),V=this.applyTransferMapsToCanvas(ee)}for(const M of _)R.save(),R.transform(...M.transform),R.scale(1,-1),d(R,V,M.x,M.y,M.w,M.h,0,-1,1,1),R.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(w){}markPointProps(w,_){}beginMarkedContent(w){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(w,_){w==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(_)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(w){const _=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(w);const R=this.ctx;this.pendingClip&&(_||(this.pendingClip===Q?R.clip("evenodd"):R.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),R.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const w=(0,r.getCurrentTransform)(this.ctx);if(w[1]===0&&w[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(w[0]),Math.abs(w[3]));else{const _=Math.abs(w[0]*w[3]-w[2]*w[1]),R=Math.hypot(w[0],w[2]),V=Math.hypot(w[1],w[3]);this._cachedGetSinglePixelWidth=Math.max(R,V)/_}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:w}=this.current,{a:_,b:R,c:V,d:M}=this.ctx.getTransform();let Y,W;if(R===0&&V===0){const ee=Math.abs(_),me=Math.abs(M);if(ee===me)if(w===0)Y=W=1/ee;else{const he=ee*w;Y=W=he<1?1/he:1}else if(w===0)Y=1/ee,W=1/me;else{const he=ee*w,ye=me*w;Y=he<1?1/he:1,W=ye<1?1/ye:1}}else{const ee=Math.abs(_*M-R*V),me=Math.hypot(_,R),he=Math.hypot(V,M);if(w===0)Y=he/ee,W=me/ee;else{const ye=w*ee;Y=he>ye?he/ye:1,W=me>ye?me/ye:1}}this._cachedScaleForStroking[0]=Y,this._cachedScaleForStroking[1]=W}return this._cachedScaleForStroking}rescaleAndStroke(w){const{ctx:_}=this,{lineWidth:R}=this.current,[V,M]=this.getScaleForStroking();if(_.lineWidth=R||1,V===1&&M===1){_.stroke();return}const Y=_.getLineDash();if(w&&_.save(),_.scale(V,M),Y.length>0){const W=Math.max(V,M);_.setLineDash(Y.map(ee=>ee/W)),_.lineDashOffset/=W}_.stroke(),w&&_.restore()}isContentVisible(){for(let w=this.markedContentStack.length-1;w>=0;w--)if(!this.markedContentStack[w].visible)return!1;return!0}};D=new WeakSet,on=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},J=new WeakSet,an=function(){if(this.pageColors){const w=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(w!=="none"){const _=this.ctx.filter;this.ctx.filter=w,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=_}}};let ne=pe;e.CanvasGraphics=ne;for(const U in n.OPS)ne.prototype[U]!==void 0&&(ne.prototype[n.OPS[U]]=ne.prototype[U])},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=y,t(2);var n=t(1),r=t(168);const i={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=i;function o(v,E){if(!E)return;const O=E[2]-E[0],N=E[3]-E[1],m=new Path2D;m.rect(E[0],E[1],O,N),v.clip(m)}class a{constructor(){this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class c extends a{constructor(E){super(),this._type=E[1],this._bbox=E[2],this._colorStops=E[3],this._p0=E[4],this._p1=E[5],this._r0=E[6],this._r1=E[7],this.matrix=null}_createGradient(E){let O;this._type==="axial"?O=E.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(O=E.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const N of this._colorStops)O.addColorStop(N[0],N[1]);return O}getPattern(E,O,N,m){let b;if(m===i.STROKE||m===i.FILL){const k=O.current.getClippedPathBoundingBox(m,(0,r.getCurrentTransform)(E))||[0,0,0,0],T=Math.ceil(k[2]-k[0])||1,S=Math.ceil(k[3]-k[1])||1,F=O.cachedCanvases.getCanvas("pattern",T,S,!0),P=F.context;P.clearRect(0,0,P.canvas.width,P.canvas.height),P.beginPath(),P.rect(0,0,P.canvas.width,P.canvas.height),P.translate(-k[0],-k[1]),N=n.Util.transform(N,[1,0,0,1,k[0],k[1]]),P.transform(...O.baseTransform),this.matrix&&P.transform(...this.matrix),o(P,this._bbox),P.fillStyle=this._createGradient(P),P.fill(),b=E.createPattern(F.canvas,"no-repeat");const G=new DOMMatrix(N);b.setTransform(G)}else o(E,this._bbox),b=this._createGradient(E);return b}}function l(v,E,O,N,m,b,k,T){const S=E.coords,F=E.colors,P=v.data,G=v.width*4;let j;S[O+1]>S[N+1]&&(j=O,O=N,N=j,j=b,b=k,k=j),S[N+1]>S[m+1]&&(j=N,N=m,m=j,j=k,k=T,T=j),S[O+1]>S[N+1]&&(j=O,O=N,N=j,j=b,b=k,k=j);const L=(S[O]+E.offsetX)*E.scaleX,K=(S[O+1]+E.offsetY)*E.scaleY,Q=(S[N]+E.offsetX)*E.scaleX,ne=(S[N+1]+E.offsetY)*E.scaleY,D=(S[m]+E.offsetX)*E.scaleX,$=(S[m+1]+E.offsetY)*E.scaleY;if(K>=$)return;const J=F[b],re=F[b+1],pe=F[b+2],U=F[k],w=F[k+1],_=F[k+2],R=F[T],V=F[T+1],M=F[T+2],Y=Math.round(K),W=Math.round($);let ee,me,he,ye,ie,ve,Ne,Fe;for(let Le=Y;Le<=W;Le++){if(Le<ne){const fe=Le<K?0:(K-Le)/(K-ne);ee=L-(L-Q)*fe,me=J-(J-U)*fe,he=re-(re-w)*fe,ye=pe-(pe-_)*fe}else{let fe;Le>$?fe=1:ne===$?fe=0:fe=(ne-Le)/(ne-$),ee=Q-(Q-D)*fe,me=U-(U-R)*fe,he=w-(w-V)*fe,ye=_-(_-M)*fe}let ke;Le<K?ke=0:Le>$?ke=1:ke=(K-Le)/(K-$),ie=L-(L-D)*ke,ve=J-(J-R)*ke,Ne=re-(re-V)*ke,Fe=pe-(pe-M)*ke;const ze=Math.round(Math.min(ee,ie)),Oe=Math.round(Math.max(ee,ie));let be=G*Le+ze*4;for(let fe=ze;fe<=Oe;fe++)ke=(ee-fe)/(ee-ie),ke<0?ke=0:ke>1&&(ke=1),P[be++]=me-(me-ve)*ke|0,P[be++]=he-(he-Ne)*ke|0,P[be++]=ye-(ye-Fe)*ke|0,P[be++]=255}}function u(v,E,O){const N=E.coords,m=E.colors;let b,k;switch(E.type){case"lattice":const T=E.verticesPerRow,S=Math.floor(N.length/T)-1,F=T-1;for(b=0;b<S;b++){let P=b*T;for(let G=0;G<F;G++,P++)l(v,O,N[P],N[P+1],N[P+T],m[P],m[P+1],m[P+T]),l(v,O,N[P+T+1],N[P+1],N[P+T],m[P+T+1],m[P+1],m[P+T])}break;case"triangles":for(b=0,k=N.length;b<k;b+=3)l(v,O,N[b],N[b+1],N[b+2],m[b],m[b+1],m[b+2]);break;default:throw new Error("illegal figure")}}class p extends a{constructor(E){super(),this._coords=E[2],this._colors=E[3],this._figures=E[4],this._bounds=E[5],this._bbox=E[7],this._background=E[8],this.matrix=null}_createMeshCanvas(E,O,N){const T=Math.floor(this._bounds[0]),S=Math.floor(this._bounds[1]),F=Math.ceil(this._bounds[2])-T,P=Math.ceil(this._bounds[3])-S,G=Math.min(Math.ceil(Math.abs(F*E[0]*1.1)),3e3),j=Math.min(Math.ceil(Math.abs(P*E[1]*1.1)),3e3),L=F/G,K=P/j,Q={coords:this._coords,colors:this._colors,offsetX:-T,offsetY:-S,scaleX:1/L,scaleY:1/K},ne=G+2*2,D=j+2*2,$=N.getCanvas("mesh",ne,D,!1),J=$.context,re=J.createImageData(G,j);if(O){const U=re.data;for(let w=0,_=U.length;w<_;w+=4)U[w]=O[0],U[w+1]=O[1],U[w+2]=O[2],U[w+3]=255}for(const U of this._figures)u(re,U,Q);return J.putImageData(re,2,2),{canvas:$.canvas,offsetX:T-2*L,offsetY:S-2*K,scaleX:L,scaleY:K}}getPattern(E,O,N,m){o(E,this._bbox);let b;if(m===i.SHADING)b=n.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(E));else if(b=n.Util.singularValueDecompose2dScale(O.baseTransform),this.matrix){const T=n.Util.singularValueDecompose2dScale(this.matrix);b=[b[0]*T[0],b[1]*T[1]]}const k=this._createMeshCanvas(b,m===i.SHADING?null:this._background,O.cachedCanvases);return m!==i.SHADING&&(E.setTransform(...O.baseTransform),this.matrix&&E.transform(...this.matrix)),E.translate(k.offsetX,k.offsetY),E.scale(k.scaleX,k.scaleY),E.createPattern(k.canvas,"no-repeat")}}class g extends a{getPattern(){return"hotpink"}}function y(v){switch(v[0]){case"RadialAxial":return new c(v);case"Mesh":return new p(v);case"Dummy":return new g}throw new Error(`Unknown IR type: ${v[0]}`)}const h={COLORED:1,UNCOLORED:2},d=class d{constructor(E,O,N,m,b){this.operatorList=E[2],this.matrix=E[3]||[1,0,0,1,0,0],this.bbox=E[4],this.xstep=E[5],this.ystep=E[6],this.paintType=E[7],this.tilingType=E[8],this.color=O,this.ctx=N,this.canvasGraphicsFactory=m,this.baseTransform=b}createPatternCanvas(E){const O=this.operatorList,N=this.bbox,m=this.xstep,b=this.ystep,k=this.paintType,T=this.tilingType,S=this.color,F=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+T);const P=N[0],G=N[1],j=N[2],L=N[3],K=n.Util.singularValueDecompose2dScale(this.matrix),Q=n.Util.singularValueDecompose2dScale(this.baseTransform),ne=[K[0]*Q[0],K[1]*Q[1]],D=this.getSizeAndScale(m,this.ctx.canvas.width,ne[0]),$=this.getSizeAndScale(b,this.ctx.canvas.height,ne[1]),J=E.cachedCanvases.getCanvas("pattern",D.size,$.size,!0),re=J.context,pe=F.createCanvasGraphics(re);pe.groupLevel=E.groupLevel,this.setFillAndStrokeStyleToContext(pe,k,S);let U=P,w=G,_=j,R=L;return P<0&&(U=0,_+=Math.abs(P)),G<0&&(w=0,R+=Math.abs(G)),re.translate(-(D.scale*U),-($.scale*w)),pe.transform(D.scale,0,0,$.scale,0,0),re.save(),this.clipBbox(pe,U,w,_,R),pe.baseTransform=(0,r.getCurrentTransform)(pe.ctx),pe.executeOperatorList(O),pe.endDrawing(),{canvas:J.canvas,scaleX:D.scale,scaleY:$.scale,offsetX:U,offsetY:w}}getSizeAndScale(E,O,N){E=Math.abs(E);const m=Math.max(d.MAX_PATTERN_SIZE,O);let b=Math.ceil(E*N);return b>=m?b=m:N=b/E,{scale:N,size:b}}clipBbox(E,O,N,m,b){const k=m-O,T=b-N;E.ctx.rect(O,N,k,T),E.current.updateRectMinMax((0,r.getCurrentTransform)(E.ctx),[O,N,m,b]),E.clip(),E.endPath()}setFillAndStrokeStyleToContext(E,O,N){const m=E.ctx,b=E.current;switch(O){case h.COLORED:const k=this.ctx;m.fillStyle=k.fillStyle,m.strokeStyle=k.strokeStyle,b.fillColor=k.fillStyle,b.strokeColor=k.strokeStyle;break;case h.UNCOLORED:const T=n.Util.makeHexColor(N[0],N[1],N[2]);m.fillStyle=T,m.strokeStyle=T,b.fillColor=T,b.strokeColor=T;break;default:throw new n.FormatError(`Unsupported paint type: ${O}`)}}getPattern(E,O,N,m){let b=N;m!==i.SHADING&&(b=n.Util.transform(b,O.baseTransform),this.matrix&&(b=n.Util.transform(b,this.matrix)));const k=this.createPatternCanvas(O);let T=new DOMMatrix(b);T=T.translate(k.offsetX,k.offsetY),T=T.scale(1/k.scaleX,1/k.scaleY);const S=E.createPattern(k.canvas,"repeat");return S.setTransform(T),S}};st(d,"MAX_PATTERN_SIZE",3e3);let f=d;e.TilingPattern=f},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.convertBlackAndWhiteToRGBA=i,e.convertToRGBA=r,e.grayToRGBA=a,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123);var n=t(1);function r(c){switch(c.kind){case n.ImageKind.GRAYSCALE_1BPP:return i(c);case n.ImageKind.RGB_24BPP:return o(c)}return null}function i(c){let{src:l,srcPos:u=0,dest:p,width:g,height:y,nonBlackColor:h=4294967295,inverseDecode:f=!1}=c;const d=n.FeatureTest.isLittleEndian?4278190080:255,[v,E]=f?[h,d]:[d,h],O=g>>3,N=g&7,m=l.length;p=new Uint32Array(p.buffer);let b=0;for(let k=0;k<y;k++){for(const S=u+O;u<S;u++){const F=u<m?l[u]:255;p[b++]=F&128?E:v,p[b++]=F&64?E:v,p[b++]=F&32?E:v,p[b++]=F&16?E:v,p[b++]=F&8?E:v,p[b++]=F&4?E:v,p[b++]=F&2?E:v,p[b++]=F&1?E:v}if(N===0)continue;const T=u<m?l[u++]:255;for(let S=0;S<N;S++)p[b++]=T&1<<7-S?E:v}return{srcPos:u,destPos:b}}function o(c){let{src:l,srcPos:u=0,dest:p,destPos:g=0,width:y,height:h}=c,f=0;const d=l.length>>2,v=new Uint32Array(l.buffer,u,d);if(n.FeatureTest.isLittleEndian){for(;f<d-2;f+=3,g+=4){const E=v[f],O=v[f+1],N=v[f+2];p[g]=E|4278190080,p[g+1]=E>>>24|O<<8|4278190080,p[g+2]=O>>>16|N<<16|4278190080,p[g+3]=N>>>8|4278190080}for(let E=f*4,O=l.length;E<O;E+=3)p[g++]=l[E]|l[E+1]<<8|l[E+2]<<16|4278190080}else{for(;f<d-2;f+=3,g+=4){const E=v[f],O=v[f+1],N=v[f+2];p[g]=E|255,p[g+1]=E<<24|O>>>8|255,p[g+2]=O<<16|N>>>16|255,p[g+3]=N<<8|255}for(let E=f*4,O=l.length;E<O;E+=3)p[g++]=l[E]<<24|l[E+1]<<16|l[E+2]<<8|255}return{srcPos:u,destPos:g}}function a(c,l){if(n.FeatureTest.isLittleEndian)for(let u=0,p=c.length;u<p;u++)l[u]=c[u]*65793|4278190080;else for(let u=0,p=c.length;u<p;u++)l[u]=c[u]*16843008|255}},(s,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=null,t.workerSrc=""},(s,e,t)=>{var c,Gn,u,zn,g,Vt;Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0,t(2);var n=t(1);const r={UNKNOWN:0,DATA:1,ERROR:2},i={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function o(h){switch(h instanceof Error||typeof h=="object"&&h!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),h.name){case"AbortException":return new n.AbortException(h.message);case"MissingPDFException":return new n.MissingPDFException(h.message);case"PasswordException":return new n.PasswordException(h.message,h.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(h.message,h.status);case"UnknownErrorException":return new n.UnknownErrorException(h.message,h.details);default:return new n.UnknownErrorException(h.message,h.toString())}}class a{constructor(f,d,v){se(this,c);se(this,u);se(this,g);this.sourceName=f,this.targetName=d,this.comObj=v,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=E=>{const O=E.data;if(O.targetName!==this.sourceName)return;if(O.stream){le(this,u,zn).call(this,O);return}if(O.callback){const m=O.callbackId,b=this.callbackCapabilities[m];if(!b)throw new Error(`Cannot resolve callback ${m}`);if(delete this.callbackCapabilities[m],O.callback===r.DATA)b.resolve(O.data);else if(O.callback===r.ERROR)b.reject(o(O.reason));else throw new Error("Unexpected callback case");return}const N=this.actionHandler[O.action];if(!N)throw new Error(`Unknown action from worker: ${O.action}`);if(O.callbackId){const m=this.sourceName,b=O.sourceName;new Promise(function(k){k(N(O.data))}).then(function(k){v.postMessage({sourceName:m,targetName:b,callback:r.DATA,callbackId:O.callbackId,data:k})},function(k){v.postMessage({sourceName:m,targetName:b,callback:r.ERROR,callbackId:O.callbackId,reason:o(k)})});return}if(O.streamId){le(this,c,Gn).call(this,O);return}N(O.data)},v.addEventListener("message",this._onComObjOnMessage)}on(f,d){const v=this.actionHandler;if(v[f])throw new Error(`There is already an actionName called "${f}"`);v[f]=d}send(f,d,v){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:f,data:d},v)}sendWithPromise(f,d,v){const E=this.callbackId++,O=new n.PromiseCapability;this.callbackCapabilities[E]=O;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:f,callbackId:E,data:d},v)}catch(N){O.reject(N)}return O.promise}sendWithStream(f,d,v,E){const O=this.streamId++,N=this.sourceName,m=this.targetName,b=this.comObj;return new ReadableStream({start:k=>{const T=new n.PromiseCapability;return this.streamControllers[O]={controller:k,startCall:T,pullCall:null,cancelCall:null,isClosed:!1},b.postMessage({sourceName:N,targetName:m,action:f,streamId:O,data:d,desiredSize:k.desiredSize},E),T.promise},pull:k=>{const T=new n.PromiseCapability;return this.streamControllers[O].pullCall=T,b.postMessage({sourceName:N,targetName:m,stream:i.PULL,streamId:O,desiredSize:k.desiredSize}),T.promise},cancel:k=>{(0,n.assert)(k instanceof Error,"cancel must have a valid reason");const T=new n.PromiseCapability;return this.streamControllers[O].cancelCall=T,this.streamControllers[O].isClosed=!0,b.postMessage({sourceName:N,targetName:m,stream:i.CANCEL,streamId:O,reason:o(k)}),T.promise}},v)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}c=new WeakSet,Gn=function(f){const d=f.streamId,v=this.sourceName,E=f.sourceName,O=this.comObj,N=this,m=this.actionHandler[f.action],b={enqueue(k){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,S=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const F=this.desiredSize;this.desiredSize-=T,F>0&&this.desiredSize<=0&&(this.sinkCapability=new n.PromiseCapability,this.ready=this.sinkCapability.promise),O.postMessage({sourceName:v,targetName:E,stream:i.ENQUEUE,streamId:d,chunk:k},S)},close(){this.isCancelled||(this.isCancelled=!0,O.postMessage({sourceName:v,targetName:E,stream:i.CLOSE,streamId:d}),delete N.streamSinks[d])},error(k){(0,n.assert)(k instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,O.postMessage({sourceName:v,targetName:E,stream:i.ERROR,streamId:d,reason:o(k)}))},sinkCapability:new n.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:f.desiredSize,ready:null};b.sinkCapability.resolve(),b.ready=b.sinkCapability.promise,this.streamSinks[d]=b,new Promise(function(k){k(m(f.data,b))}).then(function(){O.postMessage({sourceName:v,targetName:E,stream:i.START_COMPLETE,streamId:d,success:!0})},function(k){O.postMessage({sourceName:v,targetName:E,stream:i.START_COMPLETE,streamId:d,reason:o(k)})})},u=new WeakSet,zn=function(f){const d=f.streamId,v=this.sourceName,E=f.sourceName,O=this.comObj,N=this.streamControllers[d],m=this.streamSinks[d];switch(f.stream){case i.START_COMPLETE:f.success?N.startCall.resolve():N.startCall.reject(o(f.reason));break;case i.PULL_COMPLETE:f.success?N.pullCall.resolve():N.pullCall.reject(o(f.reason));break;case i.PULL:if(!m){O.postMessage({sourceName:v,targetName:E,stream:i.PULL_COMPLETE,streamId:d,success:!0});break}m.desiredSize<=0&&f.desiredSize>0&&m.sinkCapability.resolve(),m.desiredSize=f.desiredSize,new Promise(function(b){var k;b((k=m.onPull)==null?void 0:k.call(m))}).then(function(){O.postMessage({sourceName:v,targetName:E,stream:i.PULL_COMPLETE,streamId:d,success:!0})},function(b){O.postMessage({sourceName:v,targetName:E,stream:i.PULL_COMPLETE,streamId:d,reason:o(b)})});break;case i.ENQUEUE:if((0,n.assert)(N,"enqueue should have stream controller"),N.isClosed)break;N.controller.enqueue(f.chunk);break;case i.CLOSE:if((0,n.assert)(N,"close should have stream controller"),N.isClosed)break;N.isClosed=!0,N.controller.close(),le(this,g,Vt).call(this,N,d);break;case i.ERROR:(0,n.assert)(N,"error should have stream controller"),N.controller.error(o(f.reason)),le(this,g,Vt).call(this,N,d);break;case i.CANCEL_COMPLETE:f.success?N.cancelCall.resolve():N.cancelCall.reject(o(f.reason)),le(this,g,Vt).call(this,N,d);break;case i.CANCEL:if(!m)break;new Promise(function(b){var k;b((k=m.onCancel)==null?void 0:k.call(m,o(f.reason)))}).then(function(){O.postMessage({sourceName:v,targetName:E,stream:i.CANCEL_COMPLETE,streamId:d,success:!0})},function(b){O.postMessage({sourceName:v,targetName:E,stream:i.CANCEL_COMPLETE,streamId:d,reason:o(b)})}),m.sinkCapability.reject(o(f.reason)),m.isCancelled=!0,delete this.streamSinks[d];break;default:throw new Error("Unexpected stream case")}},g=new WeakSet,Vt=async function(f,d){var v,E,O;await Promise.allSettled([(v=f.startCall)==null?void 0:v.promise,(E=f.pullCall)==null?void 0:E.promise,(O=f.cancelCall)==null?void 0:O.promise]),delete this.streamControllers[d]},e.MessageHandler=a},(s,e,t)=>{var i,o;Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var n=t(1);class r{constructor(c){se(this,i,void 0);se(this,o,void 0);let{parsedData:l,rawData:u}=c;Ae(this,i,l),Ae(this,o,u)}getRaw(){return x(this,o)}get(c){return x(this,i).get(c)??null}getAll(){return(0,n.objectFromMap)(x(this,i))}has(c){return x(this,i).has(c)}}i=new WeakMap,o=new WeakMap,e.Metadata=r},(s,e,t)=>{var c,l,u,p,g,y,cn;Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var n=t(1),r=t(170);const i=Symbol("INTERNAL");class o{constructor(d,v){se(this,c,!0);this.name=d,this.intent=v}get visible(){return x(this,c)}_setVisible(d,v){d!==i&&(0,n.unreachable)("Internal method `_setVisible` called."),Ae(this,c,v)}}c=new WeakMap;class a{constructor(d){se(this,y);se(this,l,null);se(this,u,new Map);se(this,p,null);se(this,g,null);if(this.name=null,this.creator=null,d!==null){this.name=d.name,this.creator=d.creator,Ae(this,g,d.order);for(const v of d.groups)x(this,u).set(v.id,new o(v.name,v.intent));if(d.baseState==="OFF")for(const v of x(this,u).values())v._setVisible(i,!1);for(const v of d.on)x(this,u).get(v)._setVisible(i,!0);for(const v of d.off)x(this,u).get(v)._setVisible(i,!1);Ae(this,p,this.getHash())}}isVisible(d){if(x(this,u).size===0)return!0;if(!d)return(0,n.warn)("Optional content group not defined."),!0;if(d.type==="OCG")return x(this,u).has(d.id)?x(this,u).get(d.id).visible:((0,n.warn)(`Optional content group not found: ${d.id}`),!0);if(d.type==="OCMD"){if(d.expression)return le(this,y,cn).call(this,d.expression);if(!d.policy||d.policy==="AnyOn"){for(const v of d.ids){if(!x(this,u).has(v))return(0,n.warn)(`Optional content group not found: ${v}`),!0;if(x(this,u).get(v).visible)return!0}return!1}else if(d.policy==="AllOn"){for(const v of d.ids){if(!x(this,u).has(v))return(0,n.warn)(`Optional content group not found: ${v}`),!0;if(!x(this,u).get(v).visible)return!1}return!0}else if(d.policy==="AnyOff"){for(const v of d.ids){if(!x(this,u).has(v))return(0,n.warn)(`Optional content group not found: ${v}`),!0;if(!x(this,u).get(v).visible)return!0}return!1}else if(d.policy==="AllOff"){for(const v of d.ids){if(!x(this,u).has(v))return(0,n.warn)(`Optional content group not found: ${v}`),!0;if(x(this,u).get(v).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${d.policy}.`),!0}return(0,n.warn)(`Unknown group type ${d.type}.`),!0}setVisibility(d){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!x(this,u).has(d)){(0,n.warn)(`Optional content group not found: ${d}`);return}x(this,u).get(d)._setVisible(i,!!v),Ae(this,l,null)}get hasInitialVisibility(){return x(this,p)===null||this.getHash()===x(this,p)}getOrder(){return x(this,u).size?x(this,g)?x(this,g).slice():[...x(this,u).keys()]:null}getGroups(){return x(this,u).size>0?(0,n.objectFromMap)(x(this,u)):null}getGroup(d){return x(this,u).get(d)||null}getHash(){if(x(this,l)!==null)return x(this,l);const d=new r.MurmurHash3_64;for(const[v,E]of x(this,u))d.update(`${v}:${E.visible}`);return Ae(this,l,d.hexdigest())}}l=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakSet,cn=function(d){const v=d.length;if(v<2)return!0;const E=d[0];for(let O=1;O<v;O++){const N=d[O];let m;if(Array.isArray(N))m=le(this,y,cn).call(this,N);else if(x(this,u).has(N))m=x(this,u).get(N).visible;else return(0,n.warn)(`Optional content group not found: ${N}`),!0;switch(E){case"And":if(!m)return!1;break;case"Or":if(m)return!0;break;case"Not":return!m;default:return!0}}return E==="And"},e.OptionalContentConfig=a},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(89);var n=t(1),r=t(168);class i{constructor(l,u){let{length:p,initialData:g,progressiveDone:y=!1,contentDispositionFilename:h=null,disableRange:f=!1,disableStream:d=!1}=l;if((0,n.assert)(u,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=y,this._contentDispositionFilename=h,(g==null?void 0:g.length)>0){const v=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;this._queuedChunks.push(v)}this._pdfDataRangeTransport=u,this._isStreamingSupported=!d,this._isRangeSupported=!f,this._contentLength=p,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((v,E)=>{this._onReceiveData({begin:v,chunk:E})}),this._pdfDataRangeTransport.addProgressListener((v,E)=>{this._onProgress({loaded:v,total:E})}),this._pdfDataRangeTransport.addProgressiveReadListener(v=>{this._onReceiveData({chunk:v})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(l){let{begin:u,chunk:p}=l;const g=p instanceof Uint8Array&&p.byteLength===p.buffer.byteLength?p.buffer:new Uint8Array(p).buffer;if(u===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(g):this._queuedChunks.push(g);else{const y=this._rangeReaders.some(function(h){return h._begin!==u?!1:(h._enqueue(g),!0)});(0,n.assert)(y,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var l;return((l=this._fullRequestReader)==null?void 0:l._loaded)??0}_onProgress(l){var u,p,g,y;l.total===void 0?(p=(u=this._rangeReaders[0])==null?void 0:u.onProgress)==null||p.call(u,{loaded:l.loaded}):(y=(g=this._fullRequestReader)==null?void 0:g.onProgress)==null||y.call(g,{loaded:l.loaded,total:l.total})}_onProgressiveDone(){var l;(l=this._fullRequestReader)==null||l.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(l){const u=this._rangeReaders.indexOf(l);u>=0&&this._rangeReaders.splice(u,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const l=this._queuedChunks;return this._queuedChunks=null,new o(this,l,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(l,u){if(u<=this._progressiveDataLength)return null;const p=new a(this,l,u);return this._pdfDataRangeTransport.requestDataRange(l,u),this._rangeReaders.push(p),p}cancelAllRequests(l){var u;(u=this._fullRequestReader)==null||u.cancel(l);for(const p of this._rangeReaders.slice(0))p.cancel(l);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=i;class o{constructor(l,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this._stream=l,this._done=p||!1,this._filename=(0,r.isPdfFile)(g)?g:null,this._queuedChunks=u||[],this._loaded=0;for(const y of this._queuedChunks)this._loaded+=y.byteLength;this._requests=[],this._headersReady=Promise.resolve(),l._fullRequestReader=this,this.onProgress=null}_enqueue(l){this._done||(this._requests.length>0?this._requests.shift().resolve({value:l,done:!1}):this._queuedChunks.push(l),this._loaded+=l.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const l=new n.PromiseCapability;return this._requests.push(l),l.promise}cancel(l){this._done=!0;for(const u of this._requests)u.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class a{constructor(l,u,p){this._stream=l,this._begin=u,this._end=p,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(l){if(!this._done){if(this._requests.length===0)this._queuedChunk=l;else{this._requests.shift().resolve({value:l,done:!1});for(const p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const u=this._queuedChunk;return this._queuedChunk=null,{value:u,done:!1}}if(this._done)return{value:void 0,done:!0};const l=new n.PromiseCapability;return this._requests.push(l),l.promise}cancel(l){this._done=!0;for(const u of this._requests)u.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(89);var n=t(1),r=t(182);function i(p,g,y){return{method:"GET",headers:p,signal:y.signal,mode:"cors",credentials:g?"include":"same-origin",redirect:"follow"}}function o(p){const g=new Headers;for(const y in p){const h=p[y];h!==void 0&&g.append(y,h)}return g}function a(p){return p instanceof Uint8Array?p.buffer:p instanceof ArrayBuffer?p:((0,n.warn)(`getArrayBuffer - unexpected data format: ${p}`),new Uint8Array(p).buffer)}class c{constructor(g){this.source=g,this.isHttp=/^https?:/i.test(g.url),this.httpHeaders=this.isHttp&&g.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var g;return((g=this._fullRequestReader)==null?void 0:g._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new l(this),this._fullRequestReader}getRangeReader(g,y){if(y<=this._progressiveDataLength)return null;const h=new u(this,g,y);return this._rangeRequestReaders.push(h),h}cancelAllRequests(g){var y;(y=this._fullRequestReader)==null||y.cancel(g);for(const h of this._rangeRequestReaders.slice(0))h.cancel(g)}}e.PDFFetchStream=c;class l{constructor(g){this._stream=g,this._reader=null,this._loaded=0,this._filename=null;const y=g.source;this._withCredentials=y.withCredentials||!1,this._contentLength=y.length,this._headersCapability=new n.PromiseCapability,this._disableRange=y.disableRange||!1,this._rangeChunkSize=y.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!y.disableStream,this._isRangeSupported=!y.disableRange,this._headers=o(this._stream.httpHeaders);const h=y.url;fetch(h,i(this._headers,this._withCredentials,this._abortController)).then(f=>{if(!(0,r.validateResponseStatus)(f.status))throw(0,r.createResponseStatusError)(f.status,h);this._reader=f.body.getReader(),this._headersCapability.resolve();const d=O=>f.headers.get(O),{allowRangeRequests:v,suggestedLength:E}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:d,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=v,this._contentLength=E||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(d),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var h;await this._headersCapability.promise;const{value:g,done:y}=await this._reader.read();return y?{value:g,done:y}:(this._loaded+=g.byteLength,(h=this.onProgress)==null||h.call(this,{loaded:this._loaded,total:this._contentLength}),{value:a(g),done:!1})}cancel(g){var y;(y=this._reader)==null||y.cancel(g),this._abortController.abort()}}class u{constructor(g,y,h){this._stream=g,this._reader=null,this._loaded=0;const f=g.source;this._withCredentials=f.withCredentials||!1,this._readCapability=new n.PromiseCapability,this._isStreamingSupported=!f.disableStream,this._abortController=new AbortController,this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${y}-${h-1}`);const d=f.url;fetch(d,i(this._headers,this._withCredentials,this._abortController)).then(v=>{if(!(0,r.validateResponseStatus)(v.status))throw(0,r.createResponseStatusError)(v.status,d);this._readCapability.resolve(),this._reader=v.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var h;await this._readCapability.promise;const{value:g,done:y}=await this._reader.read();return y?{value:g,done:y}:(this._loaded+=g.byteLength,(h=this.onProgress)==null||h.call(this,{loaded:this._loaded}),{value:a(g),done:!1})}cancel(g){var y;(y=this._reader)==null||y.cancel(g),this._abortController.abort()}}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=c,e.extractFilenameFromHeader=a,e.validateRangeRequestCapabilities=o,e.validateResponseStatus=l;var n=t(1),r=t(183),i=t(168);function o(u){let{getResponseHeader:p,isHttp:g,rangeChunkSize:y,disableRange:h}=u;const f={allowRangeRequests:!1,suggestedLength:void 0},d=parseInt(p("Content-Length"),10);return!Number.isInteger(d)||(f.suggestedLength=d,d<=2*y)||h||!g||p("Accept-Ranges")!=="bytes"||(p("Content-Encoding")||"identity")!=="identity"||(f.allowRangeRequests=!0),f}function a(u){const p=u("Content-Disposition");if(p){let g=(0,r.getFilenameFromContentDispositionHeader)(p);if(g.includes("%"))try{g=decodeURIComponent(g)}catch{}if((0,i.isPdfFile)(g))return g}return null}function c(u,p){return u===404||u===0&&p.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+p+'".'):new n.UnexpectedResponseException(`Unexpected server response (${u}) while retrieving PDF "${p}".`,u)}function l(u){return u===200||u===206}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=r,t(89),t(149);var n=t(1);function r(i){let o=!0,a=c("filename\\*","i").exec(i);if(a){a=a[1];let f=g(a);return f=unescape(f),f=y(f),f=h(f),u(f)}if(a=p(i),a){const f=h(a);return u(f)}if(a=c("filename","i").exec(i),a){a=a[1];let f=g(a);return f=h(f),u(f)}function c(f,d){return new RegExp("(?:^|;)\\s*"+f+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function l(f,d){if(f){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const v=new TextDecoder(f,{fatal:!0}),E=(0,n.stringToBytes)(d);d=v.decode(E),o=!1}catch{}}return d}function u(f){return o&&/[\x80-\xff]/.test(f)&&(f=l("utf-8",f),o&&(f=l("iso-8859-1",f))),f}function p(f){const d=[];let v;const E=c("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(v=E.exec(f))!==null;){let[,N,m,b]=v;if(N=parseInt(N,10),N in d){if(N===0)break;continue}d[N]=[m,b]}const O=[];for(let N=0;N<d.length&&N in d;++N){let[m,b]=d[N];b=g(b),m&&(b=unescape(b),N===0&&(b=y(b))),O.push(b)}return O.join("")}function g(f){if(f.startsWith('"')){const d=f.slice(1).split('\\"');for(let v=0;v<d.length;++v){const E=d[v].indexOf('"');E!==-1&&(d[v]=d[v].slice(0,E),d.length=v+1),d[v]=d[v].replaceAll(/\\(.)/g,"$1")}f=d.join('"')}return f}function y(f){const d=f.indexOf("'");if(d===-1)return f;const v=f.slice(0,d),O=f.slice(d+1).replace(/^[^']*'/,"");return l(v,O)}function h(f){return!f.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(f)?f:f.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,v,E,O){if(E==="q"||E==="Q")return O=O.replaceAll("_"," "),O=O.replaceAll(/=([0-9a-fA-F]{2})/g,function(N,m){return String.fromCharCode(parseInt(m,16))}),l(v,O);try{O=atob(O)}catch{}return l(v,O)})}return""}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0,t(89);var n=t(1),r=t(182);const i=200,o=206;function a(g){const y=g.response;return typeof y!="string"?y:(0,n.stringToBytes)(y).buffer}class c{constructor(y){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.url=y,this.isHttp=/^https?:/i.test(y),this.httpHeaders=this.isHttp&&h.httpHeaders||Object.create(null),this.withCredentials=h.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(y,h,f){const d={begin:y,end:h};for(const v in f)d[v]=f[v];return this.request(d)}requestFull(y){return this.request(y)}request(y){const h=new XMLHttpRequest,f=this.currXhrId++,d=this.pendingRequests[f]={xhr:h};h.open("GET",this.url),h.withCredentials=this.withCredentials;for(const v in this.httpHeaders){const E=this.httpHeaders[v];E!==void 0&&h.setRequestHeader(v,E)}return this.isHttp&&"begin"in y&&"end"in y?(h.setRequestHeader("Range",`bytes=${y.begin}-${y.end-1}`),d.expectedStatus=o):d.expectedStatus=i,h.responseType="arraybuffer",y.onError&&(h.onerror=function(v){y.onError(h.status)}),h.onreadystatechange=this.onStateChange.bind(this,f),h.onprogress=this.onProgress.bind(this,f),d.onHeadersReceived=y.onHeadersReceived,d.onDone=y.onDone,d.onError=y.onError,d.onProgress=y.onProgress,h.send(null),f}onProgress(y,h){var d;const f=this.pendingRequests[y];f&&((d=f.onProgress)==null||d.call(f,h))}onStateChange(y,h){var N,m,b;const f=this.pendingRequests[y];if(!f)return;const d=f.xhr;if(d.readyState>=2&&f.onHeadersReceived&&(f.onHeadersReceived(),delete f.onHeadersReceived),d.readyState!==4||!(y in this.pendingRequests))return;if(delete this.pendingRequests[y],d.status===0&&this.isHttp){(N=f.onError)==null||N.call(f,d.status);return}const v=d.status||i;if(!(v===i&&f.expectedStatus===o)&&v!==f.expectedStatus){(m=f.onError)==null||m.call(f,d.status);return}const O=a(d);if(v===o){const k=d.getResponseHeader("Content-Range"),T=/bytes (\d+)-(\d+)\/(\d+)/.exec(k);f.onDone({begin:parseInt(T[1],10),chunk:O})}else O?f.onDone({begin:0,chunk:O}):(b=f.onError)==null||b.call(f,d.status)}getRequestXhr(y){return this.pendingRequests[y].xhr}isPendingRequest(y){return y in this.pendingRequests}abortRequest(y){const h=this.pendingRequests[y].xhr;delete this.pendingRequests[y],h.abort()}}class l{constructor(y){this._source=y,this._manager=new c(y.url,{httpHeaders:y.httpHeaders,withCredentials:y.withCredentials}),this._rangeChunkSize=y.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(y){const h=this._rangeRequestReaders.indexOf(y);h>=0&&this._rangeRequestReaders.splice(h,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new u(this._manager,this._source),this._fullRequestReader}getRangeReader(y,h){const f=new p(this._manager,y,h);return f.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(f),f}cancelAllRequests(y){var h;(h=this._fullRequestReader)==null||h.cancel(y);for(const f of this._rangeRequestReaders.slice(0))f.cancel(y)}}e.PDFNetworkStream=l;class u{constructor(y,h){this._manager=y;const f={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=h.url,this._fullRequestId=y.requestFull(f),this._headersReceivedCapability=new n.PromiseCapability,this._disableRange=h.disableRange||!1,this._contentLength=h.length,this._rangeChunkSize=h.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const y=this._fullRequestId,h=this._manager.getRequestXhr(y),f=E=>h.getResponseHeader(E),{allowRangeRequests:d,suggestedLength:v}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:f,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});d&&(this._isRangeSupported=!0),this._contentLength=v||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(f),this._isRangeSupported&&this._manager.abortRequest(y),this._headersReceivedCapability.resolve()}_onDone(y){if(y&&(this._requests.length>0?this._requests.shift().resolve({value:y.chunk,done:!1}):this._cachedChunks.push(y.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(y){this._storedError=(0,r.createResponseStatusError)(y,this._url),this._headersReceivedCapability.reject(this._storedError);for(const h of this._requests)h.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(y){var h;(h=this.onProgress)==null||h.call(this,{loaded:y.loaded,total:y.lengthComputable?y.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const y=new n.PromiseCapability;return this._requests.push(y),y.promise}cancel(y){this._done=!0,this._headersReceivedCapability.reject(y);for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class p{constructor(y,h,f){this._manager=y;const d={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=y.url,this._requestId=y.requestRange(h,f,d),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var y;(y=this.onClosed)==null||y.call(this,this)}_onDone(y){const h=y.chunk;this._requests.length>0?this._requests.shift().resolve({value:h,done:!1}):this._queuedChunk=h,this._done=!0;for(const f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(y){this._storedError=(0,r.createResponseStatusError)(y,this._url);for(const h of this._requests)h.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(y){var h;this.isStreamingSupported||(h=this.onProgress)==null||h.call(this,{loaded:y.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const h=this._queuedChunk;return this._queuedChunk=null,{value:h,done:!1}}if(this._done)return{value:void 0,done:!0};const y=new n.PromiseCapability;return this._requests.push(y),y.promise}cancel(y){this._done=!0;for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0,t(89),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123);var n=t(1),r=t(182);const i=/^file:\/\/\/[a-zA-Z]:\//;function o(f){const d=require$$6,v=d.parse(f);return v.protocol==="file:"||v.host?v:/^[a-z]:[/\\]/i.test(f)?d.parse(`file:///${f}`):(v.host||(v.protocol="file:"),v)}class a{constructor(d){this.source=d,this.url=o(d.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&d.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var d;return((d=this._fullRequestReader)==null?void 0:d._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new y(this):new p(this),this._fullRequestReader}getRangeReader(d,v){if(v<=this._progressiveDataLength)return null;const E=this.isFsUrl?new h(this,d,v):new g(this,d,v);return this._rangeRequestReaders.push(E),E}cancelAllRequests(d){var v;(v=this._fullRequestReader)==null||v.cancel(d);for(const E of this._rangeRequestReaders.slice(0))E.cancel(d)}}e.PDFNodeStream=a;class c{constructor(d){this._url=d.url,this._done=!1,this._storedError=null,this.onProgress=null;const v=d.source;this._contentLength=v.length,this._loaded=0,this._filename=null,this._disableRange=v.disableRange||!1,this._rangeChunkSize=v.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!v.disableStream,this._isRangeSupported=!v.disableRange,this._readableStream=null,this._readCapability=new n.PromiseCapability,this._headersCapability=new n.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const d=this._readableStream.read();return d===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=d.length,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(d).buffer,done:!1})}cancel(d){if(!this._readableStream){this._error(d);return}this._readableStream.destroy(d)}_error(d){this._storedError=d,this._readCapability.resolve()}_setReadableStream(d){this._readableStream=d,d.on("readable",()=>{this._readCapability.resolve()}),d.on("end",()=>{d.destroy(),this._done=!0,this._readCapability.resolve()}),d.on("error",v=>{this._error(v)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class l{constructor(d){this._url=d.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new n.PromiseCapability;const v=d.source;this._isStreamingSupported=!v.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const d=this._readableStream.read();return d===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=d.length,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded}),{value:new Uint8Array(d).buffer,done:!1})}cancel(d){if(!this._readableStream){this._error(d);return}this._readableStream.destroy(d)}_error(d){this._storedError=d,this._readCapability.resolve()}_setReadableStream(d){this._readableStream=d,d.on("readable",()=>{this._readCapability.resolve()}),d.on("end",()=>{d.destroy(),this._done=!0,this._readCapability.resolve()}),d.on("error",v=>{this._error(v)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function u(f,d){return{protocol:f.protocol,auth:f.auth,host:f.hostname,port:f.port,path:f.path,method:"GET",headers:d}}class p extends c{constructor(d){super(d);const v=E=>{if(E.statusCode===404){const b=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=b,this._headersCapability.reject(b);return}this._headersCapability.resolve(),this._setReadableStream(E);const O=b=>this._readableStream.headers[b.toLowerCase()],{allowRangeRequests:N,suggestedLength:m}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:O,isHttp:d.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=N,this._contentLength=m||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(O)};if(this._request=null,this._url.protocol==="http:"){const E=require$$6;this._request=E.request(u(this._url,d.httpHeaders),v)}else{const E=require$$6;this._request=E.request(u(this._url,d.httpHeaders),v)}this._request.on("error",E=>{this._storedError=E,this._headersCapability.reject(E)}),this._request.end()}}class g extends l{constructor(d,v,E){super(d),this._httpHeaders={};for(const N in d.httpHeaders){const m=d.httpHeaders[N];m!==void 0&&(this._httpHeaders[N]=m)}this._httpHeaders.Range=`bytes=${v}-${E-1}`;const O=N=>{if(N.statusCode===404){const m=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=m;return}this._setReadableStream(N)};if(this._request=null,this._url.protocol==="http:"){const N=require$$6;this._request=N.request(u(this._url,this._httpHeaders),O)}else{const N=require$$6;this._request=N.request(u(this._url,this._httpHeaders),O)}this._request.on("error",N=>{this._storedError=N}),this._request.end()}}class y extends c{constructor(d){super(d);let v=decodeURIComponent(this._url.path);i.test(this._url.href)&&(v=v.replace(/^\//,""));const E=require$$6;E.lstat(v,(O,N)=>{if(O){O.code==="ENOENT"&&(O=new n.MissingPDFException(`Missing PDF "${v}".`)),this._storedError=O,this._headersCapability.reject(O);return}this._contentLength=N.size,this._setReadableStream(E.createReadStream(v)),this._headersCapability.resolve()})}}class h extends l{constructor(d,v,E){super(d);let O=decodeURIComponent(this._url.path);i.test(this._url.href)&&(O=O.replace(/^\//,""));const N=require$$6;this._setReadableStream(N.createReadStream(O,{start:v,end:E-1}))}}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0,t(84),t(86),t(87),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(2),t(89),t(187);var n=t(168),r=t(1);const i={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},o="http://www.w3.org/XML/1998/namespace",a="http://www.w3.org/1999/xlink",c=["butt","round","square"],l=["miter","round","bevel"],u=function(N){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(URL.createObjectURL&&typeof Blob<"u"&&!b)return URL.createObjectURL(new Blob([N],{type:m}));const k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let T=`data:${m};base64,`;for(let S=0,F=N.length;S<F;S+=3){const P=N[S]&255,G=N[S+1]&255,j=N[S+2]&255,L=P>>2,K=(P&3)<<4|G>>4,Q=S+1<F?(G&15)<<2|j>>6:64,ne=S+2<F?j&63:64;T+=k[L]+k[K]+k[Q]+k[ne]}return T},p=function(){const N=new Uint8Array([137,80,78,71,13,10,26,10]),m=12,b=new Int32Array(256);for(let j=0;j<256;j++){let L=j;for(let K=0;K<8;K++)L=L&1?3988292384^L>>1&2147483647:L>>1&2147483647;b[j]=L}function k(j,L,K){let Q=-1;for(let ne=L;ne<K;ne++){const D=(Q^j[ne])&255,$=b[D];Q=Q>>>8^$}return Q^-1}function T(j,L,K,Q){let ne=Q;const D=L.length;K[ne]=D>>24&255,K[ne+1]=D>>16&255,K[ne+2]=D>>8&255,K[ne+3]=D&255,ne+=4,K[ne]=j.charCodeAt(0)&255,K[ne+1]=j.charCodeAt(1)&255,K[ne+2]=j.charCodeAt(2)&255,K[ne+3]=j.charCodeAt(3)&255,ne+=4,K.set(L,ne),ne+=L.length;const $=k(K,Q+4,ne);K[ne]=$>>24&255,K[ne+1]=$>>16&255,K[ne+2]=$>>8&255,K[ne+3]=$&255}function S(j,L,K){let Q=1,ne=0;for(let D=L;D<K;++D)Q=(Q+(j[D]&255))%65521,ne=(ne+Q)%65521;return ne<<16|Q}function F(j){if(!r.isNodeJS)return P(j);try{const L=parseInt(process.versions.node)>=8?j:Buffer.from(j),K=require$$6.deflateSync(L,{level:9});return K instanceof Uint8Array?K:new Uint8Array(K)}catch(L){(0,r.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+L)}return P(j)}function P(j){let L=j.length;const K=65535,Q=Math.ceil(L/K),ne=new Uint8Array(2+L+Q*5+4);let D=0;ne[D++]=120,ne[D++]=156;let $=0;for(;L>K;)ne[D++]=0,ne[D++]=255,ne[D++]=255,ne[D++]=0,ne[D++]=0,ne.set(j.subarray($,$+K),D),D+=K,$+=K,L-=K;ne[D++]=1,ne[D++]=L&255,ne[D++]=L>>8&255,ne[D++]=~L&65535&255,ne[D++]=(~L&65535)>>8&255,ne.set(j.subarray($),D),D+=j.length-$;const J=S(j,0,j.length);return ne[D++]=J>>24&255,ne[D++]=J>>16&255,ne[D++]=J>>8&255,ne[D++]=J&255,ne}function G(j,L,K,Q){const ne=j.width,D=j.height;let $,J,re;const pe=j.data;switch(L){case r.ImageKind.GRAYSCALE_1BPP:J=0,$=1,re=ne+7>>3;break;case r.ImageKind.RGB_24BPP:J=2,$=8,re=ne*3;break;case r.ImageKind.RGBA_32BPP:J=6,$=8,re=ne*4;break;default:throw new Error("invalid format")}const U=new Uint8Array((1+re)*D);let w=0,_=0;for(let ee=0;ee<D;++ee)U[w++]=0,U.set(pe.subarray(_,_+re),w),_+=re,w+=re;if(L===r.ImageKind.GRAYSCALE_1BPP&&Q){w=0;for(let ee=0;ee<D;ee++){w++;for(let me=0;me<re;me++)U[w++]^=255}}const R=new Uint8Array([ne>>24&255,ne>>16&255,ne>>8&255,ne&255,D>>24&255,D>>16&255,D>>8&255,D&255,$,J,0,0,0]),V=F(U),M=N.length+m*3+R.length+V.length,Y=new Uint8Array(M);let W=0;return Y.set(N,W),W+=N.length,T("IHDR",R,Y,W),W+=m+R.length,T("IDATA",V,Y,W),W+=m+V.length,T("IEND",new Uint8Array(0),Y,W),u(Y,"image/png",K)}return function(L,K,Q){const ne=L.kind===void 0?r.ImageKind.GRAYSCALE_1BPP:L.kind;return G(L,ne,K,Q)}}();class g{constructor(){this.fontSizeScale=1,this.fontWeight=i.fontWeight,this.fontSize=0,this.textMatrix=r.IDENTITY_MATRIX,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=r.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=i.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(m,b){this.x=m,this.y=b}}function y(N){let m=[];const b=[];for(const k of N){if(k.fn==="save"){m.push({fnId:92,fn:"group",items:[]}),b.push(m),m=m.at(-1).items;continue}k.fn==="restore"?m=b.pop():m.push(k)}return m}function h(N){if(Number.isInteger(N))return N.toString();const m=N.toFixed(10);let b=m.length-1;if(m[b]!=="0")return m;do b--;while(m[b]==="0");return m.substring(0,m[b]==="."?b:b+1)}function f(N){if(N[4]===0&&N[5]===0){if(N[1]===0&&N[2]===0)return N[0]===1&&N[3]===1?"":`scale(${h(N[0])} ${h(N[3])})`;if(N[0]===N[3]&&N[1]===-N[2]){const m=Math.acos(N[0])*180/Math.PI;return`rotate(${h(m)})`}}else if(N[0]===1&&N[1]===0&&N[2]===0&&N[3]===1)return`translate(${h(N[4])} ${h(N[5])})`;return`matrix(${h(N[0])} ${h(N[1])} ${h(N[2])} ${h(N[3])} ${h(N[4])} ${h(N[5])})`}let d=0,v=0,E=0;class O{constructor(m,b){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new g,this.transformMatrix=r.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=m,this.objs=b,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!k,this._operatorIdMapping=[];for(const T in r.OPS)this._operatorIdMapping[r.OPS[T]]=T}getObject(m){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof m=="string"?m.startsWith("g_")?this.commonObjs.get(m):this.objs.get(m):b}save(){this.transformStack.push(this.transformMatrix);const m=this.current;this.extraStack.push(m),this.current=m.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(m){this.save(),this.executeOpTree(m),this.restore()}loadDependencies(m){const b=m.fnArray,k=m.argsArray;for(let T=0,S=b.length;T<S;T++)if(b[T]===r.OPS.dependency)for(const F of k[T]){const P=F.startsWith("g_")?this.commonObjs:this.objs,G=new Promise(j=>{P.get(F,j)});this.current.dependencies.push(G)}return Promise.all(this.current.dependencies)}transform(m,b,k,T,S,F){const P=[m,b,k,T,S,F];this.transformMatrix=r.Util.transform(this.transformMatrix,P),this.tgrp=null}getSVG(m,b){this.viewport=b;const k=this._initialize(b);return this.loadDependencies(m).then(()=>(this.transformMatrix=r.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(m)),k))}convertOpList(m){const b=this._operatorIdMapping,k=m.argsArray,T=m.fnArray,S=[];for(let F=0,P=T.length;F<P;F++){const G=T[F];S.push({fnId:G,fn:b[G],args:k[F]})}return y(S)}executeOpTree(m){for(const b of m){const k=b.fn,T=b.fnId,S=b.args;switch(T|0){case r.OPS.beginText:this.beginText();break;case r.OPS.dependency:break;case r.OPS.setLeading:this.setLeading(S);break;case r.OPS.setLeadingMoveText:this.setLeadingMoveText(S[0],S[1]);break;case r.OPS.setFont:this.setFont(S);break;case r.OPS.showText:this.showText(S[0]);break;case r.OPS.showSpacedText:this.showText(S[0]);break;case r.OPS.endText:this.endText();break;case r.OPS.moveText:this.moveText(S[0],S[1]);break;case r.OPS.setCharSpacing:this.setCharSpacing(S[0]);break;case r.OPS.setWordSpacing:this.setWordSpacing(S[0]);break;case r.OPS.setHScale:this.setHScale(S[0]);break;case r.OPS.setTextMatrix:this.setTextMatrix(S[0],S[1],S[2],S[3],S[4],S[5]);break;case r.OPS.setTextRise:this.setTextRise(S[0]);break;case r.OPS.setTextRenderingMode:this.setTextRenderingMode(S[0]);break;case r.OPS.setLineWidth:this.setLineWidth(S[0]);break;case r.OPS.setLineJoin:this.setLineJoin(S[0]);break;case r.OPS.setLineCap:this.setLineCap(S[0]);break;case r.OPS.setMiterLimit:this.setMiterLimit(S[0]);break;case r.OPS.setFillRGBColor:this.setFillRGBColor(S[0],S[1],S[2]);break;case r.OPS.setStrokeRGBColor:this.setStrokeRGBColor(S[0],S[1],S[2]);break;case r.OPS.setStrokeColorN:this.setStrokeColorN(S);break;case r.OPS.setFillColorN:this.setFillColorN(S);break;case r.OPS.shadingFill:this.shadingFill(S[0]);break;case r.OPS.setDash:this.setDash(S[0],S[1]);break;case r.OPS.setRenderingIntent:this.setRenderingIntent(S[0]);break;case r.OPS.setFlatness:this.setFlatness(S[0]);break;case r.OPS.setGState:this.setGState(S[0]);break;case r.OPS.fill:this.fill();break;case r.OPS.eoFill:this.eoFill();break;case r.OPS.stroke:this.stroke();break;case r.OPS.fillStroke:this.fillStroke();break;case r.OPS.eoFillStroke:this.eoFillStroke();break;case r.OPS.clip:this.clip("nonzero");break;case r.OPS.eoClip:this.clip("evenodd");break;case r.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case r.OPS.paintImageXObject:this.paintImageXObject(S[0]);break;case r.OPS.paintInlineImageXObject:this.paintInlineImageXObject(S[0]);break;case r.OPS.paintImageMaskXObject:this.paintImageMaskXObject(S[0]);break;case r.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(S[0],S[1]);break;case r.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case r.OPS.closePath:this.closePath();break;case r.OPS.closeStroke:this.closeStroke();break;case r.OPS.closeFillStroke:this.closeFillStroke();break;case r.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case r.OPS.nextLine:this.nextLine();break;case r.OPS.transform:this.transform(S[0],S[1],S[2],S[3],S[4],S[5]);break;case r.OPS.constructPath:this.constructPath(S[0],S[1]);break;case r.OPS.endPath:this.endPath();break;case 92:this.group(b.items);break;default:(0,r.warn)(`Unimplemented operator ${k}`);break}}}setWordSpacing(m){this.current.wordSpacing=m}setCharSpacing(m){this.current.charSpacing=m}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(m,b,k,T,S,F){const P=this.current;P.textMatrix=P.lineMatrix=[m,b,k,T,S,F],P.textMatrixScale=Math.hypot(m,b),P.x=P.lineX=0,P.y=P.lineY=0,P.xcoords=[],P.ycoords=[],P.tspan=this.svgFactory.createElement("svg:tspan"),P.tspan.setAttributeNS(null,"font-family",P.fontFamily),P.tspan.setAttributeNS(null,"font-size",`${h(P.fontSize)}px`),P.tspan.setAttributeNS(null,"y",h(-P.y)),P.txtElement=this.svgFactory.createElement("svg:text"),P.txtElement.append(P.tspan)}beginText(){const m=this.current;m.x=m.lineX=0,m.y=m.lineY=0,m.textMatrix=r.IDENTITY_MATRIX,m.lineMatrix=r.IDENTITY_MATRIX,m.textMatrixScale=1,m.tspan=this.svgFactory.createElement("svg:tspan"),m.txtElement=this.svgFactory.createElement("svg:text"),m.txtgrp=this.svgFactory.createElement("svg:g"),m.xcoords=[],m.ycoords=[]}moveText(m,b){const k=this.current;k.x=k.lineX+=m,k.y=k.lineY+=b,k.xcoords=[],k.ycoords=[],k.tspan=this.svgFactory.createElement("svg:tspan"),k.tspan.setAttributeNS(null,"font-family",k.fontFamily),k.tspan.setAttributeNS(null,"font-size",`${h(k.fontSize)}px`),k.tspan.setAttributeNS(null,"y",h(-k.y))}showText(m){const b=this.current,k=b.font,T=b.fontSize;if(T===0)return;const S=b.fontSizeScale,F=b.charSpacing,P=b.wordSpacing,G=b.fontDirection,j=b.textHScale*G,L=k.vertical,K=L?1:-1,Q=k.defaultVMetrics,ne=T*b.fontMatrix[0];let D=0;for(const re of m){if(re===null){D+=G*P;continue}else if(typeof re=="number"){D+=K*re*T/1e3;continue}const pe=(re.isSpace?P:0)+F,U=re.fontChar;let w,_,R=re.width;if(L){let M;const Y=re.vmetric||Q;M=re.vmetric?Y[1]:R*.5,M=-M*ne;const W=Y[2]*ne;R=Y?-Y[0]:R,w=M/S,_=(D+W)/S}else w=D/S,_=0;(re.isInFont||k.missingFile)&&(b.xcoords.push(b.x+w),L&&b.ycoords.push(-b.y+_),b.tspan.textContent+=U);const V=L?R*ne-pe*G:R*ne+pe*G;D+=V}b.tspan.setAttributeNS(null,"x",b.xcoords.map(h).join(" ")),L?b.tspan.setAttributeNS(null,"y",b.ycoords.map(h).join(" ")):b.tspan.setAttributeNS(null,"y",h(-b.y)),L?b.y-=D:b.x+=D*j,b.tspan.setAttributeNS(null,"font-family",b.fontFamily),b.tspan.setAttributeNS(null,"font-size",`${h(b.fontSize)}px`),b.fontStyle!==i.fontStyle&&b.tspan.setAttributeNS(null,"font-style",b.fontStyle),b.fontWeight!==i.fontWeight&&b.tspan.setAttributeNS(null,"font-weight",b.fontWeight);const $=b.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;if($===r.TextRenderingMode.FILL||$===r.TextRenderingMode.FILL_STROKE?(b.fillColor!==i.fillColor&&b.tspan.setAttributeNS(null,"fill",b.fillColor),b.fillAlpha<1&&b.tspan.setAttributeNS(null,"fill-opacity",b.fillAlpha)):b.textRenderingMode===r.TextRenderingMode.ADD_TO_PATH?b.tspan.setAttributeNS(null,"fill","transparent"):b.tspan.setAttributeNS(null,"fill","none"),$===r.TextRenderingMode.STROKE||$===r.TextRenderingMode.FILL_STROKE){const re=1/(b.textMatrixScale||1);this._setStrokeAttributes(b.tspan,re)}let J=b.textMatrix;b.textRise!==0&&(J=J.slice(),J[5]+=b.textRise),b.txtElement.setAttributeNS(null,"transform",`${f(J)} scale(${h(j)}, -1)`),b.txtElement.setAttributeNS(o,"xml:space","preserve"),b.txtElement.append(b.tspan),b.txtgrp.append(b.txtElement),this._ensureTransformGroup().append(b.txtElement)}setLeadingMoveText(m,b){this.setLeading(-b),this.moveText(m,b)}addFontStyle(m){if(!m.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const b=u(m.data,m.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${m.loadedName}"; src: url(${b}); }
`}setFont(m){const b=this.current,k=this.commonObjs.get(m[0]);let T=m[1];b.font=k,this.embedFonts&&!k.missingFile&&!this.embeddedFonts[k.loadedName]&&(this.addFontStyle(k),this.embeddedFonts[k.loadedName]=k),b.fontMatrix=k.fontMatrix||r.FONT_IDENTITY_MATRIX;let S="normal";k.black?S="900":k.bold&&(S="bold");const F=k.italic?"italic":"normal";T<0?(T=-T,b.fontDirection=-1):b.fontDirection=1,b.fontSize=T,b.fontFamily=k.loadedName,b.fontWeight=S,b.fontStyle=F,b.tspan=this.svgFactory.createElement("svg:tspan"),b.tspan.setAttributeNS(null,"y",h(-b.y)),b.xcoords=[],b.ycoords=[]}endText(){var b;const m=this.current;m.textRenderingMode&r.TextRenderingMode.ADD_TO_PATH_FLAG&&((b=m.txtElement)!=null&&b.hasChildNodes())&&(m.element=m.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(m){m>0&&(this.current.lineWidth=m)}setLineCap(m){this.current.lineCap=c[m]}setLineJoin(m){this.current.lineJoin=l[m]}setMiterLimit(m){this.current.miterLimit=m}setStrokeAlpha(m){this.current.strokeAlpha=m}setStrokeRGBColor(m,b,k){this.current.strokeColor=r.Util.makeHexColor(m,b,k)}setFillAlpha(m){this.current.fillAlpha=m}setFillRGBColor(m,b,k){this.current.fillColor=r.Util.makeHexColor(m,b,k),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(m){this.current.strokeColor=this._makeColorN_Pattern(m)}setFillColorN(m){this.current.fillColor=this._makeColorN_Pattern(m)}shadingFill(m){const{width:b,height:k}=this.viewport,T=r.Util.inverseTransform(this.transformMatrix),[S,F,P,G]=r.Util.getAxialAlignedBoundingBox([0,0,b,k],T),j=this.svgFactory.createElement("svg:rect");j.setAttributeNS(null,"x",S),j.setAttributeNS(null,"y",F),j.setAttributeNS(null,"width",P-S),j.setAttributeNS(null,"height",G-F),j.setAttributeNS(null,"fill",this._makeShadingPattern(m)),this.current.fillAlpha<1&&j.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(j)}_makeColorN_Pattern(m){return m[0]==="TilingPattern"?this._makeTilingPattern(m):this._makeShadingPattern(m)}_makeTilingPattern(m){const b=m[1],k=m[2],T=m[3]||r.IDENTITY_MATRIX,[S,F,P,G]=m[4],j=m[5],L=m[6],K=m[7],Q=`shading${E++}`,[ne,D,$,J]=r.Util.normalizeRect([...r.Util.applyTransform([S,F],T),...r.Util.applyTransform([P,G],T)]),[re,pe]=r.Util.singularValueDecompose2dScale(T),U=j*re,w=L*pe,_=this.svgFactory.createElement("svg:pattern");_.setAttributeNS(null,"id",Q),_.setAttributeNS(null,"patternUnits","userSpaceOnUse"),_.setAttributeNS(null,"width",U),_.setAttributeNS(null,"height",w),_.setAttributeNS(null,"x",`${ne}`),_.setAttributeNS(null,"y",`${D}`);const R=this.svg,V=this.transformMatrix,M=this.current.fillColor,Y=this.current.strokeColor,W=this.svgFactory.create($-ne,J-D);if(this.svg=W,this.transformMatrix=T,K===2){const ee=r.Util.makeHexColor(...b);this.current.fillColor=ee,this.current.strokeColor=ee}return this.executeOpTree(this.convertOpList(k)),this.svg=R,this.transformMatrix=V,this.current.fillColor=M,this.current.strokeColor=Y,_.append(W.childNodes[0]),this.defs.append(_),`url(#${Q})`}_makeShadingPattern(m){switch(typeof m=="string"&&(m=this.objs.get(m)),m[0]){case"RadialAxial":const b=`shading${E++}`,k=m[3];let T;switch(m[1]){case"axial":const S=m[4],F=m[5];T=this.svgFactory.createElement("svg:linearGradient"),T.setAttributeNS(null,"id",b),T.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),T.setAttributeNS(null,"x1",S[0]),T.setAttributeNS(null,"y1",S[1]),T.setAttributeNS(null,"x2",F[0]),T.setAttributeNS(null,"y2",F[1]);break;case"radial":const P=m[4],G=m[5],j=m[6],L=m[7];T=this.svgFactory.createElement("svg:radialGradient"),T.setAttributeNS(null,"id",b),T.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),T.setAttributeNS(null,"cx",G[0]),T.setAttributeNS(null,"cy",G[1]),T.setAttributeNS(null,"r",L),T.setAttributeNS(null,"fx",P[0]),T.setAttributeNS(null,"fy",P[1]),T.setAttributeNS(null,"fr",j);break;default:throw new Error(`Unknown RadialAxial type: ${m[1]}`)}for(const S of k){const F=this.svgFactory.createElement("svg:stop");F.setAttributeNS(null,"offset",S[0]),F.setAttributeNS(null,"stop-color",S[1]),T.append(F)}return this.defs.append(T),`url(#${b})`;case"Mesh":return(0,r.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${m[0]}`)}}setDash(m,b){this.current.dashArray=m,this.current.dashPhase=b}constructPath(m,b){const k=this.current;let T=k.x,S=k.y,F=[],P=0;for(const G of m)switch(G|0){case r.OPS.rectangle:T=b[P++],S=b[P++];const j=b[P++],L=b[P++],K=T+j,Q=S+L;F.push("M",h(T),h(S),"L",h(K),h(S),"L",h(K),h(Q),"L",h(T),h(Q),"Z");break;case r.OPS.moveTo:T=b[P++],S=b[P++],F.push("M",h(T),h(S));break;case r.OPS.lineTo:T=b[P++],S=b[P++],F.push("L",h(T),h(S));break;case r.OPS.curveTo:T=b[P+4],S=b[P+5],F.push("C",h(b[P]),h(b[P+1]),h(b[P+2]),h(b[P+3]),h(T),h(S)),P+=6;break;case r.OPS.curveTo2:F.push("C",h(T),h(S),h(b[P]),h(b[P+1]),h(b[P+2]),h(b[P+3])),T=b[P+2],S=b[P+3],P+=4;break;case r.OPS.curveTo3:T=b[P+2],S=b[P+3],F.push("C",h(b[P]),h(b[P+1]),h(T),h(S),h(T),h(S)),P+=4;break;case r.OPS.closePath:F.push("Z");break}F=F.join(" "),k.path&&m.length>0&&m[0]!==r.OPS.rectangle&&m[0]!==r.OPS.moveTo?F=k.path.getAttributeNS(null,"d")+F:(k.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(k.path)),k.path.setAttributeNS(null,"d",F),k.path.setAttributeNS(null,"fill","none"),k.element=k.path,k.setCurrentPoint(T,S)}endPath(){const m=this.current;if(m.path=null,!this.pendingClip)return;if(!m.element){this.pendingClip=null;return}const b=`clippath${d++}`,k=this.svgFactory.createElement("svg:clipPath");k.setAttributeNS(null,"id",b),k.setAttributeNS(null,"transform",f(this.transformMatrix));const T=m.element.cloneNode(!0);if(this.pendingClip==="evenodd"?T.setAttributeNS(null,"clip-rule","evenodd"):T.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,k.append(T),this.defs.append(k),m.activeClipUrl){m.clipGroup=null;for(const S of this.extraStack)S.clipGroup=null;k.setAttributeNS(null,"clip-path",m.activeClipUrl)}m.activeClipUrl=`url(#${b})`,this.tgrp=null}clip(m){this.pendingClip=m}closePath(){const m=this.current;if(m.path){const b=`${m.path.getAttributeNS(null,"d")}Z`;m.path.setAttributeNS(null,"d",b)}}setLeading(m){this.current.leading=-m}setTextRise(m){this.current.textRise=m}setTextRenderingMode(m){this.current.textRenderingMode=m}setHScale(m){this.current.textHScale=m/100}setRenderingIntent(m){}setFlatness(m){}setGState(m){for(const[b,k]of m)switch(b){case"LW":this.setLineWidth(k);break;case"LC":this.setLineCap(k);break;case"LJ":this.setLineJoin(k);break;case"ML":this.setMiterLimit(k);break;case"D":this.setDash(k[0],k[1]);break;case"RI":this.setRenderingIntent(k);break;case"FL":this.setFlatness(k);break;case"Font":this.setFont(k);break;case"CA":this.setStrokeAlpha(k);break;case"ca":this.setFillAlpha(k);break;default:(0,r.warn)(`Unimplemented graphic state operator ${b}`);break}}fill(){const m=this.current;m.element&&(m.element.setAttributeNS(null,"fill",m.fillColor),m.element.setAttributeNS(null,"fill-opacity",m.fillAlpha),this.endPath())}stroke(){const m=this.current;m.element&&(this._setStrokeAttributes(m.element),m.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(m){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const k=this.current;let T=k.dashArray;b!==1&&T.length>0&&(T=T.map(function(S){return b*S})),m.setAttributeNS(null,"stroke",k.strokeColor),m.setAttributeNS(null,"stroke-opacity",k.strokeAlpha),m.setAttributeNS(null,"stroke-miterlimit",h(k.miterLimit)),m.setAttributeNS(null,"stroke-linecap",k.lineCap),m.setAttributeNS(null,"stroke-linejoin",k.lineJoin),m.setAttributeNS(null,"stroke-width",h(b*k.lineWidth)+"px"),m.setAttributeNS(null,"stroke-dasharray",T.map(h).join(" ")),m.setAttributeNS(null,"stroke-dashoffset",h(b*k.dashPhase)+"px")}eoFill(){var m;(m=this.current.element)==null||m.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var m;(m=this.current.element)==null||m.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const m=this.svgFactory.createElement("svg:rect");m.setAttributeNS(null,"x","0"),m.setAttributeNS(null,"y","0"),m.setAttributeNS(null,"width","1px"),m.setAttributeNS(null,"height","1px"),m.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(m)}paintImageXObject(m){const b=this.getObject(m);if(!b){(0,r.warn)(`Dependent image with object ID ${m} is not ready yet`);return}this.paintInlineImageXObject(b)}paintInlineImageXObject(m,b){const k=m.width,T=m.height,S=p(m,this.forceDataSchema,!!b),F=this.svgFactory.createElement("svg:rect");F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y","0"),F.setAttributeNS(null,"width",h(k)),F.setAttributeNS(null,"height",h(T)),this.current.element=F,this.clip("nonzero");const P=this.svgFactory.createElement("svg:image");P.setAttributeNS(a,"xlink:href",S),P.setAttributeNS(null,"x","0"),P.setAttributeNS(null,"y",h(-T)),P.setAttributeNS(null,"width",h(k)+"px"),P.setAttributeNS(null,"height",h(T)+"px"),P.setAttributeNS(null,"transform",`scale(${h(1/k)} ${h(-1/T)})`),b?b.append(P):this._ensureTransformGroup().append(P)}paintImageMaskXObject(m){const b=this.getObject(m.data,m);if(b.bitmap){(0,r.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const k=this.current,T=b.width,S=b.height,F=k.fillColor;k.maskId=`mask${v++}`;const P=this.svgFactory.createElement("svg:mask");P.setAttributeNS(null,"id",k.maskId);const G=this.svgFactory.createElement("svg:rect");G.setAttributeNS(null,"x","0"),G.setAttributeNS(null,"y","0"),G.setAttributeNS(null,"width",h(T)),G.setAttributeNS(null,"height",h(S)),G.setAttributeNS(null,"fill",F),G.setAttributeNS(null,"mask",`url(#${k.maskId})`),this.defs.append(P),this._ensureTransformGroup().append(G),this.paintInlineImageXObject(b,P)}paintFormXObjectBegin(m,b){if(Array.isArray(m)&&m.length===6&&this.transform(m[0],m[1],m[2],m[3],m[4],m[5]),b){const k=b[2]-b[0],T=b[3]-b[1],S=this.svgFactory.createElement("svg:rect");S.setAttributeNS(null,"x",b[0]),S.setAttributeNS(null,"y",b[1]),S.setAttributeNS(null,"width",h(k)),S.setAttributeNS(null,"height",h(T)),this.current.element=S,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(m){const b=this.svgFactory.create(m.width,m.height),k=this.svgFactory.createElement("svg:defs");b.append(k),this.defs=k;const T=this.svgFactory.createElement("svg:g");return T.setAttributeNS(null,"transform",f(m.transform)),b.append(T),this.svg=T,b}_ensureClipGroup(){if(!this.current.clipGroup){const m=this.svgFactory.createElement("svg:g");m.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(m),this.current.clipGroup=m}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",f(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}e.SVGGraphics=O},(s,e,t)=>{var n=t(3),r=t(188),i=t(193);n({target:"Array",proto:!0},{group:function(a){var c=arguments.length>1?arguments[1]:void 0;return r(this,a,c)}}),i("group")},(s,e,t)=>{var n=t(99),r=t(14),i=t(13),o=t(40),a=t(18),c=t(64),l=t(189),u=t(108),p=Array,g=r([].push);s.exports=function(y,h,f,d){for(var v=o(y),E=i(v),O=n(h,f),N=l(null),m=c(E),b=0,k,T,S;m>b;b++)S=E[b],T=a(O(S,b,v)),T in N?g(N[T],S):N[T]=[S];if(d&&(k=d(v),k!==p))for(T in N)N[T]=u(k,N[T]);return N}},(s,e,t)=>{var n=t(47),r=t(190),i=t(66),o=t(55),a=t(192),c=t(43),l=t(54),u=">",p="<",g="prototype",y="script",h=l("IE_PROTO"),f=function(){},d=function(m){return p+y+u+m+p+"/"+y+u},v=function(m){m.write(d("")),m.close();var b=m.parentWindow.Object;return m=null,b},E=function(){var m=c("iframe"),b="java"+y+":",k;return m.style.display="none",a.appendChild(m),m.src=String(b),k=m.contentWindow.document,k.open(),k.write(d("document.F=Object")),k.close(),k.F},O,N=function(){try{O=new ActiveXObject("htmlfile")}catch{}N=typeof document<"u"?document.domain&&O?v(O):E():v(O);for(var m=i.length;m--;)delete N[g][i[m]];return N()};o[h]=!0,s.exports=Object.create||function(b,k){var T;return b!==null?(f[g]=n(b),T=new f,f[g]=null,T[h]=b):T=N(),k===void 0?T:r.f(T,k)}},(s,e,t)=>{var n=t(6),r=t(46),i=t(45),o=t(47),a=t(12),c=t(191);e.f=n&&!r?Object.defineProperties:function(u,p){o(u);for(var g=a(p),y=c(p),h=y.length,f=0,d;h>f;)i.f(u,d=y[f++],g[d]);return u}},(s,e,t)=>{var n=t(59),r=t(66);s.exports=Object.keys||function(o){return n(o,r)}},(s,e,t)=>{var n=t(24);s.exports=n("document","documentElement")},(s,e,t)=>{var n=t(34),r=t(189),i=t(45).f,o=n("unscopables"),a=Array.prototype;a[o]===void 0&&i(a,o,{configurable:!0,value:r(null)}),s.exports=function(c){a[o][c]=!0}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0,t(89);class n{static textContent(i){const o=[],a={items:o,styles:Object.create(null)};function c(l){var g;if(!l)return;let u=null;const p=l.name;if(p==="#text")u=l.value;else if(n.shouldBuildText(p))(g=l==null?void 0:l.attributes)!=null&&g.textContent?u=l.attributes.textContent:l.value&&(u=l.value);else return;if(u!==null&&o.push({str:u}),!!l.children)for(const y of l.children)c(y)}return c(i),a}static shouldBuildText(i){return!(i==="textarea"||i==="input"||i==="option"||i==="select")}}e.XfaText=n},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=f,e.updateTextLayer=d,t(89),t(2);var n=t(1),r=t(168);const i=1e5,o=30,a=.8,c=new Map;function l(v,E){let O;if(E&&n.FeatureTest.isOffscreenCanvasSupported)O=new OffscreenCanvas(v,v).getContext("2d",{alpha:!1});else{const N=document.createElement("canvas");N.width=N.height=v,O=N.getContext("2d",{alpha:!1})}return O}function u(v,E){const O=c.get(v);if(O)return O;const N=l(o,E);N.font=`${o}px ${v}`;const m=N.measureText("");let b=m.fontBoundingBoxAscent,k=Math.abs(m.fontBoundingBoxDescent);if(b){const S=b/(b+k);return c.set(v,S),N.canvas.width=N.canvas.height=0,S}N.strokeStyle="red",N.clearRect(0,0,o,o),N.strokeText("g",0,0);let T=N.getImageData(0,0,o,o).data;k=0;for(let S=T.length-1-3;S>=0;S-=4)if(T[S]>0){k=Math.ceil(S/4/o);break}N.clearRect(0,0,o,o),N.strokeText("A",0,o),T=N.getImageData(0,0,o,o).data,b=0;for(let S=0,F=T.length;S<F;S+=4)if(T[S]>0){b=o-Math.floor(S/4/o);break}if(N.canvas.width=N.canvas.height=0,b){const S=b/(b+k);return c.set(v,S),S}return c.set(v,a),a}function p(v,E,O){const N=document.createElement("span"),m={angle:0,canvasWidth:0,hasText:E.str!=="",hasEOL:E.hasEOL,fontSize:0};v._textDivs.push(N);const b=n.Util.transform(v._transform,E.transform);let k=Math.atan2(b[1],b[0]);const T=O[E.fontName];T.vertical&&(k+=Math.PI/2);const S=Math.hypot(b[2],b[3]),F=S*u(T.fontFamily,v._isOffscreenCanvasSupported);let P,G;k===0?(P=b[4],G=b[5]-F):(P=b[4]+F*Math.sin(k),G=b[5]-F*Math.cos(k));const j="calc(var(--scale-factor)*",L=N.style;v._container===v._rootContainer?(L.left=`${(100*P/v._pageWidth).toFixed(2)}%`,L.top=`${(100*G/v._pageHeight).toFixed(2)}%`):(L.left=`${j}${P.toFixed(2)}px)`,L.top=`${j}${G.toFixed(2)}px)`),L.fontSize=`${j}${S.toFixed(2)}px)`,L.fontFamily=T.fontFamily,m.fontSize=S,N.setAttribute("role","presentation"),N.textContent=E.str,N.dir=E.dir,v._fontInspectorEnabled&&(N.dataset.fontName=E.fontName),k!==0&&(m.angle=k*(180/Math.PI));let K=!1;if(E.str.length>1)K=!0;else if(E.str!==" "&&E.transform[0]!==E.transform[3]){const Q=Math.abs(E.transform[0]),ne=Math.abs(E.transform[3]);Q!==ne&&Math.max(Q,ne)/Math.min(Q,ne)>1.5&&(K=!0)}K&&(m.canvasWidth=T.vertical?E.height:E.width),v._textDivProperties.set(N,m),v._isReadableStream&&v._layoutText(N)}function g(v){const{div:E,scale:O,properties:N,ctx:m,prevFontSize:b,prevFontFamily:k}=v,{style:T}=E;let S="";if(N.canvasWidth!==0&&N.hasText){const{fontFamily:F}=T,{canvasWidth:P,fontSize:G}=N;(b!==G||k!==F)&&(m.font=`${G*O}px ${F}`,v.prevFontSize=G,v.prevFontFamily=F);const{width:j}=m.measureText(E.textContent);j>0&&(S=`scaleX(${P*O/j})`)}N.angle!==0&&(S=`rotate(${N.angle}deg) ${S}`),S.length>0&&(T.transform=S)}function y(v){if(v._canceled)return;const E=v._textDivs,O=v._capability;if(E.length>i){O.resolve();return}if(!v._isReadableStream)for(const m of E)v._layoutText(m);O.resolve()}class h{constructor(E){var L;let{textContentSource:O,container:N,viewport:m,textDivs:b,textDivProperties:k,textContentItemsStr:T,isOffscreenCanvasSupported:S}=E;this._textContentSource=O,this._isReadableStream=O instanceof ReadableStream,this._container=this._rootContainer=N,this._textDivs=b||[],this._textContentItemsStr=T||[],this._isOffscreenCanvasSupported=S,this._fontInspectorEnabled=!!((L=globalThis.FontInspector)!=null&&L.enabled),this._reader=null,this._textDivProperties=k||new WeakMap,this._canceled=!1,this._capability=new n.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:m.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:l(0,S)};const{pageWidth:F,pageHeight:P,pageX:G,pageY:j}=m.rawDims;this._transform=[1,0,0,-1,-G,j+P],this._pageWidth=F,this._pageHeight=P,(0,r.setLayerDimensions)(N,m),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new n.AbortException("TextLayer task cancelled."))}_processItems(E,O){for(const N of E){if(N.str===void 0){if(N.type==="beginMarkedContentProps"||N.type==="beginMarkedContent"){const m=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),N.id!==null&&this._container.setAttribute("id",`${N.id}`),m.append(this._container)}else N.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(N.str),p(this,N,O)}}_layoutText(E){const O=this._layoutTextParams.properties=this._textDivProperties.get(E);if(this._layoutTextParams.div=E,g(this._layoutTextParams),O.hasText&&this._container.append(E),O.hasEOL){const N=document.createElement("br");N.setAttribute("role","presentation"),this._container.append(N)}}_render(){const E=new n.PromiseCapability;let O=Object.create(null);if(this._isReadableStream){const N=()=>{this._reader.read().then(m=>{let{value:b,done:k}=m;if(k){E.resolve();return}Object.assign(O,b.styles),this._processItems(b.items,O),N()},E.reject)};this._reader=this._textContentSource.getReader(),N()}else if(this._textContentSource){const{items:N,styles:m}=this._textContentSource;this._processItems(N,m),E.resolve()}else throw new Error('No "textContentSource" parameter specified.');E.promise.then(()=>{O=null,y(this)},this._capability.reject)}}e.TextLayerRenderTask=h;function f(v){!v.textContentSource&&(v.textContent||v.textContentStream)&&((0,r.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),v.textContentSource=v.textContent||v.textContentStream);const{container:E,viewport:O}=v,N=getComputedStyle(E),m=N.getPropertyValue("visibility"),b=parseFloat(N.getPropertyValue("--scale-factor"));m==="visible"&&(!b||Math.abs(b-O.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const k=new h(v);return k._render(),k}function d(v){let{container:E,viewport:O,textDivs:N,textDivProperties:m,isOffscreenCanvasSupported:b,mustRotate:k=!0,mustRescale:T=!0}=v;if(k&&(0,r.setLayerDimensions)(E,{rotation:O.rotation}),T){const S=l(0,b),P={prevFontSize:null,prevFontFamily:null,div:null,scale:O.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:S};for(const G of N)P.properties=m.get(G),P.div=G,g(P)}}},(s,e,t)=>{var u,p,g,y,h,f,d,v,E,O,N,ln,b,Wt,T,un,F,hn;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0,t(125),t(136),t(138),t(141),t(143),t(145),t(147);var n=t(1),r=t(164),i=t(197),o=t(202),a=t(168),c=t(203);const G=class G{constructor(L){se(this,N);se(this,b);se(this,T);se(this,F);se(this,u,void 0);se(this,p,!1);se(this,g,null);se(this,y,this.pointerup.bind(this));se(this,h,this.pointerdown.bind(this));se(this,f,new Map);se(this,d,!1);se(this,v,!1);se(this,E,!1);se(this,O,void 0);let{uiManager:K,pageIndex:Q,div:ne,accessibilityManager:D,annotationLayer:$,viewport:J,l10n:re}=L;const pe=[i.FreeTextEditor,o.InkEditor,c.StampEditor];if(!G._initialized){G._initialized=!0;for(const U of pe)U.initialize(re)}K.registerEditorTypes(pe),Ae(this,O,K),this.pageIndex=Q,this.div=ne,Ae(this,u,D),Ae(this,g,$),this.viewport=J,x(this,O).addLayer(this)}get isEmpty(){return x(this,f).size===0}updateToolbar(L){x(this,O).updateToolbar(L)}updateMode(){let L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x(this,O).getMode();le(this,F,hn).call(this),L===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),L!==n.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",L===n.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",L===n.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",L===n.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(L){if(!L&&x(this,O).getMode()!==n.AnnotationEditorType.INK)return;if(!L){for(const Q of x(this,f).values())if(Q.isEmpty()){Q.setInBackground();return}}le(this,b,Wt).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(L){x(this,O).setEditingState(L)}addCommands(L){x(this,O).addCommands(L)}enable(){this.div.style.pointerEvents="auto";const L=new Set;for(const Q of x(this,f).values())Q.enableEditing(),Q.annotationElementId&&L.add(Q.annotationElementId);if(!x(this,g))return;const K=x(this,g).getEditableAnnotations();for(const Q of K){if(Q.hide(),x(this,O).isDeletedAnnotationElement(Q.data.id)||L.has(Q.data.id))continue;const ne=this.deserialize(Q);ne&&(this.addOrRebuild(ne),ne.enableEditing())}}disable(){var K;Ae(this,E,!0),this.div.style.pointerEvents="none";const L=new Set;for(const Q of x(this,f).values()){if(Q.disableEditing(),!Q.annotationElementId||Q.serialize()!==null){L.add(Q.annotationElementId);continue}(K=this.getEditableAnnotation(Q.annotationElementId))==null||K.show(),Q.remove()}if(x(this,g)){const Q=x(this,g).getEditableAnnotations();for(const ne of Q){const{id:D}=ne.data;L.has(D)||x(this,O).isDeletedAnnotationElement(D)||ne.show()}}le(this,F,hn).call(this),this.isEmpty&&(this.div.hidden=!0),Ae(this,E,!1)}getEditableAnnotation(L){var K;return((K=x(this,g))==null?void 0:K.getEditableAnnotation(L))||null}setActiveEditor(L){x(this,O).getActive()!==L&&x(this,O).setActiveEditor(L)}enableClick(){this.div.addEventListener("pointerdown",x(this,h)),this.div.addEventListener("pointerup",x(this,y))}disableClick(){this.div.removeEventListener("pointerdown",x(this,h)),this.div.removeEventListener("pointerup",x(this,y))}attach(L){x(this,f).set(L.id,L);const{annotationElementId:K}=L;K&&x(this,O).isDeletedAnnotationElement(K)&&x(this,O).removeDeletedAnnotationElement(L)}detach(L){var K;x(this,f).delete(L.id),(K=x(this,u))==null||K.removePointerInTextLayer(L.contentDiv),!x(this,E)&&L.annotationElementId&&x(this,O).addDeletedAnnotationElement(L)}remove(L){this.detach(L),x(this,O).removeEditor(L),L.div.contains(document.activeElement)&&setTimeout(()=>{x(this,O).focusMainContainer()},0),L.div.remove(),L.isAttachedToDOM=!1,x(this,v)||this.addInkEditorIfNeeded(!1)}changeParent(L){var K;L.parent!==this&&(L.annotationElementId&&(x(this,O).addDeletedAnnotationElement(L.annotationElementId),r.AnnotationEditor.deleteAnnotationElement(L),L.annotationElementId=null),this.attach(L),(K=L.parent)==null||K.detach(L),L.setParent(this),L.div&&L.isAttachedToDOM&&(L.div.remove(),this.div.append(L.div)))}add(L){if(this.changeParent(L),x(this,O).addEditor(L),this.attach(L),!L.isAttachedToDOM){const K=L.render();this.div.append(K),L.isAttachedToDOM=!0}this.moveEditorInDOM(L),L.onceAdded(),x(this,O).addToAnnotationStorage(L)}moveEditorInDOM(L){var Q;if(!L.isAttachedToDOM)return;const{activeElement:K}=document;L.div.contains(K)&&(L._focusEventsAllowed=!1,setTimeout(()=>{L.div.addEventListener("focusin",()=>{L._focusEventsAllowed=!0},{once:!0}),K.focus()},0)),(Q=x(this,u))==null||Q.moveElementInDOM(this.div,L.div,L.contentDiv,!0)}addOrRebuild(L){L.needsToBeRebuilt()?L.rebuild():this.add(L)}addUndoableEditor(L){const K=()=>L._uiManager.rebuild(L),Q=()=>{L.remove()};this.addCommands({cmd:K,undo:Q,mustExec:!1})}getNextId(){return x(this,O).getId()}pasteEditor(L,K){x(this,O).updateToolbar(L),x(this,O).updateMode(L);const{offsetX:Q,offsetY:ne}=le(this,T,un).call(this),D=this.getNextId(),$=le(this,N,ln).call(this,{parent:this,id:D,x:Q,y:ne,uiManager:x(this,O),isCentered:!0,...K});$&&this.add($)}deserialize(L){switch(L.annotationType??L.annotationEditorType){case n.AnnotationEditorType.FREETEXT:return i.FreeTextEditor.deserialize(L,this,x(this,O));case n.AnnotationEditorType.INK:return o.InkEditor.deserialize(L,this,x(this,O));case n.AnnotationEditorType.STAMP:return c.StampEditor.deserialize(L,this,x(this,O))}return null}addNewEditor(){le(this,b,Wt).call(this,le(this,T,un).call(this),!0)}setSelected(L){x(this,O).setSelected(L)}toggleSelected(L){x(this,O).toggleSelected(L)}isSelected(L){return x(this,O).isSelected(L)}unselect(L){x(this,O).unselect(L)}pointerup(L){const{isMac:K}=n.FeatureTest.platform;if(!(L.button!==0||L.ctrlKey&&K)&&L.target===this.div&&x(this,d)){if(Ae(this,d,!1),!x(this,p)){Ae(this,p,!0);return}if(x(this,O).getMode()===n.AnnotationEditorType.STAMP){x(this,O).unselectAll();return}le(this,b,Wt).call(this,L,!1)}}pointerdown(L){if(x(this,d)){Ae(this,d,!1);return}const{isMac:K}=n.FeatureTest.platform;if(L.button!==0||L.ctrlKey&&K||L.target!==this.div)return;Ae(this,d,!0);const Q=x(this,O).getActive();Ae(this,p,!Q||Q.isEmpty())}findNewParent(L,K,Q){const ne=x(this,O).findParent(K,Q);return ne===null||ne===this?!1:(ne.changeParent(L),!0)}destroy(){var L,K;((L=x(this,O).getActive())==null?void 0:L.parent)===this&&x(this,O).setActiveEditor(null);for(const Q of x(this,f).values())(K=x(this,u))==null||K.removePointerInTextLayer(Q.contentDiv),Q.setParent(null),Q.isAttachedToDOM=!1,Q.div.remove();this.div=null,x(this,f).clear(),x(this,O).removeLayer(this)}render(L){let{viewport:K}=L;this.viewport=K,(0,a.setLayerDimensions)(this.div,K);for(const Q of x(this,O).getEditors(this.pageIndex))this.add(Q);this.updateMode()}update(L){let{viewport:K}=L;x(this,O).commitOrRemove(),this.viewport=K,(0,a.setLayerDimensions)(this.div,{rotation:K.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:L,pageHeight:K}=this.viewport.rawDims;return[L,K]}};u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakMap,v=new WeakMap,E=new WeakMap,O=new WeakMap,N=new WeakSet,ln=function(L){switch(x(this,O).getMode()){case n.AnnotationEditorType.FREETEXT:return new i.FreeTextEditor(L);case n.AnnotationEditorType.INK:return new o.InkEditor(L);case n.AnnotationEditorType.STAMP:return new c.StampEditor(L)}return null},b=new WeakSet,Wt=function(L,K){const Q=this.getNextId(),ne=le(this,N,ln).call(this,{parent:this,id:Q,x:L.offsetX,y:L.offsetY,uiManager:x(this,O),isCentered:K});return ne&&this.add(ne),ne},T=new WeakSet,un=function(){const{x:L,y:K,width:Q,height:ne}=this.div.getBoundingClientRect(),D=Math.max(0,L),$=Math.max(0,K),J=Math.min(window.innerWidth,L+Q),re=Math.min(window.innerHeight,K+ne),pe=(D+J)/2-L,U=($+re)/2-K,[w,_]=this.viewport.rotation%180===0?[pe,U]:[U,pe];return{offsetX:w,offsetY:_}},F=new WeakSet,hn=function(){Ae(this,v,!0);for(const L of x(this,f).values())L.isEmpty()&&L.remove();Ae(this,v,!1)},st(G,"_initialized",!1);let l=G;e.AnnotationEditorLayer=l},(s,e,t)=>{var c,l,u,p,g,y,h,f,d,v,$n,O,Hn,m,Xn,k,Rt,S,dn,P,Yn,j,fn;Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0,t(89);var n=t(1),r=t(165),i=t(164),o=t(198);const K=class K extends i.AnnotationEditor{constructor(D){super({...D,name:"freeTextEditor"});se(this,v);se(this,O);se(this,m);se(this,k);se(this,S);se(this,P);se(this,j);se(this,c,this.editorDivBlur.bind(this));se(this,l,this.editorDivFocus.bind(this));se(this,u,this.editorDivInput.bind(this));se(this,p,this.editorDivKeydown.bind(this));se(this,g,void 0);se(this,y,"");se(this,h,`${this.id}-editor`);se(this,f,void 0);se(this,d,null);Ae(this,g,D.color||K._defaultColor||i.AnnotationEditor._defaultLineColor),Ae(this,f,D.fontSize||K._defaultFontSize)}static get _keyboardManager(){const D=K.prototype,$=pe=>pe.isEmpty(),J=r.AnnotationEditorUIManager.TRANSLATE_SMALL,re=r.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,n.shadow)(this,"_keyboardManager",new r.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],D.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],D.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],D._translateEmpty,{args:[-J,0],checker:$}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],D._translateEmpty,{args:[-re,0],checker:$}],[["ArrowRight","mac+ArrowRight"],D._translateEmpty,{args:[J,0],checker:$}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],D._translateEmpty,{args:[re,0],checker:$}],[["ArrowUp","mac+ArrowUp"],D._translateEmpty,{args:[0,-J],checker:$}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],D._translateEmpty,{args:[0,-re],checker:$}],[["ArrowDown","mac+ArrowDown"],D._translateEmpty,{args:[0,J],checker:$}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],D._translateEmpty,{args:[0,re],checker:$}]]))}static initialize(D){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(J=>[J,D.get(J)]));const $=getComputedStyle(document.documentElement);this._internalPadding=parseFloat($.getPropertyValue("--freetext-padding"))}static updateDefaultParams(D,$){switch(D){case n.AnnotationEditorParamsType.FREETEXT_SIZE:K._defaultFontSize=$;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:K._defaultColor=$;break}}updateParams(D,$){switch(D){case n.AnnotationEditorParamsType.FREETEXT_SIZE:le(this,v,$n).call(this,$);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:le(this,O,Hn).call(this,$);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,K._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,K._defaultColor||i.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,x(this,f)],[n.AnnotationEditorParamsType.FREETEXT_COLOR,x(this,g)]]}_translateEmpty(D,$){this._uiManager.translateSelectedEditors(D,$,!0)}getInitialTranslation(){const D=this.parentScale;return[-K._internalPadding*D,-(K._internalPadding+x(this,f))*D]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",x(this,p)),this.editorDiv.addEventListener("focus",x(this,l)),this.editorDiv.addEventListener("blur",x(this,c)),this.editorDiv.addEventListener("input",x(this,u)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",x(this,h)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",x(this,p)),this.editorDiv.removeEventListener("focus",x(this,l)),this.editorDiv.removeEventListener("blur",x(this,c)),this.editorDiv.removeEventListener("input",x(this,u)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(D){this._focusEventsAllowed&&(super.focusin(D),D.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var D;if(this.width){le(this,j,fn).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(D=this._initialOptions)!=null&&D.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const D=x(this,y),$=Ae(this,y,le(this,m,Xn).call(this).trimEnd());if(D===$)return;const J=re=>{if(Ae(this,y,re),!re){this.remove();return}le(this,S,dn).call(this),this._uiManager.rebuild(this),le(this,k,Rt).call(this)};this.addCommands({cmd:()=>{J($)},undo:()=>{J(D)},mustExec:!1}),le(this,k,Rt).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(D){this.enterInEditMode()}keydown(D){D.target===this.div&&D.key==="Enter"&&(this.enterInEditMode(),D.preventDefault())}editorDivKeydown(D){K._keyboardManager.exec(this,D)}editorDivFocus(D){this.isEditing=!0}editorDivBlur(D){this.isEditing=!1}editorDivInput(D){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let D,$;this.width&&(D=this.x,$=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",x(this,h)),this.enableEditing(),K._l10nPromise.get("editor_free_text2_aria_label").then(re=>{var pe;return(pe=this.editorDiv)==null?void 0:pe.setAttribute("aria-label",re)}),K._l10nPromise.get("free_text2_default_content").then(re=>{var pe;return(pe=this.editorDiv)==null?void 0:pe.setAttribute("default-content",re)}),this.editorDiv.contentEditable=!0;const{style:J}=this.editorDiv;if(J.fontSize=`calc(${x(this,f)}px * var(--scale-factor))`,J.color=x(this,g),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,r.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[re,pe]=this.parentDimensions;if(this.annotationElementId){const{position:U}=x(this,d);let[w,_]=this.getInitialTranslation();[w,_]=this.pageTranslationToScreen(w,_);const[R,V]=this.pageDimensions,[M,Y]=this.pageTranslation;let W,ee;switch(this.rotation){case 0:W=D+(U[0]-M)/R,ee=$+this.height-(U[1]-Y)/V;break;case 90:W=D+(U[0]-M)/R,ee=$-(U[1]-Y)/V,[w,_]=[_,-w];break;case 180:W=D-this.width+(U[0]-M)/R,ee=$-(U[1]-Y)/V,[w,_]=[-w,-_];break;case 270:W=D+(U[0]-M-this.height*V)/R,ee=$+(U[1]-Y-this.width*R)/V,[w,_]=[-_,w];break}this.setAt(W*re,ee*pe,w,_)}else this.setAt(D*re,$*pe,this.width*re,this.height*pe);le(this,S,dn).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(D,$,J){let re=null;if(D instanceof o.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:U,fontColor:w},rect:_,rotation:R,id:V},textContent:M,textPosition:Y,parent:{page:{pageNumber:W}}}=D;if(!M||M.length===0)return null;re=D={annotationType:n.AnnotationEditorType.FREETEXT,color:Array.from(w),fontSize:U,value:M.join(`
`),position:Y,pageIndex:W-1,rect:_,rotation:R,id:V,deleted:!1}}const pe=super.deserialize(D,$,J);return Ae(pe,f,D.fontSize),Ae(pe,g,n.Util.makeHexColor(...D.color)),Ae(pe,y,D.value),pe.annotationElementId=D.id||null,Ae(pe,d,re),pe}serialize(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const $=K._internalPadding*this.parentScale,J=this.getRect($,$),re=i.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:x(this,g)),pe={annotationType:n.AnnotationEditorType.FREETEXT,color:re,fontSize:x(this,f),value:x(this,y),pageIndex:this.pageIndex,rect:J,rotation:this.rotation};return D?pe:this.annotationElementId&&!le(this,P,Yn).call(this,pe)?null:(pe.id=this.annotationElementId,pe)}};c=new WeakMap,l=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakMap,v=new WeakSet,$n=function(D){const $=re=>{this.editorDiv.style.fontSize=`calc(${re}px * var(--scale-factor))`,this.translate(0,-(re-x(this,f))*this.parentScale),Ae(this,f,re),le(this,k,Rt).call(this)},J=x(this,f);this.addCommands({cmd:()=>{$(D)},undo:()=>{$(J)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},O=new WeakSet,Hn=function(D){const $=x(this,g);this.addCommands({cmd:()=>{Ae(this,g,this.editorDiv.style.color=D)},undo:()=>{Ae(this,g,this.editorDiv.style.color=$)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},m=new WeakSet,Xn=function(){const D=this.editorDiv.getElementsByTagName("div");if(D.length===0)return this.editorDiv.innerText;const $=[];for(const J of D)$.push(J.innerText.replace(/\r\n?|\n/,""));return $.join(`
`)},k=new WeakSet,Rt=function(){const[D,$]=this.parentDimensions;let J;if(this.isAttachedToDOM)J=this.div.getBoundingClientRect();else{const{currentLayer:re,div:pe}=this,U=pe.style.display;pe.style.display="hidden",re.div.append(this.div),J=pe.getBoundingClientRect(),pe.remove(),pe.style.display=U}this.rotation%180===this.parentRotation%180?(this.width=J.width/D,this.height=J.height/$):(this.width=J.height/D,this.height=J.width/$),this.fixAndSetPosition()},S=new WeakSet,dn=function(){if(this.editorDiv.replaceChildren(),!!x(this,y))for(const D of x(this,y).split(`
`)){const $=document.createElement("div");$.append(D?document.createTextNode(D):document.createElement("br")),this.editorDiv.append($)}},P=new WeakSet,Yn=function(D){const{value:$,fontSize:J,color:re,rect:pe,pageIndex:U}=x(this,d);return D.value!==$||D.fontSize!==J||D.rect.some((w,_)=>Math.abs(w-pe[_])>=1)||D.color.some((w,_)=>w!==re[_])||D.pageIndex!==U},j=new WeakSet,fn=function(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.annotationElementId)return;if(le(this,k,Rt).call(this),!D&&(this.width===0||this.height===0)){setTimeout(()=>le(this,j,fn).call(this,!0),0);return}const $=K._internalPadding*this.parentScale;x(this,d).rect=this.getRect($,$)},st(K,"_freeTextDefaultContent",""),st(K,"_l10nPromise"),st(K,"_internalPadding",0),st(K,"_defaultColor",null),st(K,"_defaultFontSize",10),st(K,"_type","freetext");let a=K;e.FreeTextEditor=a},(s,e,t)=>{var _,R,vt,M,Kn,W,ee,me,he,ye,ie,ve,Ne,Fe,Le,ke,ze,Oe,be,fe,Ce,Me,pn,Ye,mn,Ve,gn,qe,Ze,Qe,Ee,ue,oe,Ue,Be,nt,ge,jn,Te,vn;Object.defineProperty(e,"__esModule",{value:!0}),e.StampAnnotationElement=e.InkAnnotationElement=e.FreeTextAnnotationElement=e.AnnotationLayer=void 0,t(89),t(125),t(136),t(138),t(141),t(143),t(145),t(147);var n=t(1),r=t(168),i=t(163),o=t(199),a=t(200),c=t(201);const l=1e3,u=9,p=new WeakSet;function g(Se){return{width:Se[2]-Se[0],height:Se[3]-Se[1]}}class y{static create(z){switch(z.data.annotationType){case n.AnnotationType.LINK:return new f(z);case n.AnnotationType.TEXT:return new d(z);case n.AnnotationType.WIDGET:switch(z.data.fieldType){case"Tx":return new E(z);case"Btn":return z.data.radioButton?new m(z):z.data.checkBox?new N(z):new b(z);case"Ch":return new k(z);case"Sig":return new O(z)}return new v(z);case n.AnnotationType.POPUP:return new T(z);case n.AnnotationType.FREETEXT:return new F(z);case n.AnnotationType.LINE:return new P(z);case n.AnnotationType.SQUARE:return new G(z);case n.AnnotationType.CIRCLE:return new j(z);case n.AnnotationType.POLYLINE:return new L(z);case n.AnnotationType.CARET:return new Q(z);case n.AnnotationType.INK:return new ne(z);case n.AnnotationType.POLYGON:return new K(z);case n.AnnotationType.HIGHLIGHT:return new D(z);case n.AnnotationType.UNDERLINE:return new $(z);case n.AnnotationType.SQUIGGLY:return new J(z);case n.AnnotationType.STRIKEOUT:return new re(z);case n.AnnotationType.STAMP:return new pe(z);case n.AnnotationType.FILEATTACHMENT:return new U(z);default:return new h(z)}}}class h{constructor(z){se(this,_,!1);let{isRenderable:I=!1,ignoreBorder:Z=!1,createQuadrilaterals:H=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.isRenderable=I,this.data=z.data,this.layer=z.layer,this.linkService=z.linkService,this.downloadManager=z.downloadManager,this.imageResourcesPath=z.imageResourcesPath,this.renderForms=z.renderForms,this.svgFactory=z.svgFactory,this.annotationStorage=z.annotationStorage,this.enableScripting=z.enableScripting,this.hasJSActions=z.hasJSActions,this._fieldObjects=z.fieldObjects,this.parent=z.parent,I&&(this.container=this._createContainer(Z)),H&&this._createQuadrilaterals()}_createContainer(z){const{data:I,parent:{page:Z,viewport:H}}=this,q=document.createElement("section");q.setAttribute("data-annotation-id",I.id),q.style.zIndex=this.parent.zIndex++,this.data.popupRef&&q.setAttribute("aria-haspopup","dialog"),I.noRotate&&q.classList.add("norotate");const{pageWidth:ce,pageHeight:we,pageX:X,pageY:ae}=H.rawDims;if(!I.rect||this instanceof T){const{rotation:De}=I;return!I.hasOwnCanvas&&De!==0&&this.setRotation(De,q),q}const{width:de,height:Pe}=g(I.rect),_e=n.Util.normalizeRect([I.rect[0],Z.view[3]-I.rect[1]+Z.view[1],I.rect[2],Z.view[3]-I.rect[3]+Z.view[1]]);if(!z&&I.borderStyle.width>0){q.style.borderWidth=`${I.borderStyle.width}px`;const De=I.borderStyle.horizontalCornerRadius,He=I.borderStyle.verticalCornerRadius;if(De>0||He>0){const et=`calc(${De}px * var(--scale-factor)) / calc(${He}px * var(--scale-factor))`;q.style.borderRadius=et}else if(this instanceof m){const et=`calc(${de}px * var(--scale-factor)) / calc(${Pe}px * var(--scale-factor))`;q.style.borderRadius=et}switch(I.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:q.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:q.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:q.style.borderBottomStyle="solid";break}const Je=I.borderColor||null;Je?(Ae(this,_,!0),q.style.borderColor=n.Util.makeHexColor(Je[0]|0,Je[1]|0,Je[2]|0)):q.style.borderWidth=0}q.style.left=`${100*(_e[0]-X)/ce}%`,q.style.top=`${100*(_e[1]-ae)/we}%`;const{rotation:Re}=I;return I.hasOwnCanvas||Re===0?(q.style.width=`${100*de/ce}%`,q.style.height=`${100*Pe/we}%`):this.setRotation(Re,q),q}setRotation(z){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:Z,pageHeight:H}=this.parent.viewport.rawDims,{width:q,height:ce}=g(this.data.rect);let we,X;z%180===0?(we=100*q/Z,X=100*ce/H):(we=100*ce/Z,X=100*q/H),I.style.width=`${we}%`,I.style.height=`${X}%`,I.setAttribute("data-main-rotation",(360-z)%360)}get _commonActions(){const z=(I,Z,H)=>{const q=H.detail[I],ce=q[0],we=q.slice(1);H.target.style[Z]=o.ColorConverters[`${ce}_HTML`](we),this.annotationStorage.setValue(this.data.id,{[Z]:o.ColorConverters[`${ce}_rgb`](we)})};return(0,n.shadow)(this,"_commonActions",{display:I=>{const{display:Z}=I.detail,H=Z%2===1;this.container.style.visibility=H?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:H,noPrint:Z===1||Z===2})},print:I=>{this.annotationStorage.setValue(this.data.id,{noPrint:!I.detail.print})},hidden:I=>{const{hidden:Z}=I.detail;this.container.style.visibility=Z?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:Z,noView:Z})},focus:I=>{setTimeout(()=>I.target.focus({preventScroll:!1}),0)},userName:I=>{I.target.title=I.detail.userName},readonly:I=>{I.target.disabled=I.detail.readonly},required:I=>{this._setRequired(I.target,I.detail.required)},bgColor:I=>{z("bgColor","backgroundColor",I)},fillColor:I=>{z("fillColor","backgroundColor",I)},fgColor:I=>{z("fgColor","color",I)},textColor:I=>{z("textColor","color",I)},borderColor:I=>{z("borderColor","borderColor",I)},strokeColor:I=>{z("strokeColor","borderColor",I)},rotation:I=>{const Z=I.detail.rotation;this.setRotation(Z),this.annotationStorage.setValue(this.data.id,{rotation:Z})}})}_dispatchEventFromSandbox(z,I){const Z=this._commonActions;for(const H of Object.keys(I.detail)){const q=z[H]||Z[H];q==null||q(I)}}_setDefaultPropertiesFromJS(z){if(!this.enableScripting)return;const I=this.annotationStorage.getRawValue(this.data.id);if(!I)return;const Z=this._commonActions;for(const[H,q]of Object.entries(I)){const ce=Z[H];if(ce){const we={detail:{[H]:q},target:z};ce(we),delete I[H]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:z}=this.data;if(!z)return;const[I,Z,H,q]=this.data.rect;if(z.length===1){const[,{x:He,y:Je},{x:et,y:it}]=z[0];if(H===He&&q===Je&&I===et&&Z===it)return}const{style:ce}=this.container;let we;if(x(this,_)){const{borderColor:He,borderWidth:Je}=ce;ce.borderWidth=0,we=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${He}" stroke-width="${Je}">`],this.container.classList.add("hasBorder")}const X=H-I,ae=q-Z,{svgFactory:de}=this,Pe=de.createElement("svg");Pe.classList.add("quadrilateralsContainer"),Pe.setAttribute("width",0),Pe.setAttribute("height",0);const _e=de.createElement("defs");Pe.append(_e);const Re=de.createElement("clipPath"),De=`clippath_${this.data.id}`;Re.setAttribute("id",De),Re.setAttribute("clipPathUnits","objectBoundingBox"),_e.append(Re);for(const[,{x:He,y:Je},{x:et,y:it}]of z){const tt=de.createElement("rect"),ct=(et-I)/X,lt=(q-Je)/ae,ht=(He-et)/X,dt=(Je-it)/ae;tt.setAttribute("x",ct),tt.setAttribute("y",lt),tt.setAttribute("width",ht),tt.setAttribute("height",dt),Re.append(tt),we==null||we.push(`<rect vector-effect="non-scaling-stroke" x="${ct}" y="${lt}" width="${ht}" height="${dt}"/>`)}x(this,_)&&(we.push("</g></svg>')"),ce.backgroundImage=we.join("")),this.container.append(Pe),this.container.style.clipPath=`url(#${De})`}_createPopup(){const{container:z,data:I}=this;z.setAttribute("aria-haspopup","dialog");const Z=new T({data:{color:I.color,titleObj:I.titleObj,modificationDate:I.modificationDate,contentsObj:I.contentsObj,richText:I.richText,parentRect:I.rect,borderStyle:0,id:`popup_${I.id}`,rotation:I.rotation},parent:this.parent,elements:[this]});this.parent.div.append(Z.render())}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(z){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const Z=[];if(this._fieldObjects){const H=this._fieldObjects[z];if(H)for(const{page:q,id:ce,exportValues:we}of H){if(q===-1||ce===I)continue;const X=typeof we=="string"?we:null,ae=document.querySelector(`[data-element-id="${ce}"]`);if(ae&&!p.has(ae)){(0,n.warn)(`_getElementsByName - element not allowed: ${ce}`);continue}Z.push({id:ce,exportValue:X,domElement:ae})}return Z}for(const H of document.getElementsByName(z)){const{exportValue:q}=H,ce=H.getAttribute("data-element-id");ce!==I&&p.has(H)&&Z.push({id:ce,exportValue:q,domElement:H})}return Z}show(){var z;this.container&&(this.container.hidden=!1),(z=this.popup)==null||z.maybeShow()}hide(){var z;this.container&&(this.container.hidden=!0),(z=this.popup)==null||z.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const z=this.getElementsToTriggerPopup();if(Array.isArray(z))for(const I of z)I.classList.add("highlightArea");else z.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:z,data:{id:I}}=this;this.container.addEventListener("dblclick",()=>{var Z;(Z=this.linkService.eventBus)==null||Z.dispatch("switchannotationeditormode",{source:this,mode:z,editId:I})})}}_=new WeakMap;class f extends h{constructor(I){let Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;super(I,{isRenderable:!0,ignoreBorder:!!(Z!=null&&Z.ignoreBorder),createQuadrilaterals:!0});se(this,R);se(this,M);this.isTooltipOnly=I.data.isTooltipOnly}render(){const{data:I,linkService:Z}=this,H=document.createElement("a");H.setAttribute("data-element-id",I.id);let q=!1;return I.url?(Z.addLinkAttributes(H,I.url,I.newWindow),q=!0):I.action?(this._bindNamedAction(H,I.action),q=!0):I.attachment?(this._bindAttachment(H,I.attachment),q=!0):I.setOCGState?(le(this,M,Kn).call(this,H,I.setOCGState),q=!0):I.dest?(this._bindLink(H,I.dest),q=!0):(I.actions&&(I.actions.Action||I.actions["Mouse Up"]||I.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(H,I),q=!0),I.resetForm?(this._bindResetFormAction(H,I.resetForm),q=!0):this.isTooltipOnly&&!q&&(this._bindLink(H,""),q=!0)),this.container.classList.add("linkAnnotation"),q&&this.container.append(H),this.container}_bindLink(I,Z){I.href=this.linkService.getDestinationHash(Z),I.onclick=()=>(Z&&this.linkService.goToDestination(Z),!1),(Z||Z==="")&&le(this,R,vt).call(this)}_bindNamedAction(I,Z){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>(this.linkService.executeNamedAction(Z),!1),le(this,R,vt).call(this)}_bindAttachment(I,Z){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>{var H;return(H=this.downloadManager)==null||H.openOrDownloadData(this.container,Z.content,Z.filename),!1},le(this,R,vt).call(this)}_bindJSAction(I,Z){I.href=this.linkService.getAnchorUrl("");const H=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const q of Object.keys(Z.actions)){const ce=H.get(q);ce&&(I[ce]=()=>{var we;return(we=this.linkService.eventBus)==null||we.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Z.id,name:q}}),!1})}I.onclick||(I.onclick=()=>!1),le(this,R,vt).call(this)}_bindResetFormAction(I,Z){const H=I.onclick;if(H||(I.href=this.linkService.getAnchorUrl("")),le(this,R,vt).call(this),!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),H||(I.onclick=()=>!1);return}I.onclick=()=>{var Pe;H==null||H();const{fields:q,refs:ce,include:we}=Z,X=[];if(q.length!==0||ce.length!==0){const _e=new Set(ce);for(const Re of q){const De=this._fieldObjects[Re]||[];for(const{id:He}of De)_e.add(He)}for(const Re of Object.values(this._fieldObjects))for(const De of Re)_e.has(De.id)===we&&X.push(De)}else for(const _e of Object.values(this._fieldObjects))X.push(..._e);const ae=this.annotationStorage,de=[];for(const _e of X){const{id:Re}=_e;switch(de.push(Re),_e.type){case"text":{const He=_e.defaultValue||"";ae.setValue(Re,{value:He});break}case"checkbox":case"radiobutton":{const He=_e.defaultValue===_e.exportValues;ae.setValue(Re,{value:He});break}case"combobox":case"listbox":{const He=_e.defaultValue||"";ae.setValue(Re,{value:He});break}default:continue}const De=document.querySelector(`[data-element-id="${Re}"]`);if(De){if(!p.has(De)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${Re}`);continue}}else continue;De.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Pe=this.linkService.eventBus)==null||Pe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:de,name:"ResetForm"}})),!1}}}R=new WeakSet,vt=function(){this.container.setAttribute("data-internal-link","")},M=new WeakSet,Kn=function(I,Z){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>(this.linkService.executeSetOCGState(Z),!1),le(this,R,vt).call(this)};class d extends h{constructor(z){var Z,H,q;const I=!!(z.data.popupRef||(Z=z.data.titleObj)!=null&&Z.str||(H=z.data.contentsObj)!=null&&H.str||(q=z.data.richText)!=null&&q.str);super(z,{isRenderable:I})}render(){this.container.classList.add("textAnnotation");const z=document.createElement("img");return z.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",z.alt="[{{type}} Annotation]",z.dataset.l10nId="text_annotation_type",z.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.popupRef||this._createPopup(),this.container.append(z),this.container}}class v extends h{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(z){var I;this.data.hasOwnCanvas&&(((I=z.previousSibling)==null?void 0:I.nodeName)==="CANVAS"&&(z.previousSibling.hidden=!0),z.hidden=!1)}_getKeyModifier(z){const{isWin:I,isMac:Z}=n.FeatureTest.platform;return I&&z.ctrlKey||Z&&z.metaKey}_setEventListener(z,I,Z,H){I.includes("mouse")?z.addEventListener(I,q=>{var ce;(ce=this.linkService.eventBus)==null||ce.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Z,value:H(q),shift:q.shiftKey,modifier:this._getKeyModifier(q)}})}):z.addEventListener(I,q=>{var ce;(ce=this.linkService.eventBus)==null||ce.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Z,value:H(q)}})})}_setEventListeners(z,I,Z){var H;for(const[q,ce]of I)(ce==="Action"||(H=this.data.actions)!=null&&H[ce])&&this._setEventListener(z,q,ce,Z)}_setBackgroundColor(z){const I=this.data.backgroundColor||null;z.style.backgroundColor=I===null?"transparent":n.Util.makeHexColor(I[0],I[1],I[2])}_setTextStyle(z){const I=["left","center","right"],{fontColor:Z}=this.data.defaultAppearanceData,H=this.data.defaultAppearanceData.fontSize||u,q=z.style;let ce;const we=2,X=ae=>Math.round(10*ae)/10;if(this.data.multiLine){const ae=Math.abs(this.data.rect[3]-this.data.rect[1]-we),de=Math.round(ae/(n.LINE_FACTOR*H))||1,Pe=ae/de;ce=Math.min(H,X(Pe/n.LINE_FACTOR))}else{const ae=Math.abs(this.data.rect[3]-this.data.rect[1]-we);ce=Math.min(H,X(ae/n.LINE_FACTOR))}q.fontSize=`calc(${ce}px * var(--scale-factor))`,q.color=n.Util.makeHexColor(Z[0],Z[1],Z[2]),this.data.textAlignment!==null&&(q.textAlign=I[this.data.textAlignment])}_setRequired(z,I){I?z.setAttribute("required",!0):z.removeAttribute("required"),z.setAttribute("aria-required",I)}}class E extends v{constructor(z){const I=z.renderForms||!z.data.hasAppearance&&!!z.data.fieldValue;super(z,{isRenderable:I})}setPropertyOnSiblings(z,I,Z,H){const q=this.annotationStorage;for(const ce of this._getElementsByName(z.name,z.id))ce.domElement&&(ce.domElement[I]=Z),q.setValue(ce.id,{[H]:Z})}render(){var H,q;const z=this.annotationStorage,I=this.data.id;this.container.classList.add("textWidgetAnnotation");let Z=null;if(this.renderForms){const ce=z.getValue(I,{value:this.data.fieldValue});let we=ce.value||"";const X=z.getValue(I,{charLimit:this.data.maxLen}).charLimit;X&&we.length>X&&(we=we.slice(0,X));let ae=ce.formattedValue||((H=this.data.textContent)==null?void 0:H.join(`
`))||null;ae&&this.data.comb&&(ae=ae.replaceAll(/\s+/g,""));const de={userValue:we,formattedValue:ae,lastCommittedValue:null,commitKey:1};this.data.multiLine?(Z=document.createElement("textarea"),Z.textContent=ae??we,this.data.doNotScroll&&(Z.style.overflowY="hidden")):(Z=document.createElement("input"),Z.type="text",Z.setAttribute("value",ae??we),this.data.doNotScroll&&(Z.style.overflowX="hidden")),this.data.hasOwnCanvas&&(Z.hidden=!0),p.add(Z),Z.setAttribute("data-element-id",I),Z.disabled=this.data.readOnly,Z.name=this.data.fieldName,Z.tabIndex=l,this._setRequired(Z,this.data.required),X&&(Z.maxLength=X),Z.addEventListener("input",_e=>{z.setValue(I,{value:_e.target.value}),this.setPropertyOnSiblings(Z,"value",_e.target.value,"value"),de.formattedValue=null}),Z.addEventListener("resetform",_e=>{const Re=this.data.defaultFieldValue??"";Z.value=de.userValue=Re,de.formattedValue=null});let Pe=_e=>{const{formattedValue:Re}=de;Re!=null&&(_e.target.value=Re),_e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){Z.addEventListener("focus",Re=>{const{target:De}=Re;de.userValue&&(De.value=de.userValue),de.lastCommittedValue=De.value,de.commitKey=1}),Z.addEventListener("updatefromsandbox",Re=>{this.showElementAndHideCanvas(Re.target);const De={value(He){de.userValue=He.detail.value??"",z.setValue(I,{value:de.userValue.toString()}),He.target.value=de.userValue},formattedValue(He){const{formattedValue:Je}=He.detail;de.formattedValue=Je,Je!=null&&He.target!==document.activeElement&&(He.target.value=Je),z.setValue(I,{formattedValue:Je})},selRange(He){He.target.setSelectionRange(...He.detail.selRange)},charLimit:He=>{var tt;const{charLimit:Je}=He.detail,{target:et}=He;if(Je===0){et.removeAttribute("maxLength");return}et.setAttribute("maxLength",Je);let it=de.userValue;!it||it.length<=Je||(it=it.slice(0,Je),et.value=de.userValue=it,z.setValue(I,{value:it}),(tt=this.linkService.eventBus)==null||tt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:it,willCommit:!0,commitKey:1,selStart:et.selectionStart,selEnd:et.selectionEnd}}))}};this._dispatchEventFromSandbox(De,Re)}),Z.addEventListener("keydown",Re=>{var Je;de.commitKey=1;let De=-1;if(Re.key==="Escape"?De=0:Re.key==="Enter"&&!this.data.multiLine?De=2:Re.key==="Tab"&&(de.commitKey=3),De===-1)return;const{value:He}=Re.target;de.lastCommittedValue!==He&&(de.lastCommittedValue=He,de.userValue=He,(Je=this.linkService.eventBus)==null||Je.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:He,willCommit:!0,commitKey:De,selStart:Re.target.selectionStart,selEnd:Re.target.selectionEnd}}))});const _e=Pe;Pe=null,Z.addEventListener("blur",Re=>{var He;if(!Re.relatedTarget)return;const{value:De}=Re.target;de.userValue=De,de.lastCommittedValue!==De&&((He=this.linkService.eventBus)==null||He.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:De,willCommit:!0,commitKey:de.commitKey,selStart:Re.target.selectionStart,selEnd:Re.target.selectionEnd}})),_e(Re)}),(q=this.data.actions)!=null&&q.Keystroke&&Z.addEventListener("beforeinput",Re=>{var lt;de.lastCommittedValue=null;const{data:De,target:He}=Re,{value:Je,selectionStart:et,selectionEnd:it}=He;let tt=et,ct=it;switch(Re.inputType){case"deleteWordBackward":{const ht=Je.substring(0,et).match(/\w*[^\w]*$/);ht&&(tt-=ht[0].length);break}case"deleteWordForward":{const ht=Je.substring(et).match(/^[^\w]*\w*/);ht&&(ct+=ht[0].length);break}case"deleteContentBackward":et===it&&(tt-=1);break;case"deleteContentForward":et===it&&(ct+=1);break}Re.preventDefault(),(lt=this.linkService.eventBus)==null||lt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:Je,change:De||"",willCommit:!1,selStart:tt,selEnd:ct}})}),this._setEventListeners(Z,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Re=>Re.target.value)}if(Pe&&Z.addEventListener("blur",Pe),this.data.comb){const Re=(this.data.rect[2]-this.data.rect[0])/X;Z.classList.add("comb"),Z.style.letterSpacing=`calc(${Re}px * var(--scale-factor) - 1ch)`}}else Z=document.createElement("div"),Z.textContent=this.data.fieldValue,Z.style.verticalAlign="middle",Z.style.display="table-cell";return this._setTextStyle(Z),this._setBackgroundColor(Z),this._setDefaultPropertiesFromJS(Z),this.container.append(Z),this.container}}class O extends v{constructor(z){super(z,{isRenderable:!!z.data.hasOwnCanvas})}}class N extends v{constructor(z){super(z,{isRenderable:z.renderForms})}render(){const z=this.annotationStorage,I=this.data,Z=I.id;let H=z.getValue(Z,{value:I.exportValue===I.fieldValue}).value;typeof H=="string"&&(H=H!=="Off",z.setValue(Z,{value:H})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const q=document.createElement("input");return p.add(q),q.setAttribute("data-element-id",Z),q.disabled=I.readOnly,this._setRequired(q,this.data.required),q.type="checkbox",q.name=I.fieldName,H&&q.setAttribute("checked",!0),q.setAttribute("exportValue",I.exportValue),q.tabIndex=l,q.addEventListener("change",ce=>{const{name:we,checked:X}=ce.target;for(const ae of this._getElementsByName(we,Z)){const de=X&&ae.exportValue===I.exportValue;ae.domElement&&(ae.domElement.checked=de),z.setValue(ae.id,{value:de})}z.setValue(Z,{value:X})}),q.addEventListener("resetform",ce=>{const we=I.defaultFieldValue||"Off";ce.target.checked=we===I.exportValue}),this.enableScripting&&this.hasJSActions&&(q.addEventListener("updatefromsandbox",ce=>{const we={value(X){X.target.checked=X.detail.value!=="Off",z.setValue(Z,{value:X.target.checked})}};this._dispatchEventFromSandbox(we,ce)}),this._setEventListeners(q,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ce=>ce.target.checked)),this._setBackgroundColor(q),this._setDefaultPropertiesFromJS(q),this.container.append(q),this.container}}class m extends v{constructor(z){super(z,{isRenderable:z.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const z=this.annotationStorage,I=this.data,Z=I.id;let H=z.getValue(Z,{value:I.fieldValue===I.buttonValue}).value;typeof H=="string"&&(H=H!==I.buttonValue,z.setValue(Z,{value:H}));const q=document.createElement("input");if(p.add(q),q.setAttribute("data-element-id",Z),q.disabled=I.readOnly,this._setRequired(q,this.data.required),q.type="radio",q.name=I.fieldName,H&&q.setAttribute("checked",!0),q.tabIndex=l,q.addEventListener("change",ce=>{const{name:we,checked:X}=ce.target;for(const ae of this._getElementsByName(we,Z))z.setValue(ae.id,{value:!1});z.setValue(Z,{value:X})}),q.addEventListener("resetform",ce=>{const we=I.defaultFieldValue;ce.target.checked=we!=null&&we===I.buttonValue}),this.enableScripting&&this.hasJSActions){const ce=I.buttonValue;q.addEventListener("updatefromsandbox",we=>{const X={value:ae=>{const de=ce===ae.detail.value;for(const Pe of this._getElementsByName(ae.target.name)){const _e=de&&Pe.id===Z;Pe.domElement&&(Pe.domElement.checked=_e),z.setValue(Pe.id,{value:_e})}}};this._dispatchEventFromSandbox(X,we)}),this._setEventListeners(q,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],we=>we.target.checked)}return this._setBackgroundColor(q),this._setDefaultPropertiesFromJS(q),this.container.append(q),this.container}}class b extends f{constructor(z){super(z,{ignoreBorder:z.data.hasAppearance})}render(){const z=super.render();z.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(z.title=this.data.alternativeText);const I=z.lastChild;return this.enableScripting&&this.hasJSActions&&I&&(this._setDefaultPropertiesFromJS(I),I.addEventListener("updatefromsandbox",Z=>{this._dispatchEventFromSandbox({},Z)})),z}}class k extends v{constructor(z){super(z,{isRenderable:z.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const z=this.annotationStorage,I=this.data.id,Z=z.getValue(I,{value:this.data.fieldValue}),H=document.createElement("select");p.add(H),H.setAttribute("data-element-id",I),H.disabled=this.data.readOnly,this._setRequired(H,this.data.required),H.name=this.data.fieldName,H.tabIndex=l;let q=this.data.combo&&this.data.options.length>0;this.data.combo||(H.size=this.data.options.length,this.data.multiSelect&&(H.multiple=!0)),H.addEventListener("resetform",de=>{const Pe=this.data.defaultFieldValue;for(const _e of H.options)_e.selected=_e.value===Pe});for(const de of this.data.options){const Pe=document.createElement("option");Pe.textContent=de.displayValue,Pe.value=de.exportValue,Z.value.includes(de.exportValue)&&(Pe.setAttribute("selected",!0),q=!1),H.append(Pe)}let ce=null;if(q){const de=document.createElement("option");de.value=" ",de.setAttribute("hidden",!0),de.setAttribute("selected",!0),H.prepend(de),ce=()=>{de.remove(),H.removeEventListener("input",ce),ce=null},H.addEventListener("input",ce)}const we=de=>{const Pe=de?"value":"textContent",{options:_e,multiple:Re}=H;return Re?Array.prototype.filter.call(_e,De=>De.selected).map(De=>De[Pe]):_e.selectedIndex===-1?null:_e[_e.selectedIndex][Pe]};let X=we(!1);const ae=de=>{const Pe=de.target.options;return Array.prototype.map.call(Pe,_e=>({displayValue:_e.textContent,exportValue:_e.value}))};return this.enableScripting&&this.hasJSActions?(H.addEventListener("updatefromsandbox",de=>{const Pe={value(_e){ce==null||ce();const Re=_e.detail.value,De=new Set(Array.isArray(Re)?Re:[Re]);for(const He of H.options)He.selected=De.has(He.value);z.setValue(I,{value:we(!0)}),X=we(!1)},multipleSelection(_e){H.multiple=!0},remove(_e){const Re=H.options,De=_e.detail.remove;Re[De].selected=!1,H.remove(De),Re.length>0&&Array.prototype.findIndex.call(Re,Je=>Je.selected)===-1&&(Re[0].selected=!0),z.setValue(I,{value:we(!0),items:ae(_e)}),X=we(!1)},clear(_e){for(;H.length!==0;)H.remove(0);z.setValue(I,{value:null,items:[]}),X=we(!1)},insert(_e){const{index:Re,displayValue:De,exportValue:He}=_e.detail.insert,Je=H.children[Re],et=document.createElement("option");et.textContent=De,et.value=He,Je?Je.before(et):H.append(et),z.setValue(I,{value:we(!0),items:ae(_e)}),X=we(!1)},items(_e){const{items:Re}=_e.detail;for(;H.length!==0;)H.remove(0);for(const De of Re){const{displayValue:He,exportValue:Je}=De,et=document.createElement("option");et.textContent=He,et.value=Je,H.append(et)}H.options.length>0&&(H.options[0].selected=!0),z.setValue(I,{value:we(!0),items:ae(_e)}),X=we(!1)},indices(_e){const Re=new Set(_e.detail.indices);for(const De of _e.target.options)De.selected=Re.has(De.index);z.setValue(I,{value:we(!0)}),X=we(!1)},editable(_e){_e.target.disabled=!_e.detail.editable}};this._dispatchEventFromSandbox(Pe,de)}),H.addEventListener("input",de=>{var _e;const Pe=we(!0);z.setValue(I,{value:Pe}),de.preventDefault(),(_e=this.linkService.eventBus)==null||_e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:X,changeEx:Pe,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(H,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],de=>de.target.value)):H.addEventListener("input",function(de){z.setValue(I,{value:we(!0)})}),this.data.combo&&this._setTextStyle(H),this._setBackgroundColor(H),this._setDefaultPropertiesFromJS(H),this.container.append(H),this.container}}class T extends h{constructor(z){var q,ce,we;const{data:I,elements:Z}=z,H=!!((q=I.titleObj)!=null&&q.str||(ce=I.contentsObj)!=null&&ce.str||(we=I.richText)!=null&&we.str);super(z,{isRenderable:H}),this.elements=Z}render(){this.container.classList.add("popupAnnotation");const z=new S({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),I=[];for(const Z of this.elements)Z.popup=z,I.push(Z.data.id),Z.addHighlightArea();return this.container.setAttribute("aria-controls",I.join(",")),this.container}}class S{constructor(z){se(this,Me);se(this,Ye);se(this,Ve);se(this,W,null);se(this,ee,le(this,Ve,gn).bind(this));se(this,me,le(this,Ye,mn).bind(this));se(this,he,le(this,Me,pn).bind(this));se(this,ye,null);se(this,ie,null);se(this,ve,null);se(this,Ne,null);se(this,Fe,null);se(this,Le,null);se(this,ke,!1);se(this,ze,null);se(this,Oe,null);se(this,be,null);se(this,fe,null);se(this,Ce,!1);let{container:I,color:Z,elements:H,titleObj:q,modificationDate:ce,contentsObj:we,richText:X,parent:ae,rect:de,parentRect:Pe,open:_e}=z;Ae(this,ie,I),Ae(this,fe,q),Ae(this,ve,we),Ae(this,be,X),Ae(this,Fe,ae),Ae(this,ye,Z),Ae(this,Oe,de),Ae(this,Le,Pe),Ae(this,Ne,H);const Re=r.PDFDateString.toDateObject(ce);Re&&Ae(this,W,ae.l10n.get("annotation_date_string",{date:Re.toLocaleDateString(),time:Re.toLocaleTimeString()})),this.trigger=H.flatMap(De=>De.getElementsToTriggerPopup());for(const De of this.trigger)De.addEventListener("click",x(this,he)),De.addEventListener("mouseenter",x(this,me)),De.addEventListener("mouseleave",x(this,ee));x(this,ie).hidden=!0,_e&&le(this,Me,pn).call(this)}render(){if(x(this,ze))return;const{page:{view:z},viewport:{rawDims:{pageWidth:I,pageHeight:Z,pageX:H,pageY:q}}}=x(this,Fe),ce=Ae(this,ze,document.createElement("div"));if(ce.className="popup",x(this,ye)){const tt=ce.style.outlineColor=n.Util.makeHexColor(...x(this,ye));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?ce.style.backgroundColor=`color-mix(in srgb, ${tt} 30%, white)`:ce.style.backgroundColor=n.Util.makeHexColor(...x(this,ye).map(lt=>Math.floor(.7*(255-lt)+lt)))}const we=document.createElement("span");we.className="header";const X=document.createElement("h1");if(we.append(X),{dir:X.dir,str:X.textContent}=x(this,fe),ce.append(we),x(this,W)){const tt=document.createElement("span");tt.classList.add("popupDate"),x(this,W).then(ct=>{tt.textContent=ct}),we.append(tt)}const ae=x(this,ve),de=x(this,be);if(de!=null&&de.str&&(!(ae!=null&&ae.str)||ae.str===de.str))c.XfaLayer.render({xfaHtml:de.html,intent:"richText",div:ce}),ce.lastChild.classList.add("richText","popupContent");else{const tt=this._formatContents(ae);ce.append(tt)}let Pe=!!x(this,Le),_e=Pe?x(this,Le):x(this,Oe);for(const tt of x(this,Ne))if(!_e||n.Util.intersect(tt.data.rect,_e)!==null){_e=tt.data.rect,Pe=!0;break}const Re=n.Util.normalizeRect([_e[0],z[3]-_e[1]+z[1],_e[2],z[3]-_e[3]+z[1]]),De=5,He=Pe?_e[2]-_e[0]+De:0,Je=Re[0]+He,et=Re[1],{style:it}=x(this,ie);it.left=`${100*(Je-H)/I}%`,it.top=`${100*(et-q)/Z}%`,x(this,ie).append(ce)}_formatContents(z){let{str:I,dir:Z}=z;const H=document.createElement("p");H.classList.add("popupContent"),H.dir=Z;const q=I.split(/(?:\r\n?|\n)/);for(let ce=0,we=q.length;ce<we;++ce){const X=q[ce];H.append(document.createTextNode(X)),ce<we-1&&H.append(document.createElement("br"))}return H}forceHide(){Ae(this,Ce,this.isVisible),x(this,Ce)&&(x(this,ie).hidden=!0)}maybeShow(){x(this,Ce)&&(Ae(this,Ce,!1),x(this,ie).hidden=!1)}get isVisible(){return x(this,ie).hidden===!1}}W=new WeakMap,ee=new WeakMap,me=new WeakMap,he=new WeakMap,ye=new WeakMap,ie=new WeakMap,ve=new WeakMap,Ne=new WeakMap,Fe=new WeakMap,Le=new WeakMap,ke=new WeakMap,ze=new WeakMap,Oe=new WeakMap,be=new WeakMap,fe=new WeakMap,Ce=new WeakMap,Me=new WeakSet,pn=function(){Ae(this,ke,!x(this,ke)),x(this,ke)?(le(this,Ye,mn).call(this),x(this,ie).addEventListener("click",x(this,he))):(le(this,Ve,gn).call(this),x(this,ie).removeEventListener("click",x(this,he)))},Ye=new WeakSet,mn=function(){x(this,ze)||this.render(),this.isVisible?x(this,ke)&&x(this,ie).classList.add("focused"):(x(this,ie).hidden=!1,x(this,ie).style.zIndex=parseInt(x(this,ie).style.zIndex)+1e3)},Ve=new WeakSet,gn=function(){x(this,ie).classList.remove("focused"),!(x(this,ke)||!this.isVisible)&&(x(this,ie).hidden=!0,x(this,ie).style.zIndex=parseInt(x(this,ie).style.zIndex)-1e3)};class F extends h{constructor(z){var Z,H,q;const I=!!(z.data.popupRef||(Z=z.data.titleObj)!=null&&Z.str||(H=z.data.contentsObj)!=null&&H.str||(q=z.data.richText)!=null&&q.str);super(z,{isRenderable:I,ignoreBorder:!0}),this.textContent=z.data.textContent,this.textPosition=z.data.textPosition,this.annotationEditorType=n.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const z=document.createElement("div");z.classList.add("annotationTextContent"),z.setAttribute("role","comment");for(const I of this.textContent){const Z=document.createElement("span");Z.textContent=I,z.append(Z)}this.container.append(z)}return this.data.popupRef||this._createPopup(),this._editOnDoubleClick(),this.container}}e.FreeTextAnnotationElement=F;class P extends h{constructor(I){var H,q,ce;const Z=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(q=I.data.contentsObj)!=null&&q.str||(ce=I.data.richText)!=null&&ce.str);super(I,{isRenderable:Z,ignoreBorder:!0});se(this,qe,null)}render(){this.container.classList.add("lineAnnotation");const I=this.data,{width:Z,height:H}=g(I.rect),q=this.svgFactory.create(Z,H,!0),ce=Ae(this,qe,this.svgFactory.createElement("svg:line"));return ce.setAttribute("x1",I.rect[2]-I.lineCoordinates[0]),ce.setAttribute("y1",I.rect[3]-I.lineCoordinates[1]),ce.setAttribute("x2",I.rect[2]-I.lineCoordinates[2]),ce.setAttribute("y2",I.rect[3]-I.lineCoordinates[3]),ce.setAttribute("stroke-width",I.borderStyle.width||1),ce.setAttribute("stroke","transparent"),ce.setAttribute("fill","transparent"),q.append(ce),this.container.append(q),I.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return x(this,qe)}addHighlightArea(){this.container.classList.add("highlightArea")}}qe=new WeakMap;class G extends h{constructor(I){var H,q,ce;const Z=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(q=I.data.contentsObj)!=null&&q.str||(ce=I.data.richText)!=null&&ce.str);super(I,{isRenderable:Z,ignoreBorder:!0});se(this,Ze,null)}render(){this.container.classList.add("squareAnnotation");const I=this.data,{width:Z,height:H}=g(I.rect),q=this.svgFactory.create(Z,H,!0),ce=I.borderStyle.width,we=Ae(this,Ze,this.svgFactory.createElement("svg:rect"));return we.setAttribute("x",ce/2),we.setAttribute("y",ce/2),we.setAttribute("width",Z-ce),we.setAttribute("height",H-ce),we.setAttribute("stroke-width",ce||1),we.setAttribute("stroke","transparent"),we.setAttribute("fill","transparent"),q.append(we),this.container.append(q),I.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return x(this,Ze)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ze=new WeakMap;class j extends h{constructor(I){var H,q,ce;const Z=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(q=I.data.contentsObj)!=null&&q.str||(ce=I.data.richText)!=null&&ce.str);super(I,{isRenderable:Z,ignoreBorder:!0});se(this,Qe,null)}render(){this.container.classList.add("circleAnnotation");const I=this.data,{width:Z,height:H}=g(I.rect),q=this.svgFactory.create(Z,H,!0),ce=I.borderStyle.width,we=Ae(this,Qe,this.svgFactory.createElement("svg:ellipse"));return we.setAttribute("cx",Z/2),we.setAttribute("cy",H/2),we.setAttribute("rx",Z/2-ce/2),we.setAttribute("ry",H/2-ce/2),we.setAttribute("stroke-width",ce||1),we.setAttribute("stroke","transparent"),we.setAttribute("fill","transparent"),q.append(we),this.container.append(q),I.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return x(this,Qe)}addHighlightArea(){this.container.classList.add("highlightArea")}}Qe=new WeakMap;class L extends h{constructor(I){var H,q,ce;const Z=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(q=I.data.contentsObj)!=null&&q.str||(ce=I.data.richText)!=null&&ce.str);super(I,{isRenderable:Z,ignoreBorder:!0});se(this,Ee,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const I=this.data,{width:Z,height:H}=g(I.rect),q=this.svgFactory.create(Z,H,!0);let ce=[];for(const X of I.vertices){const ae=X.x-I.rect[0],de=I.rect[3]-X.y;ce.push(ae+","+de)}ce=ce.join(" ");const we=Ae(this,Ee,this.svgFactory.createElement(this.svgElementName));return we.setAttribute("points",ce),we.setAttribute("stroke-width",I.borderStyle.width||1),we.setAttribute("stroke","transparent"),we.setAttribute("fill","transparent"),q.append(we),this.container.append(q),I.popupRef||this._createPopup(we,I),this.container}getElementsToTriggerPopup(){return x(this,Ee)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ee=new WeakMap;class K extends L{constructor(z){super(z),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Q extends h{constructor(z){var Z,H,q;const I=!!(z.data.popupRef||(Z=z.data.titleObj)!=null&&Z.str||(H=z.data.contentsObj)!=null&&H.str||(q=z.data.richText)!=null&&q.str);super(z,{isRenderable:I,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class ne extends h{constructor(I){var H,q,ce;const Z=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(q=I.data.contentsObj)!=null&&q.str||(ce=I.data.richText)!=null&&ce.str);super(I,{isRenderable:Z,ignoreBorder:!0});se(this,ue,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=n.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const I=this.data,{width:Z,height:H}=g(I.rect),q=this.svgFactory.create(Z,H,!0);for(const ce of I.inkLists){let we=[];for(const ae of ce){const de=ae.x-I.rect[0],Pe=I.rect[3]-ae.y;we.push(`${de},${Pe}`)}we=we.join(" ");const X=this.svgFactory.createElement(this.svgElementName);x(this,ue).push(X),X.setAttribute("points",we),X.setAttribute("stroke-width",I.borderStyle.width||1),X.setAttribute("stroke","transparent"),X.setAttribute("fill","transparent"),I.popupRef||this._createPopup(X,I),q.append(X)}return this.container.append(q),this.container}getElementsToTriggerPopup(){return x(this,ue)}addHighlightArea(){this.container.classList.add("highlightArea")}}ue=new WeakMap,e.InkAnnotationElement=ne;class D extends h{constructor(z){var Z,H,q;const I=!!(z.data.popupRef||(Z=z.data.titleObj)!=null&&Z.str||(H=z.data.contentsObj)!=null&&H.str||(q=z.data.richText)!=null&&q.str);super(z,{isRenderable:I,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class $ extends h{constructor(z){var Z,H,q;const I=!!(z.data.popupRef||(Z=z.data.titleObj)!=null&&Z.str||(H=z.data.contentsObj)!=null&&H.str||(q=z.data.richText)!=null&&q.str);super(z,{isRenderable:I,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class J extends h{constructor(z){var Z,H,q;const I=!!(z.data.popupRef||(Z=z.data.titleObj)!=null&&Z.str||(H=z.data.contentsObj)!=null&&H.str||(q=z.data.richText)!=null&&q.str);super(z,{isRenderable:I,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class re extends h{constructor(z){var Z,H,q;const I=!!(z.data.popupRef||(Z=z.data.titleObj)!=null&&Z.str||(H=z.data.contentsObj)!=null&&H.str||(q=z.data.richText)!=null&&q.str);super(z,{isRenderable:I,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class pe extends h{constructor(z){var Z,H,q;const I=!!(z.data.popupRef||(Z=z.data.titleObj)!=null&&Z.str||(H=z.data.contentsObj)!=null&&H.str||(q=z.data.richText)!=null&&q.str);super(z,{isRenderable:I,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.popupRef||this._createPopup(),this.container}}e.StampAnnotationElement=pe;class U extends h{constructor(I){var q;super(I,{isRenderable:!0});se(this,oe,null);const{filename:Z,content:H}=this.data.file;this.filename=(0,r.getFilenameFromUrl)(Z,!0),this.content=H,(q=this.linkService.eventBus)==null||q.dispatch("fileattachmentannotation",{source:this,filename:Z,content:H})}render(){var H,q;this.container.classList.add("fileAttachmentAnnotation");const{data:I}=this;let Z;return I.hasAppearance||I.fillAlpha===0?Z=document.createElement("div"):(Z=document.createElement("img"),Z.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(I.name)?"paperclip":"pushpin"}.svg`,I.fillAlpha&&I.fillAlpha<1&&(Z.style=`filter: opacity(${Math.round(I.fillAlpha*100)}%);`)),Z.classList.add("popupTriggerArea"),Z.addEventListener("dblclick",this._download.bind(this)),Ae(this,oe,Z),!I.popupRef&&((H=I.titleObj)!=null&&H.str||(q=I.contentsObj)!=null&&q.str||I.richText)&&this._createPopup(),this.container.append(Z),this.container}getElementsToTriggerPopup(){return x(this,oe)}addHighlightArea(){this.container.classList.add("highlightArea")}_download(){var I;(I=this.downloadManager)==null||I.openOrDownloadData(this.container,this.content,this.filename)}}oe=new WeakMap;class w{constructor(z){se(this,ge);se(this,Te);se(this,Ue,null);se(this,Be,null);se(this,nt,new Map);let{div:I,accessibilityManager:Z,annotationCanvasMap:H,l10n:q,page:ce,viewport:we}=z;this.div=I,Ae(this,Ue,Z),Ae(this,Be,H),this.l10n=q,this.page=ce,this.viewport=we,this.zIndex=0,this.l10n||(this.l10n=a.NullL10n)}async render(z){const{annotations:I}=z,Z=this.div;(0,r.setLayerDimensions)(Z,this.viewport);const H=new Map,q={data:null,layer:Z,linkService:z.linkService,downloadManager:z.downloadManager,imageResourcesPath:z.imageResourcesPath||"",renderForms:z.renderForms!==!1,svgFactory:new r.DOMSVGFactory,annotationStorage:z.annotationStorage||new i.AnnotationStorage,enableScripting:z.enableScripting===!0,hasJSActions:z.hasJSActions,fieldObjects:z.fieldObjects,parent:this,elements:null};for(const ce of I){if(ce.noHTML)continue;const we=ce.annotationType===n.AnnotationType.POPUP;if(we){const de=H.get(ce.id);if(!de)continue;q.elements=de}else{const{width:de,height:Pe}=g(ce.rect);if(de<=0||Pe<=0)continue}q.data=ce;const X=y.create(q);if(!X.isRenderable)continue;if(!we&&ce.popupRef){const de=H.get(ce.popupRef);de?de.push(X):H.set(ce.popupRef,[X])}X.annotationEditorType>0&&x(this,nt).set(X.data.id,X);const ae=X.render();ce.hidden&&(ae.style.visibility="hidden"),le(this,ge,jn).call(this,ae,ce.id)}le(this,Te,vn).call(this),await this.l10n.translate(Z)}update(z){let{viewport:I}=z;const Z=this.div;this.viewport=I,(0,r.setLayerDimensions)(Z,{rotation:I.rotation}),le(this,Te,vn).call(this),Z.hidden=!1}getEditableAnnotations(){return Array.from(x(this,nt).values())}getEditableAnnotation(z){return x(this,nt).get(z)}}Ue=new WeakMap,Be=new WeakMap,nt=new WeakMap,ge=new WeakSet,jn=function(z,I){var H;const Z=z.firstChild||z;Z.id=`${r.AnnotationPrefix}${I}`,this.div.append(z),(H=x(this,Ue))==null||H.moveElementInDOM(this.div,z,Z,!1)},Te=new WeakSet,vn=function(){if(!x(this,Be))return;const z=this.div;for(const[I,Z]of x(this,Be)){const H=z.querySelector(`[data-annotation-id="${I}"]`);if(!H)continue;const{firstChild:q}=H;q?q.nodeName==="CANVAS"?q.replaceWith(Z):q.before(Z):H.append(Z)}x(this,Be).clear()},e.AnnotationLayer=w},(s,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function n(i){return Math.max(0,Math.min(255,255*i))}class r{static CMYK_G(o){let[a,c,l,u]=o;return["G",1-Math.min(1,.3*a+.59*l+.11*c+u)]}static G_CMYK(o){let[a]=o;return["CMYK",0,0,0,1-a]}static G_RGB(o){let[a]=o;return["RGB",a,a,a]}static G_rgb(o){let[a]=o;return a=n(a),[a,a,a]}static G_HTML(o){let[a]=o;const c=t(a);return`#${c}${c}${c}`}static RGB_G(o){let[a,c,l]=o;return["G",.3*a+.59*c+.11*l]}static RGB_rgb(o){return o.map(n)}static RGB_HTML(o){return`#${o.map(t).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB(o){let[a,c,l,u]=o;return["RGB",1-Math.min(1,a+u),1-Math.min(1,l+u),1-Math.min(1,c+u)]}static CMYK_rgb(o){let[a,c,l,u]=o;return[n(1-Math.min(1,a+u)),n(1-Math.min(1,l+u)),n(1-Math.min(1,c+u))]}static CMYK_HTML(o){const a=this.CMYK_RGB(o).slice(1);return this.RGB_HTML(a)}static RGB_CMYK(o){let[a,c,l]=o;const u=1-a,p=1-c,g=1-l,y=Math.min(u,p,g);return["CMYK",u,p,g,y]}}e.ColorConverters=r},(s,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NullL10n=void 0,e.getL10nFallback=n;const t={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image"};t.print_progress_percent="{{progress}}%";function n(o,a){switch(o){case"find_match_count":o=`find_match_count[${a.total===1?"one":"other"}]`;break;case"find_match_count_limit":o=`find_match_count_limit[${a.limit===1?"one":"other"}]`;break}return t[o]||""}function r(o,a){return a?o.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(c,l)=>l in a?a[l]:"{{"+l+"}}"):o}const i={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:n(o,a);return r(c,a)},async translate(o){}};e.NullL10n=i},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0,t(89);var n=t(194);class r{static setupStorage(o,a,c,l,u){const p=l.getValue(a,{value:null});switch(c.name){case"textarea":if(p.value!==null&&(o.textContent=p.value),u==="print")break;o.addEventListener("input",g=>{l.setValue(a,{value:g.target.value})});break;case"input":if(c.attributes.type==="radio"||c.attributes.type==="checkbox"){if(p.value===c.attributes.xfaOn?o.setAttribute("checked",!0):p.value===c.attributes.xfaOff&&o.removeAttribute("checked"),u==="print")break;o.addEventListener("change",g=>{l.setValue(a,{value:g.target.checked?g.target.getAttribute("xfaOn"):g.target.getAttribute("xfaOff")})})}else{if(p.value!==null&&o.setAttribute("value",p.value),u==="print")break;o.addEventListener("input",g=>{l.setValue(a,{value:g.target.value})})}break;case"select":if(p.value!==null){o.setAttribute("value",p.value);for(const g of c.children)g.attributes.value===p.value?g.attributes.selected=!0:g.attributes.hasOwnProperty("selected")&&delete g.attributes.selected}o.addEventListener("input",g=>{const y=g.target.options,h=y.selectedIndex===-1?"":y[y.selectedIndex].value;l.setValue(a,{value:h})});break}}static setAttributes(o){let{html:a,element:c,storage:l=null,intent:u,linkService:p}=o;const{attributes:g}=c,y=a instanceof HTMLAnchorElement;g.type==="radio"&&(g.name=`${g.name}-${u}`);for(const[h,f]of Object.entries(g))if(f!=null)switch(h){case"class":f.length&&a.setAttribute(h,f.join(" "));break;case"dataId":break;case"id":a.setAttribute("data-element-id",f);break;case"style":Object.assign(a.style,f);break;case"textContent":a.textContent=f;break;default:(!y||h!=="href"&&h!=="newWindow")&&a.setAttribute(h,f)}y&&p.addLinkAttributes(a,g.href,g.newWindow),l&&g.dataId&&this.setupStorage(a,g.dataId,c,l)}static render(o){var f;const a=o.annotationStorage,c=o.linkService,l=o.xfaHtml,u=o.intent||"display",p=document.createElement(l.name);l.attributes&&this.setAttributes({html:p,element:l,intent:u,linkService:c});const g=[[l,-1,p]],y=o.div;if(y.append(p),o.viewport){const d=`matrix(${o.viewport.transform.join(",")})`;y.style.transform=d}u!=="richText"&&y.setAttribute("class","xfaLayer xfaFont");const h=[];for(;g.length>0;){const[d,v,E]=g.at(-1);if(v+1===d.children.length){g.pop();continue}const O=d.children[++g.at(-1)[1]];if(O===null)continue;const{name:N}=O;if(N==="#text"){const b=document.createTextNode(O.value);h.push(b),E.append(b);continue}const m=(f=O==null?void 0:O.attributes)!=null&&f.xmlns?document.createElementNS(O.attributes.xmlns,N):document.createElement(N);if(E.append(m),O.attributes&&this.setAttributes({html:m,element:O,storage:a,intent:u,linkService:c}),O.children&&O.children.length>0)g.push([O,-1,m]);else if(O.value){const b=document.createTextNode(O.value);n.XfaText.shouldBuildText(N)&&h.push(b),m.append(b)}}for(const d of y.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:h}}static update(o){const a=`matrix(${o.viewport.transform.join(",")})`;o.div.style.transform=a,o.div.hidden=!1}}e.XfaLayer=r},(s,e,t)=>{var c,l,u,p,g,y,h,f,d,v,E,O,N,m,b,k,Zn,S,Qn,P,Jn,j,qn,K,yn,ne,er,$,An,re,tr,U,nr,_,rr,V,sr,Y,ir,ee,pt,he,bn,ie,Ut,Ne,Gt,Le,Et,ze,Sn,be,zt,Ce,or,Ge,Tn,je,ar,We,cr,Ze,Cn,Ee,$t,oe,xt;Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0,t(89),t(2);var n=t(1),r=t(164),i=t(198),o=t(165);const Be=class Be extends r.AnnotationEditor{constructor(te){super({...te,name:"inkEditor"});se(this,k);se(this,S);se(this,P);se(this,j);se(this,K);se(this,ne);se(this,$);se(this,re);se(this,U);se(this,_);se(this,V);se(this,Y);se(this,ee);se(this,he);se(this,ie);se(this,Ne);se(this,Le);se(this,ze);se(this,be);se(this,We);se(this,Ze);se(this,Ee);se(this,oe);se(this,c,0);se(this,l,0);se(this,u,this.canvasContextMenu.bind(this));se(this,p,this.canvasPointermove.bind(this));se(this,g,this.canvasPointerleave.bind(this));se(this,y,this.canvasPointerup.bind(this));se(this,h,this.canvasPointerdown.bind(this));se(this,f,new Path2D);se(this,d,!1);se(this,v,!1);se(this,E,!1);se(this,O,null);se(this,N,0);se(this,m,0);se(this,b,null);this.color=te.color||null,this.thickness=te.thickness||null,this.opacity=te.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(te){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(Te=>[Te,te.get(Te)]))}static updateDefaultParams(te,Te){switch(te){case n.AnnotationEditorParamsType.INK_THICKNESS:Be._defaultThickness=Te;break;case n.AnnotationEditorParamsType.INK_COLOR:Be._defaultColor=Te;break;case n.AnnotationEditorParamsType.INK_OPACITY:Be._defaultOpacity=Te/100;break}}updateParams(te,Te){switch(te){case n.AnnotationEditorParamsType.INK_THICKNESS:le(this,k,Zn).call(this,Te);break;case n.AnnotationEditorParamsType.INK_COLOR:le(this,S,Qn).call(this,Te);break;case n.AnnotationEditorParamsType.INK_OPACITY:le(this,P,Jn).call(this,Te);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,Be._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,Be._defaultColor||r.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(Be._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Be._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||Be._defaultColor||r.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Be._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(le(this,ie,Ut).call(this),le(this,Ne,Gt).call(this)),this.isAttachedToDOM||(this.parent.add(this),le(this,Le,Et).call(this)),le(this,oe,xt).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,x(this,O).disconnect(),Ae(this,O,null),super.remove())}setParent(te){!this.parent&&te?this._uiManager.removeShouldRescale(this):this.parent&&te===null&&this._uiManager.addShouldRescale(this),super.setParent(te)}onScaleChanging(){const[te,Te]=this.parentDimensions,Ie=this.width*te,Se=this.height*Te;this.setDimensions(Ie,Se)}enableEditMode(){x(this,d)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",x(this,h)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",x(this,h)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){x(this,d)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),Ae(this,d,!0),this.div.classList.add("disabled"),le(this,oe,xt).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(te){this._focusEventsAllowed&&(super.focusin(te),this.enableEditMode())}canvasPointerdown(te){te.button!==0||!this.isInEditMode()||x(this,d)||(this.setInForeground(),te.preventDefault(),te.type!=="mouse"&&this.div.focus(),le(this,ne,er).call(this,te.offsetX,te.offsetY))}canvasContextMenu(te){te.preventDefault()}canvasPointermove(te){te.preventDefault(),le(this,$,An).call(this,te.offsetX,te.offsetY)}canvasPointerup(te){te.preventDefault(),le(this,he,bn).call(this,te)}canvasPointerleave(te){le(this,he,bn).call(this,te)}get isResizable(){return!this.isEmpty()&&x(this,d)}render(){if(this.div)return this.div;let te,Te;this.width&&(te=this.x,Te=this.y),super.render(),Be._l10nPromise.get("editor_ink2_aria_label").then(Z=>{var H;return(H=this.div)==null?void 0:H.setAttribute("aria-label",Z)});const[Ie,Se,z,I]=le(this,j,qn).call(this);if(this.setAt(Ie,Se,0,0),this.setDims(z,I),le(this,ie,Ut).call(this),this.width){const[Z,H]=this.parentDimensions;this.setAspectRatio(this.width*Z,this.height*H),this.setAt(te*Z,Te*H,this.width*Z,this.height*H),Ae(this,E,!0),le(this,Le,Et).call(this),this.setDims(this.width*Z,this.height*H),le(this,ee,pt).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return le(this,Ne,Gt).call(this),this.div}setDimensions(te,Te){const Ie=Math.round(te),Se=Math.round(Te);if(x(this,N)===Ie&&x(this,m)===Se)return;Ae(this,N,Ie),Ae(this,m,Se),this.canvas.style.visibility="hidden";const[z,I]=this.parentDimensions;this.width=te/z,this.height=Te/I,this.fixAndSetPosition(),x(this,d)&&le(this,ze,Sn).call(this,te,Te),le(this,Le,Et).call(this),le(this,ee,pt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(te,Te,Ie){var Pe,_e,Re;if(te instanceof i.InkAnnotationElement)return null;const Se=super.deserialize(te,Te,Ie);Se.thickness=te.thickness,Se.color=n.Util.makeHexColor(...te.color),Se.opacity=te.opacity;const[z,I]=Se.pageDimensions,Z=Se.width*z,H=Se.height*I,q=Se.parentScale,ce=te.thickness/2;Ae(Se,d,!0),Ae(Se,N,Math.round(Z)),Ae(Se,m,Math.round(H));const{paths:we,rect:X,rotation:ae}=te;for(let{bezier:De}of we){De=le(Pe=Be,je,ar).call(Pe,De,X,ae);const He=[];Se.paths.push(He);let Je=q*(De[0]-ce),et=q*(De[1]-ce);for(let tt=2,ct=De.length;tt<ct;tt+=6){const lt=q*(De[tt]-ce),ht=q*(De[tt+1]-ce),dt=q*(De[tt+2]-ce),yt=q*(De[tt+3]-ce),mt=q*(De[tt+4]-ce),wt=q*(De[tt+5]-ce);He.push([[Je,et],[lt,ht],[dt,yt],[mt,wt]]),Je=mt,et=wt}const it=le(this,Ce,or).call(this,He);Se.bezierPath2D.push(it)}const de=le(_e=Se,Ze,Cn).call(_e);return Ae(Se,l,Math.max(r.AnnotationEditor.MIN_SIZE,de[2]-de[0])),Ae(Se,c,Math.max(r.AnnotationEditor.MIN_SIZE,de[3]-de[1])),le(Re=Se,ze,Sn).call(Re,Z,H),Se}serialize(){if(this.isEmpty())return null;const te=this.getRect(0,0),Te=r.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:Te,thickness:this.thickness,opacity:this.opacity,paths:le(this,We,cr).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,te),pageIndex:this.pageIndex,rect:te,rotation:this.rotation}}};c=new WeakMap,l=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakMap,v=new WeakMap,E=new WeakMap,O=new WeakMap,N=new WeakMap,m=new WeakMap,b=new WeakMap,k=new WeakSet,Zn=function(te){const Te=this.thickness;this.addCommands({cmd:()=>{this.thickness=te,le(this,oe,xt).call(this)},undo:()=>{this.thickness=Te,le(this,oe,xt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},S=new WeakSet,Qn=function(te){const Te=this.color;this.addCommands({cmd:()=>{this.color=te,le(this,ee,pt).call(this)},undo:()=>{this.color=Te,le(this,ee,pt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},P=new WeakSet,Jn=function(te){te/=100;const Te=this.opacity;this.addCommands({cmd:()=>{this.opacity=te,le(this,ee,pt).call(this)},undo:()=>{this.opacity=Te,le(this,ee,pt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},j=new WeakSet,qn=function(){const{parentRotation:te,parentDimensions:[Te,Ie]}=this;switch(te){case 90:return[0,Ie,Ie,Te];case 180:return[Te,Ie,Te,Ie];case 270:return[Te,0,Ie,Te];default:return[0,0,Te,Ie]}},K=new WeakSet,yn=function(){const{ctx:te,color:Te,opacity:Ie,thickness:Se,parentScale:z,scaleFactor:I}=this;te.lineWidth=Se*z/I,te.lineCap="round",te.lineJoin="round",te.miterLimit=10,te.strokeStyle=`${Te}${(0,o.opacityToHex)(Ie)}`},ne=new WeakSet,er=function(te,Te){this.canvas.addEventListener("contextmenu",x(this,u)),this.canvas.addEventListener("pointerleave",x(this,g)),this.canvas.addEventListener("pointermove",x(this,p)),this.canvas.addEventListener("pointerup",x(this,y)),this.canvas.removeEventListener("pointerdown",x(this,h)),this.isEditing=!0,x(this,E)||(Ae(this,E,!0),le(this,Le,Et).call(this),this.thickness||(this.thickness=Be._defaultThickness),this.color||(this.color=Be._defaultColor||r.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Be._defaultOpacity)),this.currentPath.push([te,Te]),Ae(this,v,!1),le(this,K,yn).call(this),Ae(this,b,()=>{le(this,_,rr).call(this),x(this,b)&&window.requestAnimationFrame(x(this,b))}),window.requestAnimationFrame(x(this,b))},$=new WeakSet,An=function(te,Te){const[Ie,Se]=this.currentPath.at(-1);if(this.currentPath.length>1&&te===Ie&&Te===Se)return;const z=this.currentPath;let I=x(this,f);if(z.push([te,Te]),Ae(this,v,!0),z.length<=2){I.moveTo(...z[0]),I.lineTo(te,Te);return}z.length===3&&(Ae(this,f,I=new Path2D),I.moveTo(...z[0])),le(this,V,sr).call(this,I,...z.at(-3),...z.at(-2),te,Te)},re=new WeakSet,tr=function(){if(this.currentPath.length===0)return;const te=this.currentPath.at(-1);x(this,f).lineTo(...te)},U=new WeakSet,nr=function(te,Te){Ae(this,b,null),te=Math.min(Math.max(te,0),this.canvas.width),Te=Math.min(Math.max(Te,0),this.canvas.height),le(this,$,An).call(this,te,Te),le(this,re,tr).call(this);let Ie;if(this.currentPath.length!==1)Ie=le(this,Y,ir).call(this);else{const H=[te,Te];Ie=[[H,H.slice(),H.slice(),H]]}const Se=x(this,f),z=this.currentPath;this.currentPath=[],Ae(this,f,new Path2D);const I=()=>{this.allRawPaths.push(z),this.paths.push(Ie),this.bezierPath2D.push(Se),this.rebuild()},Z=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(le(this,ie,Ut).call(this),le(this,Ne,Gt).call(this)),le(this,oe,xt).call(this))};this.addCommands({cmd:I,undo:Z,mustExec:!0})},_=new WeakSet,rr=function(){if(!x(this,v))return;Ae(this,v,!1);const te=Math.ceil(this.thickness*this.parentScale),Te=this.currentPath.slice(-3),Ie=Te.map(I=>I[0]),Se=Te.map(I=>I[1]);Math.min(...Ie)-te,Math.max(...Ie)+te,Math.min(...Se)-te,Math.max(...Se)+te;const{ctx:z}=this;z.save(),z.clearRect(0,0,this.canvas.width,this.canvas.height);for(const I of this.bezierPath2D)z.stroke(I);z.stroke(x(this,f)),z.restore()},V=new WeakSet,sr=function(te,Te,Ie,Se,z,I,Z){const H=(Te+Se)/2,q=(Ie+z)/2,ce=(Se+I)/2,we=(z+Z)/2;te.bezierCurveTo(H+2*(Se-H)/3,q+2*(z-q)/3,ce+2*(Se-ce)/3,we+2*(z-we)/3,ce,we)},Y=new WeakSet,ir=function(){const te=this.currentPath;if(te.length<=2)return[[te[0],te[0],te.at(-1),te.at(-1)]];const Te=[];let Ie,[Se,z]=te[0];for(Ie=1;Ie<te.length-2;Ie++){const[X,ae]=te[Ie],[de,Pe]=te[Ie+1],_e=(X+de)/2,Re=(ae+Pe)/2,De=[Se+2*(X-Se)/3,z+2*(ae-z)/3],He=[_e+2*(X-_e)/3,Re+2*(ae-Re)/3];Te.push([[Se,z],De,He,[_e,Re]]),[Se,z]=[_e,Re]}const[I,Z]=te[Ie],[H,q]=te[Ie+1],ce=[Se+2*(I-Se)/3,z+2*(Z-z)/3],we=[H+2*(I-H)/3,q+2*(Z-q)/3];return Te.push([[Se,z],ce,we,[H,q]]),Te},ee=new WeakSet,pt=function(){if(this.isEmpty()){le(this,be,zt).call(this);return}le(this,K,yn).call(this);const{canvas:te,ctx:Te}=this;Te.setTransform(1,0,0,1,0,0),Te.clearRect(0,0,te.width,te.height),le(this,be,zt).call(this);for(const Ie of this.bezierPath2D)Te.stroke(Ie)},he=new WeakSet,bn=function(te){this.canvas.removeEventListener("pointerleave",x(this,g)),this.canvas.removeEventListener("pointermove",x(this,p)),this.canvas.removeEventListener("pointerup",x(this,y)),this.canvas.addEventListener("pointerdown",x(this,h)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",x(this,u))},10),le(this,U,nr).call(this,te.offsetX,te.offsetY),this.addToAnnotationStorage(),this.setInBackground()},ie=new WeakSet,Ut=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Be._l10nPromise.get("editor_ink_canvas_aria_label").then(te=>{var Te;return(Te=this.canvas)==null?void 0:Te.setAttribute("aria-label",te)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Ne=new WeakSet,Gt=function(){Ae(this,O,new ResizeObserver(te=>{const Te=te[0].contentRect;Te.width&&Te.height&&this.setDimensions(Te.width,Te.height)})),x(this,O).observe(this.div)},Le=new WeakSet,Et=function(){if(!x(this,E))return;const[te,Te]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*te),this.canvas.height=Math.ceil(this.height*Te),le(this,be,zt).call(this)},ze=new WeakSet,Sn=function(te,Te){const Ie=le(this,Ee,$t).call(this),Se=(te-Ie)/x(this,l),z=(Te-Ie)/x(this,c);this.scaleFactor=Math.min(Se,z)},be=new WeakSet,zt=function(){const te=le(this,Ee,$t).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+te,this.translationY*this.scaleFactor+te)},Ce=new WeakSet,or=function(te){const Te=new Path2D;for(let Ie=0,Se=te.length;Ie<Se;Ie++){const[z,I,Z,H]=te[Ie];Ie===0&&Te.moveTo(...z),Te.bezierCurveTo(I[0],I[1],Z[0],Z[1],H[0],H[1])}return Te},Ge=new WeakSet,Tn=function(te,Te,Ie){const[Se,z,I,Z]=Te;switch(Ie){case 0:for(let H=0,q=te.length;H<q;H+=2)te[H]+=Se,te[H+1]=Z-te[H+1];break;case 90:for(let H=0,q=te.length;H<q;H+=2){const ce=te[H];te[H]=te[H+1]+Se,te[H+1]=ce+z}break;case 180:for(let H=0,q=te.length;H<q;H+=2)te[H]=I-te[H],te[H+1]+=z;break;case 270:for(let H=0,q=te.length;H<q;H+=2){const ce=te[H];te[H]=I-te[H+1],te[H+1]=Z-ce}break;default:throw new Error("Invalid rotation")}return te},je=new WeakSet,ar=function(te,Te,Ie){const[Se,z,I,Z]=Te;switch(Ie){case 0:for(let H=0,q=te.length;H<q;H+=2)te[H]-=Se,te[H+1]=Z-te[H+1];break;case 90:for(let H=0,q=te.length;H<q;H+=2){const ce=te[H];te[H]=te[H+1]-z,te[H+1]=ce-Se}break;case 180:for(let H=0,q=te.length;H<q;H+=2)te[H]=I-te[H],te[H+1]-=z;break;case 270:for(let H=0,q=te.length;H<q;H+=2){const ce=te[H];te[H]=Z-te[H+1],te[H+1]=I-ce}break;default:throw new Error("Invalid rotation")}return te},We=new WeakSet,cr=function(te,Te,Ie,Se){var q,ce;const z=[],I=this.thickness/2,Z=te*Te+I,H=te*Ie+I;for(const we of this.paths){const X=[],ae=[];for(let de=0,Pe=we.length;de<Pe;de++){const[_e,Re,De,He]=we[de],Je=te*_e[0]+Z,et=te*_e[1]+H,it=te*Re[0]+Z,tt=te*Re[1]+H,ct=te*De[0]+Z,lt=te*De[1]+H,ht=te*He[0]+Z,dt=te*He[1]+H;de===0&&(X.push(Je,et),ae.push(Je,et)),X.push(it,tt,ct,lt,ht,dt),ae.push(it,tt),de===Pe-1&&ae.push(ht,dt)}z.push({bezier:le(q=Be,Ge,Tn).call(q,X,Se,this.rotation),points:le(ce=Be,Ge,Tn).call(ce,ae,Se,this.rotation)})}return z},Ze=new WeakSet,Cn=function(){let te=1/0,Te=-1/0,Ie=1/0,Se=-1/0;for(const z of this.paths)for(const[I,Z,H,q]of z){const ce=n.Util.bezierBoundingBox(...I,...Z,...H,...q);te=Math.min(te,ce[0]),Ie=Math.min(Ie,ce[1]),Te=Math.max(Te,ce[2]),Se=Math.max(Se,ce[3])}return[te,Ie,Te,Se]},Ee=new WeakSet,$t=function(){return x(this,d)?Math.ceil(this.thickness*this.parentScale):0},oe=new WeakSet,xt=function(){let te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return;if(!x(this,d)){le(this,ee,pt).call(this);return}const Te=le(this,Ze,Cn).call(this),Ie=le(this,Ee,$t).call(this);Ae(this,l,Math.max(r.AnnotationEditor.MIN_SIZE,Te[2]-Te[0])),Ae(this,c,Math.max(r.AnnotationEditor.MIN_SIZE,Te[3]-Te[1]));const Se=Math.ceil(Ie+x(this,l)*this.scaleFactor),z=Math.ceil(Ie+x(this,c)*this.scaleFactor),[I,Z]=this.parentDimensions;this.width=Se/I,this.height=z/Z,this.setAspectRatio(Se,z);const H=this.translationX,q=this.translationY;this.translationX=-Te[0],this.translationY=-Te[1],le(this,Le,Et).call(this),le(this,ee,pt).call(this),Ae(this,N,Se),Ae(this,m,z),this.setDims(Se,z);const ce=te?Ie/this.scaleFactor/2:0;this.translate(H-this.translationX-ce,q-this.translationY-ce)},se(Be,Ce),se(Be,Ge),se(Be,je),st(Be,"_defaultColor",null),st(Be,"_defaultOpacity",1),st(Be,"_defaultThickness",1),st(Be,"_l10nPromise"),st(Be,"_type","ink");let a=Be;e.InkEditor=a},(s,e,t)=>{var c,l,u,p,g,y,h,f,d,v,E,It,N,Mt,b,Ht,T,En,F,lr,G,ur,L,xn,Q,Xt,D,hr;Object.defineProperty(e,"__esModule",{value:!0}),e.StampEditor=void 0,t(149),t(152);var n=t(1),r=t(164),i=t(168),o=t(198);const J=class J extends r.AnnotationEditor{constructor(U){super({...U,name:"stampEditor"});se(this,E);se(this,N);se(this,b);se(this,T);se(this,F);se(this,G);se(this,L);se(this,Q);se(this,D);se(this,c,null);se(this,l,null);se(this,u,null);se(this,p,null);se(this,g,null);se(this,y,null);se(this,h,null);se(this,f,null);se(this,d,!1);se(this,v,!1);Ae(this,p,U.bitmapUrl),Ae(this,g,U.bitmapFile)}static get supportedTypes(){const U=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,n.shadow)(this,"supportedTypes",U.map(w=>`image/${w}`))}static get supportedTypesStr(){return(0,n.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(U){return this.supportedTypes.includes(U)}static paste(U,w){w.pasteEditor(n.AnnotationEditorType.STAMP,{bitmapFile:U.getAsFile()})}remove(){var U,w;x(this,l)&&(Ae(this,c,null),this._uiManager.imageManager.deleteId(x(this,l)),(U=x(this,y))==null||U.remove(),Ae(this,y,null),(w=x(this,h))==null||w.disconnect(),Ae(this,h,null)),super.remove()}rebuild(){if(!this.parent){x(this,l)&&le(this,b,Ht).call(this);return}super.rebuild(),this.div!==null&&(x(this,l)&&le(this,b,Ht).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(x(this,u)||x(this,c)||x(this,p)||x(this,g))}get isResizable(){return!0}render(){if(this.div)return this.div;let U,w;if(this.width&&(U=this.x,w=this.y),super.render(),this.div.hidden=!0,x(this,c)?le(this,T,En).call(this):le(this,b,Ht).call(this),this.width){const[_,R]=this.parentDimensions;this.setAt(U*_,w*R,this.width*_,this.height*R)}return this.div}static deserialize(U,w,_){if(U instanceof o.StampAnnotationElement)return null;const R=super.deserialize(U,w,_),{rect:V,bitmapUrl:M,bitmapId:Y,isSvg:W}=U;Y&&_.imageManager.isValidId(Y)?Ae(R,l,Y):Ae(R,p,M),Ae(R,d,W);const[ee,me]=R.pageDimensions;return R.width=(V[2]-V[0])/ee,R.height=(V[3]-V[1])/me,R}serialize(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.isEmpty())return null;const _={annotationType:n.AnnotationEditorType.STAMP,bitmapId:x(this,l),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:x(this,d)};if(U)return _.bitmapUrl=le(this,Q,Xt).call(this,!0),_;if(w===null)return _;w.stamps||(w.stamps=new Map);const R=x(this,d)?(_.rect[2]-_.rect[0])*(_.rect[3]-_.rect[1]):null;if(!w.stamps.has(x(this,l)))w.stamps.set(x(this,l),{area:R,serialized:_}),_.bitmap=le(this,Q,Xt).call(this,!1);else if(x(this,d)){const V=w.stamps.get(x(this,l));R>V.area&&(V.area=R,V.serialized.bitmap.close(),V.serialized.bitmap=le(this,Q,Xt).call(this,!1))}return _}};c=new WeakMap,l=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakMap,v=new WeakMap,E=new WeakSet,It=function(U){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!U){this.remove();return}Ae(this,c,U.bitmap),w||(Ae(this,l,U.id),Ae(this,d,U.isSvg)),le(this,T,En).call(this)},N=new WeakSet,Mt=function(){Ae(this,u,null),this._uiManager.enableWaiting(!1),x(this,y)&&this.div.focus()},b=new WeakSet,Ht=function(){if(x(this,l)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(x(this,l)).then(w=>le(this,E,It).call(this,w,!0)).finally(()=>le(this,N,Mt).call(this));return}if(x(this,p)){const w=x(this,p);Ae(this,p,null),this._uiManager.enableWaiting(!0),Ae(this,u,this._uiManager.imageManager.getFromUrl(w).then(_=>le(this,E,It).call(this,_)).finally(()=>le(this,N,Mt).call(this)));return}if(x(this,g)){const w=x(this,g);Ae(this,g,null),this._uiManager.enableWaiting(!0),Ae(this,u,this._uiManager.imageManager.getFromFile(w).then(_=>le(this,E,It).call(this,_)).finally(()=>le(this,N,Mt).call(this)));return}const U=document.createElement("input");U.type="file",U.accept=J.supportedTypesStr,Ae(this,u,new Promise(w=>{U.addEventListener("change",async()=>{if(!U.files||U.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const _=await this._uiManager.imageManager.getFromFile(U.files[0]);le(this,E,It).call(this,_)}w()}),U.addEventListener("cancel",()=>{this.remove(),w()})}).finally(()=>le(this,N,Mt).call(this))),U.click()},T=new WeakSet,En=function(){const{div:U}=this;let{width:w,height:_}=x(this,c);const[R,V]=this.pageDimensions,M=.75;if(this.width)w=this.width*R,_=this.height*V;else if(w>M*R||_>M*V){const me=Math.min(M*R/w,M*V/_);w*=me,_*=me}const[Y,W]=this.parentDimensions;this.setDims(w*Y/R,_*W/V),this._uiManager.enableWaiting(!1);const ee=Ae(this,y,document.createElement("canvas"));U.append(ee),U.hidden=!1,le(this,L,xn).call(this,w,_),le(this,D,hr).call(this),x(this,v)||(this.parent.addUndoableEditor(this),Ae(this,v,!0))},F=new WeakSet,lr=function(U,w){var M;const[_,R]=this.parentDimensions;this.width=U/_,this.height=w/R,this.setDims(U,w),(M=this._initialOptions)!=null&&M.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,x(this,f)!==null&&clearTimeout(x(this,f)),Ae(this,f,setTimeout(()=>{Ae(this,f,null),le(this,L,xn).call(this,U,w)},200))},G=new WeakSet,ur=function(U,w){const{width:_,height:R}=x(this,c);let V=_,M=R,Y=x(this,c);for(;V>2*U||M>2*w;){const W=V,ee=M;V>2*U&&(V=V>=16384?Math.floor(V/2)-1:Math.ceil(V/2)),M>2*w&&(M=M>=16384?Math.floor(M/2)-1:Math.ceil(M/2));const me=new OffscreenCanvas(V,M);me.getContext("2d").drawImage(Y,0,0,W,ee,0,0,V,M),Y=me.transferToImageBitmap()}return Y},L=new WeakSet,xn=function(U,w){U=Math.ceil(U),w=Math.ceil(w);const _=x(this,y);if(!_||_.width===U&&_.height===w)return;_.width=U,_.height=w;const R=x(this,d)?x(this,c):le(this,G,ur).call(this,U,w),V=_.getContext("2d");V.filter=this._uiManager.hcmFilter,V.drawImage(R,0,0,R.width,R.height,0,0,U,w)},Q=new WeakSet,Xt=function(U){if(U){if(x(this,d)){const R=this._uiManager.imageManager.getSvgUrl(x(this,l));if(R)return R}const w=document.createElement("canvas");return{width:w.width,height:w.height}=x(this,c),w.getContext("2d").drawImage(x(this,c),0,0),w.toDataURL()}if(x(this,d)){const[w,_]=this.pageDimensions,R=Math.round(this.width*w*i.PixelsPerInch.PDF_TO_CSS_UNITS),V=Math.round(this.height*_*i.PixelsPerInch.PDF_TO_CSS_UNITS),M=new OffscreenCanvas(R,V);return M.getContext("2d").drawImage(x(this,c),0,0,x(this,c).width,x(this,c).height,0,0,R,V),M.transferToImageBitmap()}return structuredClone(x(this,c))},D=new WeakSet,hr=function(){Ae(this,h,new ResizeObserver(U=>{const w=U[0].contentRect;w.width&&w.height&&le(this,F,lr).call(this,w.width,w.height)})),x(this,h).observe(this.div)},st(J,"_type","stamp");let a=J;e.StampEditor=a}],__webpack_module_cache__={};function __w_pdfjs_require__(s){var e=__webpack_module_cache__[s];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[s]={exports:{}};return __webpack_modules__[s].call(t.exports,t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var s=__webpack_exports__;Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"AbortException",{enumerable:!0,get:function(){return e.AbortException}}),Object.defineProperty(s,"AnnotationEditorLayer",{enumerable:!0,get:function(){return i.AnnotationEditorLayer}}),Object.defineProperty(s,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(s,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(s,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return o.AnnotationEditorUIManager}}),Object.defineProperty(s,"AnnotationLayer",{enumerable:!0,get:function(){return a.AnnotationLayer}}),Object.defineProperty(s,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(s,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(s,"FeatureTest",{enumerable:!0,get:function(){return e.FeatureTest}}),Object.defineProperty(s,"GlobalWorkerOptions",{enumerable:!0,get:function(){return c.GlobalWorkerOptions}}),Object.defineProperty(s,"ImageKind",{enumerable:!0,get:function(){return e.ImageKind}}),Object.defineProperty(s,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(s,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(s,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(s,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(s,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(s,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(s,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(s,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(s,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(s,"PromiseCapability",{enumerable:!0,get:function(){return e.PromiseCapability}}),Object.defineProperty(s,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(s,"SVGGraphics",{enumerable:!0,get:function(){return t.SVGGraphics}}),Object.defineProperty(s,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(s,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(s,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(s,"XfaLayer",{enumerable:!0,get:function(){return l.XfaLayer}}),Object.defineProperty(s,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(s,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(s,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(s,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(s,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(s,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(s,"isDataScheme",{enumerable:!0,get:function(){return n.isDataScheme}}),Object.defineProperty(s,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(s,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(s,"normalizeUnicode",{enumerable:!0,get:function(){return e.normalizeUnicode}}),Object.defineProperty(s,"renderTextLayer",{enumerable:!0,get:function(){return r.renderTextLayer}}),Object.defineProperty(s,"setLayerDimensions",{enumerable:!0,get:function(){return n.setLayerDimensions}}),Object.defineProperty(s,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(s,"updateTextLayer",{enumerable:!0,get:function(){return r.updateTextLayer}}),Object.defineProperty(s,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(124),n=__w_pdfjs_require__(168),r=__w_pdfjs_require__(195),i=__w_pdfjs_require__(196),o=__w_pdfjs_require__(165),a=__w_pdfjs_require__(198),c=__w_pdfjs_require__(176),l=__w_pdfjs_require__(201)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const pdfjsWorkerURL="/acchymns-pr-PR_kwDOHpETuc5yaKFf/assets/pdf.worker.min-4bff82a4.js",_sfc_main$2=defineComponent({__name:"PDFWrapper",props:{src:{}},emits:["error"],setup(s,{emit:e}){const t=s;pdfExports.GlobalWorkerOptions.workerSrc=pdfjsWorkerURL;let n=ref();return onMounted(async()=>{var i;let r;try{r=await pdfExports.getDocument(t.src).promise}catch{e("error");return}for(let o=1;o<=r.numPages;o++){let a=document.createElement("canvas"),c=await r.getPage(o);const l=Capacitor.getPlatform()=="web"?5:window.devicePixelRatio;let u=c.getViewport({scale:l});a.height=u.height,a.width=u.width;let p=a.getContext("2d");if(p===null){e("error");return}try{await c.render({canvasContext:p,viewport:u}).promise,a.style.width="100%";const g=a.toDataURL("image/png"),y=document.createElement("img");y.classList.add("song-img"),y.src=g,(i=n.value)==null||i.appendChild(y)}catch{e("error");return}}}),(r,i)=>(openBlock(),createElementBlock("div",{ref_key:"root",ref:n,class:"container"},null,512))}}),PDFWrapper_vue_vue_type_style_index_0_lang="",PDFWrapper_vue_vue_type_style_index_1_lang="",_withScopeId=s=>(pushScopeId("data-v-1226a89e"),s=s(),popScopeId(),s),_hoisted_1$1={key:0,class:"fallback-container"},_hoisted_2$1=_withScopeId(()=>createBaseVNode("img",{src:_imports_0,class:"wifi-fallback"},null,-1)),_hoisted_3$1=[_hoisted_2$1],_hoisted_4$1=["src"],_sfc_main$1=defineComponent({__name:"SongContainer",props:{book:{},number:{}},setup(s){const e=s;let t=ref(""),n=ref();function r(E,O,N){const m=O+"."+N[E].fileExtension;return`${N[E].srcUrl}/songs/${m}`}let i=ref(""),o=ref(!1);const a=useMediaQuery("(prefers-color-scheme: dark)"),c=useLocalStorage("ACCOptions.overrideSystemTheme",!1),l=useLocalStorage("ACCOptions.overrideDarkMode",!1);let u=useLocalStorage("ACCOptions.songInverted",!1);const p=computed(()=>c.value?l.value:a.value),g=computed(()=>p.value&&u.value);let y=readonly(useLocalStorage("ACCOptions.panzoomEnable",!0)),h;var f=Capacitor.getPlatform()!=="web";onMounted(async()=>{const E=await getAllBookMetaData();if(console.log(E[e.book]),E[e.book]==null){o.value=!0;return}const O=r(e.book,e.number,E);t.value=E[e.book].fileExtension,i.value=O,y.value&&(h=createPanZoom$1(n.value,{beforeWheel:N=>N.shiftKey,maxZoom:3,minZoom:f?1:.25,bounds:!0,boundsPadding:f?1:.5})),f&&setInterval(()=>{v.refresh()},10)});class d{constructor(O){st(this,"_observer");st(this,"_observedNodes");this._observer=O,this._observedNodes=new Set}observe(O){this._observedNodes.add(O),this._observer.observe(O)}unobserve(O){this._observedNodes.delete(O),this._observer.unobserve(O)}disconnect(){this._observedNodes.clear(),this._observer.disconnect()}refresh(){for(let O of this._observedNodes)this._observer.unobserve(O),this._observer.observe(O)}}const v=new d(new IntersectionObserver((E,O)=>{for(const N of E){let m=N.boundingClientRect;N.intersectionRect.height<m.height?h.setVerticalPan(!0):h.setVerticalPan(!1)}},{root:null,rootMargin:"0px",threshold:1}));return onUpdated(async()=>{f&&v.observe(n.value)}),(E,O)=>unref(o)?(openBlock(),createElementBlock("div",_hoisted_1$1,_hoisted_3$1)):(openBlock(),createElementBlock("div",{key:1,ref_key:"panzoom_container",ref:n,class:"panzoom-container"},[unref(t)=="pdf"?(openBlock(),createBlock(_sfc_main$2,{key:0,onError:O[0]||(O[0]=N=>isRef(o)?o.value=!0:o=!0),src:unref(i),class:normalizeClass(["song-img",{"inverted-song":g.value}])},null,8,["src","class"])):unref(t)!==""?(openBlock(),createElementBlock("img",{key:1,onError:O[1]||(O[1]=N=>isRef(o)?o.value=!0:o=!0),src:unref(i),class:normalizeClass(["song-img",{"inverted-song":g.value}])},null,42,_hoisted_4$1)):createCommentVNode("",!0)],512))}}),SongContainer_vue_vue_type_style_index_0_scoped_1226a89e_lang="",SongContainer=_export_sfc(_sfc_main$1,[["__scopeId","data-v-1226a89e"]]),version="14.7.77",createExtendedExponentialRampToValueAutomationEvent=(s,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:s}),createExtendedLinearRampToValueAutomationEvent=(s,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:s}),createSetValueAutomationEvent=(s,e)=>({startTime:e,type:"setValue",value:s}),createSetValueCurveAutomationEvent=(s,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:s}),getTargetValueAtTime=(s,e,{startTime:t,target:n,timeConstant:r})=>n+(e-n)*Math.exp((t-s)/r),isExponentialRampToValueAutomationEvent=s=>s.type==="exponentialRampToValue",isLinearRampToValueAutomationEvent=s=>s.type==="linearRampToValue",isAnyRampToValueAutomationEvent=s=>isExponentialRampToValueAutomationEvent(s)||isLinearRampToValueAutomationEvent(s),isSetValueAutomationEvent=s=>s.type==="setValue",isSetValueCurveAutomationEvent=s=>s.type==="setValueCurve",getValueOfAutomationEventAtIndexAtTime=(s,e,t,n)=>{const r=s[e];return r===void 0?n:isAnyRampToValueAutomationEvent(r)||isSetValueAutomationEvent(r)?r.value:isSetValueCurveAutomationEvent(r)?r.values[r.values.length-1]:getTargetValueAtTime(t,getValueOfAutomationEventAtIndexAtTime(s,e-1,r.startTime,n),r)},getEndTimeAndValueOfPreviousAutomationEvent=(s,e,t,n,r)=>t===void 0?[n.insertTime,r]:isAnyRampToValueAutomationEvent(t)?[t.endTime,t.value]:isSetValueAutomationEvent(t)?[t.startTime,t.value]:isSetValueCurveAutomationEvent(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,getValueOfAutomationEventAtIndexAtTime(s,e-1,t.startTime,r)],isCancelAndHoldAutomationEvent=s=>s.type==="cancelAndHold",isCancelScheduledValuesAutomationEvent=s=>s.type==="cancelScheduledValues",getEventTime=s=>isCancelAndHoldAutomationEvent(s)||isCancelScheduledValuesAutomationEvent(s)?s.cancelTime:isExponentialRampToValueAutomationEvent(s)||isLinearRampToValueAutomationEvent(s)?s.endTime:s.startTime,getExponentialRampValueAtTime=(s,e,t,{endTime:n,value:r})=>t===r?r:0<t&&0<r||t<0&&r<0?t*(r/t)**((s-e)/(n-e)):0,getLinearRampValueAtTime=(s,e,t,{endTime:n,value:r})=>t+(s-e)/(n-e)*(r-t),interpolateValue=(s,e)=>{const t=Math.floor(e),n=Math.ceil(e);return t===n?s[t]:(1-(e-t))*s[t]+(1-(n-e))*s[n]},getValueCurveValueAtTime=(s,{duration:e,startTime:t,values:n})=>{const r=(s-t)/e*(n.length-1);return interpolateValue(n,r)},isSetTargetAutomationEvent=s=>s.type==="setTarget";class AutomationEventList{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=getEventTime(e);if(isCancelAndHoldAutomationEvent(e)||isCancelScheduledValuesAutomationEvent(e)){const n=this._automationEvents.findIndex(i=>isCancelScheduledValuesAutomationEvent(e)&&isSetValueCurveAutomationEvent(i)?i.startTime+i.duration>=t:getEventTime(i)>=t),r=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),isCancelAndHoldAutomationEvent(e)){const i=this._automationEvents[this._automationEvents.length-1];if(r!==void 0&&isAnyRampToValueAutomationEvent(r)){if(i!==void 0&&isSetTargetAutomationEvent(i))throw new Error("The internal list is malformed.");const o=i===void 0?r.insertTime:isSetValueCurveAutomationEvent(i)?i.startTime+i.duration:getEventTime(i),a=i===void 0?this._defaultValue:isSetValueCurveAutomationEvent(i)?i.values[i.values.length-1]:i.value,c=isExponentialRampToValueAutomationEvent(r)?getExponentialRampValueAtTime(t,o,a,r):getLinearRampValueAtTime(t,o,a,r),l=isExponentialRampToValueAutomationEvent(r)?createExtendedExponentialRampToValueAutomationEvent(c,t,this._currenTime):createExtendedLinearRampToValueAutomationEvent(c,t,this._currenTime);this._automationEvents.push(l)}if(i!==void 0&&isSetTargetAutomationEvent(i)&&this._automationEvents.push(createSetValueAutomationEvent(this.getValue(t),t)),i!==void 0&&isSetValueCurveAutomationEvent(i)&&i.startTime+i.duration>t){const o=t-i.startTime,a=(i.values.length-1)/i.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=i.values.slice(0,c);if(l<1)for(let p=1;p<c;p+=1){const g=l*p%1;u[p]=i.values[p-1]*(1-g)+i.values[p]*g}this._automationEvents[this._automationEvents.length-1]=createSetValueCurveAutomationEvent(u,i.startTime,o)}}}else{const n=this._automationEvents.findIndex(o=>getEventTime(o)>t),r=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(r!==void 0&&isSetValueCurveAutomationEvent(r)&&getEventTime(r)+r.duration>t)return!1;const i=isExponentialRampToValueAutomationEvent(e)?createExtendedExponentialRampToValueAutomationEvent(e.value,e.endTime,this._currenTime):isLinearRampToValueAutomationEvent(e)?createExtendedLinearRampToValueAutomationEvent(e.value,t,this._currenTime):e;if(n===-1)this._automationEvents.push(i);else{if(isSetValueCurveAutomationEvent(e)&&t+e.duration>getEventTime(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,i)}}return!0}flush(e){const t=this._automationEvents.findIndex(n=>getEventTime(n)>e);if(t>1){const n=this._automationEvents.slice(t-1),r=n[0];isSetTargetAutomationEvent(r)&&n.unshift(createSetValueAutomationEvent(getValueOfAutomationEventAtIndexAtTime(this._automationEvents,t-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>getEventTime(o)>e),n=this._automationEvents[t],r=(t===-1?this._automationEvents.length:t)-1,i=this._automationEvents[r];if(i!==void 0&&isSetTargetAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)||n.insertTime>e))return getTargetValueAtTime(e,getValueOfAutomationEventAtIndexAtTime(this._automationEvents,r-1,i.startTime,this._defaultValue),i);if(i!==void 0&&isSetValueAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)))return i.value;if(i!==void 0&&isSetValueCurveAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)||i.startTime+i.duration>e))return e<i.startTime+i.duration?getValueCurveValueAtTime(e,i):i.values[i.values.length-1];if(i!==void 0&&isAnyRampToValueAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)))return i.value;if(n!==void 0&&isExponentialRampToValueAutomationEvent(n)){const[o,a]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,r,i,n,this._defaultValue);return getExponentialRampValueAtTime(e,o,a,n)}if(n!==void 0&&isLinearRampToValueAutomationEvent(n)){const[o,a]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,r,i,n,this._defaultValue);return getLinearRampValueAtTime(e,o,a,n)}return this._defaultValue}}const createCancelAndHoldAutomationEvent=s=>({cancelTime:s,type:"cancelAndHold"}),createCancelScheduledValuesAutomationEvent=s=>({cancelTime:s,type:"cancelScheduledValues"}),createExponentialRampToValueAutomationEvent=(s,e)=>({endTime:e,type:"exponentialRampToValue",value:s}),createLinearRampToValueAutomationEvent=(s,e)=>({endTime:e,type:"linearRampToValue",value:s}),createSetTargetAutomationEvent=(s,e,t)=>({startTime:e,target:s,timeConstant:t,type:"setTarget"}),createAbortError=()=>new DOMException("","AbortError"),createAddActiveInputConnectionToAudioNode=s=>(e,t,[n,r,i],o)=>{s(e[r],[t,n,i],a=>a[0]===t&&a[1]===n,o)},createAddAudioNodeConnections=s=>(e,t,n)=>{const r=[];for(let i=0;i<n.numberOfInputs;i+=1)r.push(new Set);s.set(e,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},createAddAudioParamConnections=s=>(e,t)=>{s.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},ACTIVE_AUDIO_NODE_STORE=new WeakSet,AUDIO_NODE_CONNECTIONS_STORE=new WeakMap,AUDIO_NODE_STORE=new WeakMap,AUDIO_PARAM_CONNECTIONS_STORE=new WeakMap,AUDIO_PARAM_STORE=new WeakMap,CONTEXT_STORE=new WeakMap,EVENT_LISTENERS=new WeakMap,CYCLE_COUNTERS=new WeakMap,NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS=new WeakMap,NODE_TO_PROCESSOR_MAPS=new WeakMap,handler={construct(){return handler}},isConstructible=s=>{try{const e=new Proxy(s,handler);new e}catch{return!1}return!0},IMPORT_STATEMENT_REGEX=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,splitImportStatements=(s,e)=>{const t=[];let n=s.replace(/^[\s]+/,""),r=n.match(IMPORT_STATEMENT_REGEX);for(;r!==null;){const i=r[1].slice(1,-1),o=r[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,e).toString());t.push(o),n=n.slice(r[0].length).replace(/^[\s]+/,""),r=n.match(IMPORT_STATEMENT_REGEX)}return[t.join(";"),n]},verifyParameterDescriptors=s=>{if(s!==void 0&&!Array.isArray(s))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},verifyProcessorCtor=s=>{if(!isConstructible(s))throw new TypeError("The given value for processorCtor should be a constructor.");if(s.prototype===null||typeof s.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},createAddAudioWorkletModule=(s,e,t,n,r,i,o,a,c,l,u,p,g)=>{let y=0;return(h,f,d={credentials:"omit"})=>{const v=u.get(h);if(v!==void 0&&v.has(f))return Promise.resolve();const E=l.get(h);if(E!==void 0){const m=E.get(f);if(m!==void 0)return m}const O=i(h),N=O.audioWorklet===void 0?r(f).then(([m,b])=>{const[k,T]=splitImportStatements(m,b),S=`${k};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${T}
})})(window,'_AWGS')`;return t(S)}).then(()=>{const m=g._AWGS.pop();if(m===void 0)throw new SyntaxError;n(O.currentTime,O.sampleRate,()=>m(class{},void 0,(b,k)=>{if(b.trim()==="")throw e();const T=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(O);if(T!==void 0){if(T.has(b))throw e();verifyProcessorCtor(k),verifyParameterDescriptors(k.parameterDescriptors),T.set(b,k)}else verifyProcessorCtor(k),verifyParameterDescriptors(k.parameterDescriptors),NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.set(O,new Map([[b,k]]))},O.sampleRate,void 0,void 0))}):Promise.all([r(f),Promise.resolve(s(p,p))]).then(([[m,b],k])=>{const T=y+1;y=T;const[S,F]=splitImportStatements(m,b),L=`${S};((AudioWorkletProcessor,registerProcessor)=>{${F}
})(${k?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${k?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${k?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${T}',class extends AudioWorkletProcessor{process(){return !1}})`,K=new Blob([L],{type:"application/javascript; charset=utf-8"}),Q=URL.createObjectURL(K);return O.audioWorklet.addModule(Q,d).then(()=>{if(a(O))return O;const ne=o(O);return ne.audioWorklet.addModule(Q,d).then(()=>ne)}).then(ne=>{if(c===null)throw new SyntaxError;try{new c(ne,`__sac${T}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(Q))});return E===void 0?l.set(h,new Map([[f,N]])):E.set(f,N),N.then(()=>{const m=u.get(h);m===void 0?u.set(h,new Set([f])):m.add(f)}).finally(()=>{const m=l.get(h);m!==void 0&&m.delete(f)}),N}},getValueForKey=(s,e)=>{const t=s.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},pickElementFromSet=(s,e)=>{const t=Array.from(s).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[n]=t;return s.delete(n),n},deletePassiveInputConnectionToAudioNode=(s,e,t,n)=>{const r=getValueForKey(s,e),i=pickElementFromSet(r,o=>o[0]===t&&o[1]===n);return r.size===0&&s.delete(e),i},getEventListenersOfAudioNode=s=>getValueForKey(EVENT_LISTENERS,s),setInternalStateToActive=s=>{if(ACTIVE_AUDIO_NODE_STORE.has(s))throw new Error("The AudioNode is already stored.");ACTIVE_AUDIO_NODE_STORE.add(s),getEventListenersOfAudioNode(s).forEach(e=>e(!0))},isAudioWorkletNode=s=>"port"in s,setInternalStateToPassive=s=>{if(!ACTIVE_AUDIO_NODE_STORE.has(s))throw new Error("The AudioNode is not stored.");ACTIVE_AUDIO_NODE_STORE.delete(s),getEventListenersOfAudioNode(s).forEach(e=>e(!1))},setInternalStateToPassiveWhenNecessary=(s,e)=>{!isAudioWorkletNode(s)&&e.every(t=>t.size===0)&&setInternalStateToPassive(s)},createAddConnectionToAudioNode=(s,e,t,n,r,i,o,a,c,l,u,p,g)=>{const y=new WeakMap;return(h,f,d,v,E)=>{const{activeInputs:O,passiveInputs:N}=i(f),{outputs:m}=i(h),b=a(h),k=T=>{const S=c(f),F=c(h);if(T){const P=deletePassiveInputConnectionToAudioNode(N,h,d,v);s(O,h,P,!1),!E&&!p(h)&&t(F,S,d,v),g(f)&&setInternalStateToActive(f)}else{const P=n(O,h,d,v);e(N,v,P,!1),!E&&!p(h)&&r(F,S,d,v);const G=o(f);if(G===0)u(f)&&setInternalStateToPassiveWhenNecessary(f,O);else{const j=y.get(f);j!==void 0&&clearTimeout(j),y.set(f,setTimeout(()=>{u(f)&&setInternalStateToPassiveWhenNecessary(f,O)},G*1e3))}}};return l(m,[f,d,v],T=>T[0]===f&&T[1]===d&&T[2]===v,!0)?(b.add(k),u(h)?s(O,h,[d,v,k],!0):e(N,v,[h,d,k],!0),!0):!1}},createAddPassiveInputConnectionToAudioNode=s=>(e,t,[n,r,i],o)=>{const a=e.get(n);a===void 0?e.set(n,new Set([[r,t,i]])):s(a,[r,t,i],c=>c[0]===r&&c[1]===t,o)},createAddSilentConnection=s=>(e,t)=>{const n=s(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const r=()=>{t.removeEventListener("ended",r),t.disconnect(n),n.disconnect()};t.addEventListener("ended",r)},createAddUnrenderedAudioWorkletNode=s=>(e,t)=>{s(e).add(t)},DEFAULT_OPTIONS$j={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},createAnalyserNodeConstructor=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=r(a),u={...DEFAULT_OPTIONS$j,...c},p=n(l,u),g=i(l)?e():null;super(a,!1,p,g),this._nativeAnalyserNode=p}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},isOwnedByContext=(s,e)=>s.context===e,createAnalyserNodeRendererFactory=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=s(o,l)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},testAudioBufferCopyChannelMethodsOutOfBoundsSupport=s=>{try{s.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},createIndexSizeError=()=>new DOMException("","IndexSizeError"),wrapAudioBufferGetChannelDataMethod=s=>{s.getChannelData=(e=>t=>{try{return e.call(s,t)}catch(n){throw n.code===12?createIndexSizeError():n}})(s.getChannelData)},DEFAULT_OPTIONS$i={numberOfChannels:1},createAudioBufferConstructor=(s,e,t,n,r,i,o,a)=>{let c=null;return class dr{constructor(u){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:p,numberOfChannels:g,sampleRate:y}={...DEFAULT_OPTIONS$i,...u};c===null&&(c=new r(1,1,44100));const h=n!==null&&e(i,i)?new n({length:p,numberOfChannels:g,sampleRate:y}):c.createBuffer(g,p,y);if(h.numberOfChannels===0)throw t();return typeof h.copyFromChannel!="function"?(o(h),wrapAudioBufferGetChannelDataMethod(h)):e(testAudioBufferCopyChannelMethodsOutOfBoundsSupport,()=>testAudioBufferCopyChannelMethodsOutOfBoundsSupport(h))||a(h),s.add(h),h}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===dr.prototype||s.has(u)}}},MOST_NEGATIVE_SINGLE_FLOAT=-34028234663852886e22,MOST_POSITIVE_SINGLE_FLOAT=-MOST_NEGATIVE_SINGLE_FLOAT,isActiveAudioNode=s=>ACTIVE_AUDIO_NODE_STORE.has(s),DEFAULT_OPTIONS$h={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},createAudioBufferSourceNodeConstructor=(s,e,t,n,r,i,o,a)=>class extends s{constructor(l,u){const p=i(l),g={...DEFAULT_OPTIONS$h,...u},y=r(p,g),h=o(p),f=h?e():null;super(l,!1,y,f),this._audioBufferSourceNodeRenderer=f,this._isBufferNullified=!1,this._isBufferSet=g.buffer!==null,this._nativeAudioBufferSourceNode=y,this._onended=null,this._playbackRate=t(this,h,y.playbackRate,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const p=this._nativeAudioBufferSourceNode.onended;this._onended=p!==null&&p===u?l:p}get playbackRate(){return this._playbackRate}start(l=0,u=0,p){if(this._nativeAudioBufferSourceNode.start(l,u,p),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=p===void 0?[l,u]:[l,u,p]),this.context.state!=="closed"){setInternalStateToActive(this);const g=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",g),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",g)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},createAudioBufferSourceNodeRendererFactory=(s,e,t,n,r)=>()=>{const i=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let p=t(l);const g=isOwnedByContext(p,u);if(!g){const y={buffer:p.buffer,channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,loop:p.loop,loopEnd:p.loopEnd,loopStart:p.loopStart,playbackRate:p.playbackRate.value};p=e(u,y),o!==null&&p.start(...o),a!==null&&p.stop(a)}return i.set(u,p),g?await s(u,l.playbackRate,p.playbackRate):await n(u,l.playbackRate,p.playbackRate),await r(l,u,p),p};return{set start(l){o=l},set stop(l){a=l},render(l,u){const p=i.get(u);return p!==void 0?Promise.resolve(p):c(l,u)}}},isAudioBufferSourceNode=s=>"playbackRate"in s,isBiquadFilterNode=s=>"frequency"in s&&"gain"in s,isConstantSourceNode=s=>"offset"in s,isGainNode=s=>!("frequency"in s)&&"gain"in s,isOscillatorNode=s=>"detune"in s&&"frequency"in s,isStereoPannerNode=s=>"pan"in s,getAudioNodeConnections=s=>getValueForKey(AUDIO_NODE_CONNECTIONS_STORE,s),getAudioParamConnections=s=>getValueForKey(AUDIO_PARAM_CONNECTIONS_STORE,s),deactivateActiveAudioNodeInputConnections=(s,e)=>{const{activeInputs:t}=getAudioNodeConnections(s);t.forEach(r=>r.forEach(([i])=>{e.includes(s)||deactivateActiveAudioNodeInputConnections(i,[...e,s])}));const n=isAudioBufferSourceNode(s)?[s.playbackRate]:isAudioWorkletNode(s)?Array.from(s.parameters.values()):isBiquadFilterNode(s)?[s.Q,s.detune,s.frequency,s.gain]:isConstantSourceNode(s)?[s.offset]:isGainNode(s)?[s.gain]:isOscillatorNode(s)?[s.detune,s.frequency]:isStereoPannerNode(s)?[s.pan]:[];for(const r of n){const i=getAudioParamConnections(r);i!==void 0&&i.activeInputs.forEach(([o])=>deactivateActiveAudioNodeInputConnections(o,e))}isActiveAudioNode(s)&&setInternalStateToPassive(s)},deactivateAudioGraph=s=>{deactivateActiveAudioNodeInputConnections(s.destination,[])},isValidLatencyHint=s=>s===void 0||typeof s=="number"||typeof s=="string"&&(s==="balanced"||s==="interactive"||s==="playback"),createAudioContextConstructor=(s,e,t,n,r,i,o,a,c)=>class extends s{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let p;try{p=new c(u)}catch(h){throw h.code===12&&h.message==="sampleRate is not in range"?t():h}if(p===null)throw n();if(!isValidLatencyHint(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&p.sampleRate!==u.sampleRate)throw t();super(p,2);const{latencyHint:g}=u,{sampleRate:y}=p;if(this._baseLatency=typeof p.baseLatency=="number"?p.baseLatency:g==="balanced"?512/y:g==="interactive"||g===void 0?256/y:g==="playback"?1024/y:Math.max(2,Math.min(128,Math.round(g*y/128)))*128/y,this._nativeAudioContext=p,c.name==="webkitAudioContext"?(this._nativeGainNode=p.createGain(),this._nativeOscillatorNode=p.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(p.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,p.state==="running"){this._state="suspended";const h=()=>{this._state==="suspended"&&(this._state=null),p.removeEventListener("statechange",h)};p.addEventListener("statechange",h)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),deactivateAudioGraph(this)}))}createMediaElementSource(u){return new r(this,{mediaElement:u})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,p)=>{const g=()=>{this._nativeAudioContext.removeEventListener("statechange",g),this._nativeAudioContext.state==="running"?u():this.resume().then(u,p)};this._nativeAudioContext.addEventListener("statechange",g)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},createAudioDestinationNodeConstructor=(s,e,t,n,r,i,o,a)=>class extends s{constructor(l,u){const p=i(l),g=o(p),y=r(p,u,g),h=g?e(a):null;super(l,!1,y,h),this._isNodeOfNativeOfflineAudioContext=g,this._nativeAudioDestinationNode=y}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},createAudioDestinationNodeRenderer=s=>{const e=new WeakMap,t=async(n,r)=>{const i=r.destination;return e.set(r,i),await s(n,r,i),i};return{render(n,r){const i=e.get(r);return i!==void 0?Promise.resolve(i):t(n,r)}}},createAudioListenerFactory=(s,e,t,n,r,i,o,a)=>(c,l)=>{const u=l.listener,p=()=>{const m=new Float32Array(1),b=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),k=o(l);let T=!1,S=[0,0,-1,0,1,0],F=[0,0,0];const P=()=>{if(T)return;T=!0;const K=n(l,256,9,0);K.onaudioprocess=({inputBuffer:Q})=>{const ne=[i(Q,m,0),i(Q,m,1),i(Q,m,2),i(Q,m,3),i(Q,m,4),i(Q,m,5)];ne.some(($,J)=>$!==S[J])&&(u.setOrientation(...ne),S=ne);const D=[i(Q,m,6),i(Q,m,7),i(Q,m,8)];D.some(($,J)=>$!==F[J])&&(u.setPosition(...D),F=D)},b.connect(K)},G=K=>Q=>{Q!==S[K]&&(S[K]=Q,u.setOrientation(...S))},j=K=>Q=>{Q!==F[K]&&(F[K]=Q,u.setPosition(...F))},L=(K,Q,ne)=>{const D=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Q});D.connect(b,0,K),D.start(),Object.defineProperty(D.offset,"defaultValue",{get(){return Q}});const $=s({context:c},k,D.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT);return a($,"value",J=>()=>J.call($),J=>re=>{try{J.call($,re)}catch(pe){if(pe.code!==9)throw pe}P(),k&&ne(re)}),$.cancelAndHoldAtTime=(J=>k?()=>{throw r()}:(...re)=>{const pe=J.apply($,re);return P(),pe})($.cancelAndHoldAtTime),$.cancelScheduledValues=(J=>k?()=>{throw r()}:(...re)=>{const pe=J.apply($,re);return P(),pe})($.cancelScheduledValues),$.exponentialRampToValueAtTime=(J=>k?()=>{throw r()}:(...re)=>{const pe=J.apply($,re);return P(),pe})($.exponentialRampToValueAtTime),$.linearRampToValueAtTime=(J=>k?()=>{throw r()}:(...re)=>{const pe=J.apply($,re);return P(),pe})($.linearRampToValueAtTime),$.setTargetAtTime=(J=>k?()=>{throw r()}:(...re)=>{const pe=J.apply($,re);return P(),pe})($.setTargetAtTime),$.setValueAtTime=(J=>k?()=>{throw r()}:(...re)=>{const pe=J.apply($,re);return P(),pe})($.setValueAtTime),$.setValueCurveAtTime=(J=>k?()=>{throw r()}:(...re)=>{const pe=J.apply($,re);return P(),pe})($.setValueCurveAtTime),$};return{forwardX:L(0,0,G(0)),forwardY:L(1,0,G(1)),forwardZ:L(2,-1,G(2)),positionX:L(6,0,j(0)),positionY:L(7,0,j(1)),positionZ:L(8,0,j(2)),upX:L(3,0,G(3)),upY:L(4,1,G(4)),upZ:L(5,0,G(5))}},{forwardX:g,forwardY:y,forwardZ:h,positionX:f,positionY:d,positionZ:v,upX:E,upY:O,upZ:N}=u.forwardX===void 0?p():u;return{get forwardX(){return g},get forwardY(){return y},get forwardZ(){return h},get positionX(){return f},get positionY(){return d},get positionZ(){return v},get upX(){return E},get upY(){return O},get upZ(){return N}}},isAudioNode$1=s=>"context"in s,isAudioNodeOutputConnection=s=>isAudioNode$1(s[0]),insertElementInSet=(s,e,t,n)=>{for(const r of s)if(t(r)){if(n)return!1;throw Error("The set contains at least one similar element.")}return s.add(e),!0},addActiveInputConnectionToAudioParam=(s,e,[t,n],r)=>{insertElementInSet(s,[e,t,n],i=>i[0]===e&&i[1]===t,r)},addPassiveInputConnectionToAudioParam=(s,[e,t,n],r)=>{const i=s.get(e);i===void 0?s.set(e,new Set([[t,n]])):insertElementInSet(i,[t,n],o=>o[0]===t,r)},isNativeAudioNodeFaker=s=>"inputs"in s,connectNativeAudioNodeToNativeAudioNode=(s,e,t,n)=>{if(isNativeAudioNodeFaker(e)){const r=e.inputs[n];return s.connect(r,t,0),[r,t,0]}return s.connect(e,t,n),[e,t,n]},deleteActiveInputConnection=(s,e,t)=>{for(const n of s)if(n[0]===e&&n[1]===t)return s.delete(n),n;return null},deleteActiveInputConnectionToAudioParam=(s,e,t)=>pickElementFromSet(s,n=>n[0]===e&&n[1]===t),deleteEventListenerOfAudioNode=(s,e)=>{if(!getEventListenersOfAudioNode(s).delete(e))throw new Error("Missing the expected event listener.")},deletePassiveInputConnectionToAudioParam=(s,e,t)=>{const n=getValueForKey(s,e),r=pickElementFromSet(n,i=>i[0]===t);return n.size===0&&s.delete(e),r},disconnectNativeAudioNodeFromNativeAudioNode=(s,e,t,n)=>{isNativeAudioNodeFaker(e)?s.disconnect(e.inputs[n],t,0):s.disconnect(e,t,n)},getNativeAudioNode=s=>getValueForKey(AUDIO_NODE_STORE,s),getNativeAudioParam=s=>getValueForKey(AUDIO_PARAM_STORE,s),isPartOfACycle=s=>CYCLE_COUNTERS.has(s),isPassiveAudioNode=s=>!ACTIVE_AUDIO_NODE_STORE.has(s),testAudioNodeDisconnectMethodSupport=(s,e)=>new Promise(t=>{if(e!==null)t(!0);else{const n=s.createScriptProcessor(256,1,1),r=s.createGain(),i=s.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const a=s.createBufferSource();a.buffer=i,a.loop=!0,a.connect(n).connect(s.destination),a.connect(r),a.disconnect(r),n.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),n.onaudioprocess=null,a.disconnect(n),n.disconnect(s.destination)},a.start()}}),visitEachAudioNodeOnce=(s,e)=>{const t=new Map;for(const n of s)for(const r of n){const i=t.get(r);t.set(r,i===void 0?1:i+1)}t.forEach((n,r)=>e(r,n))},isNativeAudioNode$1=s=>"context"in s,wrapAudioNodeDisconnectMethod=s=>{const e=new Map;s.connect=(t=>(n,r=0,i=0)=>{const o=isNativeAudioNode$1(n)?t(n,r,i):t(n,r),a=e.get(n);return a===void 0?e.set(n,[{input:i,output:r}]):a.every(c=>c.input!==i||c.output!==r)&&a.push({input:i,output:r}),o})(s.connect.bind(s)),s.disconnect=(t=>(n,r,i)=>{if(t.apply(s),n===void 0)e.clear();else if(typeof n=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==n);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(n))if(r===void 0)e.delete(n);else{const o=e.get(n);if(o!==void 0){const a=o.filter(c=>c.output!==r&&(c.input!==i||i===void 0));a.length===0?e.delete(n):e.set(n,a)}}for(const[o,a]of e)a.forEach(c=>{isNativeAudioNode$1(o)?s.connect(o,c.output,c.input):s.connect(o,c.output)})})(s.disconnect)},addConnectionToAudioParamOfAudioContext=(s,e,t,n)=>{const{activeInputs:r,passiveInputs:i}=getAudioParamConnections(e),{outputs:o}=getAudioNodeConnections(s),a=getEventListenersOfAudioNode(s),c=l=>{const u=getNativeAudioNode(s),p=getNativeAudioParam(e);if(l){const g=deletePassiveInputConnectionToAudioParam(i,s,t);addActiveInputConnectionToAudioParam(r,s,g,!1),!n&&!isPartOfACycle(s)&&u.connect(p,t)}else{const g=deleteActiveInputConnectionToAudioParam(r,s,t);addPassiveInputConnectionToAudioParam(i,g,!1),!n&&!isPartOfACycle(s)&&u.disconnect(p,t)}};return insertElementInSet(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),isActiveAudioNode(s)?addActiveInputConnectionToAudioParam(r,s,[t,c],!0):addPassiveInputConnectionToAudioParam(i,[s,t,c],!0),!0):!1},deleteInputConnectionOfAudioNode=(s,e,t,n)=>{const{activeInputs:r,passiveInputs:i}=getAudioNodeConnections(e),o=deleteActiveInputConnection(r[n],s,t);return o===null?[deletePassiveInputConnectionToAudioNode(i,s,t,n)[2],!1]:[o[2],!0]},deleteInputConnectionOfAudioParam=(s,e,t)=>{const{activeInputs:n,passiveInputs:r}=getAudioParamConnections(e),i=deleteActiveInputConnection(n,s,t);return i===null?[deletePassiveInputConnectionToAudioParam(r,s,t)[1],!1]:[i[2],!0]},deleteInputsOfAudioNode=(s,e,t,n,r)=>{const[i,o]=deleteInputConnectionOfAudioNode(s,t,n,r);if(i!==null&&(deleteEventListenerOfAudioNode(s,i),o&&!e&&!isPartOfACycle(s)&&disconnectNativeAudioNodeFromNativeAudioNode(getNativeAudioNode(s),getNativeAudioNode(t),n,r)),isActiveAudioNode(t)){const{activeInputs:a}=getAudioNodeConnections(t);setInternalStateToPassiveWhenNecessary(t,a)}},deleteInputsOfAudioParam=(s,e,t,n)=>{const[r,i]=deleteInputConnectionOfAudioParam(s,t,n);r!==null&&(deleteEventListenerOfAudioNode(s,r),i&&!e&&!isPartOfACycle(s)&&getNativeAudioNode(s).disconnect(getNativeAudioParam(t),n))},deleteAnyConnection=(s,e)=>{const t=getAudioNodeConnections(s),n=[];for(const r of t.outputs)isAudioNodeOutputConnection(r)?deleteInputsOfAudioNode(s,e,...r):deleteInputsOfAudioParam(s,e,...r),n.push(r[0]);return t.outputs.clear(),n},deleteConnectionAtOutput=(s,e,t)=>{const n=getAudioNodeConnections(s),r=[];for(const i of n.outputs)i[1]===t&&(isAudioNodeOutputConnection(i)?deleteInputsOfAudioNode(s,e,...i):deleteInputsOfAudioParam(s,e,...i),r.push(i[0]),n.outputs.delete(i));return r},deleteConnectionToDestination=(s,e,t,n,r)=>{const i=getAudioNodeConnections(s);return Array.from(i.outputs).filter(o=>o[0]===t&&(n===void 0||o[1]===n)&&(r===void 0||o[2]===r)).map(o=>(isAudioNodeOutputConnection(o)?deleteInputsOfAudioNode(s,e,...o):deleteInputsOfAudioParam(s,e,...o),i.outputs.delete(o),o[0]))},createAudioNodeConstructor=(s,e,t,n,r,i,o,a,c,l,u,p,g,y,h,f)=>class extends l{constructor(v,E,O,N){super(O),this._context=v,this._nativeAudioNode=O;const m=u(v);p(m)&&t(testAudioNodeDisconnectMethodSupport,()=>testAudioNodeDisconnectMethodSupport(m,f))!==!0&&wrapAudioNodeDisconnectMethod(O),AUDIO_NODE_STORE.set(this,O),EVENT_LISTENERS.set(this,new Set),v.state!=="closed"&&E&&setInternalStateToActive(this),s(this,N,O)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,E=0,O=0){if(E<0||E>=this._nativeAudioNode.numberOfOutputs)throw r();const N=u(this._context),m=h(N);if(g(v)||y(v))throw i();if(isAudioNode$1(v)){const T=getNativeAudioNode(v);try{const F=connectNativeAudioNodeToNativeAudioNode(this._nativeAudioNode,T,E,O),P=isPassiveAudioNode(this);(m||P)&&this._nativeAudioNode.disconnect(...F),this.context.state!=="closed"&&!P&&isPassiveAudioNode(v)&&setInternalStateToActive(v)}catch(F){throw F.code===12?i():F}if(e(this,v,E,O,m)){const F=c([this],v);visitEachAudioNodeOnce(F,n(m))}return v}const b=getNativeAudioParam(v);if(b.name==="playbackRate"&&b.maxValue===1024)throw o();try{this._nativeAudioNode.connect(b,E),(m||isPassiveAudioNode(this))&&this._nativeAudioNode.disconnect(b,E)}catch(T){throw T.code===12?i():T}if(addConnectionToAudioParamOfAudioContext(this,v,E,m)){const T=c([this],v);visitEachAudioNodeOnce(T,n(m))}}disconnect(v,E,O){let N;const m=u(this._context),b=h(m);if(v===void 0)N=deleteAnyConnection(this,b);else if(typeof v=="number"){if(v<0||v>=this.numberOfOutputs)throw r();N=deleteConnectionAtOutput(this,b,v)}else{if(E!==void 0&&(E<0||E>=this.numberOfOutputs)||isAudioNode$1(v)&&O!==void 0&&(O<0||O>=v.numberOfInputs))throw r();if(N=deleteConnectionToDestination(this,b,v,E,O),N.length===0)throw i()}for(const k of N){const T=c([this],k);visitEachAudioNodeOnce(T,a)}}},createAudioParamFactory=(s,e,t,n,r,i,o,a,c,l,u,p,g)=>(y,h,f,d=null,v=null)=>{const E=f.value,O=new AutomationEventList(E),N=h?n(O):null,m={get defaultValue(){return E},get maxValue(){return d===null?f.maxValue:d},get minValue(){return v===null?f.minValue:v},get value(){return f.value},set value(b){f.value=b,m.setValueAtTime(b,y.context.currentTime)},cancelAndHoldAtTime(b){if(typeof f.cancelAndHoldAtTime=="function")N===null&&O.flush(y.context.currentTime),O.add(r(b)),f.cancelAndHoldAtTime(b);else{const k=Array.from(O).pop();N===null&&O.flush(y.context.currentTime),O.add(r(b));const T=Array.from(O).pop();f.cancelScheduledValues(b),k!==T&&T!==void 0&&(T.type==="exponentialRampToValue"?f.exponentialRampToValueAtTime(T.value,T.endTime):T.type==="linearRampToValue"?f.linearRampToValueAtTime(T.value,T.endTime):T.type==="setValue"?f.setValueAtTime(T.value,T.startTime):T.type==="setValueCurve"&&f.setValueCurveAtTime(T.values,T.startTime,T.duration))}return m},cancelScheduledValues(b){return N===null&&O.flush(y.context.currentTime),O.add(i(b)),f.cancelScheduledValues(b),m},exponentialRampToValueAtTime(b,k){if(b===0)throw new RangeError;if(!Number.isFinite(k)||k<0)throw new RangeError;const T=y.context.currentTime;return N===null&&O.flush(T),Array.from(O).length===0&&(O.add(l(E,T)),f.setValueAtTime(E,T)),O.add(o(b,k)),f.exponentialRampToValueAtTime(b,k),m},linearRampToValueAtTime(b,k){const T=y.context.currentTime;return N===null&&O.flush(T),Array.from(O).length===0&&(O.add(l(E,T)),f.setValueAtTime(E,T)),O.add(a(b,k)),f.linearRampToValueAtTime(b,k),m},setTargetAtTime(b,k,T){return N===null&&O.flush(y.context.currentTime),O.add(c(b,k,T)),f.setTargetAtTime(b,k,T),m},setValueAtTime(b,k){return N===null&&O.flush(y.context.currentTime),O.add(l(b,k)),f.setValueAtTime(b,k),m},setValueCurveAtTime(b,k,T){const S=b instanceof Float32Array?b:new Float32Array(b);if(p!==null&&p.name==="webkitAudioContext"){const F=k+T,P=y.context.sampleRate,G=Math.ceil(k*P),j=Math.floor(F*P),L=j-G,K=new Float32Array(L);for(let ne=0;ne<L;ne+=1){const D=(S.length-1)/T*((G+ne)/P-k),$=Math.floor(D),J=Math.ceil(D);K[ne]=$===J?S[$]:(1-(D-$))*S[$]+(1-(J-D))*S[J]}N===null&&O.flush(y.context.currentTime),O.add(u(K,k,T)),f.setValueCurveAtTime(K,k,T);const Q=j/P;Q<F&&g(m,K[K.length-1],Q),g(m,S[S.length-1],F)}else N===null&&O.flush(y.context.currentTime),O.add(u(S,k,T)),f.setValueCurveAtTime(S,k,T);return m}};return t.set(m,f),e.set(m,y),s(m,N),m},createAudioParamRenderer=s=>({replay(e){for(const t of s)if(t.type==="exponentialRampToValue"){const{endTime:n,value:r}=t;e.exponentialRampToValueAtTime(r,n)}else if(t.type==="linearRampToValue"){const{endTime:n,value:r}=t;e.linearRampToValueAtTime(r,n)}else if(t.type==="setTarget"){const{startTime:n,target:r,timeConstant:i}=t;e.setTargetAtTime(r,n,i)}else if(t.type==="setValue"){const{startTime:n,value:r}=t;e.setValueAtTime(r,n)}else if(t.type==="setValueCurve"){const{duration:n,startTime:r,values:i}=t;e.setValueCurveAtTime(i,r,n)}else throw new Error("Can't apply an unknown automation.")}});class ReadOnlyMap{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,r)=>e.call(t,n,r,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const DEFAULT_OPTIONS$g={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},createAudioWorkletNodeConstructor=(s,e,t,n,r,i,o,a,c,l,u,p,g,y)=>class extends e{constructor(f,d,v){var E;const O=a(f),N=c(O),m=u({...DEFAULT_OPTIONS$g,...v});g(m);const b=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(O),k=b==null?void 0:b.get(d),T=N||O.state!=="closed"?O:(E=o(O))!==null&&E!==void 0?E:O,S=r(T,N?null:f.baseLatency,l,d,k,m),F=N?n(d,m,k):null;super(f,!0,S,F);const P=[];S.parameters.forEach((j,L)=>{const K=t(this,N,j);P.push([L,K])}),this._nativeAudioWorkletNode=S,this._onprocessorerror=null,this._parameters=new ReadOnlyMap(P),N&&s(O,this);const{activeInputs:G}=i(this);p(S,G)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(f){const d=typeof f=="function"?y(this,f):null;this._nativeAudioWorkletNode.onprocessorerror=d;const v=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=v!==null&&v===d?f:v}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function copyFromChannel(s,e,t,n,r){if(typeof s.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),s.copyFromChannel(e[t],n,r);else{const i=s.getChannelData(n);if(e[t].byteLength===0)e[t]=i.slice(r,r+128);else{const o=new Float32Array(i.buffer,r*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const copyToChannel=(s,e,t,n,r)=>{typeof s.copyToChannel=="function"?e[t].byteLength!==0&&s.copyToChannel(e[t],n,r):e[t].byteLength!==0&&s.getChannelData(n).set(e[t],r)},createNestedArrays=(s,e)=>{const t=[];for(let n=0;n<s;n+=1){const r=[],i=typeof e=="number"?e:e[n];for(let o=0;o<i;o+=1)r.push(new Float32Array(128));t.push(r)}return t},getAudioWorkletProcessor=(s,e)=>{const t=getValueForKey(NODE_TO_PROCESSOR_MAPS,s),n=getNativeAudioNode(e);return getValueForKey(t,n)},processBuffer=async(s,e,t,n,r,i,o)=>{const a=e===null?Math.ceil(s.context.length/128)*128:e.length,c=n.channelCount*n.numberOfInputs,l=r.reduce((d,v)=>d+v,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const p=getAudioNodeConnections(s),g=await getAudioWorkletProcessor(t,s),y=createNestedArrays(n.numberOfInputs,n.channelCount),h=createNestedArrays(n.numberOfOutputs,r),f=Array.from(s.parameters.keys()).reduce((d,v)=>({...d,[v]:new Float32Array(128)}),{});for(let d=0;d<a;d+=128){if(n.numberOfInputs>0&&e!==null)for(let v=0;v<n.numberOfInputs;v+=1)for(let E=0;E<n.channelCount;E+=1)copyFromChannel(e,y[v],E,E,d);i.parameterDescriptors!==void 0&&e!==null&&i.parameterDescriptors.forEach(({name:v},E)=>{copyFromChannel(e,f,v,c+E,d)});for(let v=0;v<n.numberOfInputs;v+=1)for(let E=0;E<r[v];E+=1)h[v][E].byteLength===0&&(h[v][E]=new Float32Array(128));try{const v=y.map((O,N)=>p.activeInputs[N].size===0?[]:O),E=o(d/t.sampleRate,t.sampleRate,()=>g.process(v,h,f));if(u!==null)for(let O=0,N=0;O<n.numberOfOutputs;O+=1){for(let m=0;m<r[O];m+=1)copyToChannel(u,h[O],m,N+m,d);N+=r[O]}if(!E)break}catch(v){s.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return u},createAudioWorkletNodeRendererFactory=(s,e,t,n,r,i,o,a,c,l,u,p,g,y,h,f)=>(d,v,E)=>{const O=new WeakMap;let N=null;const m=async(b,k)=>{let T=u(b),S=null;const F=isOwnedByContext(T,k),P=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(p===null){const G=P.reduce((Q,ne)=>Q+ne,0),j=r(k,{channelCount:Math.max(1,G),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,G)}),L=[];for(let Q=0;Q<b.numberOfOutputs;Q+=1)L.push(n(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:P[Q]}));const K=o(k,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});K.connect=e.bind(null,L),K.disconnect=c.bind(null,L),S=[j,L,K]}else F||(T=new p(k,d));if(O.set(k,S===null?T:S[2]),S!==null){if(N===null){if(E===void 0)throw new Error("Missing the processor constructor.");if(g===null)throw new Error("Missing the native OfflineAudioContext constructor.");const ne=b.channelCount*b.numberOfInputs,D=E.parameterDescriptors===void 0?0:E.parameterDescriptors.length,$=ne+D;N=processBuffer(b,$===0?null:await(async()=>{const re=new g($,Math.ceil(b.context.length/128)*128,k.sampleRate),pe=[],U=[];for(let R=0;R<v.numberOfInputs;R+=1)pe.push(o(re,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),U.push(r(re,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const w=await Promise.all(Array.from(b.parameters.values()).map(async R=>{const V=i(re,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:R.value});return await y(re,R,V.offset),V})),_=n(re,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,ne+D)});for(let R=0;R<v.numberOfInputs;R+=1){pe[R].connect(U[R]);for(let V=0;V<v.channelCount;V+=1)U[R].connect(_,V,R*v.channelCount+V)}for(const[R,V]of w.entries())V.connect(_,0,ne+R),V.start(0);return _.connect(re.destination),await Promise.all(pe.map(R=>h(b,re,R))),f(re)})(),k,v,P,E,l)}const G=await N,j=t(k,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[L,K,Q]=S;G!==null&&(j.buffer=G,j.start(0)),j.connect(L);for(let ne=0,D=0;ne<b.numberOfOutputs;ne+=1){const $=K[ne];for(let J=0;J<P[ne];J+=1)L.connect($,D+J,J);D+=P[ne]}return Q}if(F)for(const[G,j]of b.parameters.entries())await s(k,j,T.parameters.get(G));else for(const[G,j]of b.parameters.entries())await y(k,j,T.parameters.get(G));return await h(b,k,T),T};return{render(b,k){a(k,b);const T=O.get(k);return T!==void 0?Promise.resolve(T):m(b,k)}}},createBaseAudioContextConstructor=(s,e,t,n,r,i,o,a,c,l,u,p,g,y,h,f,d,v,E,O)=>class extends h{constructor(m,b){super(m,b),this._nativeContext=m,this._audioWorklet=s===void 0?void 0:{addModule:(k,T)=>s(this,k,T)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new r(this)}createBuffer(m,b,k){return new t({length:b,numberOfChannels:m,sampleRate:k})}createBufferSource(){return new n(this)}createChannelMerger(m=6){return new i(this,{numberOfInputs:m})}createChannelSplitter(m=6){return new o(this,{numberOfOutputs:m})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(m=1){return new u(this,{maxDelayTime:m})}createDynamicsCompressor(){return new p(this)}createGain(){return new g(this)}createIIRFilter(m,b){return new y(this,{feedback:b,feedforward:m})}createOscillator(){return new f(this)}createPanner(){return new d(this)}createPeriodicWave(m,b,k={disableNormalization:!1}){return new v(this,{...k,imag:b,real:m})}createStereoPanner(){return new E(this)}createWaveShaper(){return new O(this)}decodeAudioData(m,b,k){return l(this._nativeContext,m).then(T=>(typeof b=="function"&&b(T),T),T=>{throw typeof k=="function"&&k(T),T})}},DEFAULT_OPTIONS$f={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},createBiquadFilterNodeConstructor=(s,e,t,n,r,i,o,a)=>class extends s{constructor(l,u){const p=i(l),g={...DEFAULT_OPTIONS$f,...u},y=r(p,g),h=o(p),f=h?t():null;super(l,!1,y,f),this._Q=e(this,h,y.Q,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._detune=e(this,h,y.detune,1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT),-1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT)),this._frequency=e(this,h,y.frequency,l.sampleRate/2,0),this._gain=e(this,h,y.gain,40*Math.log10(MOST_POSITIVE_SINGLE_FLOAT),MOST_NEGATIVE_SINGLE_FLOAT),this._nativeBiquadFilterNode=y,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,p){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,p)}catch(g){throw g.code===11?n():g}if(l.length!==u.length||u.length!==p.length)throw n()}},createBiquadFilterNodeRendererFactory=(s,e,t,n,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=isOwnedByContext(l,c);if(!u){const p={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,p)}return i.set(c,l),u?(await s(c,a.Q,l.Q),await s(c,a.detune,l.detune),await s(c,a.frequency,l.frequency),await s(c,a.gain,l.gain)):(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},createCacheTestResult=(s,e)=>(t,n)=>{const r=e.get(t);if(r!==void 0)return r;const i=s.get(t);if(i!==void 0)return i;try{const o=n();return o instanceof Promise?(s.set(t,o),o.catch(()=>!1).then(a=>(s.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},DEFAULT_OPTIONS$e={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},createChannelMergerNodeConstructor=(s,e,t,n,r)=>class extends s{constructor(o,a){const c=n(o),l={...DEFAULT_OPTIONS$e,...a},u=t(c,l),p=r(c)?e():null;super(o,!1,u,p)}},createChannelMergerNodeRendererFactory=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=s(o,l)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},DEFAULT_OPTIONS$d={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},createChannelSplitterNodeConstructor=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=n(a),u=i({...DEFAULT_OPTIONS$d,...c}),p=t(l,u),g=r(l)?e():null;super(a,!1,p,g)}},createChannelSplitterNodeRendererFactory=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=s(o,l)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},createConnectAudioParam=s=>(e,t,n)=>s(t,e,n),createConnectMultipleOutputs=s=>(e,t,n=0,r=0)=>{const i=e[n];if(i===void 0)throw s();return isNativeAudioNode$1(t)?i.connect(t,0,r):i.connect(t,0)},createConnectedNativeAudioBufferSourceNodeFactory=s=>(e,t)=>{const n=s(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=e.createBuffer(1,2,44100);return n.buffer=r,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}},DEFAULT_OPTIONS$c={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},createConstantSourceNodeConstructor=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),p={...DEFAULT_OPTIONS$c,...l},g=n(u,p),y=i(u),h=y?t():null;super(c,!1,g,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=g,this._offset=e(this,y,g.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){setInternalStateToActive(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},createConstantSourceNodeRendererFactory=(s,e,t,n,r)=>()=>{const i=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let p=t(l);const g=isOwnedByContext(p,u);if(!g){const y={channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,offset:p.offset.value};p=e(u,y),o!==null&&p.start(o),a!==null&&p.stop(a)}return i.set(u,p),g?await s(u,l.offset,p.offset):await n(u,l.offset,p.offset),await r(l,u,p),p};return{set start(l){o=l},set stop(l){a=l},render(l,u){const p=i.get(u);return p!==void 0?Promise.resolve(p):c(l,u)}}},createConvertNumberToUnsignedLong=s=>e=>(s[0]=e,s[0]),DEFAULT_OPTIONS$b={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},createConvolverNodeConstructor=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=n(a),u={...DEFAULT_OPTIONS$b,...c},p=t(l,u),y=r(l)?e():null;super(a,!1,p,y),this._isBufferNullified=!1,this._nativeConvolverNode=p,u.buffer!==null&&i(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},createConvolverNodeRendererFactory=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=s(o,l)}return n.set(o,a),isNativeAudioNodeFaker(a)?await t(i,o,a.inputs[0]):await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},createCreateNativeOfflineAudioContext=(s,e)=>(t,n,r)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,r)}catch(i){throw i.name==="SyntaxError"?s():i}},createDataCloneError=()=>new DOMException("","DataCloneError"),detachArrayBuffer=s=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{const r=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>r();try{e.postMessage(s,[s])}catch{}finally{r()}})},createDecodeAudioData=(s,e,t,n,r,i,o,a,c,l,u)=>(p,g)=>{const y=o(p)?p:i(p);if(r.has(g)){const h=t();return Promise.reject(h)}try{r.add(g)}catch{}return e(c,()=>c(y))?y.decodeAudioData(g).then(h=>(detachArrayBuffer(g).catch(()=>{}),e(a,()=>a(h))||u(h),s.add(h),h)):new Promise((h,f)=>{const d=async()=>{try{await detachArrayBuffer(g)}catch{}},v=E=>{f(E),d()};try{y.decodeAudioData(g,E=>{typeof E.copyFromChannel!="function"&&(l(E),wrapAudioBufferGetChannelDataMethod(E)),s.add(E),d().then(()=>h(E))},E=>{v(E===null?n():E)})}catch(E){v(E)}})},createDecrementCycleCounter=(s,e,t,n,r,i,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const p=i(c.context),g=a(p);if(u===l){if(e.delete(c),!g&&o(c)){const y=n(c),{outputs:h}=t(c);for(const f of h)if(isAudioNodeOutputConnection(f)){const d=n(f[0]);s(y,d,f[1],f[2])}else{const d=r(f[0]);y.connect(d,f[1])}}}else e.set(c,u-l)},DEFAULT_OPTIONS$a={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},createDelayNodeConstructor=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),p={...DEFAULT_OPTIONS$a,...l},g=n(u,p),y=i(u),h=y?t(p.maxDelayTime):null;super(c,!1,g,h),this._delayTime=e(this,y,g.delayTime),o(this,p.maxDelayTime)}get delayTime(){return this._delayTime}},createDelayNodeRendererFactory=(s,e,t,n,r)=>i=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const p=isOwnedByContext(u,l);if(!p){const g={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:i};u=e(l,g)}return o.set(l,u),p?await s(l,c.delayTime,u.delayTime):await n(l,c.delayTime,u.delayTime),await r(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},createDeleteActiveInputConnectionToAudioNode=s=>(e,t,n,r)=>s(e[r],i=>i[0]===t&&i[1]===n),createDeleteUnrenderedAudioWorkletNode=s=>(e,t)=>{s(e).delete(t)},isDelayNode=s=>"delayTime"in s,createDetectCycles=(s,e,t)=>function n(r,i){const o=isAudioNode$1(i)?i:t(s,i);if(isDelayNode(o))return[];if(r[0]===o)return[r];if(r.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>n([...r,o],c[0])).reduce((c,l)=>c.concat(l),[])},getOutputAudioNodeAtIndex=(s,e,t)=>{const n=e[t];if(n===void 0)throw s();return n},createDisconnectMultipleOutputs=s=>(e,t=void 0,n=void 0,r=0)=>t===void 0?e.forEach(i=>i.disconnect()):typeof t=="number"?getOutputAudioNodeAtIndex(s,e,t).disconnect():isNativeAudioNode$1(t)?n===void 0?e.forEach(i=>i.disconnect(t)):r===void 0?getOutputAudioNodeAtIndex(s,e,n).disconnect(t,0):getOutputAudioNodeAtIndex(s,e,n).disconnect(t,0,r):n===void 0?e.forEach(i=>i.disconnect(t)):getOutputAudioNodeAtIndex(s,e,n).disconnect(t,0),DEFAULT_OPTIONS$9={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},createDynamicsCompressorNodeConstructor=(s,e,t,n,r,i,o,a)=>class extends s{constructor(l,u){const p=i(l),g={...DEFAULT_OPTIONS$9,...u},y=n(p,g),h=o(p),f=h?t():null;super(l,!1,y,f),this._attack=e(this,h,y.attack),this._knee=e(this,h,y.knee),this._nativeDynamicsCompressorNode=y,this._ratio=e(this,h,y.ratio),this._release=e(this,h,y.release),this._threshold=e(this,h,y.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,r()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,r()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},createDynamicsCompressorNodeRendererFactory=(s,e,t,n,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=isOwnedByContext(l,c);if(!u){const p={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,p)}return i.set(c,l),u?(await s(c,a.attack,l.attack),await s(c,a.knee,l.knee),await s(c,a.ratio,l.ratio),await s(c,a.release,l.release),await s(c,a.threshold,l.threshold)):(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},createEncodingError=()=>new DOMException("","EncodingError"),createEvaluateSource=s=>e=>new Promise((t,n)=>{if(s===null){n(new SyntaxError);return}const r=s.document.head;if(r===null)n(new SyntaxError);else{const i=s.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=s.onerror,l=()=>{s.onerror=c,URL.revokeObjectURL(a)};s.onerror=(u,p,g,y,h)=>{if(p===a||p===s.location.href&&g===1&&y===1)return l(),n(h),!1;if(c!==null)return c(u,p,g,y,h)},i.onerror=()=>{l(),n(new SyntaxError)},i.onload=()=>{l(),t()},i.src=a,i.type="module",r.appendChild(i)}}),createEventTargetConstructor=s=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,r){if(n!==null){let i=this._listeners.get(n);i===void 0&&(i=s(this,n),typeof n=="function"&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(t,i,r)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,r){const i=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,i===void 0?null:i,r)}},createExposeCurrentFrameAndCurrentTime=s=>(e,t,n)=>{Object.defineProperties(s,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{s!==null&&(delete s.currentFrame,delete s.currentTime)}},createFetchSource=s=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw s()},DEFAULT_OPTIONS$8={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},createGainNodeConstructor=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=r(a),u={...DEFAULT_OPTIONS$8,...c},p=n(l,u),g=i(l),y=g?t():null;super(a,!1,p,y),this._gain=e(this,g,p.gain,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get gain(){return this._gain}},createGainNodeRendererFactory=(s,e,t,n,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=isOwnedByContext(l,c);if(!u){const p={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,p)}return i.set(c,l),u?await s(c,a.gain,l.gain):await n(c,a.gain,l.gain),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},createGetActiveAudioWorkletNodeInputs=(s,e)=>t=>e(s,t),createGetAudioNodeRenderer=s=>e=>{const t=s(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},createGetAudioNodeTailTime=s=>e=>{var t;return(t=s.get(e))!==null&&t!==void 0?t:0},createGetAudioParamRenderer=s=>e=>{const t=s(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},createGetBackupOfflineAudioContext=s=>e=>s.get(e),createInvalidStateError=()=>new DOMException("","InvalidStateError"),createGetNativeContext=s=>e=>{const t=s.get(e);if(t===void 0)throw createInvalidStateError();return t},createGetOrCreateBackupOfflineAudioContext=(s,e)=>t=>{let n=s.get(t);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),s.set(t,n),n},createGetUnrenderedAudioWorkletNodes=s=>e=>{const t=s.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},createInvalidAccessError=()=>new DOMException("","InvalidAccessError"),wrapIIRFilterNodeGetFrequencyResponseMethod=s=>{s.getFrequencyResponse=(e=>(t,n,r)=>{if(t.length!==n.length||n.length!==r.length)throw createInvalidAccessError();return e.call(s,t,n,r)})(s.getFrequencyResponse)},DEFAULT_OPTIONS$7={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},createIIRFilterNodeConstructor=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=n(a),u=r(l),p={...DEFAULT_OPTIONS$7,...c},g=e(l,u?null:a.baseLatency,p),y=u?t(p.feedback,p.feedforward):null;super(a,!1,g,y),wrapIIRFilterNodeGetFrequencyResponseMethod(g),this._nativeIIRFilterNode=g,i(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},filterBuffer=(s,e,t,n,r,i,o,a,c,l,u)=>{const p=l.length;let g=a;for(let y=0;y<p;y+=1){let h=t[0]*l[y];for(let f=1;f<r;f+=1){const d=g-f&c-1;h+=t[f]*i[d],h-=s[f]*o[d]}for(let f=r;f<n;f+=1)h+=t[f]*i[g-f&c-1];for(let f=r;f<e;f+=1)h-=s[f]*o[g-f&c-1];i[g]=l[y],o[g]=h,g=g+1&c-1,u[y]=h}return g},filterFullBuffer=(s,e,t,n)=>{const r=t instanceof Float64Array?t:new Float64Array(t),i=n instanceof Float64Array?n:new Float64Array(n),o=r.length,a=i.length,c=Math.min(o,a);if(r[0]!==1){for(let h=0;h<o;h+=1)i[h]/=r[0];for(let h=1;h<a;h+=1)r[h]/=r[0]}const l=32,u=new Float32Array(l),p=new Float32Array(l),g=e.createBuffer(s.numberOfChannels,s.length,s.sampleRate),y=s.numberOfChannels;for(let h=0;h<y;h+=1){const f=s.getChannelData(h),d=g.getChannelData(h);u.fill(0),p.fill(0),filterBuffer(r,o,i,a,c,u,p,0,l,f,d)}return g},createIIRFilterNodeRendererFactory=(s,e,t,n,r)=>(i,o)=>{const a=new WeakMap;let c=null;const l=async(u,p)=>{let g=null,y=e(u);const h=isOwnedByContext(y,p);if(p.createIIRFilter===void 0?g=s(p,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):h||(y=p.createIIRFilter(o,i)),a.set(p,g===null?y:g),g!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const d=new t(u.context.destination.channelCount,u.context.length,p.sampleRate);c=(async()=>{await n(u,d,d.destination);const v=await r(d);return filterFullBuffer(v,p,i,o)})()}const f=await c;return g.buffer=f,g.start(0),g}return await n(u,p,y),y};return{render(u,p){const g=a.get(p);return g!==void 0?Promise.resolve(g):l(u,p)}}},createIncrementCycleCounterFactory=(s,e,t,n,r,i)=>o=>(a,c)=>{const l=s.get(a);if(l===void 0){if(!o&&i(a)){const u=n(a),{outputs:p}=t(a);for(const g of p)if(isAudioNodeOutputConnection(g)){const y=n(g[0]);e(u,y,g[1],g[2])}else{const y=r(g[0]);u.disconnect(y,g[1])}}s.set(a,c)}else s.set(a,l+c)},createIsAnyAudioContext=(s,e)=>t=>{const n=s.get(t);return e(n)||e(t)},createIsAnyAudioNode=(s,e)=>t=>s.has(t)||e(t),createIsAnyAudioParam=(s,e)=>t=>s.has(t)||e(t),createIsAnyOfflineAudioContext=(s,e)=>t=>{const n=s.get(t);return e(n)||e(t)},createIsNativeAudioContext=s=>e=>s!==null&&e instanceof s,createIsNativeAudioNode=s=>e=>s!==null&&typeof s.AudioNode=="function"&&e instanceof s.AudioNode,createIsNativeAudioParam=s=>e=>s!==null&&typeof s.AudioParam=="function"&&e instanceof s.AudioParam,createIsNativeContext=(s,e)=>t=>s(t)||e(t),createIsNativeOfflineAudioContext=s=>e=>s!==null&&e instanceof s,createIsSecureContext=s=>s!==null&&s.isSecureContext,createMediaElementAudioSourceNodeConstructor=(s,e,t,n)=>class extends s{constructor(i,o){const a=t(i),c=e(a,o);if(n(a))throw TypeError();super(i,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},DEFAULT_OPTIONS$6={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},createMediaStreamAudioDestinationNodeConstructor=(s,e,t,n)=>class extends s{constructor(i,o){const a=t(i);if(n(a))throw new TypeError;const c={...DEFAULT_OPTIONS$6,...o},l=e(a,c);super(i,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},createMediaStreamAudioSourceNodeConstructor=(s,e,t,n)=>class extends s{constructor(i,o){const a=t(i),c=e(a,o);if(n(a))throw new TypeError;super(i,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},createMediaStreamTrackAudioSourceNodeConstructor=(s,e,t)=>class extends s{constructor(r,i){const o=t(r),a=e(o,i);super(r,!0,a,null)}},createMinimalBaseAudioContextConstructor=(s,e,t,n,r,i)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,CONTEXT_STORE.set(this,a),n(a)&&r.set(a,new Set),this._destination=new s(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?i(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},testPromiseSupport=s=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=s.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},createMonitorConnections=(s,e)=>(t,n,r)=>{const i=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=i.size===0;if(e(a))return o.call(t,a,c,l),s(i,[a,c,l],p=>p[0]===a&&p[1]===c&&p[2]===l,!0),u&&n(),a;o.call(t,a,c),s(i,[a,c],p=>p[0]===a&&p[1]===c,!0),u&&n()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=i.size>0;if(a===void 0)o.apply(t),i.clear();else if(typeof a=="number"){o.call(t,a);for(const g of i)g[1]===a&&i.delete(g)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const g of i)g[0]===a&&(c===void 0||g[1]===c)&&(l===void 0||g[2]===l)&&i.delete(g)}const p=i.size===0;u&&p&&r()})(t.disconnect),t},assignNativeAudioNodeOption=(s,e,t)=>{const n=e[t];n!==void 0&&n!==s[t]&&(s[t]=n)},assignNativeAudioNodeOptions=(s,e)=>{assignNativeAudioNodeOption(s,e,"channelCount"),assignNativeAudioNodeOption(s,e,"channelCountMode"),assignNativeAudioNodeOption(s,e,"channelInterpretation")},testAnalyserNodeGetFloatTimeDomainDataMethodSupport=s=>typeof s.getFloatTimeDomainData=="function",wrapAnalyserNodeGetFloatTimeDomainDataMethod=s=>{s.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);s.getByteTimeDomainData(t);const n=Math.max(t.length,s.fftSize);for(let r=0;r<n;r+=1)e[r]=(t[r]-128)*.0078125;return e}},createNativeAnalyserNodeFactory=(s,e)=>(t,n)=>{const r=t.createAnalyser();if(assignNativeAudioNodeOptions(r,n),!(n.maxDecibels>n.minDecibels))throw e();return assignNativeAudioNodeOption(r,n,"fftSize"),assignNativeAudioNodeOption(r,n,"maxDecibels"),assignNativeAudioNodeOption(r,n,"minDecibels"),assignNativeAudioNodeOption(r,n,"smoothingTimeConstant"),s(testAnalyserNodeGetFloatTimeDomainDataMethodSupport,()=>testAnalyserNodeGetFloatTimeDomainDataMethodSupport(r))||wrapAnalyserNodeGetFloatTimeDomainDataMethod(r),r},createNativeAudioBufferConstructor=s=>s===null?null:s.hasOwnProperty("AudioBuffer")?s.AudioBuffer:null,assignNativeAudioNodeAudioParamValue=(s,e,t)=>{const n=e[t];n!==void 0&&n!==s[t].value&&(s[t].value=n)},wrapAudioBufferSourceNodeStartMethodConsecutiveCalls=s=>{s.start=(e=>{let t=!1;return(n=0,r=0,i)=>{if(t)throw createInvalidStateError();e.call(s,n,r,i),t=!0}})(s.start)},wrapAudioScheduledSourceNodeStartMethodNegativeParameters=s=>{s.start=(e=>(t=0,n=0,r)=>{if(typeof r=="number"&&r<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(s,t,n,r)})(s.start)},wrapAudioScheduledSourceNodeStopMethodNegativeParameters=s=>{s.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(s,t)})(s.stop)},createNativeAudioBufferSourceNodeFactory=(s,e,t,n,r,i,o,a,c,l,u)=>(p,g)=>{const y=p.createBufferSource();return assignNativeAudioNodeOptions(y,g),assignNativeAudioNodeAudioParamValue(y,g,"playbackRate"),assignNativeAudioNodeOption(y,g,"buffer"),assignNativeAudioNodeOption(y,g,"loop"),assignNativeAudioNodeOption(y,g,"loopEnd"),assignNativeAudioNodeOption(y,g,"loopStart"),e(t,()=>t(p))||wrapAudioBufferSourceNodeStartMethodConsecutiveCalls(y),e(n,()=>n(p))||c(y),e(r,()=>r(p))||l(y,p),e(i,()=>i(p))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(y),e(o,()=>o(p))||u(y,p),e(a,()=>a(p))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(y),s(p,y),y},createNativeAudioContextConstructor=s=>s===null?null:s.hasOwnProperty("AudioContext")?s.AudioContext:s.hasOwnProperty("webkitAudioContext")?s.webkitAudioContext:null,createNativeAudioDestinationNodeFactory=(s,e)=>(t,n,r)=>{const i=t.destination;if(i.channelCount!==n)try{i.channelCount=n}catch{}r&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:n});const o=s(t,{channelCount:n,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{i.channelCount=c}catch(l){if(c>i.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),i.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),i.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>i.maxChannelCount}),o.connect(i),o},createNativeAudioWorkletNodeConstructor=s=>s===null?null:s.hasOwnProperty("AudioWorkletNode")?s.AudioWorkletNode:null,testClonabilityOfAudioWorkletNodeOptions=s=>{const{port1:e}=new MessageChannel;try{e.postMessage(s)}finally{e.close()}},createNativeAudioWorkletNodeFactory=(s,e,t,n,r)=>(i,o,a,c,l,u)=>{if(a!==null)try{const p=new a(i,c,u),g=new Map;let y=null;if(Object.defineProperties(p,{channelCount:{get:()=>u.channelCount,set:()=>{throw s()}},channelCountMode:{get:()=>"explicit",set:()=>{throw s()}},onprocessorerror:{get:()=>y,set:h=>{typeof y=="function"&&p.removeEventListener("processorerror",y),y=typeof h=="function"?h:null,typeof y=="function"&&p.addEventListener("processorerror",y)}}}),p.addEventListener=(h=>(...f)=>{if(f[0]==="processorerror"){const d=typeof f[1]=="function"?f[1]:typeof f[1]=="object"&&f[1]!==null&&typeof f[1].handleEvent=="function"?f[1].handleEvent:null;if(d!==null){const v=g.get(f[1]);v!==void 0?f[1]=v:(f[1]=E=>{E.type==="error"?(Object.defineProperties(E,{type:{value:"processorerror"}}),d(E)):d(new ErrorEvent(f[0],{...E}))},g.set(d,f[1]))}}return h.call(p,"error",f[1],f[2]),h.call(p,...f)})(p.addEventListener),p.removeEventListener=(h=>(...f)=>{if(f[0]==="processorerror"){const d=g.get(f[1]);d!==void 0&&(g.delete(f[1]),f[1]=d)}return h.call(p,"error",f[1],f[2]),h.call(p,f[0],f[1],f[2])})(p.removeEventListener),u.numberOfOutputs!==0){const h=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return p.connect(h).connect(i.destination),r(p,()=>h.disconnect(),()=>h.connect(i.destination))}return p}catch(p){throw p.code===11?n():p}if(l===void 0)throw n();return testClonabilityOfAudioWorkletNodeOptions(u),e(i,o,l,u)},computeBufferSize=(s,e)=>s===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(s*e))))),cloneAudioWorkletNodeOptions=s=>new Promise((e,t)=>{const{port1:n,port2:r}=new MessageChannel;n.onmessage=({data:i})=>{n.close(),r.close(),e(i)},n.onmessageerror=({data:i})=>{n.close(),r.close(),t(i)},r.postMessage(s)}),createAudioWorkletProcessorPromise=async(s,e)=>{const t=await cloneAudioWorkletNodeOptions(e);return new s(t)},createAudioWorkletProcessor=(s,e,t,n)=>{let r=NODE_TO_PROCESSOR_MAPS.get(s);r===void 0&&(r=new WeakMap,NODE_TO_PROCESSOR_MAPS.set(s,r));const i=createAudioWorkletProcessorPromise(t,n);return r.set(e,i),i},createNativeAudioWorkletNodeFakerFactory=(s,e,t,n,r,i,o,a,c,l,u,p,g)=>(y,h,f,d)=>{if(d.numberOfInputs===0&&d.numberOfOutputs===0)throw c();const v=Array.isArray(d.outputChannelCount)?d.outputChannelCount:Array.from(d.outputChannelCount);if(v.some(ie=>ie<1))throw c();if(v.length!==d.numberOfOutputs)throw e();if(d.channelCountMode!=="explicit")throw c();const E=d.channelCount*d.numberOfInputs,O=v.reduce((ie,ve)=>ie+ve,0),N=f.parameterDescriptors===void 0?0:f.parameterDescriptors.length;if(E+N>6||O>6)throw c();const m=new MessageChannel,b=[],k=[];for(let ie=0;ie<d.numberOfInputs;ie+=1)b.push(o(y,{channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,gain:1})),k.push(r(y,{channelCount:d.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:d.channelCount}));const T=[];if(f.parameterDescriptors!==void 0)for(const{defaultValue:ie,maxValue:ve,minValue:Ne,name:Fe}of f.parameterDescriptors){const Le=i(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:d.parameterData[Fe]!==void 0?d.parameterData[Fe]:ie===void 0?0:ie});Object.defineProperties(Le.offset,{defaultValue:{get:()=>ie===void 0?0:ie},maxValue:{get:()=>ve===void 0?MOST_POSITIVE_SINGLE_FLOAT:ve},minValue:{get:()=>Ne===void 0?MOST_NEGATIVE_SINGLE_FLOAT:Ne}}),T.push(Le)}const S=n(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,E+N)}),F=computeBufferSize(h,y.sampleRate),P=a(y,F,E+N,Math.max(1,O)),G=r(y,{channelCount:Math.max(1,O),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,O)}),j=[];for(let ie=0;ie<d.numberOfOutputs;ie+=1)j.push(n(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[ie]}));for(let ie=0;ie<d.numberOfInputs;ie+=1){b[ie].connect(k[ie]);for(let ve=0;ve<d.channelCount;ve+=1)k[ie].connect(S,ve,ie*d.channelCount+ve)}const L=new ReadOnlyMap(f.parameterDescriptors===void 0?[]:f.parameterDescriptors.map(({name:ie},ve)=>{const Ne=T[ve];return Ne.connect(S,0,E+ve),Ne.start(0),[ie,Ne.offset]}));S.connect(P);let K=d.channelInterpretation,Q=null;const ne=d.numberOfOutputs===0?[P]:j,D={get bufferSize(){return F},get channelCount(){return d.channelCount},set channelCount(ie){throw t()},get channelCountMode(){return d.channelCountMode},set channelCountMode(ie){throw t()},get channelInterpretation(){return K},set channelInterpretation(ie){for(const ve of b)ve.channelInterpretation=ie;K=ie},get context(){return P.context},get inputs(){return b},get numberOfInputs(){return d.numberOfInputs},get numberOfOutputs(){return d.numberOfOutputs},get onprocessorerror(){return Q},set onprocessorerror(ie){typeof Q=="function"&&D.removeEventListener("processorerror",Q),Q=typeof ie=="function"?ie:null,typeof Q=="function"&&D.addEventListener("processorerror",Q)},get parameters(){return L},get port(){return m.port2},addEventListener(...ie){return P.addEventListener(ie[0],ie[1],ie[2])},connect:s.bind(null,ne),disconnect:l.bind(null,ne),dispatchEvent(...ie){return P.dispatchEvent(ie[0])},removeEventListener(...ie){return P.removeEventListener(ie[0],ie[1],ie[2])}},$=new Map;m.port1.addEventListener=(ie=>(...ve)=>{if(ve[0]==="message"){const Ne=typeof ve[1]=="function"?ve[1]:typeof ve[1]=="object"&&ve[1]!==null&&typeof ve[1].handleEvent=="function"?ve[1].handleEvent:null;if(Ne!==null){const Fe=$.get(ve[1]);Fe!==void 0?ve[1]=Fe:(ve[1]=Le=>{u(y.currentTime,y.sampleRate,()=>Ne(Le))},$.set(Ne,ve[1]))}}return ie.call(m.port1,ve[0],ve[1],ve[2])})(m.port1.addEventListener),m.port1.removeEventListener=(ie=>(...ve)=>{if(ve[0]==="message"){const Ne=$.get(ve[1]);Ne!==void 0&&($.delete(ve[1]),ve[1]=Ne)}return ie.call(m.port1,ve[0],ve[1],ve[2])})(m.port1.removeEventListener);let J=null;Object.defineProperty(m.port1,"onmessage",{get:()=>J,set:ie=>{typeof J=="function"&&m.port1.removeEventListener("message",J),J=typeof ie=="function"?ie:null,typeof J=="function"&&(m.port1.addEventListener("message",J),m.port1.start())}}),f.prototype.port=m.port1;let re=null;createAudioWorkletProcessor(y,D,f,d).then(ie=>re=ie);const U=createNestedArrays(d.numberOfInputs,d.channelCount),w=createNestedArrays(d.numberOfOutputs,v),_=f.parameterDescriptors===void 0?[]:f.parameterDescriptors.reduce((ie,{name:ve})=>({...ie,[ve]:new Float32Array(128)}),{});let R=!0;const V=()=>{d.numberOfOutputs>0&&P.disconnect(G);for(let ie=0,ve=0;ie<d.numberOfOutputs;ie+=1){const Ne=j[ie];for(let Fe=0;Fe<v[ie];Fe+=1)G.disconnect(Ne,ve+Fe,Fe);ve+=v[ie]}},M=new Map;P.onaudioprocess=({inputBuffer:ie,outputBuffer:ve})=>{if(re!==null){const Ne=p(D);for(let Fe=0;Fe<F;Fe+=128){for(let Le=0;Le<d.numberOfInputs;Le+=1)for(let ke=0;ke<d.channelCount;ke+=1)copyFromChannel(ie,U[Le],ke,ke,Fe);f.parameterDescriptors!==void 0&&f.parameterDescriptors.forEach(({name:Le},ke)=>{copyFromChannel(ie,_,Le,E+ke,Fe)});for(let Le=0;Le<d.numberOfInputs;Le+=1)for(let ke=0;ke<v[Le];ke+=1)w[Le][ke].byteLength===0&&(w[Le][ke]=new Float32Array(128));try{const Le=U.map((ze,Oe)=>{if(Ne[Oe].size>0)return M.set(Oe,F/128),ze;const fe=M.get(Oe);return fe===void 0?[]:(ze.every(Ce=>Ce.every(Me=>Me===0))&&(fe===1?M.delete(Oe):M.set(Oe,fe-1)),ze)});R=u(y.currentTime+Fe/y.sampleRate,y.sampleRate,()=>re.process(Le,w,_));for(let ze=0,Oe=0;ze<d.numberOfOutputs;ze+=1){for(let be=0;be<v[ze];be+=1)copyToChannel(ve,w[ze],be,Oe+be,Fe);Oe+=v[ze]}}catch(Le){R=!1,D.dispatchEvent(new ErrorEvent("processorerror",{colno:Le.colno,filename:Le.filename,lineno:Le.lineno,message:Le.message}))}if(!R){for(let Le=0;Le<d.numberOfInputs;Le+=1){b[Le].disconnect(k[Le]);for(let ke=0;ke<d.channelCount;ke+=1)k[Fe].disconnect(S,ke,Le*d.channelCount+ke)}if(f.parameterDescriptors!==void 0){const Le=f.parameterDescriptors.length;for(let ke=0;ke<Le;ke+=1){const ze=T[ke];ze.disconnect(S,0,E+ke),ze.stop()}}S.disconnect(P),P.onaudioprocess=null,Y?V():me();break}}}};let Y=!1;const W=o(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),ee=()=>P.connect(W).connect(y.destination),me=()=>{P.disconnect(W),W.disconnect()},he=()=>{if(R){me(),d.numberOfOutputs>0&&P.connect(G);for(let ie=0,ve=0;ie<d.numberOfOutputs;ie+=1){const Ne=j[ie];for(let Fe=0;Fe<v[ie];Fe+=1)G.connect(Ne,ve+Fe,Fe);ve+=v[ie]}}Y=!0},ye=()=>{R&&(ee(),V()),Y=!1};return ee(),g(D,he,ye)},createNativeBiquadFilterNode=(s,e)=>{const t=s.createBiquadFilter();return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"Q"),assignNativeAudioNodeAudioParamValue(t,e,"detune"),assignNativeAudioNodeAudioParamValue(t,e,"frequency"),assignNativeAudioNodeAudioParamValue(t,e,"gain"),assignNativeAudioNodeOption(t,e,"type"),t},createNativeChannelMergerNodeFactory=(s,e)=>(t,n)=>{const r=t.createChannelMerger(n.numberOfInputs);return s!==null&&s.name==="webkitAudioContext"&&e(t,r),assignNativeAudioNodeOptions(r,n),r},wrapChannelSplitterNode=s=>{const e=s.numberOfOutputs;Object.defineProperty(s,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw createInvalidStateError()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw createInvalidStateError()}}),Object.defineProperty(s,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw createInvalidStateError()}})},createNativeChannelSplitterNode=(s,e)=>{const t=s.createChannelSplitter(e.numberOfOutputs);return assignNativeAudioNodeOptions(t,e),wrapChannelSplitterNode(t),t},createNativeConstantSourceNodeFactory=(s,e,t,n,r)=>(i,o)=>{if(i.createConstantSource===void 0)return t(i,o);const a=i.createConstantSource();return assignNativeAudioNodeOptions(a,o),assignNativeAudioNodeAudioParamValue(a,o,"offset"),e(n,()=>n(i))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(a),e(r,()=>r(i))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(a),s(i,a),a},interceptConnections=(s,e)=>(s.connect=e.connect.bind(e),s.disconnect=e.disconnect.bind(e),s),createNativeConstantSourceNodeFakerFactory=(s,e,t,n)=>(r,{offset:i,...o})=>{const a=r.createBuffer(1,2,44100),c=e(r,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(r,{...o,gain:i}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const p={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(h){l.channelCount=h},get channelCountMode(){return l.channelCountMode},set channelCountMode(h){l.channelCountMode=h},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(h){l.channelInterpretation=h},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(h){c.onended=h},addEventListener(...h){return c.addEventListener(h[0],h[1],h[2])},dispatchEvent(...h){return c.dispatchEvent(h[0])},removeEventListener(...h){return c.removeEventListener(h[0],h[1],h[2])},start(h=0){c.start.call(c,h)},stop(h=0){c.stop.call(c,h)}},g=()=>c.connect(l),y=()=>c.disconnect(l);return s(r,c),n(interceptConnections(p,l),g,y)},createNativeConvolverNodeFactory=(s,e)=>(t,n)=>{const r=t.createConvolver();if(assignNativeAudioNodeOptions(r,n),n.disableNormalization===r.normalize&&(r.normalize=!n.disableNormalization),assignNativeAudioNodeOption(r,n,"buffer"),n.channelCount>2||(e(r,"channelCount",i=>()=>i.call(r),i=>o=>{if(o>2)throw s();return i.call(r,o)}),n.channelCountMode==="max"))throw s();return e(r,"channelCountMode",i=>()=>i.call(r),i=>o=>{if(o==="max")throw s();return i.call(r,o)}),r},createNativeDelayNode=(s,e)=>{const t=s.createDelay(e.maxDelayTime);return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"delayTime"),t},createNativeDynamicsCompressorNodeFactory=s=>(e,t)=>{const n=e.createDynamicsCompressor();if(assignNativeAudioNodeOptions(n,t),t.channelCount>2||t.channelCountMode==="max")throw s();return assignNativeAudioNodeAudioParamValue(n,t,"attack"),assignNativeAudioNodeAudioParamValue(n,t,"knee"),assignNativeAudioNodeAudioParamValue(n,t,"ratio"),assignNativeAudioNodeAudioParamValue(n,t,"release"),assignNativeAudioNodeAudioParamValue(n,t,"threshold"),n},createNativeGainNode=(s,e)=>{const t=s.createGain();return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"gain"),t},createNativeIIRFilterNodeFactory=s=>(e,t,n)=>{if(e.createIIRFilter===void 0)return s(e,t,n);const r=e.createIIRFilter(n.feedforward,n.feedback);return assignNativeAudioNodeOptions(r,n),r};function divide(s,e){const t=e[0]*e[0]+e[1]*e[1];return[(s[0]*e[0]+s[1]*e[1])/t,(s[1]*e[0]-s[0]*e[1])/t]}function multiply(s,e){return[s[0]*e[0]-s[1]*e[1],s[0]*e[1]+s[1]*e[0]]}function evaluatePolynomial(s,e){let t=[0,0];for(let n=s.length-1;n>=0;n-=1)t=multiply(t,e),t[0]+=s[n];return t}const createNativeIIRFilterNodeFakerFactory=(s,e,t,n)=>(r,i,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const p=computeBufferSize(i,r.sampleRate),g=l instanceof Float64Array?l:new Float64Array(l),y=u instanceof Float64Array?u:new Float64Array(u),h=g.length,f=y.length,d=Math.min(h,f);if(h===0||h>20)throw n();if(g[0]===0)throw e();if(f===0||f>20)throw n();if(y[0]===0)throw e();if(g[0]!==1){for(let T=0;T<f;T+=1)y[T]/=g[0];for(let T=1;T<h;T+=1)g[T]/=g[0]}const v=t(r,p,o,o);v.channelCount=o,v.channelCountMode=a,v.channelInterpretation=c;const E=32,O=[],N=[],m=[];for(let T=0;T<o;T+=1){O.push(0);const S=new Float32Array(E),F=new Float32Array(E);S.fill(0),F.fill(0),N.push(S),m.push(F)}v.onaudioprocess=T=>{const S=T.inputBuffer,F=T.outputBuffer,P=S.numberOfChannels;for(let G=0;G<P;G+=1){const j=S.getChannelData(G),L=F.getChannelData(G);O[G]=filterBuffer(g,h,y,f,d,N[G],m[G],O[G],E,j,L)}};const b=r.sampleRate/2;return interceptConnections({get bufferSize(){return p},get channelCount(){return v.channelCount},set channelCount(T){v.channelCount=T},get channelCountMode(){return v.channelCountMode},set channelCountMode(T){v.channelCountMode=T},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(T){v.channelInterpretation=T},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener(...T){return v.addEventListener(T[0],T[1],T[2])},dispatchEvent(...T){return v.dispatchEvent(T[0])},getFrequencyResponse(T,S,F){if(T.length!==S.length||S.length!==F.length)throw s();const P=T.length;for(let G=0;G<P;G+=1){const j=-Math.PI*(T[G]/b),L=[Math.cos(j),Math.sin(j)],K=evaluatePolynomial(y,L),Q=evaluatePolynomial(g,L),ne=divide(K,Q);S[G]=Math.sqrt(ne[0]*ne[0]+ne[1]*ne[1]),F[G]=Math.atan2(ne[1],ne[0])}},removeEventListener(...T){return v.removeEventListener(T[0],T[1],T[2])}},v)},createNativeMediaElementAudioSourceNode=(s,e)=>s.createMediaElementSource(e.mediaElement),createNativeMediaStreamAudioDestinationNode=(s,e)=>{const t=s.createMediaStreamDestination();return assignNativeAudioNodeOptions(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},createNativeMediaStreamAudioSourceNode=(s,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((i,o)=>i.id<o.id?-1:i.id>o.id?1:0);const n=t.slice(0,1),r=s.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(r,"mediaStream",{value:e}),r},createNativeMediaStreamTrackAudioSourceNodeFactory=(s,e)=>(t,{mediaStreamTrack:n})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(n);const r=new MediaStream([n]),i=t.createMediaStreamSource(r);if(n.kind!=="audio")throw s();if(e(t))throw new TypeError;return i},createNativeOfflineAudioContextConstructor=s=>s===null?null:s.hasOwnProperty("OfflineAudioContext")?s.OfflineAudioContext:s.hasOwnProperty("webkitOfflineAudioContext")?s.webkitOfflineAudioContext:null,createNativeOscillatorNodeFactory=(s,e,t,n,r,i)=>(o,a)=>{const c=o.createOscillator();return assignNativeAudioNodeOptions(c,a),assignNativeAudioNodeAudioParamValue(c,a,"detune"),assignNativeAudioNodeAudioParamValue(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):assignNativeAudioNodeOption(c,a,"type"),e(t,()=>t(o))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(c),e(n,()=>n(o))||i(c,o),e(r,()=>r(o))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(c),s(o,c),c},createNativePannerNodeFactory=s=>(e,t)=>{const n=e.createPanner();return n.orientationX===void 0?s(e,t):(assignNativeAudioNodeOptions(n,t),assignNativeAudioNodeAudioParamValue(n,t,"orientationX"),assignNativeAudioNodeAudioParamValue(n,t,"orientationY"),assignNativeAudioNodeAudioParamValue(n,t,"orientationZ"),assignNativeAudioNodeAudioParamValue(n,t,"positionX"),assignNativeAudioNodeAudioParamValue(n,t,"positionY"),assignNativeAudioNodeAudioParamValue(n,t,"positionZ"),assignNativeAudioNodeOption(n,t,"coneInnerAngle"),assignNativeAudioNodeOption(n,t,"coneOuterAngle"),assignNativeAudioNodeOption(n,t,"coneOuterGain"),assignNativeAudioNodeOption(n,t,"distanceModel"),assignNativeAudioNodeOption(n,t,"maxDistance"),assignNativeAudioNodeOption(n,t,"panningModel"),assignNativeAudioNodeOption(n,t,"refDistance"),assignNativeAudioNodeOption(n,t,"rolloffFactor"),n)},createNativePannerNodeFakerFactory=(s,e,t,n,r,i,o,a,c,l)=>(u,{coneInnerAngle:p,coneOuterAngle:g,coneOuterGain:y,distanceModel:h,maxDistance:f,orientationX:d,orientationY:v,orientationZ:E,panningModel:O,positionX:N,positionY:m,positionZ:b,refDistance:k,rolloffFactor:T,...S})=>{const F=u.createPanner();if(S.channelCount>2||S.channelCountMode==="max")throw o();assignNativeAudioNodeOptions(F,S);const P={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},G=t(u,{...P,channelInterpretation:"speakers",numberOfInputs:6}),j=n(u,{...S,gain:1}),L=n(u,{...P,gain:1}),K=n(u,{...P,gain:0}),Q=n(u,{...P,gain:0}),ne=n(u,{...P,gain:0}),D=n(u,{...P,gain:0}),$=n(u,{...P,gain:0}),J=r(u,256,6,1),re=i(u,{...P,curve:new Float32Array([1,1]),oversample:"none"});let pe=[d,v,E],U=[N,m,b];const w=new Float32Array(1);J.onaudioprocess=({inputBuffer:M})=>{const Y=[c(M,w,0),c(M,w,1),c(M,w,2)];Y.some((ee,me)=>ee!==pe[me])&&(F.setOrientation(...Y),pe=Y);const W=[c(M,w,3),c(M,w,4),c(M,w,5)];W.some((ee,me)=>ee!==U[me])&&(F.setPosition(...W),U=W)},Object.defineProperty(K.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ne.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty($.gain,"defaultValue",{get:()=>0});const _={get bufferSize(){},get channelCount(){return F.channelCount},set channelCount(M){if(M>2)throw o();j.channelCount=M,F.channelCount=M},get channelCountMode(){return F.channelCountMode},set channelCountMode(M){if(M==="max")throw o();j.channelCountMode=M,F.channelCountMode=M},get channelInterpretation(){return F.channelInterpretation},set channelInterpretation(M){j.channelInterpretation=M,F.channelInterpretation=M},get coneInnerAngle(){return F.coneInnerAngle},set coneInnerAngle(M){F.coneInnerAngle=M},get coneOuterAngle(){return F.coneOuterAngle},set coneOuterAngle(M){F.coneOuterAngle=M},get coneOuterGain(){return F.coneOuterGain},set coneOuterGain(M){if(M<0||M>1)throw e();F.coneOuterGain=M},get context(){return F.context},get distanceModel(){return F.distanceModel},set distanceModel(M){F.distanceModel=M},get inputs(){return[j]},get maxDistance(){return F.maxDistance},set maxDistance(M){if(M<0)throw new RangeError;F.maxDistance=M},get numberOfInputs(){return F.numberOfInputs},get numberOfOutputs(){return F.numberOfOutputs},get orientationX(){return L.gain},get orientationY(){return K.gain},get orientationZ(){return Q.gain},get panningModel(){return F.panningModel},set panningModel(M){F.panningModel=M},get positionX(){return ne.gain},get positionY(){return D.gain},get positionZ(){return $.gain},get refDistance(){return F.refDistance},set refDistance(M){if(M<0)throw new RangeError;F.refDistance=M},get rolloffFactor(){return F.rolloffFactor},set rolloffFactor(M){if(M<0)throw new RangeError;F.rolloffFactor=M},addEventListener(...M){return j.addEventListener(M[0],M[1],M[2])},dispatchEvent(...M){return j.dispatchEvent(M[0])},removeEventListener(...M){return j.removeEventListener(M[0],M[1],M[2])}};p!==_.coneInnerAngle&&(_.coneInnerAngle=p),g!==_.coneOuterAngle&&(_.coneOuterAngle=g),y!==_.coneOuterGain&&(_.coneOuterGain=y),h!==_.distanceModel&&(_.distanceModel=h),f!==_.maxDistance&&(_.maxDistance=f),d!==_.orientationX.value&&(_.orientationX.value=d),v!==_.orientationY.value&&(_.orientationY.value=v),E!==_.orientationZ.value&&(_.orientationZ.value=E),O!==_.panningModel&&(_.panningModel=O),N!==_.positionX.value&&(_.positionX.value=N),m!==_.positionY.value&&(_.positionY.value=m),b!==_.positionZ.value&&(_.positionZ.value=b),k!==_.refDistance&&(_.refDistance=k),T!==_.rolloffFactor&&(_.rolloffFactor=T),(pe[0]!==1||pe[1]!==0||pe[2]!==0)&&F.setOrientation(...pe),(U[0]!==0||U[1]!==0||U[2]!==0)&&F.setPosition(...U);const R=()=>{j.connect(F),s(j,re,0,0),re.connect(L).connect(G,0,0),re.connect(K).connect(G,0,1),re.connect(Q).connect(G,0,2),re.connect(ne).connect(G,0,3),re.connect(D).connect(G,0,4),re.connect($).connect(G,0,5),G.connect(J).connect(u.destination)},V=()=>{j.disconnect(F),a(j,re,0,0),re.disconnect(L),L.disconnect(G),re.disconnect(K),K.disconnect(G),re.disconnect(Q),Q.disconnect(G),re.disconnect(ne),ne.disconnect(G),re.disconnect(D),D.disconnect(G),re.disconnect($),$.disconnect(G),G.disconnect(J),J.disconnect(u.destination)};return l(interceptConnections(_,F),R,V)},createNativePeriodicWaveFactory=s=>(e,{disableNormalization:t,imag:n,real:r})=>{const i=n instanceof Float32Array?n:new Float32Array(n),o=r instanceof Float32Array?r:new Float32Array(r),a=e.createPeriodicWave(o,i,{disableNormalization:t});if(Array.from(n).length<2)throw s();return a},createNativeScriptProcessorNode=(s,e,t,n)=>s.createScriptProcessor(e,t,n),createNativeStereoPannerNodeFactory=(s,e)=>(t,n)=>{const r=n.channelCountMode;if(r==="clamped-max")throw e();if(t.createStereoPanner===void 0)return s(t,n);const i=t.createStereoPanner();return assignNativeAudioNodeOptions(i,n),assignNativeAudioNodeAudioParamValue(i,n,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>r,set:o=>{if(o!==r)throw e()}}),i},createNativeStereoPannerNodeFakerFactory=(s,e,t,n,r,i)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},p=(h,f,d,v)=>{const E=new Float32Array(16385),O=new Float32Array(16385);for(let S=0;S<16385;S+=1){const F=S/16384*c;E[S]=Math.cos(F),O[S]=Math.sin(F)}const N=t(h,{...l,gain:0}),m=n(h,{...u,curve:E}),b=n(h,{...u,curve:a}),k=t(h,{...l,gain:0}),T=n(h,{...u,curve:O});return{connectGraph(){f.connect(N),f.connect(b.inputs===void 0?b:b.inputs[0]),f.connect(k),b.connect(d),d.connect(m.inputs===void 0?m:m.inputs[0]),d.connect(T.inputs===void 0?T:T.inputs[0]),m.connect(N.gain),T.connect(k.gain),N.connect(v,0,0),k.connect(v,0,1)},disconnectGraph(){f.disconnect(N),f.disconnect(b.inputs===void 0?b:b.inputs[0]),f.disconnect(k),b.disconnect(d),d.disconnect(m.inputs===void 0?m:m.inputs[0]),d.disconnect(T.inputs===void 0?T:T.inputs[0]),m.disconnect(N.gain),T.disconnect(k.gain),N.disconnect(v,0,0),k.disconnect(v,0,1)}}},g=(h,f,d,v)=>{const E=new Float32Array(16385),O=new Float32Array(16385),N=new Float32Array(16385),m=new Float32Array(16385),b=Math.floor(16385/2);for(let ne=0;ne<16385;ne+=1)if(ne>b){const D=(ne-b)/(16384-b)*c;E[ne]=Math.cos(D),O[ne]=Math.sin(D),N[ne]=0,m[ne]=1}else{const D=ne/(16384-b)*c;E[ne]=1,O[ne]=0,N[ne]=Math.cos(D),m[ne]=Math.sin(D)}const k=e(h,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),T=t(h,{...l,gain:0}),S=n(h,{...u,curve:E}),F=t(h,{...l,gain:0}),P=n(h,{...u,curve:O}),G=n(h,{...u,curve:a}),j=t(h,{...l,gain:0}),L=n(h,{...u,curve:N}),K=t(h,{...l,gain:0}),Q=n(h,{...u,curve:m});return{connectGraph(){f.connect(k),f.connect(G.inputs===void 0?G:G.inputs[0]),k.connect(T,0),k.connect(F,0),k.connect(j,1),k.connect(K,1),G.connect(d),d.connect(S.inputs===void 0?S:S.inputs[0]),d.connect(P.inputs===void 0?P:P.inputs[0]),d.connect(L.inputs===void 0?L:L.inputs[0]),d.connect(Q.inputs===void 0?Q:Q.inputs[0]),S.connect(T.gain),P.connect(F.gain),L.connect(j.gain),Q.connect(K.gain),T.connect(v,0,0),j.connect(v,0,0),F.connect(v,0,1),K.connect(v,0,1)},disconnectGraph(){f.disconnect(k),f.disconnect(G.inputs===void 0?G:G.inputs[0]),k.disconnect(T,0),k.disconnect(F,0),k.disconnect(j,1),k.disconnect(K,1),G.disconnect(d),d.disconnect(S.inputs===void 0?S:S.inputs[0]),d.disconnect(P.inputs===void 0?P:P.inputs[0]),d.disconnect(L.inputs===void 0?L:L.inputs[0]),d.disconnect(Q.inputs===void 0?Q:Q.inputs[0]),S.disconnect(T.gain),P.disconnect(F.gain),L.disconnect(j.gain),Q.disconnect(K.gain),T.disconnect(v,0,0),j.disconnect(v,0,0),F.disconnect(v,0,1),K.disconnect(v,0,1)}}},y=(h,f,d,v,E)=>{if(f===1)return p(h,d,v,E);if(f===2)return g(h,d,v,E);throw r()};return(h,{channelCount:f,channelCountMode:d,pan:v,...E})=>{if(d==="max")throw r();const O=s(h,{...E,channelCount:1,channelCountMode:d,numberOfInputs:2}),N=t(h,{...E,channelCount:f,channelCountMode:d,gain:1}),m=t(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:v});let{connectGraph:b,disconnectGraph:k}=y(h,f,N,m,O);Object.defineProperty(m.gain,"defaultValue",{get:()=>0}),Object.defineProperty(m.gain,"maxValue",{get:()=>1}),Object.defineProperty(m.gain,"minValue",{get:()=>-1});const T={get bufferSize(){},get channelCount(){return N.channelCount},set channelCount(G){N.channelCount!==G&&(S&&k(),{connectGraph:b,disconnectGraph:k}=y(h,G,N,m,O),S&&b()),N.channelCount=G},get channelCountMode(){return N.channelCountMode},set channelCountMode(G){if(G==="clamped-max"||G==="max")throw r();N.channelCountMode=G},get channelInterpretation(){return N.channelInterpretation},set channelInterpretation(G){N.channelInterpretation=G},get context(){return N.context},get inputs(){return[N]},get numberOfInputs(){return N.numberOfInputs},get numberOfOutputs(){return N.numberOfOutputs},get pan(){return m.gain},addEventListener(...G){return N.addEventListener(G[0],G[1],G[2])},dispatchEvent(...G){return N.dispatchEvent(G[0])},removeEventListener(...G){return N.removeEventListener(G[0],G[1],G[2])}};let S=!1;const F=()=>{b(),S=!0},P=()=>{k(),S=!1};return i(interceptConnections(T,O),F,P)}},createNativeWaveShaperNodeFactory=(s,e,t,n,r,i,o)=>(a,c)=>{const l=a.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);assignNativeAudioNodeOptions(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();assignNativeAudioNodeOption(l,{curve:u},"curve"),assignNativeAudioNodeOption(l,c,"oversample");let p=null,g=!1;return o(l,"curve",f=>()=>f.call(l),f=>d=>(f.call(l,d),g&&(n(d)&&p===null?p=s(a,l):!n(d)&&p!==null&&(p(),p=null)),d)),r(l,()=>{g=!0,n(l.curve)&&(p=s(a,l))},()=>{g=!1,p!==null&&(p(),p=null)})},createNativeWaveShaperNodeFakerFactory=(s,e,t,n,r)=>(i,{curve:o,oversample:a,...c})=>{const l=i.createWaveShaper(),u=i.createWaveShaper();assignNativeAudioNodeOptions(l,c),assignNativeAudioNodeOptions(u,c);const p=t(i,{...c,gain:1}),g=t(i,{...c,gain:-1}),y=t(i,{...c,gain:1}),h=t(i,{...c,gain:-1});let f=null,d=!1,v=null;const E={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(m){p.channelCount=m,g.channelCount=m,l.channelCount=m,y.channelCount=m,u.channelCount=m,h.channelCount=m},get channelCountMode(){return l.channelCountMode},set channelCountMode(m){p.channelCountMode=m,g.channelCountMode=m,l.channelCountMode=m,y.channelCountMode=m,u.channelCountMode=m,h.channelCountMode=m},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(m){p.channelInterpretation=m,g.channelInterpretation=m,l.channelInterpretation=m,y.channelInterpretation=m,u.channelInterpretation=m,h.channelInterpretation=m},get context(){return l.context},get curve(){return v},set curve(m){if(m!==null&&m.length<2)throw e();if(m===null)l.curve=m,u.curve=m;else{const b=m.length,k=new Float32Array(b+2-b%2),T=new Float32Array(b+2-b%2);k[0]=m[0],T[0]=-m[b-1];const S=Math.ceil((b+1)/2),F=(b+1)/2-1;for(let P=1;P<S;P+=1){const G=P/S*F,j=Math.floor(G),L=Math.ceil(G);k[P]=j===L?m[j]:(1-(G-j))*m[j]+(1-(L-G))*m[L],T[P]=j===L?-m[b-1-j]:-((1-(G-j))*m[b-1-j])-(1-(L-G))*m[b-1-L]}k[S]=b%2===1?m[S-1]:(m[S-2]+m[S-1])/2,l.curve=k,u.curve=T}v=m,d&&(n(v)&&f===null?f=s(i,p):f!==null&&(f(),f=null))},get inputs(){return[p]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(m){l.oversample=m,u.oversample=m},addEventListener(...m){return p.addEventListener(m[0],m[1],m[2])},dispatchEvent(...m){return p.dispatchEvent(m[0])},removeEventListener(...m){return p.removeEventListener(m[0],m[1],m[2])}};o!==null&&(E.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==E.oversample&&(E.oversample=a);const O=()=>{p.connect(l).connect(y),p.connect(g).connect(u).connect(h).connect(y),d=!0,n(v)&&(f=s(i,p))},N=()=>{p.disconnect(l),l.disconnect(y),p.disconnect(g),g.disconnect(u),u.disconnect(h),h.disconnect(y),d=!1,f!==null&&(f(),f=null)};return r(interceptConnections(E,y),O,N)},createNotSupportedError=()=>new DOMException("","NotSupportedError"),DEFAULT_OPTIONS$5={numberOfChannels:1},createOfflineAudioContextConstructor=(s,e,t,n,r)=>class extends s{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:p,sampleRate:g}={...DEFAULT_OPTIONS$5,...l},y=n(p,u,g);e(testPromiseSupport,()=>testPromiseSupport(y))||y.addEventListener("statechange",(()=>{let h=0;const f=d=>{this._state==="running"&&(h>0?(y.removeEventListener("statechange",f),d.stopImmediatePropagation(),this._waitForThePromiseToSettle(d)):h+=1)};return f})()),super(y,p),this._length=u,this._nativeOfflineAudioContext=y,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",r(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,deactivateAudioGraph(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},DEFAULT_OPTIONS$4={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},createOscillatorNodeConstructor=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),p={...DEFAULT_OPTIONS$4,...l},g=t(u,p),y=i(u),h=y?n():null,f=c.sampleRate/2;super(c,!1,g,h),this._detune=e(this,y,g.detune,153600,-153600),this._frequency=e(this,y,g.frequency,f,-f),this._nativeOscillatorNode=g,this._onended=null,this._oscillatorNodeRenderer=h,this._oscillatorNodeRenderer!==null&&p.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=p.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){setInternalStateToActive(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},createOscillatorNodeRendererFactory=(s,e,t,n,r)=>()=>{const i=new WeakMap;let o=null,a=null,c=null;const l=async(u,p)=>{let g=t(u);const y=isOwnedByContext(g,p);if(!y){const h={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,detune:g.detune.value,frequency:g.frequency.value,periodicWave:o===null?void 0:o,type:g.type};g=e(p,h),a!==null&&g.start(a),c!==null&&g.stop(c)}return i.set(p,g),y?(await s(p,u.detune,g.detune),await s(p,u.frequency,g.frequency)):(await n(p,u.detune,g.detune),await n(p,u.frequency,g.frequency)),await r(u,p,g),g};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,p){const g=i.get(p);return g!==void 0?Promise.resolve(g):l(u,p)}}},DEFAULT_OPTIONS$3={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},createPannerNodeConstructor=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),p={...DEFAULT_OPTIONS$3,...l},g=t(u,p),y=i(u),h=y?n():null;super(c,!1,g,h),this._nativePannerNode=g,this._orientationX=e(this,y,g.orientationX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationY=e(this,y,g.orientationY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationZ=e(this,y,g.orientationZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionX=e(this,y,g.positionX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionY=e(this,y,g.positionY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionZ=e(this,y,g.positionZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},createPannerNodeRendererFactory=(s,e,t,n,r,i,o,a,c,l)=>()=>{const u=new WeakMap;let p=null;const g=async(y,h)=>{let f=null,d=i(y);const v={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation},E={...v,coneInnerAngle:d.coneInnerAngle,coneOuterAngle:d.coneOuterAngle,coneOuterGain:d.coneOuterGain,distanceModel:d.distanceModel,maxDistance:d.maxDistance,panningModel:d.panningModel,refDistance:d.refDistance,rolloffFactor:d.rolloffFactor},O=isOwnedByContext(d,h);if("bufferSize"in d)f=n(h,{...v,gain:1});else if(!O){const N={...E,orientationX:d.orientationX.value,orientationY:d.orientationY.value,orientationZ:d.orientationZ.value,positionX:d.positionX.value,positionY:d.positionY.value,positionZ:d.positionZ.value};d=r(h,N)}if(u.set(h,f===null?d:f),f!==null){if(p===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const P=new o(6,y.context.length,h.sampleRate),G=e(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});G.connect(P.destination),p=(async()=>{const j=await Promise.all([y.orientationX,y.orientationY,y.orientationZ,y.positionX,y.positionY,y.positionZ].map(async(L,K)=>{const Q=t(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:K===0?1:0});return await a(P,L,Q.offset),Q}));for(let L=0;L<6;L+=1)j[L].connect(G,0,L),j[L].start(0);return l(P)})()}const N=await p,m=n(h,{...v,gain:1});await c(y,h,m);const b=[];for(let P=0;P<N.numberOfChannels;P+=1)b.push(N.getChannelData(P));let k=[b[0][0],b[1][0],b[2][0]],T=[b[3][0],b[4][0],b[5][0]],S=n(h,{...v,gain:1}),F=r(h,{...E,orientationX:k[0],orientationY:k[1],orientationZ:k[2],positionX:T[0],positionY:T[1],positionZ:T[2]});m.connect(S).connect(F.inputs[0]),F.connect(f);for(let P=128;P<N.length;P+=128){const G=[b[0][P],b[1][P],b[2][P]],j=[b[3][P],b[4][P],b[5][P]];if(G.some((L,K)=>L!==k[K])||j.some((L,K)=>L!==T[K])){k=G,T=j;const L=P/h.sampleRate;S.gain.setValueAtTime(0,L),S=n(h,{...v,gain:0}),F=r(h,{...E,orientationX:k[0],orientationY:k[1],orientationZ:k[2],positionX:T[0],positionY:T[1],positionZ:T[2]}),S.gain.setValueAtTime(1,L),m.connect(S).connect(F.inputs[0]),F.connect(f)}}return f}return O?(await s(h,y.orientationX,d.orientationX),await s(h,y.orientationY,d.orientationY),await s(h,y.orientationZ,d.orientationZ),await s(h,y.positionX,d.positionX),await s(h,y.positionY,d.positionY),await s(h,y.positionZ,d.positionZ)):(await a(h,y.orientationX,d.orientationX),await a(h,y.orientationY,d.orientationY),await a(h,y.orientationZ,d.orientationZ),await a(h,y.positionX,d.positionX),await a(h,y.positionY,d.positionY),await a(h,y.positionZ,d.positionZ)),isNativeAudioNodeFaker(d)?await c(y,h,d.inputs[0]):await c(y,h,d),d};return{render(y,h){const f=u.get(h);return f!==void 0?Promise.resolve(f):g(y,h)}}},DEFAULT_OPTIONS$2={disableNormalization:!1},createPeriodicWaveConstructor=(s,e,t,n)=>class fr{constructor(i,o){const a=e(i),c=n({...DEFAULT_OPTIONS$2,...o}),l=s(a,c);return t.add(l),l}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===fr.prototype||t.has(i)}},createRenderAutomation=(s,e)=>(t,n,r)=>(s(n).replay(r),e(n,t,r)),createRenderInputsOfAudioNode=(s,e,t)=>async(n,r,i)=>{const o=s(n);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const g=await e(l).render(l,r),y=n.context.destination;!t(l)&&(n!==y||!t(n))&&g.connect(i,u,c)})).reduce((a,c)=>[...a,...c],[]))},createRenderInputsOfAudioParam=(s,e,t)=>async(n,r,i)=>{const o=e(n);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await s(a).render(a,r);t(a)||u.connect(i,c)}))},createRenderNativeOfflineAudioContext=(s,e,t,n)=>r=>s(testPromiseSupport,()=>testPromiseSupport(r))?Promise.resolve(s(n,n)).then(i=>{if(!i){const o=t(r,512,0,1);r.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>r.currentTime,o.connect(r.destination)}return r.startRendering()}):new Promise(i=>{const o=e(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.oncomplete=a=>{o.disconnect(),i(a.renderedBuffer)},o.connect(r.destination),r.startRendering()}),createSetActiveAudioWorkletNodeInputs=s=>(e,t)=>{s.set(e,t)},createSetAudioNodeTailTime=s=>(e,t)=>s.set(e,t),createStartRendering=(s,e,t,n,r,i,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(n(l)).map(u=>t(u).render(u,l)))).then(()=>r(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),wrapAudioBufferGetChannelDataMethod(u)):e(i,()=>i(u))||a(u),s.add(u),u)),DEFAULT_OPTIONS$1={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},createStereoPannerNodeConstructor=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=r(a),u={...DEFAULT_OPTIONS$1,...c},p=t(l,u),g=i(l),y=g?n():null;super(a,!1,p,y),this._pan=e(this,g,p.pan)}get pan(){return this._pan}},createStereoPannerNodeRendererFactory=(s,e,t,n,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=isOwnedByContext(l,c);if(!u){const p={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,p)}return i.set(c,l),u?await s(c,a.pan,l.pan):await n(c,a.pan,l.pan),isNativeAudioNodeFaker(l)?await r(a,c,l.inputs[0]):await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},createTestAudioBufferConstructorSupport=s=>()=>{if(s===null)return!1;try{new s({length:1,sampleRate:44100})}catch{return!1}return!0},createTestAudioWorkletProcessorPostMessageSupport=(s,e)=>async()=>{if(s===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),r=URL.createObjectURL(t);let i=!1,o=!1;try{await n.audioWorklet.addModule(r);const a=new s(n,"a",{numberOfOutputs:0}),c=n.createOscillator();a.port.onmessage=()=>i=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await n.startRendering()}catch{}finally{URL.revokeObjectURL(r)}return i&&!o},createTestOfflineAudioContextCurrentTimeSupport=(s,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),n=s(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(r=>{t.oncomplete=()=>{n.disconnect(),r(t.currentTime!==0)},t.startRendering()})},createUnknownError=()=>new DOMException("","UnknownError"),DEFAULT_OPTIONS={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},createWaveShaperNodeConstructor=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),p={...DEFAULT_OPTIONS,...l},g=t(u,p),h=i(u)?n():null;super(c,!0,g,h),this._isCurveNullified=!1,this._nativeWaveShaperNode=g,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},createWaveShaperNodeRendererFactory=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=s(o,l)}return n.set(o,a),isNativeAudioNodeFaker(a)?await t(i,o,a.inputs[0]):await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},createWindow=()=>typeof window>"u"?null:window,createWrapAudioBufferCopyChannelMethods=(s,e)=>t=>{t.copyFromChannel=(n,r,i=0)=>{const o=s(i),a=s(r);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=n.length;for(let p=o<0?-o:0;p+o<c&&p<u;p+=1)n[p]=l[p+o]},t.copyToChannel=(n,r,i=0)=>{const o=s(i),a=s(r);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=n.length;for(let p=o<0?-o:0;p+o<c&&p<u;p+=1)l[p+o]=n[p]}},createWrapAudioBufferCopyChannelMethodsOutOfBounds=s=>e=>{e.copyFromChannel=(t=>(n,r,i=0)=>{const o=s(i),a=s(r);if(o<e.length)return t.call(e,n,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(n,r,i=0)=>{const o=s(i),a=s(r);if(o<e.length)return t.call(e,n,a,o)})(e.copyToChannel)},createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer=s=>(e,t)=>{const n=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),s(e,"buffer",r=>()=>{const i=r.call(e);return i===n?null:i},r=>i=>r.call(e,i===null?n:i))},createWrapChannelMergerNode=(s,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw s()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw s()}});const r=t.createBufferSource();e(n,()=>{const a=n.numberOfInputs;for(let c=0;c<a;c+=1)r.connect(n,0,c)},()=>r.disconnect(n))},getFirstSample=(s,e,t)=>s.copyFromChannel===void 0?s.getChannelData(t)[0]:(s.copyFromChannel(e,t),e[0]),isDCCurve=s=>{if(s===null)return!1;const e=s.length;return e%2!==0?s[Math.floor(e/2)]!==0:s[e/2-1]+s[e/2]!==0},overwriteAccessors=(s,e,t,n)=>{let r=s;for(;!r.hasOwnProperty(e);)r=Object.getPrototypeOf(r);const{get:i,set:o}=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(s,e,{get:t(i),set:n(o)})},sanitizeAudioWorkletNodeOptions=s=>({...s,outputChannelCount:s.outputChannelCount!==void 0?s.outputChannelCount:s.numberOfInputs===1&&s.numberOfOutputs===1?[s.channelCount]:Array.from({length:s.numberOfOutputs},()=>1)}),sanitizeChannelSplitterOptions=s=>({...s,channelCount:s.numberOfOutputs}),sanitizePeriodicWaveOptions=s=>{const{imag:e,real:t}=s;return e===void 0?t===void 0?{...s,imag:[0,0],real:[0,0]}:{...s,imag:Array.from(t,()=>0),real:t}:t===void 0?{...s,imag:e,real:Array.from(e,()=>0)}:{...s,imag:e,real:t}},setValueAtTimeUntilPossible=(s,e,t)=>{try{s.setValueAtTime(e,t)}catch(n){if(n.code!==9)throw n;setValueAtTimeUntilPossible(s,e,t+1e-7)}},testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport=s=>{const e=s.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},testAudioBufferSourceNodeStartMethodOffsetClampingSupport=s=>{const e=s.createBufferSource(),t=s.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},testAudioBufferSourceNodeStopMethodNullifiedBufferSupport=s=>{const e=s.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},testAudioScheduledSourceNodeStartMethodNegativeParametersSupport=s=>{const e=s.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport=s=>{const e=s.createBuffer(1,1,44100),t=s.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},testAudioScheduledSourceNodeStopMethodNegativeParametersSupport=s=>{const e=s.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},testAudioWorkletNodeOptionsClonability=s=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(s)}finally{e.close(),t.close()}},wrapAudioBufferSourceNodeStartMethodOffsetClamping=s=>{s.start=(e=>(t=0,n=0,r)=>{const i=s.buffer,o=i===null?n:Math.min(i.duration,n);i!==null&&o>i.duration-.5/s.context.sampleRate?e.call(s,t,0,0):e.call(s,t,o,r)})(s.start)},wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls=(s,e)=>{const t=e.createGain();s.connect(t);const n=(r=>()=>{r.call(s,t),s.removeEventListener("ended",n)})(s.disconnect);s.addEventListener("ended",n),interceptConnections(s,t),s.stop=(r=>{let i=!1;return(o=0)=>{if(i)try{r.call(s,o)}catch{t.gain.setValueAtTime(0,o)}else r.call(s,o),i=!0}})(s.stop)},wrapEventListener=(s,e)=>t=>{const n={value:s};return Object.defineProperties(t,{currentTarget:n,target:n}),typeof e=="function"?e.call(s,t):e.handleEvent.call(s,t)},addActiveInputConnectionToAudioNode=createAddActiveInputConnectionToAudioNode(insertElementInSet),addPassiveInputConnectionToAudioNode=createAddPassiveInputConnectionToAudioNode(insertElementInSet),deleteActiveInputConnectionToAudioNode=createDeleteActiveInputConnectionToAudioNode(pickElementFromSet),audioNodeTailTimeStore=new WeakMap,getAudioNodeTailTime=createGetAudioNodeTailTime(audioNodeTailTimeStore),cacheTestResult=createCacheTestResult(new Map,new WeakMap),window$1=createWindow(),createNativeAnalyserNode=createNativeAnalyserNodeFactory(cacheTestResult,createIndexSizeError),getAudioNodeRenderer=createGetAudioNodeRenderer(getAudioNodeConnections),renderInputsOfAudioNode=createRenderInputsOfAudioNode(getAudioNodeConnections,getAudioNodeRenderer,isPartOfACycle),createAnalyserNodeRenderer=createAnalyserNodeRendererFactory(createNativeAnalyserNode,getNativeAudioNode,renderInputsOfAudioNode),getNativeContext=createGetNativeContext(CONTEXT_STORE),nativeOfflineAudioContextConstructor=createNativeOfflineAudioContextConstructor(window$1),isNativeOfflineAudioContext=createIsNativeOfflineAudioContext(nativeOfflineAudioContextConstructor),audioParamAudioNodeStore=new WeakMap,eventTargetConstructor=createEventTargetConstructor(wrapEventListener),nativeAudioContextConstructor=createNativeAudioContextConstructor(window$1),isNativeAudioContext=createIsNativeAudioContext(nativeAudioContextConstructor),isNativeAudioNode=createIsNativeAudioNode(window$1),isNativeAudioParam=createIsNativeAudioParam(window$1),nativeAudioWorkletNodeConstructor=createNativeAudioWorkletNodeConstructor(window$1),audioNodeConstructor=createAudioNodeConstructor(createAddAudioNodeConnections(AUDIO_NODE_CONNECTIONS_STORE),createAddConnectionToAudioNode(addActiveInputConnectionToAudioNode,addPassiveInputConnectionToAudioNode,connectNativeAudioNodeToNativeAudioNode,deleteActiveInputConnectionToAudioNode,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getAudioNodeTailTime,getEventListenersOfAudioNode,getNativeAudioNode,insertElementInSet,isActiveAudioNode,isPartOfACycle,isPassiveAudioNode),cacheTestResult,createIncrementCycleCounterFactory(CYCLE_COUNTERS,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,isActiveAudioNode),createIndexSizeError,createInvalidAccessError,createNotSupportedError,createDecrementCycleCounter(connectNativeAudioNodeToNativeAudioNode,CYCLE_COUNTERS,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,getNativeContext,isActiveAudioNode,isNativeOfflineAudioContext),createDetectCycles(audioParamAudioNodeStore,getAudioNodeConnections,getValueForKey),eventTargetConstructor,getNativeContext,isNativeAudioContext,isNativeAudioNode,isNativeAudioParam,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor),analyserNodeConstructor=createAnalyserNodeConstructor(audioNodeConstructor,createAnalyserNodeRenderer,createIndexSizeError,createNativeAnalyserNode,getNativeContext,isNativeOfflineAudioContext),audioBufferStore=new WeakSet,nativeAudioBufferConstructor=createNativeAudioBufferConstructor(window$1),convertNumberToUnsignedLong=createConvertNumberToUnsignedLong(new Uint32Array(1)),wrapAudioBufferCopyChannelMethods=createWrapAudioBufferCopyChannelMethods(convertNumberToUnsignedLong,createIndexSizeError),wrapAudioBufferCopyChannelMethodsOutOfBounds=createWrapAudioBufferCopyChannelMethodsOutOfBounds(convertNumberToUnsignedLong),audioBufferConstructor=createAudioBufferConstructor(audioBufferStore,cacheTestResult,createNotSupportedError,nativeAudioBufferConstructor,nativeOfflineAudioContextConstructor,createTestAudioBufferConstructorSupport(nativeAudioBufferConstructor),wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),addSilentConnection=createAddSilentConnection(createNativeGainNode),renderInputsOfAudioParam=createRenderInputsOfAudioParam(getAudioNodeRenderer,getAudioParamConnections,isPartOfACycle),connectAudioParam=createConnectAudioParam(renderInputsOfAudioParam),createNativeAudioBufferSourceNode=createNativeAudioBufferSourceNodeFactory(addSilentConnection,cacheTestResult,testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport,testAudioBufferSourceNodeStartMethodOffsetClampingSupport,testAudioBufferSourceNodeStopMethodNullifiedBufferSupport,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioBufferSourceNodeStartMethodOffsetClamping,createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer(overwriteAccessors),wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),renderAutomation=createRenderAutomation(createGetAudioParamRenderer(getAudioParamConnections),renderInputsOfAudioParam),createAudioBufferSourceNodeRenderer=createAudioBufferSourceNodeRendererFactory(connectAudioParam,createNativeAudioBufferSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),createAudioParam=createAudioParamFactory(createAddAudioParamConnections(AUDIO_PARAM_CONNECTIONS_STORE),audioParamAudioNodeStore,AUDIO_PARAM_STORE,createAudioParamRenderer,createCancelAndHoldAutomationEvent,createCancelScheduledValuesAutomationEvent,createExponentialRampToValueAutomationEvent,createLinearRampToValueAutomationEvent,createSetTargetAutomationEvent,createSetValueAutomationEvent,createSetValueCurveAutomationEvent,nativeAudioContextConstructor,setValueAtTimeUntilPossible),audioBufferSourceNodeConstructor=createAudioBufferSourceNodeConstructor(audioNodeConstructor,createAudioBufferSourceNodeRenderer,createAudioParam,createInvalidStateError,createNativeAudioBufferSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),audioDestinationNodeConstructor=createAudioDestinationNodeConstructor(audioNodeConstructor,createAudioDestinationNodeRenderer,createIndexSizeError,createInvalidStateError,createNativeAudioDestinationNodeFactory(createNativeGainNode,overwriteAccessors),getNativeContext,isNativeOfflineAudioContext,renderInputsOfAudioNode),createBiquadFilterNodeRenderer=createBiquadFilterNodeRendererFactory(connectAudioParam,createNativeBiquadFilterNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),setAudioNodeTailTime=createSetAudioNodeTailTime(audioNodeTailTimeStore),biquadFilterNodeConstructor=createBiquadFilterNodeConstructor(audioNodeConstructor,createAudioParam,createBiquadFilterNodeRenderer,createInvalidAccessError,createNativeBiquadFilterNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),monitorConnections=createMonitorConnections(insertElementInSet,isNativeAudioNode),wrapChannelMergerNode=createWrapChannelMergerNode(createInvalidStateError,monitorConnections),createNativeChannelMergerNode=createNativeChannelMergerNodeFactory(nativeAudioContextConstructor,wrapChannelMergerNode),createChannelMergerNodeRenderer=createChannelMergerNodeRendererFactory(createNativeChannelMergerNode,getNativeAudioNode,renderInputsOfAudioNode),channelMergerNodeConstructor=createChannelMergerNodeConstructor(audioNodeConstructor,createChannelMergerNodeRenderer,createNativeChannelMergerNode,getNativeContext,isNativeOfflineAudioContext),createChannelSplitterNodeRenderer=createChannelSplitterNodeRendererFactory(createNativeChannelSplitterNode,getNativeAudioNode,renderInputsOfAudioNode),channelSplitterNodeConstructor=createChannelSplitterNodeConstructor(audioNodeConstructor,createChannelSplitterNodeRenderer,createNativeChannelSplitterNode,getNativeContext,isNativeOfflineAudioContext,sanitizeChannelSplitterOptions),createNativeConstantSourceNodeFaker=createNativeConstantSourceNodeFakerFactory(addSilentConnection,createNativeAudioBufferSourceNode,createNativeGainNode,monitorConnections),createNativeConstantSourceNode=createNativeConstantSourceNodeFactory(addSilentConnection,cacheTestResult,createNativeConstantSourceNodeFaker,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport),createConstantSourceNodeRenderer=createConstantSourceNodeRendererFactory(connectAudioParam,createNativeConstantSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),constantSourceNodeConstructor=createConstantSourceNodeConstructor(audioNodeConstructor,createAudioParam,createConstantSourceNodeRenderer,createNativeConstantSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createNativeConvolverNode=createNativeConvolverNodeFactory(createNotSupportedError,overwriteAccessors),createConvolverNodeRenderer=createConvolverNodeRendererFactory(createNativeConvolverNode,getNativeAudioNode,renderInputsOfAudioNode),convolverNodeConstructor=createConvolverNodeConstructor(audioNodeConstructor,createConvolverNodeRenderer,createNativeConvolverNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createDelayNodeRenderer=createDelayNodeRendererFactory(connectAudioParam,createNativeDelayNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),delayNodeConstructor=createDelayNodeConstructor(audioNodeConstructor,createAudioParam,createDelayNodeRenderer,createNativeDelayNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativeDynamicsCompressorNode=createNativeDynamicsCompressorNodeFactory(createNotSupportedError),createDynamicsCompressorNodeRenderer=createDynamicsCompressorNodeRendererFactory(connectAudioParam,createNativeDynamicsCompressorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),dynamicsCompressorNodeConstructor=createDynamicsCompressorNodeConstructor(audioNodeConstructor,createAudioParam,createDynamicsCompressorNodeRenderer,createNativeDynamicsCompressorNode,createNotSupportedError,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createGainNodeRenderer=createGainNodeRendererFactory(connectAudioParam,createNativeGainNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),gainNodeConstructor=createGainNodeConstructor(audioNodeConstructor,createAudioParam,createGainNodeRenderer,createNativeGainNode,getNativeContext,isNativeOfflineAudioContext),createNativeIIRFilterNodeFaker=createNativeIIRFilterNodeFakerFactory(createInvalidAccessError,createInvalidStateError,createNativeScriptProcessorNode,createNotSupportedError),renderNativeOfflineAudioContext=createRenderNativeOfflineAudioContext(cacheTestResult,createNativeGainNode,createNativeScriptProcessorNode,createTestOfflineAudioContextCurrentTimeSupport(createNativeGainNode,nativeOfflineAudioContextConstructor)),createIIRFilterNodeRenderer=createIIRFilterNodeRendererFactory(createNativeAudioBufferSourceNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderInputsOfAudioNode,renderNativeOfflineAudioContext),createNativeIIRFilterNode=createNativeIIRFilterNodeFactory(createNativeIIRFilterNodeFaker),iIRFilterNodeConstructor=createIIRFilterNodeConstructor(audioNodeConstructor,createNativeIIRFilterNode,createIIRFilterNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createAudioListener=createAudioListenerFactory(createAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeScriptProcessorNode,createNotSupportedError,getFirstSample,isNativeOfflineAudioContext,overwriteAccessors),unrenderedAudioWorkletNodeStore=new WeakMap,minimalBaseAudioContextConstructor=createMinimalBaseAudioContextConstructor(audioDestinationNodeConstructor,createAudioListener,eventTargetConstructor,isNativeOfflineAudioContext,unrenderedAudioWorkletNodeStore,wrapEventListener),createNativeOscillatorNode=createNativeOscillatorNodeFactory(addSilentConnection,cacheTestResult,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),createOscillatorNodeRenderer=createOscillatorNodeRendererFactory(connectAudioParam,createNativeOscillatorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),oscillatorNodeConstructor=createOscillatorNodeConstructor(audioNodeConstructor,createAudioParam,createNativeOscillatorNode,createOscillatorNodeRenderer,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createConnectedNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNodeFactory(createNativeAudioBufferSourceNode),createNativeWaveShaperNodeFaker=createNativeWaveShaperNodeFakerFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeGainNode,isDCCurve,monitorConnections),createNativeWaveShaperNode=createNativeWaveShaperNodeFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeWaveShaperNodeFaker,isDCCurve,monitorConnections,nativeAudioContextConstructor,overwriteAccessors),createNativePannerNodeFaker=createNativePannerNodeFakerFactory(connectNativeAudioNodeToNativeAudioNode,createInvalidStateError,createNativeChannelMergerNode,createNativeGainNode,createNativeScriptProcessorNode,createNativeWaveShaperNode,createNotSupportedError,disconnectNativeAudioNodeFromNativeAudioNode,getFirstSample,monitorConnections),createNativePannerNode=createNativePannerNodeFactory(createNativePannerNodeFaker),createPannerNodeRenderer=createPannerNodeRendererFactory(connectAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeGainNode,createNativePannerNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),pannerNodeConstructor=createPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativePannerNode,createPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativePeriodicWave=createNativePeriodicWaveFactory(createIndexSizeError),periodicWaveConstructor=createPeriodicWaveConstructor(createNativePeriodicWave,getNativeContext,new WeakSet,sanitizePeriodicWaveOptions),nativeStereoPannerNodeFakerFactory=createNativeStereoPannerNodeFakerFactory(createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeGainNode,createNativeWaveShaperNode,createNotSupportedError,monitorConnections),createNativeStereoPannerNode=createNativeStereoPannerNodeFactory(nativeStereoPannerNodeFakerFactory,createNotSupportedError),createStereoPannerNodeRenderer=createStereoPannerNodeRendererFactory(connectAudioParam,createNativeStereoPannerNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),stereoPannerNodeConstructor=createStereoPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativeStereoPannerNode,createStereoPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext),createWaveShaperNodeRenderer=createWaveShaperNodeRendererFactory(createNativeWaveShaperNode,getNativeAudioNode,renderInputsOfAudioNode),waveShaperNodeConstructor=createWaveShaperNodeConstructor(audioNodeConstructor,createInvalidStateError,createNativeWaveShaperNode,createWaveShaperNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),isSecureContext=createIsSecureContext(window$1),exposeCurrentFrameAndCurrentTime=createExposeCurrentFrameAndCurrentTime(window$1),backupOfflineAudioContextStore=new WeakMap,getOrCreateBackupOfflineAudioContext=createGetOrCreateBackupOfflineAudioContext(backupOfflineAudioContextStore,nativeOfflineAudioContextConstructor),addAudioWorkletModule=isSecureContext?createAddAudioWorkletModule(cacheTestResult,createNotSupportedError,createEvaluateSource(window$1),exposeCurrentFrameAndCurrentTime,createFetchSource(createAbortError),getNativeContext,getOrCreateBackupOfflineAudioContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,new WeakMap,new WeakMap,createTestAudioWorkletProcessorPostMessageSupport(nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor),window$1):void 0,isNativeContext=createIsNativeContext(isNativeAudioContext,isNativeOfflineAudioContext),decodeAudioData=createDecodeAudioData(audioBufferStore,cacheTestResult,createDataCloneError,createEncodingError,new WeakSet,getNativeContext,isNativeContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,testPromiseSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),baseAudioContextConstructor=createBaseAudioContextConstructor(addAudioWorkletModule,analyserNodeConstructor,audioBufferConstructor,audioBufferSourceNodeConstructor,biquadFilterNodeConstructor,channelMergerNodeConstructor,channelSplitterNodeConstructor,constantSourceNodeConstructor,convolverNodeConstructor,decodeAudioData,delayNodeConstructor,dynamicsCompressorNodeConstructor,gainNodeConstructor,iIRFilterNodeConstructor,minimalBaseAudioContextConstructor,oscillatorNodeConstructor,pannerNodeConstructor,periodicWaveConstructor,stereoPannerNodeConstructor,waveShaperNodeConstructor),mediaElementAudioSourceNodeConstructor=createMediaElementAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaElementAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioDestinationNodeConstructor=createMediaStreamAudioDestinationNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioDestinationNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioSourceNodeConstructor=createMediaStreamAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),createNativeMediaStreamTrackAudioSourceNode=createNativeMediaStreamTrackAudioSourceNodeFactory(createInvalidStateError,isNativeOfflineAudioContext),mediaStreamTrackAudioSourceNodeConstructor=createMediaStreamTrackAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamTrackAudioSourceNode,getNativeContext),audioContextConstructor=createAudioContextConstructor(baseAudioContextConstructor,createInvalidStateError,createNotSupportedError,createUnknownError,mediaElementAudioSourceNodeConstructor,mediaStreamAudioDestinationNodeConstructor,mediaStreamAudioSourceNodeConstructor,mediaStreamTrackAudioSourceNodeConstructor,nativeAudioContextConstructor),getUnrenderedAudioWorkletNodes=createGetUnrenderedAudioWorkletNodes(unrenderedAudioWorkletNodeStore),addUnrenderedAudioWorkletNode=createAddUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),connectMultipleOutputs=createConnectMultipleOutputs(createIndexSizeError),deleteUnrenderedAudioWorkletNode=createDeleteUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),disconnectMultipleOutputs=createDisconnectMultipleOutputs(createIndexSizeError),activeAudioWorkletNodeInputsStore=new WeakMap,getActiveAudioWorkletNodeInputs=createGetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore,getValueForKey),createNativeAudioWorkletNodeFaker=createNativeAudioWorkletNodeFakerFactory(connectMultipleOutputs,createIndexSizeError,createInvalidStateError,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,createNativeScriptProcessorNode,createNotSupportedError,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getActiveAudioWorkletNodeInputs,monitorConnections),createNativeAudioWorkletNode=createNativeAudioWorkletNodeFactory(createInvalidStateError,createNativeAudioWorkletNodeFaker,createNativeGainNode,createNotSupportedError,monitorConnections),createAudioWorkletNodeRenderer=createAudioWorkletNodeRendererFactory(connectAudioParam,connectMultipleOutputs,createNativeAudioBufferSourceNode,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,deleteUnrenderedAudioWorkletNode,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getNativeAudioNode,nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),getBackupOfflineAudioContext=createGetBackupOfflineAudioContext(backupOfflineAudioContextStore),setActiveAudioWorkletNodeInputs=createSetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore),audioWorkletNodeConstructor=isSecureContext?createAudioWorkletNodeConstructor(addUnrenderedAudioWorkletNode,audioNodeConstructor,createAudioParam,createAudioWorkletNodeRenderer,createNativeAudioWorkletNode,getAudioNodeConnections,getBackupOfflineAudioContext,getNativeContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,sanitizeAudioWorkletNodeOptions,setActiveAudioWorkletNodeInputs,testAudioWorkletNodeOptionsClonability,wrapEventListener):void 0,createNativeOfflineAudioContext=createCreateNativeOfflineAudioContext(createNotSupportedError,nativeOfflineAudioContextConstructor),startRendering=createStartRendering(audioBufferStore,cacheTestResult,getAudioNodeRenderer,getUnrenderedAudioWorkletNodes,renderNativeOfflineAudioContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),offlineAudioContextConstructor=createOfflineAudioContextConstructor(baseAudioContextConstructor,cacheTestResult,createInvalidStateError,createNativeOfflineAudioContext,startRendering),isAnyAudioContext=createIsAnyAudioContext(CONTEXT_STORE,isNativeAudioContext),isAnyAudioNode=createIsAnyAudioNode(AUDIO_NODE_STORE,isNativeAudioNode),isAnyAudioParam=createIsAnyAudioParam(AUDIO_PARAM_STORE,isNativeAudioParam),isAnyOfflineAudioContext=createIsAnyOfflineAudioContext(CONTEXT_STORE,isNativeOfflineAudioContext);function assert(s,e){if(!s)throw new Error(e)}function assertRange(s,e,t=1/0){if(!(e<=s&&s<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${s}`)}function assertContextRunning(s){!s.isOffline&&s.state!=="running"&&warn('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let defaultLogger=console;function log(...s){defaultLogger.log(...s)}function warn(...s){defaultLogger.warn(...s)}function isUndef(s){return typeof s>"u"}function isDefined(s){return!isUndef(s)}function isFunction(s){return typeof s=="function"}function isNumber(s){return typeof s=="number"}function isObject(s){return Object.prototype.toString.call(s)==="[object Object]"&&s.constructor===Object}function isBoolean(s){return typeof s=="boolean"}function isArray(s){return Array.isArray(s)}function isString(s){return typeof s=="string"}function isNote(s){return isString(s)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(s)}function createAudioContext(s){return new audioContextConstructor(s)}function createOfflineAudioContext(s,e,t){return new offlineAudioContextConstructor(s,e,t)}const theWindow=typeof self=="object"?self:null,hasAudioContext=theWindow&&(theWindow.hasOwnProperty("AudioContext")||theWindow.hasOwnProperty("webkitAudioContext"));function createAudioWorkletNode(s,e,t){return assert(isDefined(audioWorkletNodeConstructor),"This node only works in a secure context (https or localhost)"),new audioWorkletNodeConstructor(s,e,t)}function __decorate(s,e,t,n){var r=arguments.length,i=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(i=(r<3?o(i):r>3?o(e,t,i):o(e,t))||i);return r>3&&i&&Object.defineProperty(e,t,i),i}function __awaiter(s,e,t,n){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(n.next(u))}catch(p){o(p)}}function c(u){try{l(n.throw(u))}catch(p){o(p)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((n=n.apply(s,e||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;class Ticker{constructor(e,t,n){this._callback=e,this._type=t,this._updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(e*1e3,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function isAudioParam(s){return isAnyAudioParam(s)}function isAudioNode(s){return isAnyAudioNode(s)}function isOfflineAudioContext(s){return isAnyOfflineAudioContext(s)}function isAudioContext(s){return isAnyAudioContext(s)}function isAudioBuffer(s){return s instanceof AudioBuffer}function noCopy(s,e){return s==="value"||isAudioParam(e)||isAudioNode(e)||isAudioBuffer(e)}function deepMerge(s,...e){if(!e.length)return s;const t=e.shift();if(isObject(s)&&isObject(t))for(const n in t)noCopy(n,t[n])?s[n]=t[n]:isObject(t[n])?(s[n]||Object.assign(s,{[n]:{}}),deepMerge(s[n],t[n])):Object.assign(s,{[n]:t[n]});return deepMerge(s,...e)}function deepEquals(s,e){return s.length===e.length&&s.every((t,n)=>e[n]===t)}function optionsFromArguments(s,e,t=[],n){const r={},i=Array.from(e);if(isObject(i[0])&&n&&!Reflect.has(i[0],n)&&(Object.keys(i[0]).some(a=>Reflect.has(s,a))||(deepMerge(r,{[n]:i[0]}),t.splice(t.indexOf(n),1),i.shift())),i.length===1&&isObject(i[0]))deepMerge(r,i[0]);else for(let o=0;o<t.length;o++)isDefined(i[o])&&(r[t[o]]=i[o]);return deepMerge(s,r)}function getDefaultsFromInstance(s){return s.constructor.getDefaults()}function defaultArg(s,e){return isUndef(s)?e:s}function omitFromObject(s,e){return e.forEach(t=>{Reflect.has(s,t)&&delete s[t]}),s}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Tone{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||theWindow&&this.toString()===theWindow.TONE_DEBUG_CLASS)&&log(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Tone.version=version;const EPSILON=1e-6;function GT(s,e){return s>e+EPSILON}function GTE(s,e){return GT(s,e)||EQ(s,e)}function LT(s,e){return s+EPSILON<e}function EQ(s,e){return Math.abs(s-e)<EPSILON}function clamp(s,e,t){return Math.max(Math.min(s,t),e)}class Timeline extends Tone{constructor(){super(),this.name="Timeline",this._timeline=[];const e=optionsFromArguments(Timeline.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(assert(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];assert(GTE(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(EQ(this._timeline[t].time,e)){for(let n=t;n>=0&&EQ(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&GTE(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let n=0;const r=this._timeline.length;let i=r;if(r>0&&this._timeline[r-1][t]<=e)return r-1;for(;n<i;){let o=Math.floor(n+(i-n)/2);const a=this._timeline[o],c=this._timeline[o+1];if(EQ(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(EQ(u[t],e))o=l;else break}return o}else{if(LT(a[t],e)&&GT(c[t],e))return o;GT(a[t],e)?i=o:n=o+1}}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return n!==-1&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let r=this._search(e),i=this._search(t);return r!==-1&&i!==-1?(this._timeline[r].time!==e&&(r+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,r,i)):r===-1&&this._iterate(n,0,i),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(n!==-1&&EQ(this._timeline[n].time,e)){let r=n;for(let i=n;i>=0&&EQ(this._timeline[i].time,e);i--)r=i;this._iterate(i=>{t(i)},r,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const notifyNewContext=[];function onContextInit(s){notifyNewContext.push(s)}function initializeContext(s){notifyNewContext.forEach(e=>e(s))}const notifyCloseContext=[];function onContextClose(s){notifyCloseContext.push(s)}function closeContext(s){notifyCloseContext.forEach(e=>e(s))}class Emitter extends Tone{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(r=>{isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(r)||(this._events[r]=[]),this._events[r].push(t)}),this}once(e,t){const n=(...r)=>{t(...r),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(r=>{if(isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(isUndef(t))this._events[e]=[];else{const i=this._events[e];for(let o=i.length-1;o>=0;o--)i[o]===t&&i.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let r=0,i=n.length;r<i;r++)n[r].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const n=Object.getOwnPropertyDescriptor(Emitter.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class BaseContext extends Emitter{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Context extends BaseContext{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Timeline,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=optionsFromArguments(Context.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=createAudioContext({latencyHint:e.latencyHint}),this._ticker=new Ticker(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(initializeContext(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){assert(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){assert(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){assert(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){assert(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return createAudioWorkletNode(this.rawContext,e,t)}addAudioWorkletModule(e,t){return __awaiter(this,void 0,void 0,function*(){assert(isDefined(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)})}workletsAreReady(){return __awaiter(this,void 0,void 0,function*(){const e=[];this._workletModules.forEach(t=>e.push(t)),yield Promise.all(e)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,isString(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25;break}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return isAudioContext(this._context)?this._context.resume():Promise.resolve()}close(){return __awaiter(this,void 0,void 0,function*(){isAudioContext(this._context)&&(yield this._context.close()),this._initialized&&closeContext(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=e;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=t,r.loop=!0,r.start(0),this._constants.set(e,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,r=()=>{const i=this.now();this._timeouts.add({callback:()=>{e(),r()},id:n,time:i+t})};return r(),n}}class DummyContext extends BaseContext{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return __awaiter(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function readOnly(s,e){isArray(e)?e.forEach(t=>readOnly(s,t)):Object.defineProperty(s,e,{enumerable:!0,writable:!1})}function writable(s,e){isArray(e)?e.forEach(t=>writable(s,t)):Object.defineProperty(s,e,{writable:!0})}const noOp=()=>{};class ToneAudioBuffer extends Tone{constructor(){super(),this.name="ToneAudioBuffer",this.onload=noOp;const e=optionsFromArguments(ToneAudioBuffer.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&isAudioBuffer(e.url)||e.url instanceof ToneAudioBuffer?this.set(e.url):isString(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:noOp,onload:noOp,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:getContext().sampleRate}set(e){return e instanceof ToneAudioBuffer?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return __awaiter(this,void 0,void 0,function*(){const t=ToneAudioBuffer.load(e).then(n=>{this.set(n),this.onload(this)});ToneAudioBuffer.downloads.push(t);try{yield t}finally{const n=ToneAudioBuffer.downloads.indexOf(t);ToneAudioBuffer.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=isArray(e)&&e[0].length>0,n=t?e.length:1,r=t?e[0].length:e.length,i=getContext(),o=i.createBuffer(n,r,i.sampleRate),a=!t&&n===1?[e]:e;for(let c=0;c<n;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(isNumber(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const n=this.numberOfChannels;for(let r=0;r<n;r++){const i=this.toArray(r);for(let o=0;o<i.length;o++)t[o]+=i[o]}t=t.map(r=>r/n),this.fromArray(t)}return this}toArray(e){if(isNumber(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const n=Math.floor(e*this.sampleRate),r=Math.floor(t*this.sampleRate);assert(n<r,"The start time must be less than the end time");const i=r-n,o=getContext().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(n,r),a);return new ToneAudioBuffer(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new ToneAudioBuffer().fromArray(e)}static fromUrl(e){return __awaiter(this,void 0,void 0,function*(){return yield new ToneAudioBuffer().load(e)})}static load(e){return __awaiter(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const a=t[1].split("|");let c=a[0];for(const l of a)if(ToneAudioBuffer.supportsType(l)){c=l;break}e=e.replace(t[0],c)}const n=ToneAudioBuffer.baseUrl===""||ToneAudioBuffer.baseUrl.endsWith("/")?ToneAudioBuffer.baseUrl:ToneAudioBuffer.baseUrl+"/",r=yield fetch(n+e);if(!r.ok)throw new Error(`could not load url: ${e}`);const i=yield r.arrayBuffer();return yield getContext().decodeAudioData(i)})}static supportsType(e){const t=e.split("."),n=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return __awaiter(this,void 0,void 0,function*(){for(yield Promise.resolve();ToneAudioBuffer.downloads.length;)yield ToneAudioBuffer.downloads[0]})}}ToneAudioBuffer.baseUrl="";ToneAudioBuffer.downloads=[];class OfflineContext extends Context{constructor(){super({clockSource:"offline",context:isOfflineAudioContext(arguments[0])?arguments[0]:createOfflineAudioContext(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:isOfflineAudioContext(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=isOfflineAudioContext(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return __awaiter(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(r=>setTimeout(r,1)))}})}render(e=!0){return __awaiter(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new ToneAudioBuffer(t)})}close(){return Promise.resolve()}}const dummyContext=new DummyContext;let globalContext=dummyContext;function getContext(){return globalContext===dummyContext&&hasAudioContext&&setContext(new Context),globalContext}function setContext(s){isAudioContext(s)?globalContext=new Context(s):isOfflineAudioContext(s)?globalContext=new OfflineContext(s):globalContext=s}function start(){return globalContext.resume()}if(theWindow&&!theWindow.TONE_SILENCE_LOGGING){const e=` * Tone.js v${version} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function dbToGain(s){return Math.pow(10,s/20)}function gainToDb(s){return 20*(Math.log(s)/Math.LN10)}function intervalToFrequencyRatio(s){return Math.pow(2,s/12)}let A4=440;function getA4(){return A4}function setA4(s){A4=s}function ftom(s){return Math.round(ftomf(s))}function ftomf(s){return 69+12*Math.log2(s/A4)}function mtof(s){return A4*Math.pow(2,(s-69)/12)}class TimeBaseClass extends Tone{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),r=t==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/n)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let r=0;return e&&e!=="0"&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(r+=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(r+=this._beatsToUnits(parseFloat(n)/4)),r},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof TimeBaseClass&&this.fromType(this._val),isUndef(this._val))return this._noArg();if(isString(this._val)&&isUndef(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(isObject(this._val)){let e=0;for(const t in this._val)if(isDefined(this._val[t])){const n=this._val[t],r=new this.constructor(this.context,t).valueOf()*n;e+=r}return e}if(isDefined(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return isString(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class TimeClass extends TimeBaseClass{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new TimeClass(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),r=this.valueOf(),a=Math.round(r/n)*n-r;return r+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let i=1;i<9;i++){const o=Math.pow(2,i);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let n=t[0],r=new TimeClass(this.context,t[0]).toSeconds();return t.forEach(i=>{const o=new TimeClass(this.context,i).toSeconds();Math.abs(o-e)<Math.abs(r-e)&&(n=i,r=o)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let r=t%1*4;t=Math.floor(t)%this._getTimeSignature();const i=r.toString();return i.length>3&&(r=parseFloat(parseFloat(i).toFixed(3))),[n,t,r].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ftom(this.toFrequency())}_now(){return this.context.now()}}class FrequencyClass extends TimeClass{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return getA4()}static set A4(e){setA4(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:FrequencyClass.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const r=noteToScaleIndex[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?r:FrequencyClass.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let r=1;return e&&e!=="0"&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(r*=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}})}transpose(e){return new FrequencyClass(this.context,this.valueOf()*intervalToFrequencyRatio(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return ftom(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/FrequencyClass.A4);let n=Math.round(12*t)+57;const r=Math.floor(n/12);return r<0&&(n+=-12*r),scaleIndexToNote[n%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return mtof(e)}static ftom(e){return ftom(e)}}const noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class TransportTimeClass extends TimeClass{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ToneWithContext extends Tone{constructor(){super();const e=optionsFromArguments(ToneWithContext.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:getContext()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new TimeClass(this.context,e).toSeconds()}toFrequency(e){return new FrequencyClass(this.context,e).toFrequency()}toTicks(e){return new TransportTimeClass(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(n=>{isUndef(e[n])&&delete t[n]}),t}get(){const e=getDefaultsFromInstance(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const n=this[t];isDefined(n)&&isDefined(n.value)&&isDefined(n.setValueAtTime)?e[t]=n.value:n instanceof ToneWithContext?e[t]=n._getPartialProperties(e[t]):isArray(n)||isNumber(n)||isString(n)||isBoolean(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&isDefined(this[t])&&(this[t]&&isDefined(this[t].value)&&isDefined(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof ToneWithContext?this[t].set(e[t]):this[t]=e[t])}),this}}class StateTimeline extends Timeline{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,n){return assertRange(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){const n=this._search(t);for(let r=n;r>=0;r--){const i=this._timeline[r];if(i.state===e)return i}}getNextState(e,t){const n=this._search(t);if(n!==-1)for(let r=n;r<this._timeline.length;r++){const i=this._timeline[r];if(i.state===e)return i}}}class Param extends ToneWithContext{constructor(){super(optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"]);for(assert(isDefined(e.param)&&(isAudioParam(e.param)||e.param instanceof Param),"param must be an AudioParam");!isAudioParam(e.param);)e.param=e.param._param;this._swappable=isDefined(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Timeline(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,isDefined(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return isDefined(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return isDefined(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return isDefined(this.maxValue)&&isDefined(this.minValue)&&assertRange(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?dbToGain(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?gainToDb(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),r=this._fromType(e);return assert(isFinite(r)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(r),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),r=this._events.get(t);let i=this._initialValue;if(r===null)i=this._initialValue;else if(r.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const o=this._events.getBefore(r.time);let a;o===null?a=this._initialValue:a=o.value,r.type==="setTargetAtTime"&&(i=this._exponentialApproach(r.time,a,r.value,r.constant,t))}else if(n===null)i=r.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let o=r.value;if(r.type==="setTargetAtTime"){const a=this._events.getBefore(r.time);a===null?o=this._initialValue:o=a.value}n.type==="linearRampToValueAtTime"?i=this._linearInterpolate(r.time,o,n.time,n.value,t):i=this._exponentialInterpolate(r.time,o,n.time,n.value,t)}else i=r.value;return this._toType(i)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),r=this.toSeconds(t);return assert(isFinite(n)&&isFinite(r),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:r,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,r),this._param.linearRampToValueAtTime(n,r),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=EQ(n,0)?this._minOutput:n,this._assertRange(n);const r=this.toSeconds(t);return assert(isFinite(n)&&isFinite(r),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,r),this._param.exponentialRampToValueAtTime(n,r),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const r=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,r),this.cancelAndHoldAtTime(t+n*.9),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const r=this._fromType(e);assert(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(t);return this._assertRange(r),assert(isFinite(r)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",e,i,n),this._param.setTargetAtTime(r,i,n),this}setValueCurveAtTime(e,t,n,r=1){n=this.toSeconds(n),t=this.toSeconds(t);const i=this._fromType(e[0])*r;this.setValueAtTime(this._toType(i),t);const o=n/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*r;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return assert(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));assert(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const r=this._events.get(t),i=this._events.getAfter(t);return r&&EQ(r.time,t)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),t):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&n.type==="setTargetAtTime"){const r=this._events.getAfter(n.time),i=r?r.time:t+2,o=(i-t)/10;for(let a=t;a<i;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,r=>{r.type==="cancelScheduledValues"?e.cancelScheduledValues(r.time):r.type==="setTargetAtTime"?e.setTargetAtTime(r.value,r.time,r.constant):e[r.type](r.value,r.time)}),this}setParam(e){assert(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,r,i){return n+(t-n)*Math.exp(-(i-e)/r)}_linearInterpolate(e,t,n,r,i){return t+(r-t)*((i-e)/(n-e))}_exponentialInterpolate(e,t,n,r,i){return t*Math.pow(r/t,(i-e)/(n-e))}}class ToneAudioNode extends ToneWithContext{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return isDefined(this.input)?isAudioParam(this.input)||this.input instanceof Param?1:this.input.numberOfInputs:0}get numberOfOutputs(){return isDefined(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return isDefined(e)&&(e instanceof ToneAudioNode||isAudioNode(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();assert(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return connect(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return warn("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return disconnect(this,e,t,n),this}chain(...e){return connectSeries(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),isDefined(this.input)&&(this.input instanceof ToneAudioNode?this.input.dispose():isAudioNode(this.input)&&this.input.disconnect()),isDefined(this.output)&&(this.output instanceof ToneAudioNode?this.output.dispose():isAudioNode(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function connectSeries(...s){const e=s.shift();s.reduce((t,n)=>(t instanceof ToneAudioNode?t.connect(n):isAudioNode(t)&&connect(t,n),n),e)}function connect(s,e,t=0,n=0){for(assert(isDefined(s),"Cannot connect from undefined node"),assert(isDefined(e),"Cannot connect to undefined node"),(e instanceof ToneAudioNode||isAudioNode(e))&&assert(e.numberOfInputs>0,"Cannot connect to node with no inputs"),assert(s.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof ToneAudioNode||e instanceof Param;)isDefined(e.input)&&(e=e.input);for(;s instanceof ToneAudioNode;)isDefined(s.output)&&(s=s.output);isAudioParam(e)?s.connect(e,t):s.connect(e,t,n)}function disconnect(s,e,t=0,n=0){if(isDefined(e))for(;e instanceof ToneAudioNode;)e=e.input;for(;!isAudioNode(s);)isDefined(s.output)&&(s=s.output);isAudioParam(e)?s.disconnect(e,t):isAudioNode(e)?s.disconnect(e,t,n):s.disconnect()}class Gain extends ToneAudioNode{constructor(){super(optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"]);this.gain=new Param({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),readOnly(this,"gain")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class OneShotSource extends ToneAudioNode{constructor(e){super(e),this.onended=noOp,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Gain({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const n=this.toSeconds(t);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:noOp})}_startGain(e,t=1){assert(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){assert(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==noOp&&(this.onended(this),this.onended=noOp,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),assert(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class ToneConstantSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"]);connect(this._source,this._gainNode),this.offset=new Param({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Signal extends ToneAudioNode{constructor(){super(optionsFromArguments(Signal.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=optionsFromArguments(Signal.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ToneConstantSource({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,r){return this._param.setValueCurveAtTime(e,t,n,r),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function connectSignal(s,e,t,n){(e instanceof Param||isAudioParam(e)||e instanceof Signal&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Signal&&(e.overridden=!0)),connect(s,e,t,n)}class TickParam extends Param{constructor(){super(optionsFromArguments(TickParam.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Timeline(1/0),this._multiplier=1;const e=optionsFromArguments(TickParam.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Param.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const r=this._fromType(e),i=this._events.get(t),o=Math.round(Math.max(1/n,1));for(let a=0;a<=o;a++){const c=n*a+t,l=this._exponentialApproach(i.time,i.value,r,n,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const r=this._events.get(n),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const r=this._events.get(n),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),r=this._events.get(t),i=Math.round(Math.max((t-r.time)*10,1)),o=(t-r.time)/i;for(let a=0;a<=i;a++){const c=o*a+r.time,l=this._exponentialInterpolate(r.time,r.value,t,n,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(isUndef(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let r=this._fromType(this.getValueAtTime(t));const i=this._events.get(t);return i&&i.time===t&&i.type==="setValueAtTime"&&(r=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+r)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),r=this.getTicksAtTime(t);return this.getTimeOfTick(r+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type==="linearRampToValueAtTime"&&t.value!==n.value){const r=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(n.time))-r)/(n.time-t.time),a=Math.sqrt(Math.pow(r,2)-2*o*(t.ticks-e)),c=(-r+a)/o,l=(-r-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),r=this.toSeconds(e),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+r)-i}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class TickSignal extends Signal{constructor(){super(optionsFromArguments(TickSignal.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=optionsFromArguments(TickSignal.getDefaults(),arguments,["value"]);this.input=this._param=new TickParam({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Signal.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class TickSource extends ToneWithContext{constructor(){super(optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new StateTimeline,this._tickOffset=new Timeline;const e=optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"]);this.frequency=new TickSignal({context:this.context,units:e.units,value:e.frequency}),readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ToneWithContext.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),isDefined(t)&&this.setTicksAtTime(t,n)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),r={state:"paused",time:t};this._state.add(r);let i=n,o=0;return this._state.forEachBetween(n.time,t+this.sampleTime,a=>{let c=i.time;const l=this._tickOffset.get(a.time);l&&l.time>=i.time&&(o=l.ticks,c=l.time),i.state==="started"&&a.state!=="started"&&(o+=this.frequency.getTicksAtTime(a.time)-this.frequency.getTicksAtTime(c)),i=a}),this._state.remove(r),o}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let r=t,i=0;return this._state.forEachBetween(t.time,e+this.sampleTime,o=>{let a=r.time;const c=this._tickOffset.get(o.time);c&&c.time>=r.time&&(i=c.seconds,a=c.time),r.state==="started"&&o.state!=="started"&&(i+=o.time-a),r=o}),this._state.remove(n),i}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),r=this._state.get(t),i=Math.max(n.time,r.time),o=this.frequency.getTicksAtTime(i)+e-n.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,n){let r=this._state.get(e);this._state.forEachBetween(e,t,o=>{r&&r.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(r.time,e),o.time-this.sampleTime,n),r=o});let i=null;if(r&&r.state==="started"){const o=Math.max(r.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(r.time),l=a-c;let u=Math.ceil(l)-l;u=EQ(u,1)?0:u;let p=this.frequency.getTimeOfTick(a+u);for(;p<t;){try{n(p,Math.round(this.getTicksAtTime(p)))}catch(g){i=g;break}p+=this.frequency.getDurationOfTicks(1,p)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Clock extends ToneWithContext{constructor(){super(optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=noOp,this._lastUpdate=0,this._state=new StateTimeline("stopped"),this._boundLoop=this._loop.bind(this);const e=optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new TickSource({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{callback:noOp,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){assertContextRunning(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),r=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(r+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":const r=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,r);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,t,(n,r)=>{this.callback(n,r)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Emitter.mixin(Clock);class ToneAudioBuffers extends Tone{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=optionsFromArguments(ToneAudioBuffers.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:noOp,onload:noOp,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return assert(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=noOp,r=noOp){return isString(t)?this._buffers.set(e.toString(),new ToneAudioBuffer(this.baseUrl+t,n,r)):this._buffers.set(e.toString(),new ToneAudioBuffer(t,n,r)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class TicksClass extends TransportTimeClass{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Draw extends ToneWithContext{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Timeline,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}onContextInit(s=>{s.draw=new Draw({context:s})});onContextClose(s=>{s.draw.dispose()});class IntervalTimeline extends Tone{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){assert(isDefined(e.time),"Events must have a time property"),assert(isDefined(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new IntervalNode(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let n,r=null;if(t>0)if(e.left.right===null)n=e.left,n.right=e.right,r=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,r=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,r=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,r=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),r&&this._rebalance(r)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),r=e.right;r&&(e.right=r.left,r.left=e),t!==null?n?t.left=r:t.right=r:this._setRoot(r)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),r=e.left;r&&(e.left=r.right,r.right=e),t!==null?n?t.left=r:t.right=r:this._setRoot(r)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let r=1;r<t.length;r++)t[r].low>n.low&&(n=t[r]);return n.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(r=>{r.event&&t(r.event)})}return this}forEachFrom(e,t){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(r=>{r.event&&t(r.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class IntervalNode{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Volume extends ToneAudioNode{constructor(){super(optionsFromArguments(Volume.getDefaults(),arguments,["volume"])),this.name="Volume";const e=optionsFromArguments(Volume.getDefaults(),arguments,["volume"]);this.input=this.output=new Gain({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,readOnly(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Destination extends ToneAudioNode{constructor(){super(optionsFromArguments(Destination.getDefaults(),arguments)),this.name="Destination",this.input=new Volume({context:this.context}),this.output=new Gain({context:this.context}),this.volume=this.input.volume;const e=optionsFromArguments(Destination.getDefaults(),arguments);connectSeries(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),connectSeries(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}onContextInit(s=>{s.destination=new Destination({context:s})});onContextClose(s=>{s.destination.dispose()});class TimelineValue extends Tone{constructor(e){super(),this.name="TimelineValue",this._timeline=new Timeline({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class TransportEvent{constructor(e,t){this.id=TransportEvent._eventId++;const n=Object.assign(TransportEvent.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:noOp,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}TransportEvent._eventId=0;class TransportRepeatEvent extends TransportEvent{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(TransportRepeatEvent.getDefaults(),t);this.duration=new TicksClass(e.context,n.duration).valueOf(),this._interval=new TicksClass(e.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},TransportEvent.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Transport extends ToneWithContext{constructor(){super(optionsFromArguments(Transport.getDefaults(),arguments)),this.name="Transport",this._loop=new TimelineValue(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Timeline,this._repeatedEvents=new IntervalTimeline,this._syncedSignals=[],this._swingAmount=0;const e=optionsFromArguments(Transport.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Clock({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),readOnly(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const n=t%(this._swingTicks*2)/(this._swingTicks*2),r=Math.sin(n*Math.PI)*this._swingAmount;e+=new TicksClass(this.context,this._swingTicks*2/3).toSeconds()*r}this._timeline.forEachAtTime(t,n=>n.invoke(e))}schedule(e,t){const n=new TransportEvent(this,{callback:e,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,r=1/0){const i=new TransportRepeatEvent(this,{callback:e,duration:new TimeClass(this.context,r).toTicks(),interval:new TimeClass(this.context,t).toTicks(),time:new TransportTimeClass(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(e,t){const n=new TransportEvent(this,{callback:e,once:!0,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new TicksClass(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return isDefined(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){isArray(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new TimeClass(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new TimeClass(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new TicksClass(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new TicksClass(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(t),r=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t),i=t+r;this.emit("stop",i),this._clock.setTicksAtTime(e,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),n=this.getTicksAtTime(t),r=e-n%e;return this._clock.nextTickTime(r,t)}}syncSignal(e,t){if(!t){const r=this.now();if(e.getValueAtTime(r)!==0){const o=1/(60/this.bpm.getValueAtTime(r)/this.PPQ);t=e.getValueAtTime(r)/o}else t=0}const n=new Gain(t);return this.bpm.connect(n),n.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:n,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),writable(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Emitter.mixin(Transport);onContextInit(s=>{s.transport=new Transport({context:s})});onContextClose(s=>{s.transport.dispose()});class Source extends ToneAudioNode{constructor(e){super(e),this.input=void 0,this._state=new StateTimeline("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=noOp,this._syncedStop=noOp,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Volume({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,onstop:noOp,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let r=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(r=this._clampToCurrentTime(r),!this._synced&&this._state.getValueAtTime(r)==="started")assert(GT(r,this._state.get(r).time),"Start time must be strictly greater than previous start time"),this._state.cancel(r),this._state.setStateAtTime("started",r),this.log("restart",r),this.restart(r,t,n);else if(this.log("start",r),this._state.setStateAtTime("started",r),this._synced){const i=this._state.get(r);i&&(i.offset=this.toSeconds(defaultArg(t,0)),i.duration=n?this.toSeconds(n):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,n)},r);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>r&&this._syncedStart(this.now(),this.context.transport.seconds)}else assertContextRunning(this.context),this._start(r,t,n);return this}stop(e){let t=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||isDefined(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const n=this._state.get(t);if(n&&n.state==="started"&&n.time!==t){const r=t-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-r),this._start(e,this.toSeconds(n.offset)+r,i)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=noOp,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ToneBufferSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"]);connect(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Param({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ToneAudioBuffer(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{url:new ToneAudioBuffer,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,r=1){assert(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(e);this._startGain(i,r),this.loop?t=defaultArg(t,this.loopStart):t=defaultArg(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;GTE(o,a)&&(o=(o-c)%l+c),EQ(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,LT(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),isDefined(n)){let a=this.toSeconds(n);a=Math.max(a,0),this.stop(i+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function generateWaveform(s,e){return __awaiter(this,void 0,void 0,function*(){const t=e/s.context.sampleRate,n=new OfflineContext(1,t,s.context.sampleRate);return new s.constructor(Object.assign(s.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class ToneOscillatorNode extends OneShotSource{constructor(){super(optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"]);connect(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Param({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Param({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Oscillator extends Source{constructor(){super(optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),readOnly(this,"frequency"),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new ToneOscillatorNode({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Oscillator._periodicWaveCache.find(t=>t.phase===this._phase&&deepEquals(t.partials,this._partials));{const e=Oscillator._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(isDefined(n)){const{partials:r,wave:i}=n;this._wave=i,this._partials=r,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[r,i]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(r,i);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Oscillator._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:r,type:this._type,wave:this._wave}),Oscillator._periodicWaveCache.length>100&&Oscillator._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){assertRange(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const r=new Float32Array(e);this._partials.forEach((i,o)=>r[o]=i),this._partials=Array.from(r),this.type=this._type}}_getRealImaginary(e,t){let r=2048;const i=new Float32Array(r),o=new Float32Array(r);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,r=a,this._partials.length===0)return[i,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),r=a):this._partialCount=0,this._partials=[]}for(let c=1;c<r;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(i[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(i[c]=0,o[c]=0)}return[i,o]}_inverseFFT(e,t,n){let r=0;const i=e.length;for(let o=0;o<i;o++)r+=e[o]*Math.cos(o*n)+t[o]*Math.sin(o*n);return r}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const r=Math.PI*2,i=32;for(let o=0;o<i;o++)n=Math.max(this._inverseFFT(e,t,o/i*r),n);return clamp(-this._inverseFFT(e,t,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Oscillator._periodicWaveCache=[];class SignalOperator extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(SignalOperator.getDefaults(),arguments,["context"])))}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}}class WaveShaper extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]);isArray(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):isFunction(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Signal.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let r=0,i=t;r<i;r++){const o=r/(i-1)*2-1;n[r]=e(o,r)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(n=>n.includes(e));assert(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class AudioToGain extends SignalOperator{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new WaveShaper({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Multiply extends Signal{constructor(){super(Object.assign(optionsFromArguments(Multiply.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=optionsFromArguments(Multiply.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Gain({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Signal.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class AMOscillator extends Source{constructor(){super(optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new AudioToGain({context:this.context}),this._modulationNode=new Gain({context:this.context});const e=optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),readOnly(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class FMOscillator extends Source{constructor(){super(optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Gain({context:this.context,gain:0});const e=optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Multiply({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),readOnly(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class PulseOscillator extends Source{constructor(){super(optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Gain({context:this.context,gain:0}),this._thresh=new WaveShaper({context:this.context,mapping:t=>t<=0?-1:1});const e=optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"]);this.width=new Signal({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),readOnly(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class FatOscillator extends Source{constructor(){super(optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach((r,i)=>r.detune.value=t+n*i)}}get count(){return this._oscillators.length}set count(e){if(assertRange(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const n=new Oscillator({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):noOp});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class PWMOscillator extends Source{constructor(){super(optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Multiply({context:this.context,value:2});const e=optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new PulseOscillator({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),readOnly(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const OmniOscillatorSourceMap={am:AMOscillator,fat:FatOscillator,fm:FMOscillator,oscillator:Oscillator,pulse:PulseOscillator,pwm:PWMOscillator};class OmniOscillator extends Source{constructor(){super(optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Oscillator.getDefaults(),FMOscillator.getDefaults(),AMOscillator.getDefaults(),FatOscillator.getDefaults(),PulseOscillator.getDefaults(),PWMOscillator.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=OmniOscillatorSourceMap[e],n=this.now();if(this._oscillator){const r=this._oscillator;r.stop(n),this.context.setTimeout(()=>r.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof OmniOscillatorSourceMap[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&isString(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function range(s,e=1/0){const t=new WeakMap;return function(n,r){Reflect.defineProperty(n,r,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){assertRange(i,s,e),t.set(this,i)}})}}function timeRange(s,e=1/0){const t=new WeakMap;return function(n,r){Reflect.defineProperty(n,r,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){assertRange(this.toSeconds(i),s,e),t.set(this,i)}})}}class Player extends Source{constructor(){super(optionsFromArguments(Player.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=optionsFromArguments(Player.getDefaults(),arguments,["url","onload"]);this._buffer=new ToneAudioBuffer({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1,reverse:!1})}load(e){return __awaiter(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=noOp){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){this._loop?t=defaultArg(t,this._loopStart):t=defaultArg(t,0);const r=this.toSeconds(t),i=n;n=defaultArg(n,Math.max(this._buffer.duration-r,0));let o=this.toSeconds(n);o=o/this._playbackRate,e=this.toSeconds(e);const a=new ToneBufferSource({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&isUndef(i)?a.start(e,r):a.start(e,r,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){this._stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="started"){const r=this.toSeconds(e);this._stop(n),this._start(n,r)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(r=>r.cancelStop())),this._activeSources.forEach(r=>{r.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}__decorate([timeRange(0)],Player.prototype,"fadeIn",void 0);__decorate([timeRange(0)],Player.prototype,"fadeOut",void 0);class Envelope extends ToneAudioNode{constructor(){super(optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Signal({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(isString(e))return e;{let n;for(n in EnvelopeCurves)if(EnvelopeCurves[n][t]===e)return n;return e}}_setCurve(e,t,n){if(isString(n)&&Reflect.has(EnvelopeCurves,n)){const r=EnvelopeCurves[n];isObject(r)?e!=="_decayCurve"&&(this[e]=r[t]):this[e]=r}else if(isArray(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){assert(["linear","exponential"].some(t=>t===e),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let r=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/r;r=(1-o)/a}if(r<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,r,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,r,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,r,t)}if(i&&this.sustain<1){const a=t*this.sustain,c=e+r;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,i+c):this._sig.exponentialApproachValueAtTime(a,c,i)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(assert(isArray(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,n=new OfflineContext(1,t,this.context.sampleRate),r=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=r+this.toSeconds(this.release),o=i*.1,a=i+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:n}));return c._sig.toDestination(),c.triggerAttackRelease(t*(r+o)/a,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}__decorate([timeRange(0)],Envelope.prototype,"attack",void 0);__decorate([timeRange(0)],Envelope.prototype,"decay",void 0);__decorate([range(0,1)],Envelope.prototype,"sustain",void 0);__decorate([timeRange(0)],Envelope.prototype,"release",void 0);const EnvelopeCurves=(()=>{let e,t;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/(128-1)*(Math.PI/2));const r=[],i=6.4;for(e=0;e<128-1;e++){t=e/(128-1);const g=Math.sin(t*(Math.PI*2)*i-Math.PI/2)+1;r[e]=g/10+t*.83}r[128-1]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/(128-1)*a)/a;const c=[];for(e=0;e<128;e++)t=e/(128-1),c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/(128-1);const g=Math.pow(t,3)*4+.2,y=Math.cos(g*Math.PI*2*t);l[e]=Math.abs(y*(1-t))}function u(g){const y=new Array(g.length);for(let h=0;h<g.length;h++)y[h]=1-g[h];return y}function p(g){return g.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:n,Out:p(n)},exponential:"exponential",linear:"linear",ripple:{In:r,Out:u(r)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class Instrument extends ToneAudioNode{constructor(){super(optionsFromArguments(Instrument.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=optionsFromArguments(Instrument.getDefaults(),arguments);this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...r)=>{const i=r[t],o=this.context.transport.schedule(a=>{r[t]=a,n.apply(this,r)},i);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,n,r){const i=this.toSeconds(n),o=this.toSeconds(t);return this.triggerAttack(e,i,r),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Monophonic extends Instrument{constructor(){super(optionsFromArguments(Monophonic.getDefaults(),arguments));const e=optionsFromArguments(Monophonic.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Instrument.getDefaults(),{detune:0,onsilence:noOp,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const r=this.toSeconds(t);return this._triggerEnvelopeAttack(r,n),this.setNote(e,r),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),r=e instanceof FrequencyClass?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,i,n)}else this.frequency.setValueAtTime(r,n);return this}}__decorate([timeRange(0)],Monophonic.prototype,"portamento",void 0);class AmplitudeEnvelope extends Envelope{constructor(){super(optionsFromArguments(AmplitudeEnvelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Gain({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Synth extends Monophonic{constructor(){super(optionsFromArguments(Synth.getDefaults(),arguments)),this.name="Synth";const e=optionsFromArguments(Synth.getDefaults(),arguments);this.oscillator=new OmniOscillator(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new AmplitudeEnvelope(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),readOnly(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Monophonic.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(omitFromObject(OmniOscillator.getDefaults(),[...Object.keys(Source.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+r)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class MembraneSynth extends Synth{constructor(){super(optionsFromArguments(MembraneSynth.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=optionsFromArguments(MembraneSynth.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,readOnly(this,["oscillator","envelope"])}static getDefaults(){return deepMerge(Monophonic.getDefaults(),Synth.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),r=this.toFrequency(e instanceof FrequencyClass?e.toFrequency():e),i=r*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(r,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}__decorate([range(0)],MembraneSynth.prototype,"octaves",void 0);__decorate([timeRange(0)],MembraneSynth.prototype,"pitchDecay",void 0);const workletContext=new Set;function addToWorklet(s){workletContext.add(s)}function registerProcessor(s,e){const t=`registerProcessor("${s}", ${e})`;workletContext.add(t)}const toneAudioWorkletProcessor=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;addToWorklet(toneAudioWorkletProcessor);const singleIOProcess=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;addToWorklet(singleIOProcess);const delayLine=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;addToWorklet(delayLine);const workletName$1="feedback-comb-filter",feedbackCombFilter=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;registerProcessor(workletName$1,feedbackCombFilter);class Sampler extends Instrument{constructor(){super(optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(n=>{const r=parseInt(n,10);if(assert(isNote(n)||isNumber(r)&&isFinite(r),`url key is neither a note or midi pitch: ${n}`),isNote(n)){const i=new FrequencyClass(this.context,n).toMidi();t[i]=e.urls[n]}else isNumber(r)&&isFinite(r)&&(t[r]=e.urls[r])}),this._buffers=new ToneAudioBuffers({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:noOp,onerror:noOp,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=ftomf(new FrequencyClass(this.context,r).toFrequency()),o=Math.round(i),a=i-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),p=intervalToFrequencyRatio(c+a),g=new ToneBufferSource({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:p}).connect(this.output);g.start(t,0,u.duration/p,n),isArray(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(g),g.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const y=this._activeSources.get(o),h=y.indexOf(g);h!==-1&&y.splice(h,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{const r=new FrequencyClass(this.context,n).toMidi();if(this._activeSources.has(r)&&this._activeSources.get(r).length){const i=this._activeSources.get(r);t=this.toSeconds(t),i.forEach(o=>{o.stop(t)}),this._activeSources.set(r,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,r=1){const i=this.toSeconds(n);return this.triggerAttack(e,i,r),isArray(t)?(assert(isArray(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,i+this.toSeconds(c))})):this.triggerRelease(e,i+this.toSeconds(t)),this}add(e,t,n){if(assert(isNote(e)||isFinite(e),`note must be a pitch or midi: ${e}`),isNote(e)){const r=new FrequencyClass(this.context,e).toMidi();this._buffers.add(r,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}__decorate([timeRange(0)],Sampler.prototype,"attack",void 0);__decorate([timeRange(0)],Sampler.prototype,"release",void 0);class Panner extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(Panner.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=optionsFromArguments(Panner.getDefaults(),arguments,["pan"]);this.pan=new Param({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",readOnly(this,"pan")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const workletName="bit-crusher",bitCrusherWorklet=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;registerProcessor(workletName,bitCrusherWorklet);class Solo extends ToneAudioNode{constructor(){super(optionsFromArguments(Solo.getDefaults(),arguments,["solo"])),this.name="Solo";const e=optionsFromArguments(Solo.getDefaults(),arguments,["solo"]);this.input=this.output=new Gain({context:this.context}),Solo._allSolos.has(this.context)||Solo._allSolos.set(this.context,new Set),Solo._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Solo._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Solo._soloed.has(this.context)||Solo._soloed.set(this.context,new Set),Solo._soloed.get(this.context).add(this)}_removeSolo(){Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).delete(this)}_isSoloed(){return Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).has(this)}_noSolos(){return!Solo._soloed.has(this.context)||Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Solo._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Solo._allSolos=new Map;Solo._soloed=new Map;class PanVol extends ToneAudioNode{constructor(){super(optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Panner({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Channel extends ToneAudioNode{constructor(){super(optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Solo({solo:e.solo,context:this.context}),this._panVol=this.output=new PanVol({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Channel.buses.has(e)||Channel.buses.set(e,new Gain({context:this.context})),Channel.buses.get(e)}send(e,t=0){const n=this._getBus(e),r=new Gain({context:this.context,units:"decibels",gain:t});return this.connect(r),r.connect(n),r}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Channel.buses=new Map;class Listener extends ToneAudioNode{constructor(){super(...arguments),this.name="Listener",this.positionX=new Param({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Param({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Param({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Param({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Param({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Param({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Param({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Param({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Param({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}onContextInit(s=>{s.listener=new Listener({context:s})});onContextClose(s=>{s.listener.dispose()});getContext().transport;getContext().destination;getContext().destination;getContext().listener;getContext().draw;const context=getContext();function loaded(){return ToneAudioBuffer.loaded()}const notes_to_load=["A2","C3","A3","C4","A4","C5"],notes_loaded=Object.fromEntries(notes_to_load.map(s=>[s,!1])),sampler=new Sampler().toDestination();context.lookAhead=.05;for(const s of notes_to_load)fetch(`/acchymns-pr-PR_kwDOHpETuc5yaKFf/assets/notes/${s}.mp3`).then(async e=>{const t=URL.createObjectURL(await e.blob());sampler.add(s,t),notes_loaded[s]=!0});const interval=useLocalStorage("ACCOptions.playbackInterval",.25),duration=useLocalStorage("ACCOptions.playbackDuration",2.5),staggered=useLocalStorage("ACCOptions.staggered",!0),isPlaying=ref(!1),timeouts=[],player={async play(s){if(isPlaying.value)return;if(isPlaying.value=!0,await start(),!Object.values(notes_loaded).every(n=>n)){console.log("Not all notes have been loaded!");return}if(!sampler.loaded){console.log("Sampler hasn't loaded!");return}console.log("attempting to start notes"),console.log(...unref(s)),await loaded();let e,t=0;if(staggered.value){for(const[n,r]of unref(s).entries()){const i=setTimeout(()=>{sampler.triggerAttack(r)},interval.value*n*1e3);timeouts.push(i),t++}e=duration.value+interval.value*unref(s).length}else sampler.triggerAttack(unref(s)),e=duration.value;timeouts[t]=setTimeout(()=>{sampler.releaseAll(),isPlaying.value=!1},e*1e3)},stop(){for(const s of timeouts)clearTimeout(s);sampler.releaseAll(),isPlaying.value=!1}};function useNotes(){return{player,isPlaying}}const _hoisted_1={class:"menu"},_hoisted_2={class:"title"},_hoisted_3={class:"title--left"},_hoisted_4={class:"title--center"},_hoisted_5={class:"title--right"},_hoisted_6={key:1,class:"ionicon",src:_imports_2$1},_hoisted_7=createBaseVNode("p",{class:"tooltiptext"},"New! Starting Notes",-1),_hoisted_8=[_hoisted_7],_hoisted_9={key:0,class:"broadcast-button-container"},_hoisted_10={class:"broadcast-button"},_hoisted_11=createBaseVNode("h1",null,"Broadcast",-1),_hoisted_12=createBaseVNode("br",null,null,-1),_hoisted_13=createBaseVNode("h3",null,"Verses",-1),_hoisted_14=createBaseVNode("br",null,null,-1),_hoisted_15={class:"verse-list"},_hoisted_16=["onClick"],_hoisted_17={class:"w-100",style:{height:"100vh"}},_sfc_main=defineComponent({__name:"SongDisplayView",props:{book:{},number:{}},setup(s){const e=s,t=useRouter(),{player:n,isPlaying:r}=useNotes(),i=ref([]),o=ref(),a=useCapacitorPreferences("bookmarks",[]),c=useCapacitorPreferences("broadcasting_auth_token","");let l=ref(""),u=ref(!1),p=ref(!1),g=ref([]);ref("");const y=computed(()=>a.value.findIndex(m=>m.book==e.book&&m.number==e.number)!=-1);async function h(){if(!y.value)a.value.push(e),await Toast.show({text:`#${e.number} added to Bookmarks`});else{const m=a.value.findIndex(b=>b.book==e.book&&b.number==e.number);a.value.splice(m,1),await Toast.show({text:`#${e.number} removed from Bookmarks`})}}onMounted(async()=>{var T;const m=await getSongMetaData(e.book);m!=null&&(i.value=(((T=m[e.number])==null?void 0:T.notes)??[]).reverse());const b=await getAllBookMetaData();o.value=b[e.book];let k=await validate_token(c.value);u.value=k.status==200,l.value=k.data.church_id}),onUnmounted(()=>{n.stop()});let f=useLocalStorage("starting_notes_tooltip_complete",!1),d=ref();function v(m){var k;p.value=!0;let b=(k=m.target.parentElement)==null?void 0:k.parentElement;b==null||b.style.setProperty("opacity","0")}async function E(m){var b,k;l.value!=null&&(await set(request_client(),l.value,e.number,((b=o.value)==null?void 0:b.name.medium)||e.book,g.value,((k=o.value)==null?void 0:k.primaryColor)||"#000000"),m.target.parentElement,p.value=!1)}function O(){n.play(i),N()}function N(){var m,b;(m=d.value)==null||m.classList.add("tooltiphidden"),(b=d.value)==null||b.classList.add("tooltip"),setTimeout(()=>{f.value=!0},1e3)}return(m,b)=>{var k;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("img",{onClick:b[0]||(b[0]=T=>unref(t).back()),class:"ionicon",src:_imports_0$1})]),createBaseVNode("div",_hoisted_4,[createBaseVNode("h1",null,"#"+toDisplayString(e.number),1)]),createBaseVNode("div",_hoisted_5,[i.value.length!=0?(openBlock(),createElementBlock(Fragment,{key:0},[unref(r)?(openBlock(),createElementBlock("img",_hoisted_6)):(openBlock(),createElementBlock("img",{key:0,onClick:O,class:"ionicon",src:_imports_1})),unref(f)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",{key:2,class:"tooltip",ref_key:"tooltip",ref:d,onClick:b[1]||(b[1]=T=>N())},_hoisted_8,512))],64)):createCommentVNode("",!0),y.value?(openBlock(),createElementBlock("img",{key:1,onClick:b[2]||(b[2]=T=>h()),class:"ionicon",src:_imports_3})):(openBlock(),createElementBlock("img",{key:2,onClick:b[3]||(b[3]=T=>h()),class:"ionicon",src:_imports_2}))])])]),unref(u)?(openBlock(),createElementBlock("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[createBaseVNode("img",{onClick:b[4]||(b[4]=T=>v(T)),class:"ionicon",src:_imports_5})])])):createCommentVNode("",!0),unref(u)&&unref(p)?(openBlock(),createElementBlock("div",{key:1,class:"broadcast-container",onTouchmove:b[7]||(b[7]=T=>T.preventDefault())},[_hoisted_11,createBaseVNode("h3",null,toDisplayString(((k=o.value)==null?void 0:k.name.medium)||e.book)+" - #"+toDisplayString(e.number),1),_hoisted_12,_hoisted_13,createBaseVNode("a",{class:normalizeClass(["verse",{"verse-selected":unref(g)[0]==-2}]),onClick:b[5]||(b[5]=T=>{isRef(g)?g.value=[]:g=[],unref(g).push(-2)})}," All ",2),_hoisted_14,createBaseVNode("div",_hoisted_15,[(openBlock(),createElementBlock(Fragment,null,renderList(12,T=>createBaseVNode("a",{key:T,class:normalizeClass(["verse",{"verse-selected":unref(g).includes(T)}]),onClick:S=>{unref(g)[0]==-2&&(isRef(g)?g.value=[]:g=[]),unref(g).includes(T)?unref(g).splice(unref(g).indexOf(T),1):unref(g).push(T)}},toDisplayString(T),11,_hoisted_16)),64))]),createBaseVNode("button",{class:"send-button",onClick:b[6]||(b[6]=T=>E(T))},"Send")],32)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_17,[createVNode(SongContainer,{book:e.book,number:e.number},null,8,["book","number"])])],64)}}}),SongDisplayView_vue_vue_type_style_index_0_lang="";export{_sfc_main as default};
